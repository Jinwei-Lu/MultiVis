[
    {
        "type": "type_A",
        "db_id": "activity_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "calculate_residuals",
        "NLQ": "Can you create a scatter plot showing how each activity's average student age differs from the overall average? Put activity names on the x-axis and the age difference in years on the y-axis. Title it \"Difference in Average Age by Activity\" and color-code the points using a red-blue scheme where red shows activities with younger-than-average students and blue shows older-than-average students.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/activity_1.sqlite')\n\nquery = '''\nSELECT \n    A.activity_name,\n    AVG(S.Age) AS Avg_Age\nFROM \n    Activity AS A\nJOIN \n    Participates_in AS P ON A.actid = P.actid\nJOIN \n    Student AS S ON P.stuid = S.StuID\nGROUP BY \n    A.actid, A.activity_name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\noverall_avg_age = df['Avg_Age'].mean()\n\nchart = (\n    alt.Chart(df)\n    .mark_point()\n    .transform_calculate(\n        Age_Delta=\"datum.Avg_Age - \" + str(overall_avg_age)\n    )\n    .encode(\n        x=alt.X(\"activity_name:N\").title(\"Activity Name\"),\n        y=alt.Y(\"Age_Delta:Q\").title(\"Age Delta (Years)\"),\n        color=alt.Color(\"Age_Delta:Q\")\n        .title(\"Age Delta\")\n        .scale(domainMid=0, scheme=\"redblue\"),\n    )\n    .properties(title=\"Difference in Average Age by Activity\")\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "activity_1",
        "chart_category": "Interactive Charts",
        "chart_type": "simple_interactive_colored_scatter_plot",
        "NLQ": "Can you create an interactive scatter plot showing the relationship between students' ages and how many activities they participate in? I'd like to see each student represented as a circle, with different colors for each major so I can spot any patterns across different fields of study.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/activity_1.sqlite')\n\nquery = '''\nSELECT \n    S.Age, \n    COUNT(P.actid) AS ActivityCount, \n    S.Major\nFROM \n    Student AS S\nLEFT JOIN \n    Participates_in AS P ON S.StuID = P.stuid\nGROUP BY \n    S.StuID, S.Age, S.Major\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    x='Age:Q',\n    y='ActivityCount:Q',\n    color='Major:N'\n).interactive()\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "activity_1",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "simple_scatter_plot_with_errorbars",
        "NLQ": "Can you create a chart showing the average age of students participating in each activity? I'd like to see the average age as black dots and also display the full age range from minimum to maximum for each activity using error bars. Don't sort the activities in any particular order, and label the y-axis as \"Average Age of Participants\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/activity_1.sqlite')\nquery = '''\nSELECT\n    A.activity_name,\n    AVG(S.Age) AS average_age,\n    MIN(S.Age) AS min_age,\n    MAX(S.Age) AS max_age\nFROM\n    Participates_in AS P\nJOIN\n    Student AS S ON P.stuid = S.StuID\nJOIN\n    Activity AS A ON P.actid = A.actid\nGROUP BY\n    A.activity_name;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).transform_calculate(\n    ymin=\"datum.min_age\",\n    ymax=\"datum.max_age\"\n)\n\npoints = base.mark_point(\n    filled=True,\n    size=50,\n    color='black'\n).encode(\n    alt.X('activity_name', sort=None),\n    alt.Y('average_age', title='Average Age of Participants')\n)\n\nerrorbars = base.mark_errorbar().encode(\n    x=\"activity_name\",\n    y=\"ymin:Q\",\n    y2=\"ymax:Q\"\n)\n\nchart = points + errorbars\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "aircraft",
        "chart_category": "Advanced Calculations",
        "chart_type": "calculate_residuals",
        "NLQ": "Can you create a scatter plot showing how each aircraft's weight differs from the average weight, plotted against their total disk area? I'd like to see the weight residuals on the y-axis and total disk area in square feet on the x-axis. Color the points based on whether they're above or below average weight, and include aircraft name, maximum gross weight, and disk area information when I hover over points. Title it \"Aircraft Weight Residuals vs. Total Disk Area\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\n\nquery = '''\nSELECT \n    Aircraft, \n    CAST(REPLACE(Max_Gross_Weight, ',', '') AS REAL) AS Max_Gross_Weight,\n    CAST(REPLACE(Total_disk_area, ' ftÂ²', '') AS REAL) AS Total_Disk_Area\nFROM \n    aircraft\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = (\n    alt.Chart(df)\n    .mark_point()\n    .transform_joinaggregate(Average_Weight=\"mean(Max_Gross_Weight)\")\n    .transform_calculate(Weight_Residual=\"datum.Max_Gross_Weight - datum.Average_Weight\")\n    .encode(\n        x=alt.X(\"Total_Disk_Area:Q\").title(\"Total Disk Area (sq ft)\"),\n        y=alt.Y(\"Weight_Residual:Q\").title(\"Weight Residual (lbs)\"),\n        color=alt.Color(\"Weight_Residual:Q\").title(\"Weight Residual\").scale(domainMid=0),\n        tooltip=[\"Aircraft:N\", \"Max_Gross_Weight:Q\", \"Total_Disk_Area:Q\"]\n    )\n    .properties(title=\"Aircraft Weight Residuals vs. Total Disk Area\")\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "aircraft",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart",
        "NLQ": "Can you create a bar chart showing the total number of passengers for each airport, with the bars split into international and domestic passengers? I'd like to see the airport names along the x-axis, the passenger counts on the y-axis, and different colors to distinguish between international and domestic travelers.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\n\nquery = '''\nSELECT \n    Airport_Name,\n    International_Passengers AS Passengers,\n    'International' AS Passenger_Type\nFROM \n    airport\nUNION ALL\nSELECT \n    Airport_Name,\n    Domestic_Passengers AS Passengers,\n    'Domestic' AS Passenger_Type\nFROM \n    airport\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Airport_Name:N',\n    y='sum(Passengers):Q',\n    color='Passenger_Type:N'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "aircraft",
        "chart_category": "Interactive Charts",
        "chart_type": "slider_cutoff",
        "NLQ": "Can you create a horizontal bar chart showing airports ranked by their total passenger numbers? I'd like the airports with the highest passenger counts at the top. Also, add an interactive slider that lets me set a passenger count threshold - airports below this threshold should be colored blue, and those above it should be red. The slider should start at the median passenger count value.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\n\nquery = '''\nSELECT Airport_Name, Total_Passengers\nFROM airport\nORDER BY Total_Passengers DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nslider = alt.binding_range(min=0, max=int(df['Total_Passengers'].max()), step=100000)\ncutoff = alt.param(bind=slider, value=int(df['Total_Passengers'].median()))\npredicate = alt.datum.Total_Passengers < cutoff\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Total_Passengers:Q',\n    y=alt.Y('Airport_Name:N', sort='-x'),\n    color=alt.when(predicate).then(alt.value(\"blue\")).otherwise(alt.value(\"red\")),\n).add_params(\n    cutoff\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "aircraft",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "simple_scatter_plot_with_errorbars",
        "NLQ": "Can you create a scatter plot showing the relationship between total disk area in square feet and maximum gross weight in pounds for aircraft? I'd like to see error bars around the weight values showing about 10% margin of error. Please use black dots for the data points and don't start the y-axis at zero.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\n\nquery = '''\nSELECT \n    CAST(REPLACE(Max_Gross_Weight, ',', '') AS REAL) AS Max_Gross_Weight,\n    CAST(REPLACE(Total_disk_area, ',', '') AS REAL) AS Total_Disk_Area\nFROM \n    aircraft\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['yerr'] = df['Max_Gross_Weight'] * 0.1\n\nbase = alt.Chart(df).transform_calculate(\n    ymin=\"datum.Max_Gross_Weight - datum.yerr\",\n    ymax=\"datum.Max_Gross_Weight + datum.yerr\"\n)\n\npoints = base.mark_point(\n    filled=True,\n    size=50,\n    color='black'\n).encode(\n    x=alt.X('Total_Disk_Area:Q', title='Total Disk Area (sq ft)'),\n    y=alt.Y('Max_Gross_Weight:Q', title='Max Gross Weight (lb)', scale=alt.Scale(zero=False))\n)\n\nerrorbars = base.mark_errorbar().encode(\n    x=\"Total_Disk_Area:Q\",\n    y=\"ymin:Q\",\n    y2=\"ymax:Q\"\n)\n\nchart = points + errorbars\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "baseball_1",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "line_chart_with_confidence_interval_band",
        "NLQ": "Can you create a line chart showing the average number of home runs per team for each year, with a 95% confidence interval band to show the variability? Please title it \"Average Team Home Runs per Year with 95% Confidence Interval\" and label the axes as \"Year\" and \"Average Home Runs per Team\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/baseball_1.sqlite')\nquery = '''\nSELECT \n    year, \n    team_id, \n    SUM(hr) AS team_hr\nFROM batting\nWHERE hr IS NOT NULL\nGROUP BY year, team_id;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nline = alt.Chart(df).mark_line().encode(\n    x=alt.X('year:O', title='Year'),\n    y=alt.Y('mean(team_hr):Q', title='Average Home Runs per Team')\n)\n\nband = alt.Chart(df).mark_errorband(extent='ci').encode(\n    x='year:O',\n    y=alt.Y('team_hr:Q')\n)\n\nchart = (band + line).properties(\n    title='Average Team Home Runs per Year with 95% Confidence Interval'\n)\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "browser_web",
        "chart_category": "Advanced Calculations",
        "chart_type": "gantt_chart",
        "NLQ": "Can you create a simple Gantt chart showing web client accelerators? I want to see each accelerator name listed vertically, with horizontal bars representing their timeframes. Each bar should start at the accelerator's ID number and extend for 2 units. Nothing fancy needed - just a basic timeline view of these accelerators.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/browser_web.sqlite')\nquery = '''\nSELECT id, name\nFROM Web_client_accelerator\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['start'] = df['id']\ndf['end'] = df['id'] + 2\ndf = df.rename(columns={'name': 'task'})\nchart = alt.Chart(df).mark_bar().encode(\n    x='start:Q',\n    x2='end:Q',\n    y='task:N'\n)\nchart"
    },
    {
        "type": "type_A",
        "db_id": "candidate_poll",
        "chart_category": "Circular Plots",
        "chart_type": "pacman_chart",
        "NLQ": "Can you create a simple gold-colored Pac-Man shape with its mouth open at the top-right? I want to use this as a visual element, not to represent any specific data values.",
        "code": "import numpy as np\nimport altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/candidate_poll.sqlite')\nquery = '''\nSELECT Support_rate\nFROM candidate\nLIMIT 1\n'''\ndf = pd.read_sql_query(query, conn)\nprint(\"Fetched Support Rate from Database:\", df['Support_rate'].iloc[0])\nconn.close()\n\nchart = alt.Chart().mark_arc(color=\"gold\").encode(\n    theta=alt.ThetaDatum((5 / 8) * np.pi).scale(None),\n    theta2=alt.Theta2Datum((19 / 8) * np.pi),\n    radius=alt.RadiusDatum(100).scale(None),\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "company_employee",
        "chart_category": "Circular Plots",
        "chart_type": "radial_chart",
        "NLQ": "Can you create a radial chart showing the distribution of employees by industry and their graduation college? I'd like to see the employee count represented by both the angle and radius of each segment, with different colors for each industry. Please include tooltips showing the college, industry, and exact employee count when I hover over segments. Add a white border between segments and display the employee count as text labels. Title the chart \"Employee Distribution by Graduation College and Industry\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_employee.sqlite')\n\nquery = '''\nSELECT \n    p.Graduation_College AS College,\n    c.Industry AS Industry,\n    COUNT(*) AS Employee_Count\nFROM \n    employment AS e\nJOIN \n    people AS p ON e.People_ID = p.People_ID\nJOIN \n    company AS c ON e.Company_ID = c.Company_ID\nGROUP BY \n    p.Graduation_College, c.Industry\nORDER BY \n    p.Graduation_College, c.Industry;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"Employee_Count:Q\").stack(True),\n    alt.Radius(\"Employee_Count\").scale(type=\"sqrt\", zero=True, rangeMin=20),\n    color=\"Industry:N\",\n    tooltip=[\"College:N\", \"Industry:N\", \"Employee_Count:Q\"]\n)\n\nc1 = base.mark_arc(innerRadius=20, stroke=\"#fff\")\n\nc2 = base.mark_text(radiusOffset=10).encode(text=\"Employee_Count:Q\")\n\nchart = c1 + c2\n\nchart.properties(title=\"Employee Distribution by Graduation College and Industry\")"
    },
    {
        "type": "type_A",
        "db_id": "concert_singer",
        "chart_category": "Advanced Calculations",
        "chart_type": "layered_chart_with_dual-axis",
        "NLQ": "Can you create a chart comparing stadium capacities and average attendance? I'd like to see the stadium names along the bottom, with green bars showing the capacity and a blue line showing the average attendance. Please use separate scales for capacity and attendance, and color-code the axis titles to match the bars and line.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/concert_singer.sqlite')\n\nquery = '''\nSELECT Name, Capacity, Average\nFROM stadium;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.X('Name:N').title('Stadium Name')\n)\n\nbars = base.mark_bar(color='#57A44C').encode(\n    alt.Y('Capacity:Q').axis(title='Stadium Capacity', titleColor='#57A44C')\n)\n\nline = base.mark_line(color='#5276A7').encode(\n    alt.Y('Average:Q').axis(title='Average Attendance', titleColor='#5276A7')\n)\n\nchart = alt.layer(bars, line).resolve_scale(\n    y='independent'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "cre_Theme_park",
        "chart_category": "Advanced Calculations",
        "chart_type": "ranged_dot_plot",
        "NLQ": "Can you create a scatter plot showing hotel price ranges by star rating, with different colors for hotels that allow pets versus those that don't? I'd like to see a connecting line between the star rating categories, and please use large filled dots for the hotels. Title it \"Hotel Price Ranges by Star Rating and Pet Policy\" and make sure to exclude any hotels that don't have price information or star ratings.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/cre_Theme_park.sqlite')\nquery = '''\nSELECT \n    h.star_rating_code,\n    r.star_rating_description,\n    h.price_range,\n    CASE \n        WHEN h.pets_allowed_yn = '1' THEN 'Pets Allowed'\n        ELSE 'No Pets Allowed'\n    END AS pets_policy\nFROM Hotels AS h\nJOIN Ref_Hotel_Star_Ratings AS r ON h.star_rating_code = r.star_rating_code\nWHERE h.price_range IS NOT NULL AND h.price_range != '' AND h.star_rating_code IS NOT NULL\nORDER BY h.star_rating_code\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = (\n    alt.Chart(df)\n    .encode(\n        x=alt.X(\"price_range:Q\", title=\"Price Range\"),\n        y=alt.Y(\"star_rating_description:N\", title=\"Star Rating\"),\n        color=alt.Color(\"pets_policy:N\", title=\"Pet Policy\"),\n    )\n    .mark_point(size=100, filled=True)\n)\n\nline = (\n    alt.Chart(df)\n    .encode(\n        x=\"price_range:Q\",\n        y=\"star_rating_description:N\",\n        detail=\"star_rating_description:N\",\n    )\n    .mark_line(color=\"#db646f\")\n)\n\nfinal_chart = (line + chart).properties(\n    title=\"Hotel Price Ranges by Star Rating and Pet Policy\"\n)\n\nfinal_chart"
    },
    {
        "type": "type_A",
        "db_id": "cre_Theme_park",
        "chart_category": "Distributions",
        "chart_type": "boxplot_with_minmax_whiskers",
        "NLQ": "Can you create a boxplot showing the distribution of Visit_ID values for each Tourist_ID? Make sure to include the minimum and maximum values in the whiskers.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/cre_Theme_park.sqlite')\nquery = '''\nSELECT CAST(Tourist_ID AS TEXT) AS age, Visit_ID AS people FROM Visits\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_boxplot(extent='min-max').encode(\n    x='age:O',\n    y='people:Q'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "culture_company",
        "chart_category": "Distributions",
        "chart_type": "cumulative_count_chart",
        "NLQ": "Can you create an area chart showing the cumulative count of books in the book club over time? I'd like to see how the total number of books has grown year by year, with years on the x-axis and the running total on the y-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/culture_company.sqlite')\n\nquery = '''\nSELECT Year, COUNT(*) AS Book_Count\nFROM book_club\nGROUP BY Year\nORDER BY Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ncumulative_chart = alt.Chart(df).transform_window(\n    cumulative_count=\"sum(Book_Count)\",\n    sort=[{\"field\": \"Year\"}],\n).mark_area().encode(\n    x=alt.X(\"Year:Q\", title=\"Year\"),\n    y=alt.Y(\"cumulative_count:Q\", title=\"Cumulative Count of Books\").stack(False)\n)\n\ncumulative_chart"
    },
    {
        "type": "type_A",
        "db_id": "customers_and_addresses",
        "chart_category": "Distributions",
        "chart_type": "cumulative_count_chart",
        "NLQ": "Can you create a cumulative area chart showing how orders in each status category have accumulated over time? I'd like to see the order date on the x-axis and the cumulative count on the y-axis, with different colors for each order status. Please title it \"Cumulative Count of Orders by Status Over Time\" and make sure the areas don't stack on top of each other so I can clearly see each status trend.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customers_and_addresses.sqlite')\n\nquery = '''\nSELECT \n    order_status, \n    order_date\nFROM \n    Customer_Orders\nORDER BY \n    order_date ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['order_date'] = pd.to_datetime(df['order_date'])\n\ncumulative_chart = alt.Chart(df).transform_window(\n    cumulative_count=\"count()\",\n    sort=[{\"field\": \"order_date\"}],\n    groupby=[\"order_status\"]\n).mark_area().encode(\n    x=alt.X(\"order_date:T\", title=\"Order Date\"),\n    y=alt.Y(\"cumulative_count:Q\", stack=False, title=\"Cumulative Count\"),\n    color=alt.Color(\"order_status:N\", title=\"Order Status\")\n).properties(\n    title=\"Cumulative Count of Orders by Status Over Time\"\n)\n\ncumulative_chart"
    },
    {
        "type": "type_A",
        "db_id": "customers_and_addresses",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_last_value_labeled",
        "NLQ": "Can you create a line chart showing the total number of customer orders by date? I'd like to see the trend over time with the most recent order count highlighted with a circle and labeled with the exact number.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customers_and_addresses.sqlite')\n\nquery = '''\nSELECT \n    DATE(order_date) AS order_date, \n    COUNT(order_id) AS total_orders\nFROM \n    Customer_Orders\nGROUP BY \n    DATE(order_date)\nORDER BY \n    order_date\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).encode(\n    x=alt.X(\"order_date:T\", title=\"Order Date\"),\n    y=alt.Y(\"total_orders:Q\", title=\"Total Orders\")\n)\n\nline = chart.mark_line().encode()\n\nlabel = chart.encode(\n    x='max(order_date):T',\n    y=alt.Y('total_orders:Q').aggregate(argmax='order_date'),\n    text=alt.Text('total_orders:Q', format='.0f')\n)\n\ntext = label.mark_text(align='left', dx=4)\ncircle = label.mark_circle()\nfinal_chart = line + circle + text\nfinal_chart"
    },
    {
        "type": "type_A",
        "db_id": "customers_and_invoices",
        "chart_category": "Distributions",
        "chart_type": "cumulative_count_chart",
        "NLQ": "Can you create an area chart showing the cumulative count of orders over time? I'd like to see the running total of orders placed by date, with the order date on the x-axis and the cumulative count on the y-axis. This would help me understand how our order volume has grown over time and identify any trends in customer ordering patterns.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customers_and_invoices.sqlite')\n\nquery = '''\nSELECT \n    date_order_placed AS order_date\nFROM \n    Orders\nORDER BY \n    date_order_placed ASC\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ncumulative_chart = alt.Chart(df).transform_window(\n    cumulative_count=\"count()\",\n    sort=[{\"field\": \"order_date\"}],\n).mark_area().encode(\n    x=alt.X(\"order_date:T\", title=\"Order Date\"),\n    y=alt.Y(\"cumulative_count:Q\", title=\"Cumulative Count of Orders\").stack(False)\n)\n\ncumulative_chart"
    },
    {
        "type": "type_A",
        "db_id": "customer_deliveries",
        "chart_category": "Distributions",
        "chart_type": "dot_dash_plot",
        "NLQ": "Can you create a scatter plot showing delivery days of the month on the x-axis and truck IDs on the y-axis? I'd like each point to represent a delivery, colored by its status code. Also, could you add tick marks on the sides showing the distribution of delivery statuses? I want to be able to select regions on the chart to highlight specific deliveries while the others turn grey.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/customer_deliveries.sqlite')\nquery = '''\nSELECT\n    CAST(strftime('%d', delivery_date) AS INTEGER) AS delivery_day_of_month,\n    truck_id,\n    delivery_status_code\nFROM Order_Deliveries\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\nbrush_status = alt.when(brush).then(\"delivery_status_code\")\nbase = alt.Chart(df).add_params(brush)\n\npoints = base.mark_point().encode(\n    x=alt.X('delivery_day_of_month:Q', title='Delivery Day of Month'),\n    y=alt.Y('truck_id:Q', title='Truck ID'),\n    color=brush_status.otherwise(alt.value(\"grey\")),\n)\n\ntick_axis = alt.Axis(labels=False, domain=False, ticks=False)\ntick_color = brush_status.otherwise(alt.value(\"lightgrey\"))\n\nx_ticks = base.mark_tick().encode(\n    alt.X('delivery_day_of_month:Q', axis=tick_axis),\n    alt.Y('delivery_status_code:N', title='Delivery Status', axis=tick_axis),\n    color=tick_color\n)\n\ny_ticks = base.mark_tick().encode(\n    alt.X('delivery_status_code:N', title='', axis=tick_axis),\n    alt.Y('truck_id:Q', axis=tick_axis),\n    color=tick_color\n)\n\ny_ticks | (points & x_ticks)"
    },
    {
        "type": "type_A",
        "db_id": "customer_deliveries",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_logarithmic_scale",
        "NLQ": "Can you create a line chart showing our customer growth over time? I'd like to see the cumulative number of customers by year, with the y-axis on a logarithmic scale to better visualize the growth pattern. Please title it \"Customer Growth Over Time (Logarithmic Scale)\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customer_deliveries.sqlite')\n\nquery = '''\nSELECT\n    date(date_became_customer) AS year,\n    COUNT(customer_id) AS num_customers\nFROM Customers\nGROUP BY\n    year\nORDER BY\n    year;\n'''\n\ndf = pd.read_sql_query(query, conn)\ndf['cumulative_customers'] = df['num_customers'].cumsum()\nconn.close()\n\nalt.Chart(df).mark_line().encode(\n    x='year:O',\n    y=alt.Y('cumulative_customers', scale=alt.Scale(type=\"log\"), title='Cumulative Number of Customers')\n).properties(\n    title='Customer Growth Over Time (Logarithmic Scale)'\n)"
    },
    {
        "type": "type_A",
        "db_id": "decoration_competition",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_items",
        "NLQ": "Could you please show me a bar chart highlighting the top 5 colleges with the highest average rankings in the decoration competition? I'd like the college names on the x-axis, sorted by their average rank in descending order, and the y-axis to represent the average rank. Also, could the bars be colored based on their average rank values?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/decoration_competition.sqlite')\n\nquery = '''\nSELECT \n    c.Name AS College_Name,\n    AVG(r.Rank_in_Round) AS Avg_Rank\nFROM \n    round AS r\nJOIN \n    member AS m ON r.Member_ID = m.Member_ID\nJOIN \n    college AS c ON m.College_ID = c.College_ID\nGROUP BY \n    c.College_ID\nORDER BY \n    Avg_Rank DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X('College_Name:N').sort('-y'),\n    alt.Y('Avg_Rank:Q'),\n    alt.Color('Avg_Rank:Q')\n).transform_window(\n    rank='rank(Avg_Rank)',\n    sort=[alt.SortField('Avg_Rank', order='descending')]\n).transform_filter(\n    (alt.datum.rank < 6)\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "decoration_competition",
        "chart_category": "Distributions",
        "chart_type": "empirical_cumulative_distribution_function",
        "NLQ": "Can you create a line chart showing the cumulative distribution of ranks for each college? I'd like to see an empirical cumulative distribution function with rank in round on the x-axis and the cumulative distribution on the y-axis. Please use different colors for each college and title it \"Empirical Cumulative Distribution of Ranks by College\". Make the chart 600 pixels wide and 400 pixels tall.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/decoration_competition.sqlite')\nquery = '''\nSELECT \n    c.Name AS College_Name,\n    r.Rank_in_Round\nFROM \n    round AS r\nJOIN \n    member AS m ON r.Member_ID = m.Member_ID\nJOIN \n    college AS c ON m.College_ID = c.College_ID\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_window(\n    ecdf=\"cume_dist()\",\n    sort=[{\"field\": \"Rank_in_Round\", \"order\": \"ascending\"}],\n    groupby=[\"College_Name\"]\n).mark_line().encode(\n    x=alt.X(\"Rank_in_Round:Q\", title=\"Rank in Round\"),\n    y=alt.Y(\"ecdf:Q\", title=\"Empirical Cumulative Distribution\"),\n    color=alt.Color(\"College_Name:N\", title=\"College\")\n).properties(\n    title=\"Empirical Cumulative Distribution of Ranks by College\",\n    width=600,\n    height=400\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "department_management",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_letters",
        "NLQ": "Show me a horizontal bar chart of the top 10 states where department heads were born, with the states sorted from highest to lowest count.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/department_management.sqlite')\n\nquery = '''\nSELECT h.born_state AS state, COUNT(*) AS head_count\nFROM head AS h\nGROUP BY h.born_state\nORDER BY head_count DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_window(\n    rank='rank(head_count)',\n    sort=[alt.SortField('head_count', order='descending')]\n).transform_filter(\n    alt.datum.rank < 11\n).mark_bar().encode(\n    y=alt.Y('state:N').sort('-x'),\n    x='head_count:Q'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "department_management",
        "chart_category": "Distributions",
        "chart_type": "empirical_cumulative_distribution_function",
        "NLQ": "Can you show me the cumulative distribution of department budgets as a step line chart? I'd like to see the budget in billions on the x-axis and the cumulative proportion from 0 to 1 on the y-axis. Please title it \"Empirical Cumulative Distribution of Department Budgets\" and make the chart 600 by 400 pixels.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/department_management.sqlite')\n\nquery = '''\nSELECT Budget_in_Billions\nFROM department\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\necdf_chart = alt.Chart(df).transform_window(\n    ecdf=\"cume_dist()\",\n    sort=[{\"field\": \"Budget_in_Billions\"}]\n).mark_line(interpolate='step-after').encode(\n    x=alt.X(\"Budget_in_Billions:Q\", title=\"Budget in Billions\"),\n    y=alt.Y(\"ecdf:Q\", title=\"Cumulative Proportion\", scale=alt.Scale(domain=[0, 1]))\n).properties(\n    title=\"Empirical Cumulative Distribution of Department Budgets\",\n    width=600,\n    height=400\n)\n\necdf_chart"
    },
    {
        "type": "type_A",
        "db_id": "department_store",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_letters",
        "NLQ": "Could you create a bar chart showing the top 10 most frequently purchased products at the department store? I'd like to see the products listed vertically with their names on the left side and horizontal bars showing the purchase count. Please sort them from highest to lowest purchase count and title the chart \"Top 10 Most Frequently Purchased Products\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/department_store.sqlite')\n\nquery = '''\nSELECT \n    P.product_name AS product,\n    COUNT(OI.order_item_id) AS purchase_count\nFROM \n    Products AS P\nJOIN \n    Order_Items AS OI ON P.product_id = OI.product_id\nGROUP BY \n    P.product_name\nORDER BY \n    purchase_count DESC\nLIMIT 10;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    y=alt.Y('product:N', sort='-x', title='Product'),\n    x=alt.X('purchase_count:Q', title='Purchase Count')\n).properties(\n    title='Top 10 Most Frequently Purchased Products'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "device",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_letters",
        "NLQ": "Can you create a horizontal bar chart showing the top 5 software platforms used across devices? Sort the platforms from most to least common, with the count of devices for each platform displayed on the x-axis and platform names on the y-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/device.sqlite')\n\nquery = '''\nSELECT Software_Platform, COUNT(*) AS Platform_Count\nFROM device\nGROUP BY Software_Platform\nORDER BY Platform_Count DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nalt.Chart(df).transform_window(\n    rank='rank(Platform_Count)',\n    sort=[alt.SortField('Platform_Count', order='descending')]\n).transform_filter(\n    alt.datum.rank < 6\n).mark_bar().encode(\n    y=alt.Y('Software_Platform:N').sort('-x'),\n    x='Platform_Count:Q'\n)"
    },
    {
        "type": "type_A",
        "db_id": "device",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_point_markers",
        "NLQ": "Can you show me the trend of shop openings over the years using a line chart? I'd like to see the number of shops opened each year with points marking each year's data. Please include tooltips so I can see the exact year and number of shops when I hover over points.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/device.sqlite')\n\nquery = \"\"\"\nSELECT Open_Year, COUNT(Shop_ID) AS Shop_Count\nFROM shop\nGROUP BY Open_Year\nORDER BY Open_Year\n\"\"\"\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    x=alt.X('Open_Year:O', title='Year Opened'),\n    y=alt.Y('Shop_Count:Q', title='Number of Shops Opened'),\n    tooltip=['Open_Year', 'Shop_Count']\n).properties(\n    title='Trend of Shop Openings Over Years'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "document_management",
        "chart_category": "Advanced Calculations",
        "chart_type": "waterfall_chart",
        "NLQ": "Can you create a waterfall chart showing how document access counts add up across different document structures? I'd like to see the chart start at zero, then show each structure's contribution with red bars for increases, and end with the total count. Please include the actual values on each bar in white text, and show the running total at the top or bottom of each bar. Make it a good size so it's easy to read, with clear labels on the horizontal axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/document_management.sqlite')\nquery = '''\nSELECT \n    DS.document_structure_description,\n    SUM(D.access_count) AS total_access_count\nFROM Documents AS D\nJOIN Document_Structures AS DS \n    ON D.document_structure_code = DS.document_structure_code\nGROUP BY DS.document_structure_description\nORDER BY DS.document_structure_code\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbegin_row = pd.DataFrame([{\"document_structure_description\": \"Begin\", \"total_access_count\": 0}])\nend_row = pd.DataFrame([{\"document_structure_description\": \"End\", \"total_access_count\": df['total_access_count'].sum()}])\ndf = pd.concat([begin_row, df, end_row], ignore_index=True)\n\namount = alt.datum.total_access_count\nlabel = alt.datum.document_structure_description\nwindow_lead_label = alt.datum.window_lead_label\nwindow_sum_amount = alt.datum.window_sum_amount\n\ncalc_prev_sum = alt.expr.if_(label == \"End\", 0, window_sum_amount - amount)\ncalc_amount = alt.expr.if_(label == \"End\", window_sum_amount, amount)\ncalc_text_amount = (\n    alt.expr.if_((label != \"Begin\") & (label != \"End\") & calc_amount > 0, \"+\", \"\")\n    + calc_amount\n)\n\nbase_chart = alt.Chart(df).transform_window(\n    window_sum_amount=\"sum(total_access_count)\",\n    window_lead_label=\"lead(document_structure_description)\",\n).transform_calculate(\n    calc_lead=alt.expr.if_((window_lead_label == None), label, window_lead_label),\n    calc_prev_sum=calc_prev_sum,\n    calc_amount=calc_amount,\n    calc_text_amount=calc_text_amount,\n    calc_center=(window_sum_amount + calc_prev_sum) / 2,\n    calc_sum_dec=alt.expr.if_(window_sum_amount < calc_prev_sum, window_sum_amount, \"\"),\n    calc_sum_inc=alt.expr.if_(window_sum_amount > calc_prev_sum, window_sum_amount, \"\"),\n).encode(\n    x=alt.X(\"document_structure_description:O\", axis=alt.Axis(title=\"Document Structure\", labelAngle=0), sort=None)\n)\n\ncolor_coding = (\n    alt.when((label == \"Begin\") | (label == \"End\"))\n    .then(alt.value(\"#878d96\"))\n    .when(calc_amount < 0)\n    .then(alt.value(\"#24a148\"))\n    .otherwise(alt.value(\"#fa4d56\"))\n)\n\nbar = base_chart.mark_bar(size=45).encode(\n    y=alt.Y(\"calc_prev_sum:Q\", title=\"Access Count\"),\n    y2=alt.Y2(\"window_sum_amount:Q\"),\n    color=color_coding,\n)\n\nrule = base_chart.mark_rule(xOffset=-22.5, x2Offset=22.5).encode(\n    y=\"window_sum_amount:Q\",\n    x2=\"calc_lead\",\n)\n\ntext_pos_values_top_of_bar = base_chart.mark_text(baseline=\"bottom\", dy=-4).encode(\n    text=alt.Text(\"calc_sum_inc:N\"),\n    y=\"calc_sum_inc:Q\",\n)\ntext_neg_values_bot_of_bar = base_chart.mark_text(baseline=\"top\", dy=4).encode(\n    text=alt.Text(\"calc_sum_dec:N\"),\n    y=\"calc_sum_dec:Q\",\n)\ntext_bar_values_mid_of_bar = base_chart.mark_text(baseline=\"middle\").encode(\n    text=alt.Text(\"calc_text_amount:N\"),\n    y=\"calc_center:Q\",\n    color=alt.value(\"white\"),\n)\n\nalt.layer(\n    bar,\n    rule,\n    text_pos_values_top_of_bar,\n    text_neg_values_bot_of_bar,\n    text_bar_values_mid_of_bar\n).properties(\n    width=800,\n    height=450\n)"
    },
    {
        "type": "type_A",
        "db_id": "document_management",
        "chart_category": "Distributions",
        "chart_type": "faceted_histogram",
        "NLQ": "Can you show me the distribution of access counts for different document types? I'd like to see separate histograms stacked vertically, one for each document type, with about 30 bins for the access count ranges.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/document_management.sqlite')\n\nquery = '''\nSELECT \n    document_type_code AS Document_Type,\n    access_count AS Access_Count\nFROM \n    Documents\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"Access_Count:Q\").bin(maxbins=30),\n    y=\"count()\",\n    row=\"Document_Type\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "document_management",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_point_markers",
        "NLQ": "Can you create a line chart showing the total access count of different document types over time? I'd like to see the trends month by month with each document type shown in a different color. Please include point markers on the lines to highlight the monthly data points, and title the chart \"Total Access Count of Documents by Type Over Time\". Label the x-axis as \"Month\" and the y-axis as \"Total Access Count\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/document_management.sqlite')\n\nquery = '''\nSELECT \n    strftime('%Y-%m', T1.document_code) AS month,\n    T1.document_type_code AS document_type,\n    SUM(T1.access_count) AS total_access_count\nFROM \n    Documents AS T1\nGROUP BY \n    month, document_type\nORDER BY \n    month ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    x=alt.X('month:T', title='Month'),\n    y=alt.Y('total_access_count:Q', title='Total Access Count'),\n    color=alt.Color('document_type:N', title='Document Type')\n).properties(\n    title='Total Access Count of Documents by Type Over Time'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "dog_kennels",
        "chart_category": "Advanced Calculations",
        "chart_type": "waterfall_chart",
        "NLQ": "Can you create a waterfall chart showing how monthly treatment costs add up over time? Start at zero and break it down month by month, with red bars for cost increases and green bars for any decreases. Show the actual amount on each bar in white text, with a plus sign for increases. Label the x-axis as \"Months\" with angled labels, and the y-axis as \"Cost of Treatment\". Make it a large visualization so I can clearly see the progression from start to end with the final total.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/dog_kennels.sqlite')\n\nquery = \"\"\"\nSELECT\n    STRFTIME('%Y-%m', date_of_treatment) AS treatment_month,\n    SUM(cost_of_treatment) AS monthly_cost\nFROM Treatments\nGROUP BY treatment_month\nORDER BY treatment_month;\n\"\"\"\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndata = []\ntotal_cost = 0\ndata.append({\"label\": \"Start\", \"amount\": 0})\n\nfor index, row in df.iterrows():\n    amount = row['monthly_cost']\n    total_cost += amount\n    data.append({\"label\": row['treatment_month'], \"amount\": amount})\n\ndata.append({\"label\": \"End\", \"amount\": 0})\n\nsource = pd.DataFrame(data)\n\namount = alt.datum.amount\nlabel = alt.datum.label\nwindow_lead_label = alt.datum.window_lead_label\nwindow_sum_amount = alt.datum.window_sum_amount\n\ncalc_prev_sum = alt.expr.if_(label == \"End\", 0, window_sum_amount - amount)\ncalc_amount = alt.expr.if_(label == \"End\", window_sum_amount, amount)\ncalc_text_amount = (\n    alt.expr.if_((label != \"Start\") & (label != \"End\") & calc_amount > 0, \"+\", \"\")\n    + calc_amount\n)\n\nbase_chart = alt.Chart(source).transform_window(\n    window_sum_amount=\"sum(amount)\",\n    window_lead_label=\"lead(label)\",\n).transform_calculate(\n    calc_lead=alt.expr.if_((window_lead_label == None), label, window_lead_label),\n    calc_prev_sum=calc_prev_sum,\n    calc_amount=calc_amount,\n    calc_text_amount=calc_text_amount,\n    calc_center=(window_sum_amount + calc_prev_sum) / 2,\n    calc_sum_dec=alt.expr.if_(window_sum_amount < calc_prev_sum, window_sum_amount, \"\"),\n    calc_sum_inc=alt.expr.if_(window_sum_amount > calc_prev_sum, window_sum_amount, \"\"),\n).encode(\n    x=alt.X(\"label:O\", axis=alt.Axis(title=\"Months\", labelAngle=45), sort=None)\n)\n\ncolor_coding = (\n    alt.when((label == \"Start\") | (label == \"End\"))\n    .then(alt.value(\"#878d96\"))\n    .when(calc_amount < 0)\n    .then(alt.value(\"#24a148\"))\n    .otherwise(alt.value(\"#fa4d56\"))\n)\n\nbar = base_chart.mark_bar(size=45).encode(\n    y=alt.Y(\"calc_prev_sum:Q\", title=\"Cost of Treatment\"),\n    y2=alt.Y2(\"window_sum_amount:Q\"),\n    color=color_coding,\n)\n\nrule = base_chart.mark_rule(xOffset=-22.5, x2Offset=22.5).encode(\n    y=\"window_sum_amount:Q\",\n    x2=\"calc_lead\",\n)\n\ntext_pos_values_top_of_bar = base_chart.mark_text(baseline=\"bottom\", dy=-4).encode(\n    text=alt.Text(\"calc_sum_inc:N\"),\n    y=\"calc_sum_inc:Q\",\n)\ntext_neg_values_bot_of_bar = base_chart.mark_text(baseline=\"top\", dy=4).encode(\n    text=alt.Text(\"calc_sum_dec:N\"),\n    y=\"calc_sum_dec:Q\",\n)\ntext_bar_values_mid_of_bar = base_chart.mark_text(baseline=\"middle\").encode(\n    text=alt.Text(\"calc_text_amount:N\"),\n    y=\"calc_center:Q\",\n    color=alt.value(\"white\"),\n)\n\nalt.layer(\n    bar,\n    rule,\n    text_pos_values_top_of_bar,\n    text_neg_values_bot_of_bar,\n    text_bar_values_mid_of_bar\n).properties(\n    width=800,\n    height=450\n)"
    },
    {
        "type": "type_A",
        "db_id": "dorm_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "waterfall_chart",
        "NLQ": "Can you create a waterfall chart showing the cumulative student capacity across all dormitories? I'd like to see each dorm's contribution starting from the smallest capacity, with the bars building up to show the total capacity. Please include the capacity number on each bar, use red for positive values, and make the chart wide enough to read all the dormitory names. Title it \"Cumulative Student Capacity Across Dormitories\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/dorm_1.sqlite')\nquery = '''\nSELECT dorm_name, student_capacity\nFROM Dorm\nORDER BY student_capacity;\n'''\ndf_dorm = pd.read_sql_query(query, conn)\nconn.close()\n\ndata = []\ndata.append({\"label\": \"Start\", \"amount\": 0})\nfor index, row in df_dorm.iterrows():\n    data.append({\"label\": row['dorm_name'], \"amount\": row['student_capacity']})\ntotal_capacity = df_dorm['student_capacity'].sum()\ndata.append({\"label\": \"Total\", \"amount\": total_capacity})\n\nsource = pd.DataFrame(data)\n\namount = alt.datum.amount\nlabel = alt.datum.label\nwindow_lead_label = alt.datum.window_lead_label\nwindow_sum_amount = alt.datum.window_sum_amount\n\ncalc_prev_sum = alt.expr.if_(label == \"Total\", 0, window_sum_amount - amount)\ncalc_amount = alt.expr.if_(label == \"Total\", window_sum_amount, amount)\ncalc_text_amount = (\n    alt.expr.if_((label != \"Start\") & (label != \"Total\") & calc_amount > 0, \"+\", \"\")\n    + calc_amount\n)\n\nbase_chart = alt.Chart(source).transform_window(\n    window_sum_amount=\"sum(amount)\",\n    window_lead_label=\"lead(label)\",\n).transform_calculate(\n    calc_lead=alt.expr.if_((window_lead_label == None), label, window_lead_label),\n    calc_prev_sum=calc_prev_sum,\n    calc_amount=calc_amount,\n    calc_text_amount=calc_text_amount,\n    calc_center=(window_sum_amount + calc_prev_sum) / 2,\n    calc_sum_dec=alt.expr.if_(window_sum_amount < calc_prev_sum, window_sum_amount, \"\"),\n    calc_sum_inc=alt.expr.if_(window_sum_amount > calc_prev_sum, window_sum_amount, \"\"),\n).encode(\n    x=alt.X(\"label:O\", axis=alt.Axis(title=\"Dormitory\", labelAngle=45), sort=None)\n)\n\ncolor_coding = (\n    alt.when((label == \"Start\") | (label == \"Total\"))\n    .then(alt.value(\"#878d96\"))\n    .when(calc_amount < 0)\n    .then(alt.value(\"#24a148\"))\n    .otherwise(alt.value(\"#fa4d56\"))\n)\n\nbar = base_chart.mark_bar(size=45).encode(\n    y=alt.Y(\"calc_prev_sum:Q\", title=\"Student Capacity\"),\n    y2=alt.Y2(\"window_sum_amount:Q\"),\n    color=color_coding,\n)\n\nrule = base_chart.mark_rule(xOffset=-22.5, x2Offset=22.5).encode(\n    y=\"window_sum_amount:Q\",\n    x2=\"calc_lead\",\n)\n\ntext_pos_values_top_of_bar = base_chart.mark_text(baseline=\"bottom\", dy=-4).encode(\n    text=alt.Text(\"calc_sum_inc:N\"),\n    y=\"calc_sum_inc:Q\",\n)\ntext_neg_values_bot_of_bar = base_chart.mark_text(baseline=\"top\", dy=4).encode(\n    text=alt.Text(\"calc_sum_dec:N\"),\n    y=\"calc_sum_dec:Q\",\n)\ntext_bar_values_mid_of_bar = base_chart.mark_text(baseline=\"middle\").encode(\n    text=alt.Text(\"calc_text_amount:N\"),\n    y=\"calc_center:Q\",\n    color=alt.value(\"white\"),\n)\n\nchart = alt.layer(\n    bar,\n    rule,\n    text_pos_values_top_of_bar,\n    text_neg_values_bot_of_bar,\n    text_bar_values_mid_of_bar\n).properties(\n    title='Cumulative Student Capacity Across Dormitories',\n    width=800,\n    height=450\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "dorm_1",
        "chart_category": "Distributions",
        "chart_type": "heat_lane_chart",
        "NLQ": "Can you create a chart showing the distribution of student ages across different dorms? I'd like to see dorm names listed vertically on the left side and student age ranges horizontally along the bottom. Use a blue color scheme to represent the number of students in each age group, with darker colors showing higher concentrations. Title the chart \"Distribution of Student Ages Across Dorm Capacities\" and make it wide but not too tall.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/dorm_1.sqlite')\n\nquery = '''\nSELECT \n    Dorm.dorm_name AS dorm_name,\n    Dorm.student_capacity AS capacity,\n    Student.Age AS age\nFROM \n    Lives_in\nJOIN \n    Student ON Lives_in.stuid = Student.StuID\nJOIN \n    Dorm ON Lives_in.dormid = Dorm.dormid\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Distribution of Student Ages Across Dorm Capacities\", height=100, width=400).encode(\n    alt.X(\"bin_Age_start:Q\").title(\"Student Age\").axis(grid=False),\n    alt.X2(\"bin_Age_end:Q\"),\n    alt.Y(\"dorm_name:N\").title(\"Dorm Name\"),\n    alt.Y2(\"y2\"),\n).transform_bin(\n    [\"bin_Age_start\", \"bin_Age_end\"],\n    field='age'\n).transform_aggregate(\n    count='count()',\n    groupby=[\"bin_Age_start\", \"bin_Age_end\", \"dorm_name\"]\n).transform_bin(\n    [\"bin_count_start\", \"bin_count_end\"],\n    field='count'\n).transform_calculate(\n    y=\"datum.bin_count_end/2\",\n    y2=\"-datum.bin_count_end/2\",\n).transform_joinaggregate(\n    max_bin_count_end=\"max(bin_count_end)\",\n)\n\nlayer1 = chart.mark_bar(xOffset=1, x2Offset=-1, cornerRadius=3).encode(\n    alt.Color(\"max_bin_count_end:O\").title(\"Number of Students\").scale(scheme=\"lighttealblue\")\n)\nlayer2 = chart.mark_bar(xOffset=1, x2Offset=-1, yOffset=-3, y2Offset=3).encode(\n    alt.Color(\"bin_count_end:O\").title(\"Number of Students\")\n)\n\nlayer1 + layer2"
    },
    {
        "type": "type_A",
        "db_id": "dorm_1",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_sequence_generator",
        "NLQ": "Can you create a line chart showing how the number of students in each dorm changes over time from 0 to 10 in half-unit intervals? I'd like to see the lines colored by gender, with each dorm represented by its own line. The y-axis should show the student count, which should increase proportionally with time based on the average student count from our data.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/dorm_1.sqlite')\nquery = '''\nSELECT \n    T2.dorm_name AS dorm_name,\n    T2.gender AS gender,\n    COUNT(T1.stuid) AS student_count\nFROM \n    Lives_in AS T1\nJOIN \n    Dorm AS T2 ON T1.dormid = T2.dormid\nGROUP BY \n    T2.dorm_name, T2.gender\nORDER BY \n    T2.gender, T2.dorm_name;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ntime_sequence = alt.sequence(start=0, stop=10, step=0.5, as_='time')\n\nchart = alt.Chart(time_sequence).mark_line().transform_calculate(\n    student_count_simulated=f'datum.time * {df[\"student_count\"].mean()}'\n).transform_fold(\n    ['student_count_simulated']\n).encode(\n    x='time:Q',\n    y='value:Q',\n    color='gender:N',\n    detail='dorm_name:N'\n).transform_lookup(\n    lookup='dorm_name',\n    from_=alt.LookupData(data=df, key='dorm_name', fields=['gender', 'student_count'])\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "driving_school",
        "chart_category": "Advanced Calculations",
        "chart_type": "wilkinson_dot_plot",
        "NLQ": "Can you show me the distribution of lesson prices for each vehicle type using colored dots? I'd like to see the price ranges on the x-axis with a title \"Lesson Price\" and have different colors for each vehicle type. Please title the chart \"Distribution of Lesson Prices by Vehicle Type\" and include a color legend labeled \"Vehicle Type\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/driving_school.sqlite')\n\nquery = '''\nSELECT V.vehicle_details AS vehicle_type, L.price\nFROM Lessons AS L\nJOIN Vehicles AS V ON L.vehicle_id = V.vehicle_id\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df, height=100).mark_circle(opacity=1).transform_window(\n    id='rank()',\n    groupby=['vehicle_type', 'price']\n).encode(\n    alt.X('price:Q', title='Lesson Price'),\n    alt.Y('id:O').axis(None).sort('descending'),\n    alt.Color('vehicle_type:N', title='Vehicle Type')\n).properties(\n    title='Distribution of Lesson Prices by Vehicle Type'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "driving_school",
        "chart_category": "Distributions",
        "chart_type": "heat_lane_chart",
        "NLQ": "Can you show me a horizontal bar chart comparing the distribution of lesson prices by vehicle type? I'd like to see the price ranges color-coded by the number of lessons, using light teal to blue colors. Please title it \"Distribution of Lesson Prices by Vehicle Type\" and keep the visualization compact.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/driving_school.sqlite')\n\nquery = '''\nSELECT \n    Vehicles.vehicle_details AS vehicle_type, \n    Lessons.price AS lesson_price\nFROM \n    Lessons\nJOIN \n    Vehicles ON Lessons.vehicle_id = Vehicles.vehicle_id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Distribution of Lesson Prices by Vehicle Type\", height=100, width=300).encode(\n    alt.X(\"bin_price_start:Q\")\n        .title(\"Lesson Price\")\n        .axis(grid=False),\n    alt.X2(\"bin_price_end:Q\"),\n    alt.Y(\"vehicle_type:N\").title(\"Vehicle Type\"),\n    alt.Y2(\"y2\"),\n).transform_bin(\n    [\"bin_price_start\", \"bin_price_end\"],\n    field='lesson_price',\n    bin=alt.Bin(maxbins=20)\n).transform_aggregate(\n    count='count()',\n    groupby=[\"vehicle_type\", \"bin_price_start\", \"bin_price_end\"]\n).transform_bin(\n    [\"bin_count_start\", \"bin_count_end\"],\n    field='count'\n).transform_calculate(\n    y=\"datum.bin_count_end/2\",\n    y2=\"-datum.bin_count_end/2\",\n).transform_joinaggregate(\n    max_bin_count_end=\"max(bin_count_end)\",\n    groupby=[\"vehicle_type\"]\n)\n\nlayer1 = chart.mark_bar(xOffset=1, x2Offset=-1, cornerRadius=3).encode(\n    alt.Color(\"max_bin_count_end:O\")\n        .title(\"Number of Lessons\")\n        .scale(scheme=\"lighttealblue\")\n)\nlayer2 = chart.mark_bar(xOffset=1, x2Offset=-1, yOffset=-3, y2Offset=3).encode(\n    alt.Color(\"bin_count_end:O\").title(\"Number of Lessons\")\n)\n\nlayer1 + layer2"
    },
    {
        "type": "type_A",
        "db_id": "election",
        "chart_category": "Advanced Calculations",
        "chart_type": "wilkinson_dot_plot",
        "NLQ": "Can you create a simple dot plot showing how delegates are distributed across different political parties? I'd like to see each party listed along the x-axis with dots stacked vertically to represent their delegate counts. This would help me visualize which political parties have more representation compared to others. No need for a y-axis label since the dots themselves will show the quantities.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/election.sqlite')\n\nquery = '''\nSELECT p.Party, COUNT(e.Delegate) AS Delegate_Count\nFROM election AS e\nJOIN party AS p ON e.Party = p.Party_ID\nGROUP BY p.Party\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle(opacity=1).transform_window(\n    id='rank()',\n    groupby=['Party']\n).encode(\n    alt.X('Party:N', title='Political Party'),\n    alt.Y('id:O').axis(None).sort('descending')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "election",
        "chart_category": "Distributions",
        "chart_type": "heat_lane_chart",
        "NLQ": "Can you create a heat lane chart showing the population distribution by zip code? I'd like to see the population values grouped into about 20 bins along the x-axis, with zip codes listed on the y-axis. Use a light teal-blue color scheme to show the number of counties in each population range, with darker colors indicating higher counts. Make the chart 300 pixels wide by 100 pixels tall, with rounded corners on the bars. Title it \"Population Distribution by Zip Code\" and label the axes as \"Population\" and \"Zip Code\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/election.sqlite')\nquery = '''\nSELECT Zip_code, Population\nFROM county\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Population Distribution by Zip Code\", height=100, width=300).encode(\n    alt.X(\"bin_Population_start:Q\")\n        .title(\"Population\")\n        .axis(grid=False),\n    alt.X2(\"bin_Population_end:Q\"),\n    alt.Y(\"Zip_code:N\").title(\"Zip Code\"),\n).transform_bin(\n    [\"bin_Population_start\", \"bin_Population_end\"],\n    field='Population',\n    bin=alt.Bin(maxbins=20)\n).transform_aggregate(\n    count='count()',\n    groupby=[\"Zip_code\", \"bin_Population_start\", \"bin_Population_end\"]\n).transform_calculate(\n    y_offset=\"datum.count / 2\",\n    y2_offset=\"-datum.count / 2\",\n).mark_bar(xOffset=1, x2Offset=-1, cornerRadius=3).encode(\n    alt.Color(\"count:Q\")\n        .title(\"Number of Counties\")\n        .scale(scheme=\"lighttealblue\")\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "election_representative",
        "chart_category": "Advanced Calculations",
        "chart_type": "wilkinson_dot_plot",
        "NLQ": "Can you create a Wilkinson dot plot showing the total number of seats won by each political party? I'd like to see the parties arranged horizontally with dots stacked vertically to represent each seat, with the parties ordered from highest to lowest number of seats.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/election_representative.sqlite')\n\nquery = '''\nSELECT r.Party, SUM(e.Seats) AS Total_Seats\nFROM election AS e\nJOIN representative AS r ON e.Representative_ID = r.Representative_ID\nGROUP BY r.Party\nORDER BY Total_Seats DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndot_data = []\nfor _, row in df.iterrows():\n    dot_data.extend([row['Party']] * int(row['Total_Seats']))\n\ndot_df = pd.DataFrame({'Party': dot_data})\n\nchart = alt.Chart(dot_df, height=100).mark_circle(opacity=1).transform_window(\n    id='rank()',\n    groupby=['Party']\n).encode(\n    alt.X('Party:N', title='Political Party'),\n    alt.Y('id:O').axis(None).sort('descending')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "employee_hire_evaluation",
        "chart_category": "Area Charts",
        "chart_type": "area_chart_with_gradient",
        "NLQ": "Can you create an area chart showing the total bonuses awarded to employees from Bristol over the years? I'd like the chart to have a dark blue outline with a white-to-dark blue gradient fill. Please title it \"Total Bonuses Awarded Over Years for Employees from Bristol\" and label the x-axis as \"Year\" and the y-axis as \"Total Bonus Awarded\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/employee_hire_evaluation.sqlite')\n\nquery = '''\nSELECT e.City, ev.Year_awarded, SUM(ev.Bonus) AS Total_Bonus\nFROM employee AS e\nJOIN evaluation AS ev ON e.Employee_ID = ev.Employee_ID\nWHERE e.City = 'Bristol'\nGROUP BY ev.Year_awarded\nORDER BY ev.Year_awarded\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_area(\n    line={'color': 'darkblue'},\n    color=alt.Gradient(\n        gradient='linear',\n        stops=[alt.GradientStop(color='white', offset=0),\n               alt.GradientStop(color='darkblue', offset=1)],\n        x1=1,\n        x2=1,\n        y1=1,\n        y2=0\n    )\n).encode(\n    alt.X('Year_awarded:T', title='Year'),\n    alt.Y('Total_Bonus:Q', title='Total Bonus Awarded')\n).properties(\n    title='Total Bonuses Awarded Over Years for Employees from Bristol'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "entertainment_awards",
        "chart_category": "Area Charts",
        "chart_type": "area_chart_with_gradient",
        "NLQ": "Can you create an area chart showing how the total number of festival audiences in the United States has changed over the years? I'd like a gradient fill that goes from white at the top to dark blue at the bottom, with a dark blue outline for the area. Please label the x-axis as \"Year\" and the y-axis as \"Total Number of Audiences\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/entertainment_awards.sqlite')\n\nquery = '''\nSELECT Year, SUM(Num_of_Audience) AS Total_Audience\nFROM festival_detail\nWHERE Location = 'United States'\nGROUP BY Year\nORDER BY Year\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_area(\n    line={'color': 'darkblue'},\n    color=alt.Gradient(\n        gradient='linear',\n        stops=[alt.GradientStop(color='white', offset=0),\n               alt.GradientStop(color='darkblue', offset=1)],\n        x1=1,\n        x2=1,\n        y1=1,\n        y2=0\n    )\n).encode(\n    alt.X('Year:T', title='Year'),\n    alt.Y('Total_Audience:Q', title='Total Number of Audiences')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "entrepreneur",
        "chart_category": "Area Charts",
        "chart_type": "area_chart_with_gradient",
        "NLQ": "Can you create an area chart showing the total money requested from Duncan Bannatyne by entrepreneurs based on their birth dates? I'd like to see a gradient effect from white to dark blue on the area, with a dark blue outline. The x-axis should show the dates of birth and the y-axis should display the total money requested.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/entrepreneur.sqlite')\n\nquery = '''\nSELECT \n    p.Date_of_Birth AS date,\n    e.Investor AS investor,\n    SUM(e.Money_Requested) AS total_money_requested\nFROM entrepreneur AS e\nJOIN people AS p ON e.People_ID = p.People_ID\nGROUP BY p.Date_of_Birth, e.Investor\nORDER BY p.Date_of_Birth\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_filter(\n    'datum.investor === \"Duncan Bannatyne\"'\n).mark_area(\n    line={'color': 'darkblue'},\n    color=alt.Gradient(\n        gradient='linear',\n        stops=[alt.GradientStop(color='white', offset=0),\n               alt.GradientStop(color='darkblue', offset=1)],\n        x1=1,\n        x2=1,\n        y1=1,\n        y2=0\n    )\n).encode(\n    alt.X('date:T', title='Date of Birth'),\n    alt.Y('total_money_requested:Q', title='Cumulative Money Requested')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "entrepreneur",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_varying_size",
        "NLQ": "Can you show me a trail chart comparing the total money requested by entrepreneurs from different investors? I'd like to see each investor on the x-axis and the total amount requested on the y-axis. Also, make the thickness of the trail lines represent the amount of money requested - thicker lines for larger amounts.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/entrepreneur.sqlite')\nquery = '''\nSELECT \n    Investor, \n    SUM(Money_Requested) AS Total_Money_Requested\nFROM \n    entrepreneur\nGROUP BY \n    Investor\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_trail().encode(\n    x='Investor:N',\n    y='Total_Money_Requested:Q',\n    size='Total_Money_Requested:Q'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "epinions_1",
        "chart_category": "Area Charts",
        "chart_type": "faceted_area_chart",
        "NLQ": "Can you show me the trend of total ratings across different ranks for each user? I'd like to see this as small area charts stacked vertically, with one chart per user. Please sort the users from highest to lowest total ratings and use different colors to distinguish between users. Make each chart about 50 pixels tall and 400 pixels wide.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/epinions_1.sqlite')\n\nquery = '''\nSELECT \n    ua.name AS user_name,\n    r.rank AS rank,\n    SUM(r.rating) AS total_rating\nFROM \n    review AS r\nJOIN \n    useracct AS ua ON r.u_id = ua.u_id\nGROUP BY \n    ua.name, r.rank\nORDER BY \n    ua.name, r.rank\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_area().encode(\n    x=alt.X(\"rank:Q\", title=\"Rank\"),\n    y=alt.Y(\"total_rating:Q\", title=\"Total Rating\"),\n    color=alt.Color(\"user_name:N\", title=\"User\"),\n    row=alt.Row(\"user_name:N\", title=\"User\", sort=alt.EncodingSortField(field=\"total_rating\", op=\"sum\", order=\"descending\"))\n).properties(\n    height=50,\n    width=400\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "epinions_1",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_gradient_color",
        "NLQ": "Can you create a histogram showing the distribution of trust scores from the trust table? I'd like to see the trust scores on the x-axis divided into 20 bins ranging from 0 to 10, with the count on the y-axis. Please color the bars using a pink-yellow-green gradient to help visualize the different trust levels.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/epinions_1.sqlite')\n\nquery = '''\nSELECT trust\nFROM trust\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"trust:Q\").bin(maxbins=20).scale(domain=[0, 10]),\n    alt.Y('count()'),\n    alt.Color(\"trust:Q\").bin(maxbins=20).scale(scheme='pinkyellowgreen')\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "e_learning",
        "chart_category": "Area Charts",
        "chart_type": "faceted_area_chart",
        "NLQ": "Can you create a faceted area chart showing how many students completed courses each month, broken down by subject? I'd like to see a separate row for each subject, with the completion months on the x-axis and student count on the y-axis. Use different colors for each subject and make each chart about 100 pixels tall and 400 pixels wide.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/e_learning.sqlite')\n\nquery = '''\nSELECT \n    Subjects.subject_name AS subject,\n    strftime('%Y-%m', Student_Course_Enrolment.date_of_completion) AS completion_month,\n    COUNT(Student_Course_Enrolment.student_id) AS student_count\nFROM \n    Student_Course_Enrolment\nJOIN \n    Courses ON Student_Course_Enrolment.course_id = Courses.course_id\nJOIN \n    Subjects ON Courses.subject_id = Subjects.subject_id\nWHERE \n    Student_Course_Enrolment.date_of_completion IS NOT NULL\nGROUP BY \n    Subjects.subject_name, completion_month\nORDER BY \n    Subjects.subject_name, completion_month;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_area().encode(\n    x=alt.X(\"completion_month:T\", title=\"Completion Month\"),\n    y=alt.Y(\"student_count:Q\", title=\"Number of Students\"),\n    color=alt.Color(\"subject:N\", title=\"Subject\"),\n    row=alt.Row(\"subject:N\", title=\"Subject\")\n).properties(\n    height=100,\n    width=400\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "e_learning",
        "chart_category": "Line Charts",
        "chart_type": "multiple_series_line_chart",
        "NLQ": "Can you create a line chart showing the number of course completions over time by subject? I'd like to see how many students completed courses each month, with different colored lines for each subject. Please label the x-axis as \"Completion Month\" and the y-axis as \"Number of Completions\", and title the chart \"Number of Course Completions Over Time by Subject\". I want to track the trends for each subject month by month.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/e_learning.sqlite')\n\nquery = '''\nSELECT \n    Subjects.subject_name AS subject,\n    strftime('%Y-%m', Student_Course_Enrolment.date_of_completion) AS completion_month,\n    COUNT(Student_Course_Enrolment.registration_id) AS completions\nFROM \n    Student_Course_Enrolment\nJOIN \n    Courses ON Student_Course_Enrolment.course_id = Courses.course_id\nJOIN \n    Subjects ON Courses.subject_id = Subjects.subject_id\nWHERE \n    Student_Course_Enrolment.date_of_completion IS NOT NULL\nGROUP BY \n    Subjects.subject_name, completion_month\nORDER BY \n    completion_month ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line().encode(\n    x=alt.X('completion_month:T', title='Completion Month'),\n    y=alt.Y('completions:Q', title='Number of Completions'),\n    color=alt.Color('subject:N', title='Subject')\n).properties(\n    title='Number of Course Completions Over Time by Subject'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "farm",
        "chart_category": "Area Charts",
        "chart_type": "horizon_graph",
        "NLQ": "Can you create a horizon graph showing how the total cattle population has changed over the years? I'd like to see the data split into two ranges: 0-5000 and 5000+. Make the graph 500 pixels wide with smooth, semi-transparent area curves. Order the years chronologically along the x-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/farm.sqlite')\n\nquery = '''\nSELECT Year, Total_Cattle\nFROM farm\nORDER BY Year\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\narea1 = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.6\n).encode(\n    alt.X('Year:O').scale(zero=False, nice=False),\n    alt.Y('Total_Cattle:Q').scale(domain=[0, 5000]).title('Total Cattle (0-5000)'),\n).properties(\n    width=500,\n    height=75\n)\n\narea2 = area1.encode(\n    alt.Y('ny:Q').scale(domain=[0, 5000])\n).transform_calculate(\n    \"ny\", alt.datum.Total_Cattle - 5000\n)\n\narea1 + area2"
    },
    {
        "type": "type_A",
        "db_id": "film_rank",
        "chart_category": "Area Charts",
        "chart_type": "horizon_graph",
        "NLQ": "Can you create a horizon graph showing the total gross revenue for films by country? I'd like to see countries ordered by their total gross revenue from highest to lowest. Split the visualization into two halves - the top half showing the upper portion of revenues and the bottom half showing the lower portion. Use a smooth monotone line with moderate transparency for the areas. Make the graph about 500 pixels wide and keep it relatively compact in height.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/film_rank.sqlite')\n\nquery = '''\nSELECT \n    m.Country AS Country,\n    SUM(f.Gross_in_dollar) AS Total_Gross\nFROM \n    film_market_estimation AS fme\nJOIN \n    film AS f ON fme.Film_ID = f.Film_ID\nJOIN \n    market AS m ON fme.Market_ID = m.Market_ID\nGROUP BY \n    m.Country\nORDER BY \n    Total_Gross DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbase = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.6\n).encode(\n    alt.X('Country:N').title('Country'),\n    alt.Y('Total_Gross:Q').scale(domain=[0, df['Total_Gross'].max() / 2]).title('Gross Revenue (Top Half)'),\n).properties(\n    width=500,\n    height=75\n)\n\ntop_half = base\n\nbottom_half = base.encode(\n    alt.Y('ny:Q').scale(domain=[0, df['Total_Gross'].max() / 2]).title('Gross Revenue (Bottom Half)')\n).transform_calculate(\n    \"ny\", alt.datum.Total_Gross - df['Total_Gross'].max() / 2\n)\n\ntop_half + bottom_half"
    },
    {
        "type": "type_A",
        "db_id": "flight_1",
        "chart_category": "Area Charts",
        "chart_type": "horizon_graph",
        "NLQ": "Can you create a horizon graph showing the total distance flown by each aircraft type? I'd like to see the distances split into two bands - one for distances up to 5,000 miles and another for distances above 5,000 miles. Use a monotone curve style with slight transparency for the areas. Label the x-axis as \"Aircraft Type\" and the y-axis as \"Distance (miles)\". Make the chart 500 pixels wide and 75 pixels tall. Please get the data by combining information from the flight and aircraft tables, and sort the results by total distance in descending order.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/flight_1.sqlite')\n\nquery = '''\nSELECT \n    a.name AS aircraft_name,\n    SUM(f.distance) AS total_distance\nFROM \n    flight AS f\nJOIN \n    aircraft AS a ON f.aid = a.aid\nGROUP BY \n    a.name\nORDER BY \n    total_distance DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\narea1 = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.6\n).encode(\n    alt.X('aircraft_name:N').title('Aircraft Type'),\n    alt.Y('total_distance:Q').scale(domain=[0, 5000]).title('Distance (miles)'),\n).properties(\n    width=500,\n    height=75\n)\n\narea2 = area1.encode(\n    alt.Y('adjusted_distance:Q').scale(domain=[0, 5000])\n).transform_calculate(\n    \"adjusted_distance\", alt.datum.total_distance - 5000\n)\n\nfinal_chart = area1 + area2\nfinal_chart"
    },
    {
        "type": "type_A",
        "db_id": "game_injury",
        "chart_category": "Area Charts",
        "chart_type": "normalized_stacked_area_chart",
        "NLQ": "Can you create a normalized stacked area chart showing the proportion of games for each competition across different seasons? I'd like to see how the distribution of competitions has changed over time, with seasons on the x-axis and the relative proportion of games on the y-axis. Please title it \"Proportion of Game Competitions Over Seasons\" and use different colors to distinguish between the competitions.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/game_injury.sqlite')\n\nquery = \"\"\"\nSELECT\n  Season,\n  Competition,\n  COUNT(id) AS game_count\nFROM game\nGROUP BY Season, Competition\nORDER BY Season, Competition\n\"\"\"\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_area().encode(\n    x=alt.X('Season:O', title='Season'),\n    y=alt.Y('game_count:Q', stack='normalize', title='Proportion of Games'),\n    color='Competition:N'\n).properties(\n    title='Proportion of Game Competitions Over Seasons'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "gymnast",
        "chart_category": "Area Charts",
        "chart_type": "normalized_stacked_area_chart",
        "NLQ": "Can you create a chart showing how gymnasts' points are distributed across different events? I'd like to see a normalized stacked area chart that shows the proportion of points each gymnast earned in Floor Exercise, Pommel Horse, Rings, Vault, Parallel Bars, and Horizontal Bar. Label the x-axis with Gymnast ID and title the chart \"Normalized Distribution of Points Across Gymnastic Events.\"",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/gymnast.sqlite')\n\nquery = '''\nSELECT \n    Gymnast_ID,\n    Floor_Exercise_Points AS Floor,\n    Pommel_Horse_Points AS Pommel_Horse,\n    Rings_Points AS Rings,\n    Vault_Points AS Vault,\n    Parallel_Bars_Points AS Parallel_Bars,\n    Horizontal_Bar_Points AS Horizontal_Bar\nFROM \n    gymnast\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndf_long = df.melt(id_vars=['Gymnast_ID'], \n                  value_vars=['Floor', 'Pommel_Horse', 'Rings', 'Vault', 'Parallel_Bars', 'Horizontal_Bar'],\n                  var_name='Event', value_name='Points')\n\nchart = alt.Chart(df_long).mark_area().encode(\n    x=alt.X(\"Gymnast_ID:N\", title=\"Gymnast ID\"),\n    y=alt.Y(\"Points:Q\").stack(\"normalize\"),\n    color=\"Event:N\"\n).properties(\n    title=\"Normalized Distribution of Points Across Gymnastic Events\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "gymnast",
        "chart_category": "Distributions",
        "chart_type": "repeated_density_estimates",
        "NLQ": "Can you show me the distribution of gymnast scores for each event (Floor, Pommel Horse, Rings, Vault, Parallel Bars, and Horizontal Bar) using density plots? I'd like to see the scores between 8 and 10 points, with each event displayed in a separate row.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/gymnast.sqlite')\n\nquery = '''\nSELECT \n    Floor_Exercise_Points AS Floor,\n    Pommel_Horse_Points AS Pommel_Horse,\n    Rings_Points AS Rings,\n    Vault_Points AS Vault,\n    Parallel_Bars_Points AS Parallel_Bars,\n    Horizontal_Bar_Points AS Horizontal_Bar\nFROM gymnast\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_fold(\n    [\"Floor\", \"Pommel_Horse\", \"Rings\", \"Vault\", \"Parallel_Bars\", \"Horizontal_Bar\"],\n    as_=[\"Event\", \"Score\"]\n).transform_density(\n    density=\"Score\",\n    bandwidth=0.1,\n    groupby=[\"Event\"],\n    extent=[8, 10]\n).mark_area().encode(\n    alt.X(\"value:Q\", title=\"Score\"),\n    alt.Y(\"density:Q\", title=\"Density\"),\n    alt.Row(\"Event:N\")\n).properties(\n    width=300, height=50\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "insurance_and_eClaims",
        "chart_category": "Bar Charts",
        "chart_type": "bar_and_tick_chart",
        "NLQ": "Can you create a chart comparing the total amount claimed versus average amount paid for each claim type? I'd like to see the total claimed amounts as blue bars and the average paid amounts as red tick marks overlaid on the same chart. Please label the x-axis as \"Claim Type\" and use appropriate y-axis labels for the amounts.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_and_eClaims.sqlite')\n\nquery = '''\nSELECT \n    Claim_Type_Code AS claim_type,\n    SUM(Amount_Claimed) AS total_claimed,\n    AVG(Amount_Piad) AS avg_paid\nFROM \n    Claim_Headers\nGROUP BY \n    Claim_Type_Code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('claim_type:N', title='Claim Type'),\n    y=alt.Y('total_claimed:Q', title='Total Amount Claimed')\n).properties(\n    width=alt.Step(40)\n)\n\ntick = alt.Chart(df).mark_tick(\n    color='red',\n    thickness=2,\n    size=40 * 0.9,\n).encode(\n    x=alt.X('claim_type:N', title='Claim Type'),\n    y=alt.Y('avg_paid:Q', title='Average Amount Paid')\n)\n\nchart = bar + tick\nchart"
    },
    {
        "type": "type_A",
        "db_id": "insurance_and_eClaims",
        "chart_category": "Distributions",
        "chart_type": "ridgeline_plot",
        "NLQ": "Can you create a ridgeline plot showing the distribution of claim amounts for each claim status code? I'd like to see smooth, overlapping density curves with different colors for each status. Please put \"Distribution of Claim Amounts by Claim Status\" as the title, label the x-axis as \"Claim Amount\", and align the status codes on the left side. Make the curves semi-transparent with light gray borders.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_and_eClaims.sqlite')\n\nquery = '''\nSELECT Claim_Status_Code, Amount_Claimed\nFROM Claim_Headers\nWHERE Amount_Claimed IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nstep = 20\noverlap = 1\n\nchart = alt.Chart(df, height=step).transform_density(\n    'Amount_Claimed',\n    groupby=['Claim_Status_Code'],\n    as_=['Amount_Claimed', 'density'],\n    extent=[0, df['Amount_Claimed'].max()],\n    bandwidth=50\n).mark_area(\n    interpolate='monotone',\n    fillOpacity=0.8,\n    stroke='lightgray',\n    strokeWidth=0.5\n).encode(\n    alt.X('Amount_Claimed:Q').title('Claim Amount'),\n    alt.Y('density:Q')\n        .axis(None)\n        .scale(range=[step, -step * overlap]),\n    alt.Fill('Claim_Status_Code:N')\n        .legend(None)\n        .scale(scheme='category10')\n).facet(\n    row=alt.Row('Claim_Status_Code:N')\n        .title(None)\n        .header(labelAngle=0, labelAlign='left')\n).properties(\n    title='Distribution of Claim Amounts by Claim Status',\n    bounds='flush'\n).configure_facet(\n    spacing=0\n).configure_view(\n    stroke=None\n).configure_title(\n    anchor='end'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "insurance_fnol",
        "chart_category": "Bar Charts",
        "chart_type": "bar_and_tick_chart",
        "NLQ": "Can you create a bar chart showing the total number of claims filed by each customer? I'd like to see their names along the bottom and the claim count on the vertical axis. Also, could you add a red horizontal tick mark across all bars showing the average number of claims, so I can easily see which customers are above or below average?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_fnol.sqlite')\n\nquery = '''\nSELECT \n    C.Customer_name AS customer_name,\n    COUNT(Cl.Claim_ID) AS total_claims\nFROM \n    Customers AS C\nJOIN \n    First_Notification_of_Loss AS FNOL ON C.Customer_ID = FNOL.Customer_ID\nJOIN \n    Claims AS Cl ON FNOL.FNOL_ID = Cl.FNOL_ID\nGROUP BY \n    C.Customer_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\naverage_claims = df['total_claims'].mean()\ndf['average_claims'] = average_claims\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('customer_name:N', title='Customer Name'),\n    y=alt.Y('total_claims:Q', title='Total Claims')\n).properties(\n    width=alt.Step(40)\n)\n\ntick = alt.Chart(df).mark_tick(\n    color='red',\n    thickness=2,\n    size=40 * 0.9\n).encode(\n    x=alt.X('customer_name:N', title='Customer Name'),\n    y=alt.Y('average_claims:Q', title='Average Claims')\n)\n\nchart = bar + tick\nchart"
    },
    {
        "type": "type_A",
        "db_id": "insurance_fnol",
        "chart_category": "Distributions",
        "chart_type": "ridgeline_plot",
        "NLQ": "Can you create a ridgeline plot showing the distribution of settlement amounts for each policy type? I'd like to see them stacked vertically with slightly overlapping areas to easily compare the patterns. Use different colors for each policy type, make the areas semi-transparent, and add a light gray border around each area. Title it \"Distribution of Settlement Amounts by Policy Type\" and show the policy type labels on the left side.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/insurance_fnol.sqlite')\n\nquery = '''\nSELECT\n    ap.policy_type_code,\n    s.Settlement_Amount\nFROM\n    Available_Policies AS ap\nJOIN\n    First_Notification_of_Loss AS fnol ON ap.Policy_ID = fnol.Policy_ID\nJOIN\n    Claims AS c ON fnol.FNOL_ID = c.FNOL_ID\nJOIN\n    Settlements AS s ON c.Claim_ID = s.Claim_ID;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nstep = 20\noverlap = 1\n\nchart = alt.Chart(df, height=step).transform_bin(\n    ['bin_amount_min', 'bin_amount_max'], 'Settlement_Amount'\n).transform_aggregate(\n    value='count()', groupby=['policy_type_code', 'bin_amount_min', 'bin_amount_max']\n).transform_impute(\n    impute='value', groupby=['policy_type_code'], key='bin_amount_min', value=0\n).mark_area(\n    interpolate='monotone',\n    fillOpacity=0.8,\n    stroke='lightgray',\n    strokeWidth=0.5\n).encode(\n    alt.X('bin_amount_min:Q')\n        .bin('binned')\n        .title('Settlement Amount'),\n    alt.Y('value:Q')\n        .axis(None)\n        .scale(range=[step, -step * overlap]),\n    alt.Fill('policy_type_code:N')\n        .legend(None)\n).facet(\n    row=alt.Row('policy_type_code:N')\n        .title(None)\n        .header(labelAngle=0, labelAlign='left')\n).properties(\n    title='Distribution of Settlement Amounts by Policy Type',\n    bounds='flush'\n).configure_facet(\n    spacing=0\n).configure_view(\n    stroke=None\n).configure_title(\n    anchor='end'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "insurance_policies",
        "chart_category": "Bar Charts",
        "chart_type": "bar_and_tick_chart",
        "NLQ": "Can you create a chart comparing the total amount claimed versus settled for each policy type? I'd like to see the claimed amounts as blue bars and the settled amounts as red tick marks overlaid on the same chart. Make the bars about 40 units wide so it's easy to compare the values for each policy type.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_policies.sqlite')\n\nquery = '''\nSELECT \n    CP.Policy_Type_Code AS Policy_Type,\n    SUM(C.Amount_Claimed) AS Total_Amount_Claimed,\n    SUM(C.Amount_Settled) AS Total_Amount_Settled\nFROM \n    Customer_Policies AS CP\nJOIN \n    Claims AS C ON CP.Policy_ID = C.Policy_ID\nGROUP BY \n    CP.Policy_Type_Code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar().encode(\n    x='Policy_Type',\n    y='Total_Amount_Claimed'\n).properties(\n    width=alt.Step(40)\n)\n\ntick = alt.Chart(df).mark_tick(\n    color='red',\n    thickness=2,\n    size=40 * 0.9,\n).encode(\n    x='Policy_Type',\n    y='Total_Amount_Settled'\n)\n\nchart = bar + tick\nchart"
    },
    {
        "type": "type_A",
        "db_id": "insurance_policies",
        "chart_category": "Distributions",
        "chart_type": "scatter_plot_with_faceted_marginal_histograms",
        "NLQ": "Can you create a scatter plot showing the relationship between claimed amounts and settled amounts for insurance claims? I'd like to see the data points colored by policy type code. Also, include histograms at the top and right side showing the distribution of claimed and settled amounts respectively, also colored by policy type. Make the histograms slightly transparent and use about 20 bins for each. The histograms should be smaller than the main plot - the top one should be short and the right one should be narrow.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/insurance_policies.sqlite')\n\nquery = '''\nSELECT\n    C.Amount_Claimed,\n    C.Amount_Settled,\n    CP.Policy_Type_Code\nFROM\n    Claims AS C\nJOIN\n    Customer_Policies AS CP ON C.Policy_ID = CP.Policy_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df)\nbase_bar = base.mark_bar(opacity=0.3, binSpacing=0)\n\npoints = base.mark_circle().encode(\n    alt.X(\"Amount_Claimed:Q\"),\n    alt.Y(\"Amount_Settled:Q\"),\n    color=\"Policy_Type_Code:N\",\n)\n\ntop_hist = (\n    base_bar\n    .encode(\n        alt.X(\"Amount_Claimed:Q\")\n            .bin(maxbins=20).stack(None).title(\"\"),\n        alt.Y(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Policy_Type_Code:N\"),\n    )\n    .properties(height=60)\n)\n\nright_hist = (\n    base_bar\n    .encode(\n        alt.Y(\"Amount_Settled:Q\")\n            .bin(maxbins=20)\n            .stack(None)\n            .title(\"\"),\n        alt.X(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Policy_Type_Code:N\"),\n    )\n    .properties(width=60)\n)\n\nchart = top_hist & (points | right_hist)\nchart"
    },
    {
        "type": "type_A",
        "db_id": "journal_committee",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_highlighting_values_beyond_a_threshold",
        "NLQ": "Can you create a bar chart showing total journal sales by theme? I'd like the chart to have \"Journal Theme\" on the x-axis and \"Total Sales\" on the y-axis. Please use blue bars for all themes, but highlight the high performers (those with sales over 2,000) in red. Add a black dotted line at the 2,000 threshold with a label that says \"High Sales Threshold\". Title the chart \"Journal Sales by Theme with Highlighted High Performers\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/journal_committee.sqlite')\n\nquery = '''\nSELECT Theme, SUM(Sales) AS Total_Sales\nFROM journal\nGROUP BY Theme\nORDER BY Total_Sales DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nthreshold = 2000\n\nbars = alt.Chart(df).mark_bar(color=\"steelblue\").encode(\n    x=alt.X(\"Theme:N\", title=\"Journal Theme\"),\n    y=alt.Y(\"Total_Sales:Q\", title=\"Total Sales\")\n)\n\nhighlight = bars.mark_bar(color=\"#e45755\").encode(\n    y2=alt.Y2(datum=threshold)\n).transform_filter(\n    alt.datum.Total_Sales > threshold\n)\n\nrule = alt.Chart().mark_rule(color=\"black\", strokeDash=[3, 5]).encode(\n    y=alt.Y(datum=threshold)\n)\n\nlabel = rule.mark_text(\n    x=\"width\",\n    dx=-2,\n    align=\"right\",\n    baseline=\"bottom\",\n    text=\"High Sales Threshold\"\n)\n\nchart = (bars + highlight + rule + label).properties(\n    title=\"Journal Sales by Theme with Highlighted High Performers\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "journal_committee",
        "chart_category": "Distributions",
        "chart_type": "scatter_plot_with_faceted_marginal_histograms",
        "NLQ": "Can you create a scatter plot showing the relationship between editor age and journal sales, colored by work type? I'd like to see histograms at the top and right side showing the distribution of ages and sales for each work type. Make the scatter points circular and the histogram bars slightly transparent. Also, make sure the axes extend slightly beyond the minimum and maximum values in the data.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/journal_committee.sqlite')\nquery = '''\nSELECT\n    e.Age,\n    j.Sales,\n    jc.Work_Type\nFROM\n    editor AS e\nJOIN\n    journal_committee AS jc ON e.Editor_ID = jc.Editor_ID\nJOIN\n    journal AS j ON jc.Journal_ID = j.Journal_ID;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df)\nbase_bar = base.mark_bar(opacity=0.3, binSpacing=0)\n\nxscale = alt.Scale(domain=(df['Age'].min() - 1, df['Age'].max() + 1))\nyscale = alt.Scale(domain=(df['Sales'].min() - 100, df['Sales'].max() + 100))\n\npoints = base.mark_circle().encode(\n    alt.X(\"Age:Q\").scale(xscale),\n    alt.Y(\"Sales:Q\").scale(yscale),\n    color=\"Work_Type:N\",\n)\n\ntop_hist = (\n    base_bar\n    .encode(\n        alt.X(\"Age:Q\")\n            .bin(maxbins=20, extent=xscale.domain).stack(None).title(\"\"),\n        alt.Y(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Work_Type:N\"),\n    )\n    .properties(height=60)\n)\n\nright_hist = (\n    base_bar\n    .encode(\n        alt.Y(\"Sales:Q\")\n            .bin(maxbins=20, extent=yscale.domain)\n            .stack(None)\n            .title(\"\"),\n        alt.X(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Work_Type:N\"),\n    )\n    .properties(width=60)\n)\n\nchart = top_hist & (points | right_hist)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "journal_committee",
        "chart_category": "Scatter Plots",
        "chart_type": "bubble_plot",
        "NLQ": "Can you create a bubble chart showing the relationship between editors' ages on the x-axis and journal sales on the y-axis? I'd like the size of each bubble to represent how many contributions that editor made to that journal.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/journal_committee.sqlite')\n\nquery = '''\nSELECT \n    e.Age AS Editor_Age,\n    j.Sales AS Journal_Sales,\n    COUNT(jc.Work_Type) AS Contribution_Count\nFROM \n    editor AS e\nJOIN \n    journal_committee AS jc ON e.Editor_ID = jc.Editor_ID\nJOIN \n    journal AS j ON jc.Journal_ID = j.Journal_ID\nGROUP BY \n    e.Editor_ID, j.Journal_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point().encode(\n    x='Editor_Age:Q',\n    y='Journal_Sales:Q',\n    size='Contribution_Count:Q'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "loan_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_highlighting_values_beyond_a_threshold",
        "NLQ": "Can you create a bar chart showing the number of customers for each branch? I'd like the chart to have \"Branch Name\" on the x-axis and \"Number of Customers\" on the y-axis. Please highlight in red the portions of bars that exceed 300 customers, while keeping the bars below this threshold in blue. Add a horizontal line at the 300 customer mark labeled \"Threshold (300)\" on the right side. Title the chart \"Branches with More Than 300 Customers\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/loan_1.sqlite')\nquery = '''\nSELECT branch_ID, bname, no_of_customers\nFROM bank\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nthreshold = 300\n\nbars = alt.Chart(df).mark_bar(color=\"steelblue\").encode(\n    x=alt.X(\"bname:N\", title=\"Branch Name\"),\n    y=alt.Y(\"no_of_customers:Q\", title=\"Number of Customers\"),\n)\n\nhighlight = bars.mark_bar(color=\"#e45755\").encode(\n    y2=alt.Y2(datum=threshold)\n).transform_filter(\n    alt.datum.no_of_customers > threshold\n)\n\nrule = alt.Chart().mark_rule().encode(\n    y=alt.Y(datum=threshold)\n)\n\nlabel = rule.mark_text(\n    x=\"width\",\n    dx=-2,\n    align=\"right\",\n    baseline=\"bottom\",\n    text=\"Threshold (300)\"\n)\n\nchart = (bars + highlight + rule + label).properties(\n    title=\"Branches with More Than 300 Customers\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "loan_1",
        "chart_category": "Distributions",
        "chart_type": "scatter_plot_with_faceted_marginal_histograms",
        "NLQ": "Can you create a scatter plot showing the relationship between account balances and credit scores for different account types? I'd like to see the points colored by account type, with histograms on the top and right sides showing the distribution of account balances and credit scores. Make the histograms use the same colors as the scatter plot points, and keep the histogram bars slightly transparent. For the axes, use the full range of account balances and credit scores in the data.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/loan_1.sqlite')\nquery = '''\nSELECT cust_ID, acc_type, acc_bal, credit_score\nFROM customer\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df)\nbase_bar = base.mark_bar(opacity=0.3, binSpacing=0)\n\nxscale = alt.Scale(domain=(df['acc_bal'].min(), df['acc_bal'].max()))\nyscale = alt.Scale(domain=(df['credit_score'].min(), df['credit_score'].max()))\n\npoints = base.mark_circle().encode(\n    alt.X(\"acc_bal:Q\").scale(xscale),\n    alt.Y(\"credit_score:Q\").scale(yscale),\n    color=\"acc_type:N\",\n)\n\ntop_hist = (\n    base_bar\n    .encode(\n        alt.X(\"acc_bal:Q\")\n        .bin(maxbins=20, extent=xscale.domain)\n        .stack(None)\n        .title(\"Account Balance\"),\n        alt.Y(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"acc_type:N\"),\n    )\n    .properties(height=60)\n)\n\nright_hist = (\n    base_bar\n    .encode(\n        alt.Y(\"credit_score:Q\")\n        .bin(maxbins=20, extent=yscale.domain)\n        .stack(None)\n        .title(\"Credit Score\"),\n        alt.X(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"acc_type:N\"),\n    )\n    .properties(width=60)\n)\n\ntop_hist & (points | right_hist)"
    },
    {
        "type": "type_A",
        "db_id": "loan_1",
        "chart_category": "Scatter Plots",
        "chart_type": "faceted_scatter_plot",
        "NLQ": "Can you create a small scatter plot showing the relationship between number of loans and credit score for customers, with separate plots for each state arranged vertically? I'd like each mini-plot to be the same compact size.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/loan_1.sqlite')\n\nquery = '''\nSELECT c.no_of_loans, c.credit_score, c.state\nFROM customer AS c\nWHERE c.no_of_loans IS NOT NULL AND c.credit_score IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df, width=100, height=100).mark_point().encode(\n    x=\"no_of_loans:Q\",\n    y=\"credit_score:Q\",\n    row=\"state:N\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "local_govt_in_alabama",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_bar",
        "NLQ": "Can you create a bar chart showing the number of events organized by each organizer? I'd like to see the organizer with the most events highlighted in orange, while keeping the other bars in blue. Please title it \"Number of Events Organized by Each Organizer\" and make sure the organizer names are on the x-axis and the event count on the y-axis. Can you make the chart wide enough to read all the organizer names clearly?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_in_alabama.sqlite')\n\nquery = '''\nSELECT \n    P.Participant_Details AS Organizer,\n    COUNT(E.Event_ID) AS Event_Count\nFROM \n    Participants AS P\nJOIN \n    Participants_in_Events AS PE ON P.Participant_ID = PE.Participant_ID\nJOIN \n    Events AS E ON PE.Event_ID = E.Event_ID\nWHERE \n    P.Participant_Type_Code = 'Organizer'\nGROUP BY \n    P.Participant_Details\nORDER BY \n    Event_Count DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nhighlighted_organizer = df.loc[df['Event_Count'].idxmax(), 'Organizer']\n\ncolor = alt.when(alt.datum.Organizer == highlighted_organizer).then(alt.value(\"orange\")).otherwise(alt.value(\"steelblue\"))\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Organizer:N', title='Organizer'),\n    y=alt.Y('Event_Count:Q', title='Number of Events Organized'),\n    color=color\n).properties(width=600, title=\"Number of Events Organized by Each Organizer\")\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "local_govt_in_alabama",
        "chart_category": "Distributions",
        "chart_type": "stacked_density_estimates",
        "NLQ": "Can you show me a stacked area chart comparing the density distributions of Service IDs across different Service Type Codes? Make the chart 400 pixels wide and 100 pixels tall, and use different colors for each Service Type Code.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/local_govt_in_alabama.sqlite')\nquery = '''\nSELECT Service_ID, Service_Type_Code\nFROM Services\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_fold(\n    fold=['Service_ID'],\n    as_=['Measurement_type', 'value']\n).transform_density(\n    density='value',\n    bandwidth=0.3,\n    groupby=['Service_Type_Code'],\n    extent=[0, 10],\n    counts=True,\n    steps=200\n).mark_area().encode(\n    alt.X('value:Q'),\n    alt.Y('density:Q').stack('zero'),\n    alt.Color('Service_Type_Code:N')\n).properties(width=400, height=100)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "local_govt_in_alabama",
        "chart_category": "Scatter Plots",
        "chart_type": "faceted_scatter_plot",
        "NLQ": "Can you create a scatter plot showing the relationship between the number of participants and success rates (in percentage) for different service types? I'd like to see separate panels for each service type code, with the number of participants on the x-axis and success rate on the y-axis. Make each panel about the same size.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_in_alabama.sqlite')\n\nquery = '''\nSELECT \n    S.Service_Type_Code,\n    COUNT(DISTINCT P.Participant_ID) AS Participant_Count,\n    AVG(CASE WHEN E.Event_Details = 'Success' THEN 1 ELSE 0 END) * 100 AS Success_Rate\nFROM \n    Events AS E\nJOIN \n    Services AS S ON E.Service_ID = S.Service_ID\nJOIN \n    Participants_in_Events AS PE ON E.Event_ID = PE.Event_ID\nJOIN \n    Participants AS P ON PE.Participant_ID = P.Participant_ID\nGROUP BY \n    S.Service_Type_Code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point().encode(\n    x=alt.X(\"Participant_Count:Q\", title=\"Number of Participants\"),\n    y=alt.Y(\"Success_Rate:Q\", title=\"Success Rate (%)\"),\n    row=alt.Row(\"Service_Type_Code:N\", title=\"Service Type\")\n).properties(\n    width=200,\n    height=200\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "local_govt_mdm",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_bar",
        "NLQ": "Can you create a bar chart showing the number of customers for each source system from the CMI_Cross_References table? Make the chart about 600 pixels wide with \"Source System\" as the x-axis label and \"Number of Customers\" as the y-axis label. Please highlight the bar for \"Rent\" in orange while keeping the other bars blue, and title the chart \"Number of Customers by Source System\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_mdm.sqlite')\n\nquery = '''\nSELECT \n    source_system_code, \n    COUNT(master_customer_id) AS customer_count\nFROM \n    CMI_Cross_References\nGROUP BY \n    source_system_code\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ncolor = alt.condition(\n    alt.datum.source_system_code == 'Rent',\n    alt.value('orange'),\n    alt.value('steelblue')\n)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('source_system_code:N', title='Source System'),\n    y=alt.Y('customer_count:Q', title='Number of Customers'),\n    color=color\n).properties(\n    width=600,\n    title='Number of Customers by Source System'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "local_govt_mdm",
        "chart_category": "Distributions",
        "chart_type": "stacked_density_estimates",
        "NLQ": "Can you create a stacked density chart showing the distribution of customer cross-reference IDs across all six service types (Council Tax, Business Rates, Benefits Overpayments, Parking Fines, Rent Arrears, and Electoral Register)? Make the chart 400x200 pixels with a title \"Stacked Density Estimates of Customer Cross-Reference IDs by Service Type\" and use different colors for each service type. Focus on the ID range from 0 to 110.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/local_govt_mdm.sqlite')\n\nqueries = {\n    'CouncilTax': 'SELECT cmi_cross_ref_id FROM Council_Tax',\n    'BusinessRates': 'SELECT cmi_cross_ref_id FROM Business_Rates',\n    'BenefitsOverpayments': 'SELECT cmi_cross_ref_id FROM Benefits_Overpayments',\n    'ParkingFines': 'SELECT cmi_cross_ref_id FROM Parking_Fines',\n    'RentArrears': 'SELECT cmi_cross_ref_id FROM Rent_Arrears',\n    'ElectoralRegister': 'SELECT cmi_cross_ref_id FROM Electoral_Register'\n}\n\ndataframes = []\nfor measurement_type, query in queries.items():\n    df = pd.read_sql_query(query, conn)\n    df['Measurement_type'] = measurement_type\n    dataframes.append(df)\n\nsource = pd.concat(dataframes)\nsource = source.rename(columns={'cmi_cross_ref_id': 'value'})\n\nconn.close()\n\nchart = alt.Chart(source).transform_fold(\n    ['value'],\n    as_ = ['Measurement_type_fold', 'value']\n).transform_density(\n    density='value',\n    bandwidth=5,\n    groupby=['Measurement_type'],\n    extent= [0, 110],\n    counts = True,\n    steps=200\n).mark_area().encode(\n    alt.X('value:Q'),\n    alt.Y('density:Q').stack('zero'),\n    alt.Color('Measurement_type:N')\n).properties(\n    width=400,\n    height=200,\n    title='Stacked Density Estimates of Customer Cross-Reference IDs by Service Type'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "local_govt_mdm",
        "chart_category": "Scatter Plots",
        "chart_type": "multifeature_scatter_plot",
        "NLQ": "Could you create a scatter plot showing the relationship between council tax records and rent arrears for each customer? I'd like to see the number of council tax records on the x-axis and the number of rent arrears on the y-axis. Please color the circles by source system code and make the size of each circle represent the total number of cross-references for that customer. Don't start either axis at zero so we can better see the distribution.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_mdm.sqlite')\n\nquery = '''\nSELECT \n    T1.master_customer_id,\n    COUNT(DISTINCT T2.council_tax_id) AS council_tax_count,\n    COUNT(DISTINCT T3.council_tax_id) AS rent_arrears_count,\n    T4.source_system_code,\n    COUNT(T4.cmi_cross_ref_id) AS total_cross_refs\nFROM \n    Customer_Master_Index AS T1\nLEFT JOIN \n    Council_Tax AS T2 ON T2.cmi_cross_ref_id IN (\n        SELECT cmi_cross_ref_id FROM CMI_Cross_References WHERE master_customer_id = T1.master_customer_id\n    )\nLEFT JOIN \n    Rent_Arrears AS T3 ON T3.cmi_cross_ref_id IN (\n        SELECT cmi_cross_ref_id FROM CMI_Cross_References WHERE master_customer_id = T1.master_customer_id\n    )\nLEFT JOIN \n    CMI_Cross_References AS T4 ON T4.master_customer_id = T1.master_customer_id\nGROUP BY \n    T1.master_customer_id, T4.source_system_code\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    alt.X('council_tax_count').scale(zero=False),\n    alt.Y('rent_arrears_count').scale(zero=False, padding=1),\n    color='source_system_code',\n    size='total_cross_refs'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "manufactory_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_segment",
        "NLQ": "Can you create a bar chart showing the revenue of different manufacturers? Please highlight in red the manufacturers with revenue above 100 billion, and add a black dashed line at the 100 billion threshold. Title the chart \"Manufacturer Revenue with Highlighted Threshold\" and make it 600 pixels wide.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufactory_1.sqlite')\nquery = '''\nSELECT Name, Revenue\nFROM Manufacturers\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nthreshold_value = 100\nthreshold_df = pd.DataFrame([{\"threshold\": threshold_value}])\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"Name:N\", title=\"Manufacturer\"),\n    y=alt.Y(\"Revenue:Q\", title=\"Revenue (in billions)\")\n)\n\nhighlight = alt.Chart(df).mark_bar(color=\"#e45755\").encode(\n    x=alt.X(\"Name:N\", title=\"Manufacturer\"),\n    y=alt.Y(\"baseline:Q\", title=\"Revenue (in billions)\"),\n    y2=alt.Y2(\"Revenue:Q\")\n).transform_filter(\n    alt.datum.Revenue > threshold_value\n).transform_calculate(\n    baseline=f\"{threshold_value}\"\n)\n\nrule = alt.Chart(threshold_df).mark_rule(color=\"black\", strokeDash=[3, 5]).encode(\n    y=\"threshold:Q\"\n)\n\nchart = (bars + highlight + rule).properties(width=600, title=\"Manufacturer Revenue with Highlighted Threshold\")\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "manufactory_1",
        "chart_category": "Scatter Plots",
        "chart_type": "multifeature_scatter_plot",
        "NLQ": "Can you create a scatter plot showing the relationship between manufacturer revenue and the average price of their products? I'd like to see the revenue on the x-axis and average product price on the y-axis, with both axes not starting from zero. Make the size of each circle represent the number of products each manufacturer offers, and color-code them by their headquarters location. Please title the chart \"Manufacturer Revenue vs. Average Product Price\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufactory_1.sqlite')\n\nquery = '''\nSELECT \n    M.Revenue AS Revenue,\n    AVG(P.Price) AS AvgProductPrice,\n    COUNT(P.Code) AS ProductCount,\n    M.Headquarter AS Headquarter\nFROM \n    Manufacturers AS M\nJOIN \n    Products AS P ON M.Code = P.Manufacturer\nGROUP BY \n    M.Code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    alt.X('Revenue').scale(zero=False).title('Manufacturer Revenue'),\n    alt.Y('AvgProductPrice').scale(zero=False, padding=1).title('Average Product Price'),\n    color='Headquarter',\n    size='ProductCount'\n).properties(\n    title='Manufacturer Revenue vs. Average Product Price'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "manufacturer",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_segment",
        "NLQ": "Can you create a bar chart showing the number of factories for each manufacturer? I'd like to see which manufacturers have more than 20 factories highlighted in red, with a black dashed line at the 20-factory threshold. Please title it \"Number of Factories by Manufacturer\" and make it wide enough to read all the manufacturer names clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufacturer.sqlite')\nquery = '''\nSELECT Name, Num_of_Factories\nFROM manufacturer\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nthreshold_value = 20\nthreshold_df = pd.DataFrame([{\"threshold\": threshold_value}])\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Name:N', title='Manufacturer'),\n    y=alt.Y('Num_of_Factories:Q', title='Number of Factories')\n)\n\nhighlight = alt.Chart(df).mark_bar(color=\"#e45755\").encode(\n    x='Name:N',\n    y='baseline:Q',\n    y2='Num_of_Factories:Q'\n).transform_filter(\n    alt.datum.Num_of_Factories > threshold_value\n).transform_calculate(\"baseline\", str(threshold_value))\n\nrule = alt.Chart(threshold_df).mark_rule(color=\"black\", strokeDash=[3, 5]).encode(\n    y='threshold:Q'\n)\n\nchart = (bars + highlight + rule).properties(width=600, title=\"Number of Factories by Manufacturer\")\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "manufacturer",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_matrix",
        "NLQ": "Could you please create a scatter matrix showing the relationships between the number of factories, number of shops, and opening year for different manufacturers? I'd like to see all possible combinations of these three variables plotted against each other, with each manufacturer's name shown in a different color so I can easily distinguish them. Make the scatter plots relatively small and allow me to interact with the visualization.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufacturer.sqlite')\nquery = '''\nSELECT Manufacturer_ID, Open_Year, Num_of_Factories, Num_of_Shops, Name\nFROM manufacturer\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nscatter_matrix = alt.Chart(df).mark_circle().encode(\n    alt.X(alt.repeat(\"column\"), type='quantitative'),\n    alt.Y(alt.repeat(\"row\"), type='quantitative'),\n    color='Name:N'\n).properties(\n    width=150,\n    height=150\n).repeat(\n    row=['Num_of_Factories', 'Num_of_Shops', 'Open_Year'],\n    column=['Open_Year', 'Num_of_Shops', 'Num_of_Factories']\n).interactive()\n\nscatter_matrix"
    },
    {
        "type": "type_A",
        "db_id": "match_season",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_segment",
        "NLQ": "Can you create a bar chart showing the number of players drafted in each season? I'd like seasons with more than 10 players to be highlighted in red, with a black dashed line marking the 10-player threshold. Please title it \"Players Drafted Per Season with Highlighted Threshold\" and make sure the horizontal axis shows the seasons and the vertical axis shows the player count.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/match_season.sqlite')\n\nquery = '''\nSELECT Season, COUNT(Player) AS Player_Count\nFROM match_season\nGROUP BY Season\nORDER BY Season\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nthreshold = pd.DataFrame([{\"threshold\": 10}])\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"Season:O\", title=\"Season\"),\n    y=alt.Y(\"Player_Count:Q\", title=\"Number of Players Drafted\")\n)\n\nhighlight = alt.Chart(df).mark_bar(color=\"#e45755\").encode(\n    x='Season:O',\n    y='baseline:Q',\n    y2='Player_Count:Q'\n).transform_filter(\n    alt.datum.Player_Count > 10\n).transform_calculate(\"baseline\", \"10\")\n\nrule = alt.Chart(threshold).mark_rule(color=\"black\", strokeDash=[3, 5]).encode(\n    y='threshold:Q'\n)\n\nchart = (bars + highlight + rule).properties(width=600, title=\"Players Drafted Per Season with Highlighted Threshold\")\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "match_season",
        "chart_category": "Distributions",
        "chart_type": "table_bubble_plot_github_punch_card",
        "NLQ": "Can you create a bubble chart showing the number of players for each team across different seasons? I'd like to see Team IDs on the x-axis and Seasons on the y-axis, with the size of each bubble representing the player count. Please get this data from the match_season table.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/match_season.sqlite')\n\nquery = '''\nSELECT \n    Season AS season,\n    Team AS team_id,\n    COUNT(Player) AS player_count\nFROM match_season\nGROUP BY Season, Team\nORDER BY Season, Team\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    x=alt.X('team_id:O', title='Team ID'),\n    y=alt.Y('season:O', title='Season'),\n    size=alt.Size('player_count:Q', title='Player Count')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "medicine_enzyme_interaction",
        "chart_category": "Distributions",
        "chart_type": "table_bubble_plot_github_punch_card",
        "NLQ": "Can you create a bubble chart showing the count of medicines that interact with enzymes? I'd like to see enzyme locations on the x-axis and interaction types on the y-axis, with the size of each bubble representing the medicine count. Please use a blue color scale for the bubbles where darker blue means higher counts, and title it \"Count of Medicines Interacting with Enzymes by Location and Interaction Type.\"",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/medicine_enzyme_interaction.sqlite')\n\nquery = '''\nSELECT \n    e.Location AS enzyme_location,\n    mei.interaction_type,\n    COUNT(m.id) AS medicine_count\nFROM \n    medicine_enzyme_interaction AS mei\nJOIN \n    enzyme AS e ON mei.enzyme_id = e.id\nJOIN \n    medicine AS m ON mei.medicine_id = m.id\nGROUP BY \n    e.Location, mei.interaction_type\nORDER BY \n    e.Location, mei.interaction_type;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    x=alt.X('enzyme_location:N', title='Enzyme Location'),\n    y=alt.Y('interaction_type:N', title='Interaction Type'),\n    size=alt.Size('medicine_count:Q', title='Medicine Count'),\n    color=alt.Color('medicine_count:Q', scale=alt.Scale(scheme='blues'))\n).properties(\n    title='Count of Medicines Interacting with Enzymes by Location and Interaction Type'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "medicine_enzyme_interaction",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_matrix",
        "NLQ": "Can you create a scatter matrix showing the relationships between enzyme names and medicine names? I'd like to see how they interact with each other, with different interaction types shown in different colors. Include tooltips that show the enzyme name, medicine name, FDA approval status, and interaction type when I hover over points. Make the chart interactive so I can explore the data better.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/medicine_enzyme_interaction.sqlite')\n\nquery = '''\nSELECT \n    e.name AS enzyme_name, \n    m.name AS medicine_name, \n    m.FDA_approved, \n    mei.interaction_type\nFROM \n    medicine_enzyme_interaction AS mei\nJOIN \n    enzyme AS e ON mei.enzyme_id = e.id\nJOIN \n    medicine AS m ON mei.medicine_id = m.id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    alt.X(alt.repeat(\"column\"), type='nominal'),\n    alt.Y(alt.repeat(\"row\"), type='nominal'),\n    color='interaction_type:N',\n    tooltip=['enzyme_name', 'medicine_name', 'FDA_approved', 'interaction_type']\n).properties(\n    width=150,\n    height=150\n).repeat(\n    row=['enzyme_name', 'medicine_name'],\n    column=['medicine_name', 'enzyme_name']\n).interactive()\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "mountain_photos",
        "chart_category": "Distributions",
        "chart_type": "table_bubble_plot_github_punch_card",
        "NLQ": "Can you create a bubble chart showing when photos are taken throughout the week? I'd like to see the hours of the day on the x-axis and days of the week on the y-axis, with bubble sizes showing the number of photos taken at each time. Please color the bubbles based on the photo color and title it \"Photos Taken by Mountain, Day, and Hour\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/mountain_photos.sqlite')\nquery = '''\nSELECT \n    m.name AS mountain_name,\n    strftime('%w', p.id) AS day_of_week,\n    strftime('%H', p.id) AS hour_of_day,\n    p.color AS photo_color,\n    COUNT(*) AS photo_count\nFROM photos AS p\nJOIN mountain AS m ON p.mountain_id = m.id\nGROUP BY m.name, day_of_week, hour_of_day, p.color\nORDER BY m.name, day_of_week, hour_of_day\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    x=alt.X('hour_of_day:O', title='Hour of Day'),\n    y=alt.Y('day_of_week:O', title='Day of Week', sort=['0', '1', '2', '3', '4', '5', '6']),\n    size=alt.Size('photo_count:Q', title='Number of Photos'),\n    color=alt.Color('photo_color:N', title='Photo Color')\n).properties(\n    title='Photos Taken by Mountain, Day, and Hour'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "movie_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_labels",
        "NLQ": "Can you create a horizontal bar chart showing average movie ratings? I'd like to see movie titles on the y-axis and their average ratings on the x-axis, with the movies sorted from highest to lowest rating. Please include the actual rating values as text labels next to each bar, formatted to two decimal places. Title the chart \"Average Movie Ratings\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/movie_1.sqlite')\n\nquery = '''\nSELECT \n    M.title AS MovieTitle,\n    AVG(R.stars) AS AverageRating\nFROM \n    Rating AS R\nJOIN \n    Movie AS M ON R.mID = M.mID\nGROUP BY \n    M.mID, M.title\nORDER BY \n    AverageRating DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('AverageRating:Q', title='Average Rating'),\n    y=alt.Y('MovieTitle:N', sort='-x', title='Movie Title'),\n    text=alt.Text('AverageRating:Q', format='.2f')\n)\n\nchart = base.mark_bar() + base.mark_text(align='left', dx=2)\nchart.properties(title=\"Average Movie Ratings\")"
    },
    {
        "type": "type_A",
        "db_id": "movie_1",
        "chart_category": "Distributions",
        "chart_type": "violin_plot",
        "NLQ": "Can you create a visualization showing the distribution of movie ratings (from 1 to 5 stars) across different years? I'd like to see horizontal density plots for each year arranged in separate columns side by side, with the rating stars on the vertical axis. Please color-code each year's distribution and remove grid lines and unnecessary axis labels to keep it clean.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/movie_1.sqlite')\n\nquery = '''\nSELECT \n    Movie.year AS year, \n    Rating.stars AS stars\nFROM \n    Rating\nJOIN \n    Movie ON Rating.mID = Movie.mID\nWHERE \n    Rating.stars IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_density(\n    'stars',\n    as_=['stars', 'density'],\n    extent=[1, 5],\n    groupby=['year']\n).mark_area(orient='horizontal').encode(\n    alt.X('density:Q')\n        .stack('center')\n        .impute(None)\n        .title(None)\n        .axis(labels=False, values=[0], grid=False, ticks=True),\n    alt.Y('stars:Q', title='Rating Stars'),\n    alt.Color('year:N', title='Year'),\n    alt.Column('year:N')\n        .spacing(0)\n        .header(titleOrient='bottom', labelOrient='bottom', labelPadding=0)\n).configure_view(\n    stroke=None\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "museum_visit",
        "chart_category": "Distributions",
        "chart_type": "violin_plot",
        "NLQ": "Can you create a horizontal violin plot showing the distribution of total spending by visitors at each museum? I'd like to see them arranged in separate columns with the museum names at the bottom. Make sure to label the y-axis as \"Total Spent\" and include a color legend for the different museums. No need to show the density values on the x-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/museum_visit.sqlite')\n\nquery = '''\nSELECT \n    m.Name AS Museum_Name,\n    v.Total_spent\nFROM \n    visit AS v\nJOIN \n    museum AS m\nON \n    v.Museum_ID = m.Museum_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_density(\n    'Total_spent',\n    as_=['Total_spent', 'density'],\n    extent=[0, df['Total_spent'].max()],\n    groupby=['Museum_Name']\n).mark_area(orient='horizontal').encode(\n    alt.X('density:Q')\n        .stack('center')\n        .impute(None)\n        .title(None)\n        .axis(labels=False, values=[0], grid=False, ticks=True),\n    alt.Y('Total_spent:Q', title='Total Spent'),\n    alt.Color('Museum_Name:N', title='Museum'),\n    alt.Column('Museum_Name:N')\n        .spacing(0)\n        .header(titleOrient='bottom', labelOrient='bottom', labelPadding=0)\n).configure_view(\n    stroke=None\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "musical",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_labels_based_on_measured_luminance",
        "NLQ": "Show me a horizontal bar chart of nominees and their nomination counts, sorted from highest to lowest. Color the bars based on the nomination count and display the count value inside each bar. Make sure the text is white on dark bars and black on light bars for better readability.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/musical.sqlite')\n\nquery = '''\nSELECT Nominee, COUNT(*) AS NominationCount\nFROM musical\nGROUP BY Nominee\nORDER BY NominationCount DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('NominationCount:Q').stack('zero'),\n    y=alt.Y('Nominee:O').sort('-x'),\n    text=alt.Text('NominationCount:Q', format='.0f')\n)\n\nbars = base.mark_bar(\n    tooltip=alt.expr(\"luminance(scale('color', datum.NominationCount))\")\n).encode(\n    color='NominationCount:Q'\n)\n\ntext = base.mark_text(\n    align='right',\n    dx=-3,\n    color=alt.expr(\"luminance(scale('color', datum.NominationCount)) > 0.5 ? 'black' : 'white'\")\n)\n\nbars + text"
    },
    {
        "type": "type_A",
        "db_id": "musical",
        "chart_category": "Distributions",
        "chart_type": "violin_plot",
        "NLQ": "Can you create a horizontal violin plot showing the age distribution of actors in Tony Award-nominated musicals? I'd like to see each musical in its own column with the actor ages on the vertical axis. Please use different colors for each musical and include a legend labeled \"Musical\". Don't show any density values on the horizontal axis, just the shape of the distribution, and set the age range from 15 to 70 years old.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/musical.sqlite')\nquery = '''\nSELECT m.Name AS Musical_Name, a.age AS Actor_Age\nFROM musical AS m\nJOIN actor AS a ON m.Musical_ID = a.Musical_ID\nWHERE m.Award = 'Tony Award' AND m.Result = 'Nominated'\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_density(\n    'Actor_Age',\n    as_=['Actor_Age', 'density'],\n    extent=[15, 70],\n    groupby=['Musical_Name']\n).mark_area(orient='horizontal').encode(\n    alt.X('density:Q')\n        .stack('center')\n        .impute(None)\n        .title(None)\n        .axis(labels=False, values=[0], grid=False, ticks=True),\n    alt.Y('Actor_Age:Q', title='Actor Age'),\n    alt.Color('Musical_Name:N', legend=alt.Legend(title=\"Musical\")),\n    alt.Column('Musical_Name:N')\n        .spacing(0)\n        .header(titleOrient='bottom', labelOrient='bottom', labelPadding=0)\n).configure_view(\n    stroke=None\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "music_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_labels_based_on_measured_luminance",
        "NLQ": "Can you create a horizontal bar chart showing the total number of songs for each music genre? I'd like the genres sorted from highest to lowest count, with the genre names on the y-axis and the song counts on the x-axis. Please include the exact count number inside each bar, making sure the text is readable against the bar color. Also, color the bars based on the song count values and title the chart \"Total Number of Songs per Genre\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/music_1.sqlite')\n\nquery = '''\nSELECT \n    g.g_name AS genre_name, \n    COUNT(s.song_name) AS song_count\nFROM \n    genre AS g\nLEFT JOIN \n    song AS s ON g.g_name = s.genre_is\nGROUP BY \n    g.g_name\nORDER BY \n    song_count DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('song_count:Q', title='Total Number of Songs'),\n    y=alt.Y('genre_name:O', title='Genre', sort='-x'),\n    text=alt.Text('song_count:Q', format='.0f')\n)\n\nbars = base.mark_bar(\n    tooltip=alt.expr(\"luminance(scale('color', datum.song_count))\")\n).encode(\n    color='song_count:Q'\n)\n\ntext = base.mark_text(\n    align='right',\n    dx=-3,\n    color=alt.expr(\"luminance(scale('color', datum.song_count)) > 0.5 ? 'black' : 'white'\")\n)\n\nchart = bars + text\nchart.properties(title=\"Total Number of Songs per Genre\")"
    },
    {
        "type": "type_A",
        "db_id": "music_1",
        "chart_category": "Interactive Charts",
        "chart_type": "bar_chart_with_highlighting_on_hover_and_selection_on_click",
        "NLQ": "Can you create a bar chart showing the total number of songs for each music genre? I only want to see genres with ratings above 7. Make the bars blue with black outlines and let me hover over them to highlight a genre or click to select one. When I interact with the bars, show me the genre name, total songs, and its rating. Sort the genres by the number of songs from highest to lowest.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/music_1.sqlite')\n\nquery = '''\nSELECT \n    g.g_name AS genre_name,\n    COUNT(s.song_name) AS total_songs,\n    g.rating AS genre_rating\nFROM \n    genre AS g\nLEFT JOIN \n    song AS s ON g.g_name = s.genre_is\nGROUP BY \n    g.g_name\nORDER BY \n    total_songs DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselect = alt.selection_point(name=\"select\", on=\"click\")\nhighlight = alt.selection_point(name=\"highlight\", on=\"pointerover\", empty=False)\n\nstroke_width = (\n    alt.when(select).then(alt.value(2))\n    .when(highlight).then(alt.value(1))\n    .otherwise(alt.value(0))\n)\n\nchart = alt.Chart(df, height=200).mark_bar(\n    fill=\"#4C78A8\", stroke=\"black\", cursor=\"pointer\"\n).encode(\n    x=alt.X(\"genre_name:N\", title=\"Genre\"),\n    y=alt.Y(\"total_songs:Q\", title=\"Total Songs\"),\n    fillOpacity=alt.when(select).then(alt.value(1)).otherwise(alt.value(0.3)),\n    strokeWidth=stroke_width,\n    tooltip=[\"genre_name\", \"total_songs\", \"genre_rating\"]\n).transform_filter(\n    alt.datum.genre_rating > 7\n).add_params(\n    select, highlight\n).configure_scale(\n    bandPaddingInner=0.2\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "music_4",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_at_mean",
        "NLQ": "Can you create a bar chart showing the number of songs on top for each artist? Please add a red horizontal line showing the average number of songs across all artists. Make the chart wide enough to see all the artists clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/music_4.sqlite')\nquery = '''\nSELECT \n    a.Artist, COUNT(v.Song) AS Song_Count\nFROM \n    artist AS a\nJOIN \n    volume AS v ON a.Artist_ID = v.Artist_ID\nGROUP BY \n    a.Artist\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Artist:N', title='Artist'),\n    y=alt.Y('Song_Count:Q', title='Number of Songs on Top')\n)\n\nrule = alt.Chart(df).mark_rule(color='red').encode(\n    y='mean(Song_Count):Q'\n)\n\n(bar + rule).properties(width=600)"
    },
    {
        "type": "type_A",
        "db_id": "music_4",
        "chart_category": "Interactive Charts",
        "chart_type": "bar_chart_with_highlighting_on_hover_and_selection_on_click",
        "NLQ": "Can you create a bar chart showing artists and their total weeks on top of the charts? Make the bars blue with black outlines, and let me interact with them - when I hover over a bar it should highlight, and when I click on a bar it should stay highlighted while the other bars appear faded. Please label the x-axis as \"Artist\" and the y-axis as \"Total Weeks on Top\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/music_4.sqlite')\n\nquery = '''\nSELECT \n    a.Artist AS Artist_Name,\n    SUM(v.Weeks_on_Top) AS Total_Weeks_on_Top\nFROM \n    artist AS a\nJOIN \n    volume AS v ON a.Artist_ID = v.Artist_ID\nGROUP BY \n    a.Artist\nORDER BY \n    Total_Weeks_on_Top DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselect = alt.selection_point(name=\"select\", on=\"click\")\nhighlight = alt.selection_point(name=\"highlight\", on=\"pointerover\", empty=False)\n\nstroke_width = (\n    alt.when(select).then(alt.value(2, empty=False))\n    .when(highlight).then(alt.value(1))\n    .otherwise(alt.value(0))\n)\n\nchart = alt.Chart(df, height=200).mark_bar(\n    fill=\"#4C78A8\", stroke=\"black\", cursor=\"pointer\"\n).encode(\n    x=alt.X(\"Artist_Name:N\", title=\"Artist\"),\n    y=alt.Y(\"Total_Weeks_on_Top:Q\", title=\"Total Weeks on Top\"),\n    fillOpacity=alt.when(select).then(alt.value(1)).otherwise(alt.value(0.3)),\n    strokeWidth=stroke_width,\n).configure_scale(bandPaddingInner=0.2).add_params(select, highlight)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "network_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_at_mean",
        "NLQ": "Can you create a bar chart showing the number of friends each student has? I'd like to see each student's name on the x-axis and their friend count on the y-axis. Also, please add a red horizontal line showing the average number of friends across all students. Title the chart \"Number of Friends per Student with Average Line\" and make it wide enough to read all the student names clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/network_1.sqlite')\n\nquery = '''\nSELECT \n    T1.ID AS student_id, \n    T1.name AS student_name, \n    COUNT(T2.friend_id) AS friend_count\nFROM \n    Highschooler AS T1\nLEFT JOIN \n    Friend AS T2 ON T1.ID = T2.student_id\nGROUP BY \n    T1.ID, T1.name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('student_name:N', title='Student Name'),\n    y=alt.Y('friend_count:Q', title='Number of Friends')\n)\n\nrule = alt.Chart(df).mark_rule(color='red').encode(\n    y='mean(friend_count):Q'\n)\n\nchart = (bar + rule).properties(\n    width=600,\n    title='Number of Friends per Student with Average Line'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "network_1",
        "chart_category": "Interactive Charts",
        "chart_type": "bar_chart_with_highlighting_on_hover_and_selection_on_click",
        "NLQ": "Can you create a blue bar chart showing the number of friends each high school student has? I'd like the students' names on the x-axis and their friend count on the y-axis. Make it interactive so bars become highlighted when I hover over them and stay selected when I click on them. When I select a bar, it should appear fully opaque while unselected bars should look more transparent. Also, add a thin black outline around bars when they're selected or hovered over.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/network_1.sqlite')\n\nquery = '''\nSELECT \n    h.name AS student_name,\n    COUNT(f.friend_id) AS friend_count\nFROM \n    Highschooler AS h\nLEFT JOIN \n    Friend AS f ON h.ID = f.student_id\nGROUP BY \n    h.ID, h.name\nORDER BY \n    friend_count DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselect = alt.selection_point(name=\"select\", on=\"click\")\nhighlight = alt.selection_point(name=\"highlight\", on=\"pointerover\", empty=False)\n\nstroke_width = (\n    alt.when(select).then(alt.value(2))\n    .when(highlight).then(alt.value(1))\n    .otherwise(alt.value(0))\n)\n\nchart = alt.Chart(df, height=200).mark_bar(\n    fill=\"#4C78A8\", stroke=\"black\", cursor=\"pointer\"\n).encode(\n    x=alt.X(\"student_name:N\", title=\"Student Name\"),\n    y=alt.Y(\"friend_count:Q\", title=\"Number of Friends\"),\n    fillOpacity=alt.when(select).then(alt.value(1)).otherwise(alt.value(0.3)),\n    strokeWidth=stroke_width,\n).configure_scale(bandPaddingInner=0.2).add_params(select, highlight)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "network_2",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_at_mean",
        "NLQ": "Can you create a bar chart showing the average friendship duration in years for people with different job titles? Make the chart about 600 pixels wide, label the x-axis \"Job Title\" and the y-axis \"Average Friendship Duration (Years)\", and add a red horizontal line showing the overall average across all jobs. Title it \"Average Friendship Duration by Job Title\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\ndb_path = './database/network_2.sqlite'\nconn = sqlite3.connect(db_path)\nsql_query = 'SELECT p.job, AVG(pf.year) AS avg_friendship_duration FROM Person p JOIN PersonFriend pf ON p.name = pf.name GROUP BY p.job'\ndata = pd.read_sql_query(sql_query, conn)\nconn.close()\n\nbar = alt.Chart(data).mark_bar().encode(\n    x=alt.X('job:N', title='Job Title'),\n    y=alt.Y('avg_friendship_duration:Q', title='Average Friendship Duration (Years)')\n)\n\nrule = alt.Chart(data).mark_rule(color='red').encode(\n    y=alt.Y('mean(avg_friendship_duration):Q', title='Overall Average')\n)\n\nchart = (bar + rule).properties(\n    title='Average Friendship Duration by Job Title'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "network_2",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_average",
        "NLQ": "Can you create a bar chart showing the average years of friendship by city? I'd like to be able to select specific cities, and when I do, show those bars at full opacity while the unselected ones appear slightly faded. Also, add a red horizontal line showing the mean friendship years, but only calculate this average based on the cities I've selected.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/network_2.sqlite')\n\nquery = '''\nSELECT \n    P.city AS city, \n    AVG(PF.year) AS avg_years\nFROM \n    PersonFriend AS PF\nJOIN \n    Person AS P ON PF.name = P.name\nGROUP BY \n    P.city\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('city:N', title='City'),\n    y=alt.Y('avg_years:Q', title='Average Years of Friendship'),\n    opacity=alt.condition(brush, alt.value(1), alt.value(0.7)),\n).add_params(\n    brush\n)\n\nline = alt.Chart(df).mark_rule(color='firebrick').encode(\n    y='mean(avg_years):Q',\n    size=alt.SizeValue(3)\n).transform_filter(\n    brush\n)\n\nchart = alt.layer(bars, line)\nchart.display()"
    },
    {
        "type": "type_A",
        "db_id": "news_report",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_on_dual_axis",
        "NLQ": "Can you create a chart showing the number of events per year as bars, with a red line overlaid showing the average experience of journalists? I'd like the chart to have \"Events per Year and Average Journalist Experience\" as the title, with separate scales for the event count and years of experience. Please organize the years along the bottom of the chart.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/news_report.sqlite')\n\nquery = '''\nSELECT\n    CAST(SUBSTR(T1.Date, LENGTH(T1.Date) - 3) AS INTEGER) AS EventYear,\n    COUNT(T1.Event_ID) AS NumberOfEvents,\n    AVG(T3.Years_working) AS AverageJournalistExperience\nFROM\n    event AS T1\nJOIN\n    news_report AS T2 ON T1.Event_ID = T2.Event_ID\nJOIN\n    journalist AS T3 ON T2.journalist_ID = T3.journalist_ID\nGROUP BY\n    EventYear\nORDER BY\n    EventYear;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('EventYear:O', title='Event Year')\n)\n\nbars = base.mark_bar().encode(\n    y=alt.Y('NumberOfEvents:Q', title='Number of Events')\n)\n\nline = base.mark_line(color='red').encode(\n    y=alt.Y('AverageJournalistExperience:Q', title='Average Journalist Experience')\n)\n\nchart = (bars + line).resolve_scale(\n    y='independent'\n).properties(\n    title='Events per Year and Average Journalist Experience'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "news_report",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_average",
        "NLQ": "Can you create a bar chart showing the average attendance for each venue? I'd like to see the overall average attendance across all venues as a red horizontal line. Make it interactive so I can select date ranges to filter the data. Include tooltips that show the venue name and average attendance when I hover over the bars. Title it \"Average Event Attendance by Venue with Date Range Selection\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/news_report.sqlite')\nquery = '''\nSELECT Venue, Date, Event_Attendance\nFROM event\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['Date'] = pd.to_datetime(df['Date'], format='%d %B %Y')\nbrush = alt.selection_interval(encodings=['x'])\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Venue:N', title='Venue'),\n    y=alt.Y('mean(Event_Attendance):Q', title='Average Attendance'),\n    opacity=alt.condition(brush, alt.value(1), alt.value(0.7)),\n    tooltip=['Venue:N', alt.Tooltip('mean(Event_Attendance):Q', title='Avg Attendance')]\n).add_params(brush)\n\nline = alt.Chart(df).mark_rule(color='firebrick').encode(\n    y='mean(Event_Attendance):Q',\n    size=alt.SizeValue(3),\n    tooltip=[alt.Tooltip('mean(Event_Attendance):Q', title='Overall Avg Attendance')]\n).transform_filter(brush)\n\nchart = alt.layer(bars, line).properties(\n    width=600,\n    height=400,\n    title='Average Event Attendance by Venue with Date Range Selection'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "orchestra",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_on_dual_axis",
        "NLQ": "Can you create a chart comparing different performance types in the orchestra database? I'd like to see the average attendance shown as bars and the average official ratings (in millions) as a red line on the same graph. Put the performance types along the bottom axis, with separate scales for attendance and ratings. Make the chart about 600 pixels wide so I can easily spot trends between attendance and ratings for each type of performance.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/orchestra.sqlite')\nquery = \"\"\"\nSELECT\n    P.Type,\n    AVG(S.Attendance) AS Average_Attendance,\n    AVG(P.\"Official_ratings_(millions)\") AS Average_Official_Ratings\nFROM Performance AS P\nJOIN Show AS S\n    ON P.Performance_ID = S.Performance_ID\nGROUP BY\n    P.Type;\n\"\"\"\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x='Type:N'\n).properties(\n    width=600\n)\nbar = base.mark_bar().encode(\n    y='Average_Attendance:Q'\n)\nline = base.mark_line(color='red').encode(\n    y='Average_Official_Ratings:Q'\n)\n(bar + line).resolve_scale(\n    y='independent'\n)"
    },
    {
        "type": "type_A",
        "db_id": "orchestra",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_average",
        "NLQ": "Can you create a bar chart showing the official ratings of different performance types over time? I'd like to see the performance types in different colors, with an average rating line in red. Make it interactive so I can select specific date ranges to see how the average rating changes. Please title it \"Official Ratings of Performance Types Over Time with Average Line (Interactive)\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/orchestra.sqlite')\n\nquery = '''\nSELECT Date, Type, `Official_ratings_(millions)` AS Official_ratings\nFROM performance;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbars = alt.Chart(df).mark_bar().encode(\n    x='Date:O',\n    y='Official_ratings:Q',\n    color='Type:N',\n    opacity=alt.condition(brush, alt.value(1), alt.value(0.7))\n).add_params(\n    brush\n)\n\nline = alt.Chart(df).mark_rule(color='firebrick').encode(\n    y='mean(Official_ratings):Q',\n    size=alt.SizeValue(3)\n).transform_filter(\n    brush\n)\n\nchart = alt.layer(bars, line).properties(\n    title='Official Ratings of Performance Types Over Time with Average Line (Interactive)'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "party_host",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_on_dual_axis",
        "NLQ": "Can you create a chart showing the total number of hosts for each party theme as bars, and overlay a red line showing the average number of active years for each theme? I'd like the party themes sorted by the number of hosts in descending order, with the themes listed along the bottom and two different scales on the sides - one for the number of hosts and another for the average active years.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/party_host.sqlite')\n\nquery = '''\nSELECT \n    p.Party_Theme,\n    SUM(p.Number_of_hosts) AS Total_Hosts,\n    AVG(CAST(p.Last_year AS INT) - CAST(p.First_year AS INT)) AS Avg_Active_Years\nFROM \n    party AS p\nGROUP BY \n    p.Party_Theme\nORDER BY \n    Total_Hosts DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(x=alt.X('Party_Theme:N', title='Party Theme'))\n\nbar = base.mark_bar().encode(\n    y=alt.Y('Total_Hosts:Q', title='Total Number of Hosts')\n)\n\nline = base.mark_line(color='red').encode(\n    y=alt.Y('Avg_Active_Years:Q', title='Average Active Years')\n)\n\nchart = (bar + line).resolve_scale(y='independent').properties(width=600)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "party_people",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_negative_values",
        "NLQ": "Can you show me a bar chart of the net change in political party membership each year? I'd like to see increases in blue and decreases in orange, with a clear title \"Net Change in Political Party Membership Over Time\" and labeled axes.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/party_people.sqlite')\n\nquery = '''\nWITH MembershipYears AS (\n    SELECT \n        CAST(SUBSTR(In_office, 1, 4) AS INTEGER) AS StartYear,\n        CASE \n            WHEN Instr(In_office, 'â') > 0 THEN \n                CASE \n                    WHEN SUBSTR(In_office, Instr(In_office, 'â') + 1) = 'present' THEN strftime('%Y', 'now')\n                    ELSE CAST(SUBSTR(In_office, Instr(In_office, 'â') + 1) AS INTEGER)\n                END\n            ELSE CAST(SUBSTR(In_office, 1, 4) AS INTEGER)\n        END AS EndYear\n    FROM member\n),\nYearlyMembership AS (\n    SELECT \n        Year,\n        SUM(CASE WHEN Year BETWEEN StartYear AND EndYear THEN 1 ELSE -1 END) AS NetChange\n    FROM MembershipYears,\n         (SELECT DISTINCT CAST(SUBSTR(In_office, 1, 4) AS INTEGER) AS Year FROM member)\n    GROUP BY Year\n)\nSELECT Year, NetChange\nFROM YearlyMembership\nORDER BY Year;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\npredicate = alt.datum.NetChange > 0\ncolor = alt.when(predicate).then(alt.value(\"steelblue\")).otherwise(alt.value(\"orange\"))\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"Year:O\", title=\"Year\"),\n    y=alt.Y(\"NetChange:Q\", title=\"Net Change in Membership\"),\n    color=color\n).properties(width=600, title=\"Net Change in Political Party Membership Over Time\")\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "party_people",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_chart_with_aggregation",
        "NLQ": "Can you create a bar chart showing the number of political parties in each region? I'd like a slider to filter by office year, where parties that took office after the selected year appear in blue, while those before that year are shown in light gray. Please title it \"Number of Political Parties per Region by Office Year\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/party_people.sqlite')\n\nquery = '''\nSELECT\n    r.Region_name,\n    COUNT(p.Party_ID) AS NumberOfParties,\n    CAST(SUBSTR(p.Took_office, 1, 4) AS INTEGER) AS OfficeYear\nFROM region AS r\nJOIN party AS p ON r.Region_ID = p.Region_ID\nGROUP BY r.Region_name, OfficeYear\nORDER BY r.Region_name, OfficeYear\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nslider = alt.binding_range(min=df['OfficeYear'].min(), max=df['OfficeYear'].max(), step=1, name='Office Year Threshold:')\nthreshold = alt.param(name=\"year_threshold\", value=df['OfficeYear'].min(), bind=slider)\n\nchart = alt.layer(\n    alt.Chart(df).mark_bar().encode(\n        x=alt.X('Region_name:N', title='Region'),\n        y=alt.Y('NumberOfParties:Q', title='Number of Parties'),\n        color=alt.condition(\n            alt.datum.OfficeYear >= threshold,\n            alt.value('steelblue'),\n            alt.value('lightgray')\n        )\n    ).transform_filter(\n        alt.datum.OfficeYear >= threshold\n    ),\n    alt.Chart(df).mark_bar().encode(\n        x=alt.X('Region_name:N', title='Region'),\n        y=alt.Y('NumberOfParties:Q', title='Number of Parties'),\n        color=alt.value('lightgray')\n    ).transform_filter(\n        alt.datum.OfficeYear < threshold\n    )\n).add_params(\n    threshold\n).properties(\n    title='Number of Political Parties per Region by Office Year'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "pets_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_range",
        "NLQ": "Can you create a bar chart showing the weight range for each type of pet? I'd like to see the minimum and maximum weights for each pet type with rounded corners on the bars. Please label both the minimum and maximum weight values directly on the bars, and title it \"Weight Range by Pet Type\" with a subtitle \"Minimum and Maximum Weight for Each Pet Type\". Show the weight in kilograms on the x-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/pets_1.sqlite')\n\nquery = '''\nSELECT \n    Pets.PetType,\n    MIN(Pets.weight) AS min_weight,\n    MAX(Pets.weight) AS max_weight\nFROM \n    Pets\nGROUP BY \n    Pets.PetType\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar(cornerRadius=10, height=15).encode(\n    x=alt.X('min_weight:Q').scale(domain=[0, df['max_weight'].max() + 2]).title('Weight Range (kg)'),\n    x2='max_weight:Q',\n    y=alt.Y('PetType:O').title('Pet Type')\n)\n\ntext_min = alt.Chart(df).mark_text(align='right', dx=-5).encode(\n    x='min_weight:Q',\n    y=alt.Y('PetType:O'),\n    text='min_weight:Q'\n)\n\ntext_max = alt.Chart(df).mark_text(align='left', dx=5).encode(\n    x='max_weight:Q',\n    y=alt.Y('PetType:O'),\n    text='max_weight:Q'\n)\n\n(bar + text_min + text_max).properties(\n    title=alt.Title(text='Weight Range by Pet Type', subtitle='Minimum and Maximum Weight for Each Pet Type')\n)"
    },
    {
        "type": "type_A",
        "db_id": "pets_1",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_chart_with_cross-highlight",
        "NLQ": "Can you create an interactive visualization showing pet ownership patterns by student age? I'd like to see a heatmap at the top showing pet types across age groups with a color scale from light to dark green-blue indicating the number of pets. Below that, include a bar chart of pet types that responds when I select age ranges in the heatmap. Use grey points on the heatmap to show selected data, and highlight the corresponding bars in blue when selected while keeping unselected bars grey. Label the color scale as \"Total Pets\" and the size legend as \"Pets in Selection\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/pets_1.sqlite')\n\nquery = '''\nSELECT \n    S.Age AS Student_Age, \n    P.PetType AS Pet_Type, \n    COUNT(*) AS Pet_Count\nFROM \n    Student AS S\nJOIN \n    Has_Pet AS HP ON S.StuID = HP.StuID\nJOIN \n    Pets AS P ON HP.PetID = P.PetID\nGROUP BY \n    S.Age, P.PetType\nORDER BY \n    S.Age, P.PetType\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\npts = alt.selection_point(encodings=['x'])\n\nrect = alt.Chart(df).mark_rect().encode(\n    alt.X('Student_Age:Q').bin(),\n    alt.Y('Pet_Type:N'),\n    alt.Color('sum(Pet_Count):Q').scale(scheme='greenblue').title('Total Pets')\n)\n\ncirc = rect.mark_point().encode(\n    alt.ColorValue('grey'),\n    alt.Size('sum(Pet_Count):Q').title('Pets in Selection')\n).transform_filter(pts)\n\nbar = alt.Chart(df, width=550, height=200).mark_bar().encode(\n    x='Pet_Type:N',\n    y='sum(Pet_Count):Q',\n    color=alt.when(pts).then(alt.ColorValue(\"steelblue\")).otherwise(alt.ColorValue(\"grey\"))\n).add_params(pts)\n\nchart = alt.vconcat(\n    rect + circ,\n    bar\n).resolve_legend(\n    color=\"independent\",\n    size=\"independent\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "pets_1",
        "chart_category": "Scatter Plots",
        "chart_type": "simple_scatter_plot_with_labels",
        "NLQ": "Can you create a scatter plot showing the relationship between pet age and weight? I'd like each point to be labeled with its PetID, with the labels positioned slightly to the right of each point.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/pets_1.sqlite')\nquery = '''\nSELECT pet_age, weight, PetID\nFROM Pets\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['PetID'] = df['PetID'].astype(str)\n\npoints = alt.Chart(df).mark_point().encode(\n    x='pet_age:Q',\n    y='weight:Q'\n)\n\ntext = points.mark_text(\n    align='left',\n    baseline='middle',\n    dx=7\n).encode(\n    text='PetID:N'\n)\n\npoints + text"
    },
    {
        "type": "type_A",
        "db_id": "phone_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_range",
        "NLQ": "Can you create a bar chart showing the RAM range for phone chips by launch year? I'd like to see horizontal bars representing the minimum to maximum RAM in MiB for each year, with years listed vertically on the left side and RAM values horizontally along the bottom. Please include the actual minimum and maximum RAM values as labels at both ends of each bar, make the bars thin with rounded corners, and give the chart a title \"RAM Range by Launch Year\" with a subtitle explaining it shows minimum and maximum RAM for each year.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/phone_1.sqlite')\n\nquery = '''\nSELECT \n    Launch_year, \n    MIN(RAM_MiB) AS min_ram, \n    MAX(RAM_MiB) AS max_ram\nFROM chip_model\nGROUP BY Launch_year\nORDER BY Launch_year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar(cornerRadius=10, height=10).encode(\n    x=alt.X('min_ram:Q').scale(domain=[0, df['max_ram'].max() + 10]).title('RAM Range (MiB)'),\n    x2='max_ram:Q',\n    y=alt.Y('Launch_year:O').title('Launch Year')\n)\n\ntext_min = alt.Chart(df).mark_text(align='right', dx=-5).encode(\n    x='min_ram:Q',\n    y=alt.Y('Launch_year:O'),\n    text='min_ram:Q'\n)\n\ntext_max = alt.Chart(df).mark_text(align='left', dx=5).encode(\n    x='max_ram:Q',\n    y=alt.Y('Launch_year:O'),\n    text='max_ram:Q'\n)\n\n(bar + text_min + text_max).properties(\n    title=alt.Title(text='RAM Range by Launch Year', subtitle='Minimum and Maximum RAM for Each Year')\n)"
    },
    {
        "type": "type_A",
        "db_id": "phone_1",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_chart_with_cross-highlight",
        "NLQ": "Can you show me a heatmap of phone models by launch year and RAM size, with a color scale showing the number of models in each group? Below that, I'd like a bar chart showing the count of models by company name. I want to be able to select data points in one chart and see the corresponding data highlighted in the other chart. Use blue-green colors for the heatmap and highlight selected data in steel blue.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/phone_1.sqlite')\n\nquery = '''\nSELECT \n    cm.Model_name AS Hardware_Model,\n    cm.Launch_year,\n    cm.RAM_MiB,\n    p.Company_name\nFROM \n    chip_model AS cm\nJOIN \n    phone AS p\nON \n    cm.Model_name = p.chip_model\nWHERE \n    cm.Launch_year IS NOT NULL AND cm.RAM_MiB IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\npts = alt.selection_point(encodings=['x'])\n\nrect = alt.Chart(df).mark_rect().encode(\n    alt.X('Launch_year:Q').bin(),\n    alt.Y('RAM_MiB:Q').bin(),\n    alt.Color('count()').scale(scheme='greenblue').title('Total Models')\n)\n\ncirc = rect.mark_point().encode(\n    alt.ColorValue('grey'),\n    alt.Size('count()').title('Models in Selection')\n).transform_filter(\n    pts\n)\n\nbar = alt.Chart(df, width=550, height=200).mark_bar().encode(\n    x='Company_name:N',\n    y='count()',\n    color=alt.when(pts).then(alt.ColorValue(\"steelblue\")).otherwise(alt.ColorValue(\"grey\"))\n).add_params(pts)\n\nchart = alt.vconcat(\n    rect + circ,\n    bar\n).resolve_legend(\n    color=\"independent\",\n    size=\"independent\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "phone_market",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_range",
        "NLQ": "Can you create a bar chart showing the price range of phones by memory size in GB? I'd like to see horizontal bars with rounded corners that stretch from the minimum to maximum price for each memory size. Please label both the minimum and maximum prices directly on each bar, and title the chart \"Price Range by Memory Size\" with \"Phone Market Analysis\" as a subtitle. Make sure the price axis shows dollars and goes a bit beyond the highest price.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/phone_market.sqlite')\n\nquery = '''\nSELECT \n    Memory_in_G, \n    MIN(Price) AS min_price, \n    MAX(Price) AS max_price\nFROM phone\nGROUP BY Memory_in_G\nORDER BY Memory_in_G\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar(cornerRadius=10, height=10).encode(\n    x=alt.X('min_price:Q').scale(domain=[0, df['max_price'].max() + 100]).title('Price Range ($)'),\n    x2='max_price:Q',\n    y=alt.Y('Memory_in_G:O').title('Memory Size (GB)')\n)\n\ntext_min = alt.Chart(df).mark_text(align='right', dx=-5).encode(\n    x='min_price:Q',\n    y=alt.Y('Memory_in_G:O'),\n    text='min_price:Q'\n)\n\ntext_max = alt.Chart(df).mark_text(align='left', dx=5).encode(\n    x='max_price:Q',\n    y=alt.Y('Memory_in_G:O'),\n    text='max_price:Q'\n)\n\n(bar + text_min + text_max).properties(\n    title=alt.Title(text='Price Range by Memory Size', subtitle='Phone Market Analysis')\n)"
    },
    {
        "type": "type_A",
        "db_id": "poker_player",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_rolling_mean",
        "NLQ": "Can you create a bar chart showing earnings for each poker player ID with a red line showing the 10-player rolling average? Make the chart 600 pixels wide and title it \"Poker Player Earnings with Rolling Mean\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/poker_player.sqlite')\n\nquery = '''\nSELECT Poker_Player_ID, Earnings\nFROM poker_player\nORDER BY Poker_Player_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar().encode(\n    x='Poker_Player_ID:O',\n    y='Earnings:Q'\n)\n\nline = alt.Chart(df).mark_line(color='red').transform_window(\n    rolling_mean='mean(Earnings)',\n    frame=[-9, 0]\n).encode(\n    x='Poker_Player_ID:O',\n    y='rolling_mean:Q'\n)\n\nchart = (bar + line).properties(\n    title='Poker Player Earnings with Rolling Mean',\n    width=600\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "poker_player",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_crossfilter",
        "NLQ": "Can you create three side-by-side histograms showing the distribution of Final Table Made, Best Finish, and Earnings for poker players? Make them interactive so I can select a range in any histogram and see how it filters the data in all three charts. Use gray bars for the overall data and highlight the selected data with a different color.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/poker_player.sqlite')\n\nquery = '''\nSELECT Final_Table_Made, Best_Finish, Earnings\nFROM poker_player;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbase = alt.Chart(df, width=160, height=130).mark_bar().encode(\n    alt.X(alt.repeat('column'), bin=alt.Bin(maxbins=20)),\n    y='count()',\n)\n\nbackground = base.encode(\n    color=alt.value('#ddd')\n).add_params(brush)\n\nhighlight = base.transform_filter(brush)\n\nchart = alt.layer(\n    background,\n    highlight\n).repeat(column=[\"Final_Table_Made\", \"Best_Finish\", \"Earnings\"])\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "products_gen_characteristics",
        "chart_category": "Simple Charts",
        "chart_type": "simple_heatmap",
        "NLQ": "Can you create a heatmap showing the distribution of product categories by color code? I'd like to see color codes along the x-axis, product categories on the y-axis, and use color intensity to show the product count in each combination. Please title it \"Distribution of Product Categories by Color\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/products_gen_characteristics.sqlite')\n\nquery = '''\nSELECT \n    Ref_Colors.color_code,\n    Ref_Product_Categories.product_category_description,\n    COUNT(Products.product_id) AS product_count\nFROM Products\nJOIN Ref_Colors ON Products.color_code = Ref_Colors.color_code\nJOIN Ref_Product_Categories ON Products.product_category_code = Ref_Product_Categories.product_category_code\nGROUP BY Ref_Colors.color_code, Ref_Product_Categories.product_category_description\nORDER BY Ref_Colors.color_code, Ref_Product_Categories.product_category_description;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nheatmap = alt.Chart(df).mark_rect().encode(\n    x=alt.X('color_code:N', title='Color Code'),\n    y=alt.Y('product_category_description:N', title='Product Category'),\n    color=alt.Color('product_count:Q', title='Product Count')\n).properties(\n    title='Distribution of Product Categories by Color'\n)\n\nheatmap"
    },
    {
        "type": "type_A",
        "db_id": "product_catalog",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_rounded_edges",
        "NLQ": "Can you create a bar chart showing the total number of products for each catalog name? I'd like to see the catalog names along the bottom, the number of products on the left side, and use different colors to show the catalog levels. Please give the bars slightly rounded corners at the top and title the chart \"Total Number of Products by Catalog and Level\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/product_catalog.sqlite')\n\nquery = '''\nSELECT \n    T1.catalog_id,\n    T2.catalog_name,\n    T1.catalog_level_number,\n    COUNT(T3.catalog_entry_id) AS product_count\nFROM \n    Catalog_Structure AS T1\nJOIN \n    Catalogs AS T2 ON T1.catalog_id = T2.catalog_id\nLEFT JOIN \n    Catalog_Contents AS T3 ON T1.catalog_id = T3.catalog_level_number\nGROUP BY \n    T1.catalog_id, T1.catalog_level_number\nORDER BY \n    T1.catalog_id, T1.catalog_level_number;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar(\n    cornerRadiusTopLeft=3,\n    cornerRadiusTopRight=3\n).encode(\n    x=alt.X('catalog_name:N', title='Catalog Name'),\n    y=alt.Y('product_count:Q', title='Number of Products'),\n    color=alt.Color('catalog_level_number:N', title='Catalog Level')\n).properties(\n    title='Total Number of Products by Catalog and Level'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "product_catalog",
        "chart_category": "Simple Charts",
        "chart_type": "simple_histogram",
        "NLQ": "Can you show me a histogram of product prices in dollars from the catalog? I'd like to see how many products fall into different price ranges, with the price in dollars on the x-axis and the count on the y-axis. Please title it \"Distribution of Product Prices in Dollars\" and include tooltips showing the exact count for each price range.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/product_catalog.sqlite')\n\nquery = '''\nSELECT price_in_dollars\nFROM Catalog_Contents\nWHERE price_in_dollars IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"price_in_dollars:Q\", bin=True, title=\"Price in Dollars\"),\n    y='count()',\n    tooltip=['count()']\n).properties(\n    title=\"Distribution of Product Prices in Dollars\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "program_share",
        "chart_category": "Simple Charts",
        "chart_type": "simple_histogram",
        "NLQ": "Can you show me a histogram of the share percentages across all programs and channels? I'd like to see how the values are distributed, with the count shown on the y-axis and the share percentage ranges on the x-axis. Please include a title that mentions this is a distribution of share percentages.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/program_share.sqlite')\n\nquery = '''\nSELECT bs.Share_in_percent\nFROM broadcast_share AS bs\nJOIN channel AS c ON bs.Channel_ID = c.Channel_ID\nJOIN program AS p ON bs.Program_ID = p.Program_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"Share_in_percent:Q\", bin=True, title=\"Share Percentage\"),\n    y='count()', \n    tooltip=['count()']\n).properties(\n    title=\"Distribution of Share Percentages Across Programs and Channels\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "protein_institute",
        "chart_category": "Simple Charts",
        "chart_type": "simple_histogram",
        "NLQ": "Can you create a histogram showing the distribution of floor counts for buildings that were once the tallest? I'd like to see how many buildings fall into each floor range, with the number of floors on the x-axis and frequency on the y-axis. Please include tooltips that show the exact floor count and frequency when I hover over each bar, and title it \"Distribution of Building Floors That Were Once the Tallest\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/protein_institute.sqlite')\n\nquery = '''\nSELECT Floors\nFROM building\nWHERE Years_as_tallest IS NOT NULL AND Years_as_tallest != ''\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"Floors:Q\", bin=True, title=\"Number of Floors\"),\n    y='count()',\n    tooltip=['Floors:Q', 'count()']\n).properties(\n    title=\"Distribution of Building Floors That Were Once the Tallest\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "race_track",
        "chart_category": "Simple Charts",
        "chart_type": "simple_line_chart",
        "NLQ": "Can you create a line chart showing the number of races hosted by each track? I'd like to see the track names along the x-axis and the race counts on the y-axis, with the tracks displayed in their ID order. Connect the data points with a line to show the pattern across different tracks.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/race_track.sqlite')\n\nquery = '''\nSELECT \n    t.Name AS Track_Name,\n    COUNT(r.Race_ID) AS Race_Count\nFROM \n    track AS t\nLEFT JOIN \n    race AS r ON t.Track_ID = r.Track_ID\nGROUP BY \n    t.Track_ID\nORDER BY \n    t.Track_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line().encode(\n    x='Track_Name:N',\n    y='Race_Count:Q'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "railway",
        "chart_category": "Bar Charts",
        "chart_type": "calculating_percentage_of_total",
        "NLQ": "Can you create a horizontal bar chart showing what percentage of all trains are located at each station? I'd like to see the locations listed vertically along the y-axis, with percentage bars extending horizontally. Please format the x-axis as percentages without decimal places.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/railway.sqlite')\n\nquery = '''\nSELECT \n    T1.Location AS Location,\n    COUNT(T2.Train_ID) AS Train_Count\nFROM \n    railway AS T1\nJOIN \n    train AS T2 ON T1.Railway_ID = T2.Railway_ID\nGROUP BY \n    T1.Location\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).transform_joinaggregate(\n    TotalTrains='sum(Train_Count)',\n).transform_calculate(\n    PercentOfTotal=\"datum.Train_Count / datum.TotalTrains\"\n).mark_bar().encode(\n    alt.X('PercentOfTotal:Q').axis(format='.0%'),\n    y='Location:N'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "railway",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_scatter_plot_and_linked_layered_histogram",
        "NLQ": "Can you create a visualization showing the relationship between railway managers' average age and average working years by country? I'd like a scatter plot on the left with points colored by country (using teal, purple, and orange colors), with age on the y-axis (0-100) and working years on the x-axis (0-40). Next to it, I want a histogram showing the distribution of working years in 5-year bins (from 0-40 years). Make the visualization interactive so I can click on countries to highlight them, with unselected countries appearing in light gray.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/railway.sqlite')\nquery = '''\nSELECT \n    m.Name AS Manager_Name,\n    m.Country,\n    (strftime('%Y', 'now') - CAST(m.Working_year_starts AS INT)) AS Working_Years,\n    m.Age\nFROM \n    manager AS m\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselector = alt.selection_point(fields=['Country'])\ncolor_scale = alt.Scale(domain=df['Country'].unique(), range=['#1FC3AA', '#8624F5', '#FF5733'])\ncolor = (\n    alt.when(selector)\n    .then(alt.Color(\"Country:N\").scale(color_scale))\n    .otherwise(alt.value(\"lightgray\"))\n)\n\nbase = alt.Chart(df).properties(\n    width=250,\n    height=250\n).add_params(selector)\n\npoints = base.mark_point(filled=True, size=200).encode(\n    alt.X('mean(Working_Years):Q').scale(domain=[0, 40]),\n    alt.Y('mean(Age):Q').scale(domain=[0, 100]),\n    color=color,\n)\n\nhists = base.mark_bar(opacity=0.5, thickness=100).encode(\n    alt.X('Working_Years')\n        .bin(step=5)\n        .scale(domain=[0, 40]),\n    alt.Y('count()')\n        .stack(None)\n        .scale(domain=[0, df['Country'].value_counts().max() + 10]),\n    alt.Color('Country:N').scale(color_scale)\n).transform_filter(\n    selector\n)\n\npoints | hists"
    },
    {
        "type": "type_A",
        "db_id": "riding_club",
        "chart_category": "Simple Charts",
        "chart_type": "simple_scatter_plot_with_tooltips",
        "NLQ": "Can you create a scatter plot showing the relationship between gold medals and total points for riding clubs? I'd like to see different regions represented by different colors, and when I hover over each circle, I want to see the club name, region, gold medal count, and points. Make the circles large enough to be easily visible and let me interact with the chart.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/riding_club.sqlite')\nquery = '''\nSELECT \n    c.Club_name, \n    c.Region, \n    m.Gold, \n    m.Points\nFROM \n    club AS c\nJOIN \n    match_result AS m\nON \n    c.Club_ID = m.Club_ID\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nscatter_plot = alt.Chart(df).mark_circle(size=60).encode(\n    x='Gold:Q',\n    y='Points:Q',\n    color='Region:N',\n    tooltip=['Club_name:N', 'Region:N', 'Gold:Q', 'Points:Q']\n).interactive()\n\nscatter_plot"
    },
    {
        "type": "type_A",
        "db_id": "sakila_1",
        "chart_category": "Bar Charts",
        "chart_type": "diverging_stacked_bar_chart",
        "NLQ": "Can you create a horizontal bar chart showing the percentage breakdown of film ratings (G, PG, PG-13, R, NC-17) for each film category in the Sakila database? I'd like to see the proportions using a color scheme from red to blue, with the categories listed on the y-axis and percentages on the x-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/sakila_1.sqlite')\n\nquery = '''\nSELECT \n    c.name AS category_name,\n    f.rating,\n    COUNT(*) AS count\nFROM \n    film AS f\nJOIN \n    film_category AS fc ON f.film_id = fc.film_id\nJOIN \n    category AS c ON fc.category_id = c.category_id\nGROUP BY \n    c.name, f.rating\nORDER BY \n    c.name, f.rating\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nrating_order = {'G': -2, 'PG': -1, 'PG-13': 0, 'R': 1, 'NC-17': 2}\ndf['type_code'] = df['rating'].map(rating_order)\n\ndef compute_percentages(group):\n    group = group.set_index('type_code').sort_index()\n    perc = (group['count'] / group['count'].sum()) * 100\n    group['percentage'] = perc\n    group['percentage_end'] = perc.cumsum() - (perc[-2] + perc[-1] + perc[0] / 2)\n    group['percentage_start'] = group['percentage_end'] - perc\n    return group\n\ndf = df.groupby('category_name').apply(compute_percentages).reset_index(drop=True)\n\ncolor_scale = alt.Scale(\n    domain=['G', 'PG', 'PG-13', 'R', 'NC-17'],\n    range=[\"#c30d24\", \"#f3a583\", \"#cccccc\", \"#94c6da\", \"#1770ab\"]\n)\n\ny_axis = alt.Axis(title=\"Film Category\", offset=5, ticks=False, minExtent=60, domain=False)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"percentage_start:Q\", title=\"Percentage\"),\n    x2=\"percentage_end:Q\",\n    y=alt.Y(\"category_name:N\").axis(y_axis),\n    color=alt.Color(\"rating:N\").title(\"Rating\").scale(color_scale)\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "shop_membership",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-line_tooltip",
        "NLQ": "Can you create a line chart showing total purchase amounts by membership level across different years? I'd like to see how spending trends differ between membership tiers over time. Make the lines smooth and color-coded by membership level. Could you also add interactive features so when I hover over any point, it highlights that point and shows the exact purchase amount? A vertical line should appear at the year I'm hovering over to help track the data. Please title it \"Total Purchase Amounts by Membership Level Over Years\" and make the chart a good size - about 600 by 300.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/shop_membership.sqlite')\n\nquery = '''\nSELECT \n    m.Level AS Membership_Level,\n    p.Year AS Purchase_Year,\n    SUM(p.Total_pounds) AS Total_Purchase_Amount\nFROM \n    purchase AS p\nJOIN \n    member AS m ON p.Member_ID = m.Member_ID\nGROUP BY \n    m.Level, p.Year\nORDER BY \n    m.Level, p.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nnearest = alt.selection_point(nearest=True, on=\"pointerover\",\n                              fields=[\"Purchase_Year\"], empty=False)\n\nline = alt.Chart(df).mark_line(interpolate=\"basis\").encode(\n    x=\"Purchase_Year:O\",\n    y=\"Total_Purchase_Amount:Q\",\n    color=\"Membership_Level:N\"\n)\n\nselectors = alt.Chart(df).mark_point().encode(\n    x=\"Purchase_Year:O\",\n    opacity=alt.value(0),\n).add_params(\n    nearest\n)\nwhen_near = alt.when(nearest)\n\npoints = line.mark_point().encode(\n    opacity=when_near.then(alt.value(1)).otherwise(alt.value(0))\n)\n\ntext = line.mark_text(align=\"left\", dx=5, dy=-5).encode(\n    text=when_near.then(\"Total_Purchase_Amount:Q\").otherwise(alt.value(\" \"))\n)\n\nrules = alt.Chart(df).mark_rule(color=\"gray\").encode(\n    x=\"Purchase_Year:O\",\n).transform_filter(\n    nearest\n)\n\nchart = alt.layer(\n    line, selectors, points, rules, text\n).properties(\n    width=600, height=300, title=\"Total Purchase Amounts by Membership Level Over Years\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "soccer_1",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-line_tooltip_(standard)",
        "NLQ": "Can you create a line chart showing how a player's overall rating and potential have changed over time? Make the lines smooth and include a title \"Player Progression Over Time\". When I hover over any point on the lines, I'd like to see a vertical line appear with a tooltip showing all the player's detailed stats for that date, including crossing, finishing, short passing, dribbling, ball control, acceleration, sprint speed, strength, and aggression.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/soccer_1.sqlite')\n\nquery = '''\nSELECT \n    date,\n    overall_rating,\n    potential,\n    crossing,\n    finishing,\n    short_passing,\n    dribbling,\n    ball_control,\n    acceleration,\n    sprint_speed,\n    strength,\n    aggression\nFROM \n    Player_Attributes\nWHERE \n    player_api_id = 505942\nORDER BY \n    date ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['date'], \n                    value_vars=['overall_rating', 'potential'], \n                    var_name='metric', value_name='value')\n\nnearest = alt.selection_point(nearest=True, on=\"pointerover\",\n                              fields=[\"date\"], empty=False)\n\nline = alt.Chart(df_melted).mark_line(interpolate=\"basis\").encode(\n    x=alt.X(\"date:T\", title=\"Date\"),\n    y=alt.Y(\"value:Q\", title=\"Rating\"),\n    color=alt.Color(\"metric:N\", title=\"Metric\")\n)\n\nwhen_near = alt.when(nearest)\n\npoints = line.mark_point().encode(\n    opacity=when_near.then(alt.value(1)).otherwise(alt.value(0))\n)\n\nrules = alt.Chart(df_melted).transform_pivot(\n    \"metric\",\n    value=\"value\",\n    groupby=[\"date\"]\n).mark_rule(color=\"gray\").encode(\n    x=\"date:T\",\n    opacity=when_near.then(alt.value(0.3)).otherwise(alt.value(0)),\n    tooltip=[\n        alt.Tooltip(\"date:T\", title=\"Date\"),\n        alt.Tooltip(\"overall_rating:Q\", title=\"Overall Rating\"),\n        alt.Tooltip(\"potential:Q\", title=\"Potential\"),\n        alt.Tooltip(\"crossing:Q\", title=\"Crossing\"),\n        alt.Tooltip(\"finishing:Q\", title=\"Finishing\"),\n        alt.Tooltip(\"short_passing:Q\", title=\"Short Passing\"),\n        alt.Tooltip(\"dribbling:Q\", title=\"Dribbling\"),\n        alt.Tooltip(\"ball_control:Q\", title=\"Ball Control\"),\n        alt.Tooltip(\"acceleration:Q\", title=\"Acceleration\"),\n        alt.Tooltip(\"sprint_speed:Q\", title=\"Sprint Speed\"),\n        alt.Tooltip(\"strength:Q\", title=\"Strength\"),\n        alt.Tooltip(\"aggression:Q\", title=\"Aggression\")\n    ]\n).add_params(nearest)\n\nchart = alt.layer(\n    line, points, rules\n).properties(\n    width=600, height=300, title=\"Player Progression Over Time\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "soccer_2",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_xoffset",
        "NLQ": "Can you create a bar chart showing the number of players from each college, grouped by their positions? I'd like to see the bars colored by the tryout decision (yes or no) so I can compare how many players were accepted or rejected across different colleges and positions.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/soccer_2.sqlite')\n\nquery = '''\nSELECT \n    T.cName AS College,\n    T.pPos AS Position,\n    T.decision AS Decision,\n    COUNT(T.pID) AS PlayerCount\nFROM Tryout AS T\nGROUP BY T.cName, T.pPos, T.decision\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=\"College:N\",\n    y=\"PlayerCount:Q\",\n    xOffset=\"Position:N\",\n    color=\"Decision:N\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "solvency_ii",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_xoffset",
        "NLQ": "Can you create a bar chart showing the total number of products for each event type, grouped by product type? Please title it \"Total Products by Event Type and Product Type\" and label the axes as \"Event Type\" and \"Total Number of Products\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/solvency_ii.sqlite')\n\nquery = '''\nSELECT \n    E.Event_Type_Code AS EventType,\n    P.Product_Type_Code AS ProductType,\n    COUNT(PE.Product_ID) AS ProductCount\nFROM \n    Events AS E\nJOIN \n    Products_in_Events AS PE ON E.Event_ID = PE.Event_ID\nJOIN \n    Products AS P ON PE.Product_ID = P.Product_ID\nGROUP BY \n    E.Event_Type_Code, P.Product_Type_Code\nORDER BY \n    E.Event_Type_Code, P.Product_Type_Code;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"EventType:N\", title=\"Event Type\"),\n    y=alt.Y(\"ProductCount:Q\", title=\"Total Number of Products\"),\n    xOffset=\"ProductType:N\",\n    color=\"ProductType:N\"\n).properties(\n    title=\"Total Products by Event Type and Product Type\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "solvency_ii",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-line_tooltip_(standard)",
        "NLQ": "Can you create a line chart showing the total product price for each event ID, with different colors for each event type? I'd like the lines to be smoothed out, and when I hover over a point, I want to see the event type and total product price. Make the chart 600x300 pixels with the title \"Total Product Price by Event Type\" at the top.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/solvency_ii.sqlite')\n\nquery = '''\nSELECT \n    E.Event_Type_Code AS Event_Type,\n    SUM(P.Product_Price) AS Total_Product_Price,\n    E.Event_ID\nFROM \n    Events AS E\nJOIN \n    Products_in_Events AS PIE ON E.Event_ID = PIE.Event_ID\nJOIN \n    Products AS P ON PIE.Product_ID = P.Product_ID\nGROUP BY \n    E.Event_Type_Code, E.Event_ID\nORDER BY \n    E.Event_Type_Code, E.Event_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nnearest = alt.selection_point(nearest=True, on=\"pointerover\",\n                              fields=[\"Event_ID\"], empty=False)\n\nline = alt.Chart(df).mark_line(interpolate=\"basis\").encode(\n    x=\"Event_ID:N\",\n    y=\"Total_Product_Price:Q\",\n    color=\"Event_Type:N\"\n)\n\npoints = line.mark_point().encode(\n    opacity=alt.condition(nearest, alt.value(1), alt.value(0))\n)\n\nrules = alt.Chart(df).transform_pivot(\n    \"Event_Type\",\n    value=\"Total_Product_Price\",\n    groupby=[\"Event_ID\"]\n).mark_rule(color=\"gray\").encode(\n    x=\"Event_ID:N\",\n    opacity=alt.condition(nearest, alt.value(0.3), alt.value(0)),\n    tooltip=[alt.Tooltip(\"Event_Type:N\", title=\"Event Type\"),\n             alt.Tooltip(\"Total_Product_Price:Q\", title=\"Total Product Price\")]\n).add_params(nearest)\n\nchart = alt.layer(\n    line, points, rules\n).properties(\n    width=600, height=300,\n    title=\"Total Product Price by Event Type\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "sports_competition",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-panel_scatter_plot_with_linked_brushing",
        "NLQ": "Can you create a side-by-side interactive scatter plot showing the relationship between gold medals vs total medals and silver medals vs total medals for each sports club? I'd like the clubs to be color-coded by name, and when I select points in one chart, I want the same clubs to be highlighted in the other chart while the rest turn gray. Please include tooltips that show the club name, gold medals, silver medals, and total medals when I hover over any point.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/sports_competition.sqlite')\n\nquery = '''\nSELECT \n    c.name AS Club_Name,\n    cr.Gold,\n    cr.Silver,\n    cr.Total\nFROM \n    club_rank AS cr\nJOIN \n    club AS c\nON \n    cr.Club_ID = c.Club_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(resolve='global')\n\nbase = alt.Chart(df).mark_point().encode(\n    y='Total:Q',\n    color=alt.condition(brush, 'Club_Name:N', alt.value('gray')),\n    tooltip=['Club_Name', 'Gold', 'Silver', 'Total']\n).add_params(\n    brush\n).properties(\n    width=250,\n    height=250\n)\n\nchart = base.encode(x='Gold:Q') | base.encode(x='Silver:Q')\nchart"
    },
    {
        "type": "type_A",
        "db_id": "station_weather",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_xoffset_and_overlapping_bars",
        "NLQ": "Could you show me the high and low temperatures for each day of the week at station 1 as a grouped bar chart? I'd like the days of the week on the x-axis with high and low temperatures as different colored bars side by side. Also, please display the temperature values above each bar.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/station_weather.sqlite')\n\nquery = '''\nSELECT \n    day_of_week AS day,\n    high_temperature AS temperature,\n    'High' AS temp_type\nFROM \n    weekly_weather\nWHERE \n    station_id = 1\nUNION ALL\nSELECT \n    day_of_week AS day,\n    low_temperature AS temperature,\n    'Low' AS temp_type\nFROM \n    weekly_weather\nWHERE \n    station_id = 1\nORDER BY \n    day\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df, width=alt.Step(20)).encode(\n    x=\"day:N\",\n    y=\"temperature:Q\",\n    xOffset=alt.XOffset(\"temp_type:N\").scale(paddingOuter=0.5),\n)\n\nchart = alt.layer(\n    base.mark_bar(size=20, stroke=\"white\", fillOpacity=0.9).encode(fill=\"temp_type:N\"),\n    base.mark_text(dy=-5).encode(text=\"temperature:Q\"),\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "station_weather",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-panel_scatter_plot_with_linked_brushing",
        "NLQ": "I'm trying to explore how weather patterns vary across stations. Could you create two side-by-side scatter plots? In the first plot, show high temperature versus wind speed, and title it \"High Temp vs Wind Speed.\" In the second plot, show high temperature versus precipitation, and title it \"Low Temp vs Precipitation.\" I'd like the points to be color-coded by station name, and when I select points in one chart, I want the same stations to be highlighted in the other chart while non-selected points turn gray. Please include tooltips that show the station name, day of week, high temperature, and wind speed when I hover over points.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/station_weather.sqlite')\n\nquery = '''\nSELECT \n    s.network_name AS station_name,\n    w.day_of_week,\n    w.high_temperature,\n    w.low_temperature,\n    w.precipitation,\n    w.wind_speed_mph\nFROM \n    weekly_weather AS w\nJOIN \n    station AS s\nON \n    w.station_id = s.id\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbrush = alt.selection_interval(resolve='global')\n\nbase = alt.Chart(df).mark_point().encode(\n    y='high_temperature:Q',\n    color=alt.condition(brush, 'station_name:N', alt.value('gray')),\n    tooltip=['station_name', 'day_of_week', 'high_temperature', 'wind_speed_mph']\n).add_params(\n    brush\n).properties(\n    width=250,\n    height=250\n)\n\nchart1 = base.encode(x='wind_speed_mph:Q').properties(title='High Temp vs Wind Speed')\nchart2 = base.encode(x='precipitation:Q').properties(title='Low Temp vs Precipitation')\n\nchart1 | chart2"
    },
    {
        "type": "type_A",
        "db_id": "store_1",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_xoffset_and_overlapping_bars",
        "NLQ": "Can you create a grouped bar chart showing total sales by music genre for the top 5 countries? I'd like each country on the x-axis with colored bars representing different genres side by side. Please display the exact sales figures above each bar, and title the chart \"Total Sales by Genre and Country (Top 5 Countries)\". Make sure the bars have white outlines and are slightly transparent.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/store_1.sqlite')\n\nquery = '''\nWITH CountrySales AS (\n    SELECT\n        c.country,\n        g.name AS genre,\n        SUM(il.unit_price * il.quantity) AS total_sales,\n        RANK() OVER (ORDER BY SUM(il.unit_price * il.quantity) DESC) as country_rank\n    FROM customers c\n    JOIN invoices i ON c.id = i.customer_id\n    JOIN invoice_lines il ON i.id = il.invoice_id\n    JOIN tracks t ON il.track_id = t.id\n    JOIN genres g ON t.genre_id = g.id\n    GROUP BY c.country, g.name\n)\nSELECT\n    cs.country,\n    cs.genre,\n    cs.total_sales\nFROM CountrySales cs\nWHERE country_rank <= 5;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df, width=alt.Step(12)).encode(\n    x=alt.X(\"country:N\", title=\"Country\"),\n    y=alt.Y(\"total_sales:Q\", title=\"Total Sales\"),\n    xOffset=alt.XOffset(\"genre:N\", title=\"Genre\").scale(paddingOuter=0.5),\n)\n\nalt.layer(\n    base.mark_bar(size=20, stroke=\"white\", fillOpacity=0.9).encode(fill=alt.Color(\"genre:N\", title=\"Genre\")),\n    base.mark_text(dy=-5).encode(text=alt.Text(\"total_sales:Q\", format=\".2f\")),\n).properties(\n    title=\"Total Sales by Genre and Country (Top 5 Countries)\"\n)"
    },
    {
        "type": "type_A",
        "db_id": "store_1",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-panel_scatter_plot_with_linked_brushing",
        "NLQ": "Can you create an interactive visualization showing the relationship between track duration in seconds and file size in KB, with points colored by genre? I'd like to see two side-by-side scatter plots - one showing duration vs file size, and another showing duration vs media type. Make it interactive so when I select points in one chart, the same data points highlight in the other chart. Also, include tooltips that show genre, media type, duration, and file size when I hover over points.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/store_1.sqlite')\n\nquery = '''\nSELECT \n    g.name AS genre, \n    mt.name AS media_type, \n    t.milliseconds / 1000.0 AS duration_seconds, \n    t.bytes / 1024.0 AS size_kb\nFROM \n    tracks AS t\nJOIN \n    genres AS g ON t.genre_id = g.id\nJOIN \n    media_types AS mt ON t.media_type_id = mt.id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(resolve='global')\n\nbase = alt.Chart(df).mark_point().encode(\n    y='duration_seconds:Q',\n    color=alt.condition(brush, 'genre:N', alt.value('gray')),\n    tooltip=['genre', 'media_type', 'duration_seconds', 'size_kb']\n).add_params(\n    brush\n).properties(\n    width=250,\n    height=250\n)\n\nchart = base.encode(x='size_kb:Q') | base.encode(x='media_type:N')\nchart"
    },
    {
        "type": "type_A",
        "db_id": "storm_record",
        "chart_category": "Interactive Charts",
        "chart_type": "multiple_interactions",
        "NLQ": "Can you create a dashboard with four scatter plots showing the relationship between storm maximum speed and number of deaths? I'd like different interactive features on each plot: one with a slider to filter by number of deaths, another with a checkbox to make points bigger for storms with damage over $15 million, a third with radio buttons to highlight specific storms by name, and a fourth with a dropdown menu to select and display just one storm at a time. Each point should show the storm name when I hover over it.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/storm_record.sqlite')\nquery = '''\nSELECT Storm_ID, Name, Max_speed, Damage_millions_USD, Number_Deaths\nFROM storm\n'''\ndf = pd.read_sql_query(query, conn)\ndf['Damage_Above_15M'] = df['Damage_millions_USD'].apply(lambda x: \"Yes\" if x > 15 else \"No\")\nconn.close()\n\nbase = alt.Chart(df, width=200, height=200).mark_point(filled=True).encode(\n    x='Max_speed:Q',\n    y='Number_Deaths:Q',\n    tooltip=\"Name:N\"\n)\n\ndeaths_slider = alt.binding_range(min=df['Number_Deaths'].min(), max=df['Number_Deaths'].max(), step=1, name=\"Number of Deaths\")\nslider_selection = alt.selection_point(bind=deaths_slider, fields=['Number_Deaths'])\n\nfilter_deaths = base.add_params(\n    slider_selection\n).transform_filter(\n    slider_selection\n).properties(title=\"Slider Filtering (Deaths)\")\n\nstorm_names = df['Name'].unique().tolist()\nname_dropdown = alt.binding_select(options=storm_names, name=\"Storm Name\")\nname_select = alt.selection_point(fields=['Name'], bind=name_dropdown)\n\nfilter_names = base.add_params(\n    name_select\n).transform_filter(\n    name_select\n).properties(title=\"Dropdown Filtering (Storm Name)\")\n\nname_radio = alt.binding_radio(options=storm_names, name=\"Storm Name\")\nname_radio_select = alt.selection_point(fields=['Name'], bind=name_radio)\nname_color = (\n    alt.when(name_radio_select)\n    .then(alt.Color(\"Name:N\").legend(None))\n    .otherwise(alt.value(\"lightgray\"))\n)\n\nhighlight_names = base.add_params(\n    name_radio_select\n).encode(\n    color=name_color\n).properties(title=\"Radio Button Highlighting\")\n\ninput_checkbox = alt.binding_checkbox(name=\"Damage > $15M \")\ncheckbox_selection = alt.param(bind=input_checkbox)\n\nsize_checkbox = (\n    alt.when(checkbox_selection)\n    .then(alt.Size('Damage_Above_15M:N').scale(range=[25, 150]))\n    .otherwise(alt.value(25))\n)\n\ndamage_sizing = base.add_params(\n    checkbox_selection\n).encode(\n    size=size_checkbox\n).properties(title=\"Checkbox Formatting\")\n\n(filter_deaths | damage_sizing) & (highlight_names | filter_names)"
    },
    {
        "type": "type_A",
        "db_id": "student_transcripts_tracking",
        "chart_category": "Interactive Charts",
        "chart_type": "reorder_stacked_bar_segments",
        "NLQ": "Can you create a bar chart showing the total number of courses taken by students in each semester, broken down by degree program? I'd like to see the semesters listed vertically on the y-axis and the total courses on the x-axis. Please include a color-coded legend for the different degree programs that I can click on to highlight specific programs while fading out the others. Title it \"Total Courses Taken by Students in Each Degree Program by Semester\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/student_transcripts_tracking.sqlite')\n\nquery = '''\nSELECT \n    dp.degree_summary_name AS degree_program,\n    s.semester_name AS semester,\n    COUNT(sec.course_id) AS total_courses\nFROM \n    Student_Enrolment AS se\nJOIN \n    Degree_Programs AS dp ON se.degree_program_id = dp.degree_program_id\nJOIN \n    Semesters AS s ON se.semester_id = s.semester_id\nJOIN \n    Student_Enrolment_Courses AS sec ON se.student_enrolment_id = sec.student_enrolment_id\nGROUP BY \n    dp.degree_summary_name, s.semester_name\nORDER BY \n    dp.degree_summary_name, s.semester_name;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselection = alt.selection_point(fields=['degree_program'], bind='legend')\n\nchart = alt.Chart(df).mark_bar().transform_calculate(\n    degree_order=f\"if({selection.name}.degree_program && indexof({selection.name}.degree_program, datum.degree_program) !== -1, 0, 1)\"\n).encode(\n    x=alt.X('sum(total_courses):Q', title='Total Courses Taken'),\n    y=alt.Y('semester:N', title='Semester'),\n    color=alt.Color('degree_program:N', title='Degree Program'),\n    order=alt.Order('degree_order:N'),\n    opacity=alt.condition(selection, alt.value(0.9), alt.value(0.2))\n).add_params(\n    selection\n).properties(\n    title=\"Total Courses Taken by Students in Each Degree Program by Semester\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "swimming",
        "chart_category": "Interactive Charts",
        "chart_type": "reorder_stacked_bar_segments",
        "NLQ": "Can you create a stacked bar chart showing the total swimming times for each swimmer across different distances (100m through 700m)? I'd like to see how their times stack up, with each swimmer on a separate row and their total time in seconds on the horizontal axis. Make the chart interactive so I can highlight specific intervals by clicking on the legend items, which should dim the other intervals. Only include swimmers who have completed all seven distance intervals from 100m to 700m.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/swimming.sqlite')\n\nquery = '''\nSELECT \n    name AS Swimmer,\n    meter_100 AS \"100m\",\n    CAST(SUBSTR(meter_200, 1, INSTR(meter_200, ':') - 1) AS REAL) * 60 + \n        CAST(SUBSTR(meter_200, INSTR(meter_200, ':') + 1) AS REAL) AS \"200m\",\n    CAST(SUBSTR(meter_300, 1, INSTR(meter_300, ':') - 1) AS REAL) * 60 + \n        CAST(SUBSTR(meter_300, INSTR(meter_300, ':') + 1) AS REAL) AS \"300m\",\n    CAST(SUBSTR(meter_400, 1, INSTR(meter_400, ':') - 1) AS REAL) * 60 + \n        CAST(SUBSTR(meter_400, INSTR(meter_400, ':') + 1) AS REAL) AS \"400m\",\n    CAST(SUBSTR(meter_500, 1, INSTR(meter_500, ':') - 1) AS REAL) * 60 + \n        CAST(SUBSTR(meter_500, INSTR(meter_500, ':') + 1) AS REAL) AS \"500m\",\n    CAST(SUBSTR(meter_600, 1, INSTR(meter_600, ':') - 1) AS REAL) * 60 + \n        CAST(SUBSTR(meter_600, INSTR(meter_600, ':') + 1) AS REAL) AS \"600m\",\n    CAST(SUBSTR(meter_700, 1, INSTR(meter_700, ':') - 1) AS REAL) * 60 + \n        CAST(SUBSTR(meter_700, INSTR(meter_700, ':') + 1) AS REAL) AS \"700m\"\nFROM swimmer\nWHERE meter_100 IS NOT NULL AND meter_200 IS NOT NULL AND meter_300 IS NOT NULL \n      AND meter_400 IS NOT NULL AND meter_500 IS NOT NULL AND meter_600 IS NOT NULL \n      AND meter_700 IS NOT NULL;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['Swimmer'], var_name='Interval', value_name='Time')\n\nselection = alt.selection_point(fields=['Interval'], bind='legend')\n\nchart = alt.Chart(df_melted).mark_bar().transform_calculate(\n    interval_order=f\"if({selection.name}.Interval && indexof({selection.name}.Interval, datum.Interval) !== -1, 0, 1)\"\n).encode(\n    x=alt.X('sum(Time):Q', title='Total Time (seconds)'),\n    y=alt.Y('Swimmer:N', title='Swimmer'),\n    color=alt.Color('Interval:N', title='Interval'),\n    order=alt.Order('interval_order:N'),\n    opacity=alt.condition(selection, alt.value(0.9), alt.value(0.2))\n).add_params(\n    selection\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "theme_gallery",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_grouped_bar_chart",
        "NLQ": "Can you create a horizontal bar chart showing total attendance for each exhibition theme, with bars colored by year? I'd like to see each theme in its own separate row for easy comparison.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/theme_gallery.sqlite')\n\nquery = '''\nSELECT \n    e.Theme AS Theme, \n    e.Year AS Year, \n    SUM(er.Attendance) AS Total_Attendance\nFROM \n    exhibition AS e\nJOIN \n    exhibition_record AS er ON e.Exhibition_ID = er.Exhibition_ID\nGROUP BY \n    e.Theme, e.Year\nORDER BY \n    e.Theme, e.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Total_Attendance:Q',\n    y='Theme:N',\n    color='Year:N',\n    row='Theme:N'\n).properties(\n    width=600,\n    height=100\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "theme_gallery",
        "chart_category": "Interactive Charts",
        "chart_type": "reorder_stacked_bar_segments",
        "NLQ": "Can you show me the total attendance for each exhibition theme broken down by year? I'd like to see this as a horizontal bar chart where each theme is on the y-axis and total attendance is on the x-axis. Color-code the bars by year and make it interactive so I can click on years in the legend to highlight them while fading out the others. This would help me compare attendance patterns across different exhibition themes.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/theme_gallery.sqlite')\n\nquery = '''\nSELECT \n    e.Theme AS Theme,\n    e.Year AS Year,\n    SUM(er.Attendance) AS Total_Attendance\nFROM \n    exhibition AS e\nJOIN \n    exhibition_record AS er\nON \n    e.Exhibition_ID = er.Exhibition_ID\nGROUP BY \n    e.Theme, e.Year\nORDER BY \n    e.Theme, e.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselection = alt.selection_point(fields=['Year'], bind='legend')\n\nchart = alt.Chart(df).mark_bar().transform_calculate(\n    year_order=f\"if({selection.name}.Year && indexof({selection.name}.Year, datum.Year) !== -1, 0, 1)\"\n).encode(\n    x=alt.X('sum(Total_Attendance):Q', title='Total Attendance'),\n    y=alt.Y('Theme:N', title='Exhibition Theme'),\n    color=alt.Color('Year:N', title='Year'),\n    order=alt.Order('year_order:N'),\n    opacity=alt.condition(selection, alt.value(0.9), alt.value(0.2))\n).add_params(\n    selection\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "tracking_grants_for_research",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_grouped_bar_chart",
        "NLQ": "Hey, could you show me a horizontal bar chart that breaks down the total grant amounts by organization type? I'd like to see which types of organizations are getting the most funding, with the organization types listed vertically on the left and the grant amounts extending horizontally. Please title it \"Total Grant Amounts by Organisation Type\" and make it tall enough to read all the organization types clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/tracking_grants_for_research.sqlite')\n\nquery = '''\nSELECT \n    ot.organisation_type_description AS Organisation_Type,\n    SUM(g.grant_amount) AS Total_Grant_Amount\nFROM \n    Grants AS g\nJOIN \n    Organisations AS o ON g.organisation_id = o.organisation_id\nJOIN \n    Organisation_Types AS ot ON o.organisation_type = ot.organisation_type\nGROUP BY \n    ot.organisation_type_description\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Total_Grant_Amount:Q',\n    y='Organisation_Type:N'\n).properties(\n    height=400,\n    title=\"Total Grant Amounts by Organisation Type\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "tracking_share_transactions",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_stacked_bar_chart",
        "NLQ": "Can you create a horizontal stacked bar chart showing the total transaction amounts for each investor? I'd like to see the bars stacked by transaction type, with different colors for each type. Please title the chart \"Total Transaction Amounts by Investor and Type\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/tracking_share_transactions.sqlite')\n\nquery = '''\nSELECT \n    I.Investor_details AS investor,\n    RT.transaction_type_description AS transaction_type,\n    SUM(T.amount_of_transaction) AS total_amount\nFROM \n    Transactions AS T\nJOIN \n    Investors AS I ON T.investor_id = I.investor_id\nJOIN \n    Ref_Transaction_Types AS RT ON T.transaction_type_code = RT.transaction_type_code\nGROUP BY \n    I.Investor_details, RT.transaction_type_description\nORDER BY \n    I.Investor_details\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='sum(total_amount):Q',\n    y='investor:N',\n    color='transaction_type:N'\n).properties(\n    title=\"Total Transaction Amounts by Investor and Type\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "tracking_share_transactions",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "error_bars_with_standard_deviation",
        "NLQ": "Can you create a chart showing the mean transaction amounts for each transaction type with error bars representing the standard deviation? I'd like to see black points for the mean values and horizontal error bars showing the spread of transaction amounts. Please label the x-axis as \"Transaction Amount\" and the y-axis as \"Transaction Type\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\ndatabase_path = 'database/tracking_share_transactions.sqlite'\nconn = sqlite3.connect(database_path)\nquery = '''\nSELECT\n    T2.transaction_type_description,\n    T1.amount_of_transaction\nFROM Transactions AS T1\nJOIN Ref_Transaction_Types AS T2 ON T1.transaction_type_code = T2.transaction_type_code;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nerror_bars = alt.Chart(df).mark_errorbar(extent='stdev').encode(\n    x=alt.X('amount_of_transaction', scale=alt.Scale(zero=False), title='Transaction Amount'),\n    y=alt.Y('transaction_type_description', title='Transaction Type')\n)\n\npoints = alt.Chart(df).mark_point(filled=True, color='black').encode(\n    x=alt.X('mean(amount_of_transaction)', title='Mean Transaction Amount'),\n    y=alt.Y('transaction_type_description', title='Transaction Type'),\n)\n\nerror_bars + points"
    },
    {
        "type": "type_A",
        "db_id": "tracking_software_problems",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_stacked_bar_chart",
        "NLQ": "Can you create a horizontal bar chart showing the distribution of problems by category and status? I'd like to see each problem category as a row with the bars stacked by different status types, and I want the chart to be titled \"Problem Distribution by Category and Status\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/tracking_software_problems.sqlite')\n\nquery = '''\nSELECT \n    pcc.problem_category_description AS category,\n    psc.problem_status_description AS status,\n    COUNT(*) AS count\nFROM \n    Problem_Log AS pl\nJOIN \n    Problem_Category_Codes AS pcc ON pl.problem_category_code = pcc.problem_category_code\nJOIN \n    Problem_Status_Codes AS psc ON pl.problem_status_code = psc.problem_status_code\nGROUP BY \n    pcc.problem_category_description, psc.problem_status_description\nORDER BY \n    pcc.problem_category_description, psc.problem_status_description;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='sum(count):Q',\n    y='category:N',\n    color='status:N'\n).properties(\n    title=\"Problem Distribution by Category and Status\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "train_station",
        "chart_category": "Bar Charts",
        "chart_type": "layered_bar_chart",
        "NLQ": "Can you show me the annual passenger traffic for London train stations with side-by-side bars comparing entry/exit numbers and interchange counts? Make the bars semi-transparent so I can see both clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/train_station.sqlite')\nquery = '''\nSELECT \n    Name AS Station_Name,\n    Annual_entry_exit AS Entry_Exit,\n    Annual_interchanges AS Interchanges\nFROM \n    station\nWHERE \n    Location = 'London'\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf_melted = df.melt(id_vars='Station_Name', value_vars=['Entry_Exit', 'Interchanges'], \n                    var_name='Traffic_Type', value_name='Passenger_Count')\nchart = alt.Chart(df_melted).mark_bar(opacity=0.7).encode(\n    x='Station_Name:N',\n    y=alt.Y('Passenger_Count:Q').stack(None),\n    color='Traffic_Type:N'\n)\nchart"
    },
    {
        "type": "type_A",
        "db_id": "tvshow",
        "chart_category": "Bar Charts",
        "chart_type": "layered_bar_chart",
        "NLQ": "Can you create a bar chart showing the total viewership for different TV series, with each series on the x-axis and viewer numbers on the y-axis? I'd like to see the bars color-coded by rating categories, with the bars slightly transparent (about 70% opaque) and positioned next to each other rather than stacked. Please get this data from the TV show database by combining information from the TV series and TV channel tables.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/tvshow.sqlite')\n\nquery = '''\nSELECT \n    T2.series_name AS Series_Name,\n    T1.Rating,\n    SUM(CAST(T1.Viewers_m AS REAL)) AS Total_Viewers\nFROM \n    TV_series AS T1\nJOIN \n    TV_Channel AS T2\nON \n    T1.Channel = T2.id\nGROUP BY \n    T2.series_name, T1.Rating\nORDER BY \n    T2.series_name, T1.Rating;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar(opacity=0.7).encode(\n    x='Series_Name:N',\n    y=alt.Y('Total_Viewers:Q').stack(None),\n    color='Rating:N'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "twitter_1",
        "chart_category": "Bar Charts",
        "chart_type": "layered_bar_chart",
        "NLQ": "Can you create a bar chart showing the number of tweets posted on each day of the week by Twitter users who have more than 1 million followers? I'd like to see the bars for different users side by side (not stacked) on each day, with each user represented by a different color. Please title the chart \"Tweets by Users with >1M Followers Grouped by Day of Week\" and make the bars slightly transparent.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/twitter_1.sqlite')\n\nquery = '''\nSELECT \n    strftime('%w', t.createdate) AS day_of_week,\n    u.name AS user_name,\n    COUNT(t.id) AS tweet_count\nFROM \n    tweets AS t\nJOIN \n    user_profiles AS u ON t.uid = u.uid\nWHERE \n    u.followers > 1000000\nGROUP BY \n    day_of_week, user_name\nORDER BY \n    day_of_week;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nweekday_map = {\n    '0': 'Sunday',\n    '1': 'Monday',\n    '2': 'Tuesday',\n    '3': 'Wednesday',\n    '4': 'Thursday',\n    '5': 'Friday',\n    '6': 'Saturday'\n}\ndf['day_of_week'] = df['day_of_week'].map(weekday_map)\n\nchart = alt.Chart(df).mark_bar(opacity=0.7).encode(\n    x=alt.X('day_of_week:N', title='Day of Week'),\n    y=alt.Y('tweet_count:Q', title='Number of Tweets').stack(None),\n    color=alt.Color('user_name:N', title='User')\n).properties(\n    title='Tweets by Users with >1M Followers Grouped by Day of Week'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "twitter_1",
        "chart_category": "Interactive Charts",
        "chart_type": "selection_detail",
        "NLQ": "Can you create a visualization with two panels side by side? On the left, show me a scatter plot of users' follower counts versus their total number of tweets, with each user represented by a colored point. When I click on a user's point, I want that point to be highlighted in color while others turn light gray. On the right panel, show me a line chart displaying when that selected user posted their tweets over time. Make sure to include tooltips that show the user's name, follower count, and tweet count when I hover over points.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/twitter_1.sqlite')\n\nquery = '''\nSELECT \n    up.uid AS user_id,\n    up.name AS user_name,\n    up.followers AS follower_count,\n    COUNT(t.id) AS tweet_count,\n    t.createdate AS tweet_timestamp\nFROM \n    user_profiles AS up\nLEFT JOIN \n    tweets AS t ON up.uid = t.uid\nGROUP BY \n    up.uid, up.name, up.followers\nORDER BY \n    follower_count DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['tweet_timestamp'] = pd.to_datetime(df['tweet_timestamp'])\ndf = df.explode('tweet_timestamp').reset_index(drop=True)\n\nselector = alt.selection_point(fields=['user_id'])\n\ncolor = (\n    alt.when(selector)\n    .then(alt.Color(\"user_name:N\").legend(None))\n    .otherwise(alt.value(\"lightgray\"))\n)\n\nbase = alt.Chart(df).properties(\n    width=250,\n    height=250\n).add_params(selector)\n\npoints = base.mark_point(filled=True, size=200).encode(\n    x='follower_count:Q',\n    y='tweet_count:Q',\n    color=color,\n    tooltip=['user_name:N', 'follower_count:Q', 'tweet_count:Q']\n)\n\nline = base.mark_line().encode(\n    x='tweet_timestamp:T',\n    y=alt.Y('tweet_count:Q').scale(domain=(0, df['tweet_count'].max())),\n    color=alt.Color('user_name:N').legend(None)\n).transform_filter(\n    selector\n)\n\npoints | line"
    },
    {
        "type": "type_A",
        "db_id": "twitter_1",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "line_chart_with_confidence_interval_band",
        "NLQ": "Can you create a line chart showing the average number of followers per day over time? I'd like to see the trend with a confidence interval band around it to show the variability in follower counts. Please title it \"Average Followers per Day with Confidence Interval\" and label the y-axis as \"Followers\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/twitter_1.sqlite')\n\nquery = '''\nSELECT \n    DATE(t.createdate) AS date, \n    AVG(up.followers) AS avg_followers, \n    up.followers AS individual_followers\nFROM \n    tweets AS t\nJOIN \n    user_profiles AS up \nON \n    t.uid = up.uid\nGROUP BY \n    DATE(t.createdate), up.uid\nORDER BY \n    DATE(t.createdate)\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nline = alt.Chart(df).mark_line().encode(\n    x='date:T',\n    y='mean(avg_followers):Q'\n)\n\nband = alt.Chart(df).mark_errorband(extent='ci').encode(\n    x='date:T',\n    y=alt.Y('individual_followers:Q').title('Followers')\n)\n\nchart = band + line\nchart.properties(title=\"Average Followers per Day with Confidence Interval\")"
    },
    {
        "type": "type_A",
        "db_id": "university_basketball",
        "chart_category": "Bar Charts",
        "chart_type": "normalized_stacked_bar_chart",
        "NLQ": "Can you create a normalized stacked bar chart comparing ACC home wins versus road wins for each basketball team? I'd like to see the proportion of home vs road wins for each team, with the teams listed vertically and the bars showing the percentage breakdown. Please title it \"Normalized Comparison of ACC Home vs Road Wins\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/university_basketball.sqlite')\nquery = '''\nSELECT \n    Team_Name,\n    CAST(SUBSTR(ACC_Home, 1, INSTR(ACC_Home, 'â') - 1) AS INT) AS ACC_Home_Wins,\n    CAST(SUBSTR(ACC_Road, 1, INSTR(ACC_Road, 'â') - 1) AS INT) AS ACC_Road_Wins\nFROM basketball_match\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_long = df.melt(id_vars=['Team_Name'], \n                  value_vars=['ACC_Home_Wins', 'ACC_Road_Wins'],\n                  var_name='Game_Location', \n                  value_name='Wins')\n\nchart = alt.Chart(df_long).mark_bar().encode(\n    x=alt.X('sum(Wins)').stack(\"normalize\"),\n    y='Team_Name:N',\n    color='Game_Location:N'\n).properties(\n    title=\"Normalized Comparison of ACC Home vs Road Wins\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "university_basketball",
        "chart_category": "Interactive Charts",
        "chart_type": "selection_detail",
        "NLQ": "Can you create a side-by-side visualization showing basketball team performance? I'd like a scatter plot on the left showing team names and their overall win percentages, where I can click on a team to highlight it in color while others appear in light gray. Then on the right, show me a line chart that displays the selected team's win percentages across home, road, and neutral games, with the win percentage scale ranging from 0 to 1. Make sure the line chart updates whenever I select a different team in the scatter plot.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/university_basketball.sqlite')\n\nquery = '''\nSELECT \n    bm.Team_Name,\n    bm.All_Games_Percent AS Overall_Win_Percent,\n    CAST(SUBSTR(bm.All_Home, 1, INSTR(bm.All_Home, 'â') - 1) AS REAL) / \n    (CAST(SUBSTR(bm.All_Home, 1, INSTR(bm.All_Home, 'â') - 1) AS REAL) + \n     CAST(SUBSTR(bm.All_Home, INSTR(bm.All_Home, 'â') + 1) AS REAL)) AS Home_Win_Percent,\n    CAST(SUBSTR(bm.All_Road, 1, INSTR(bm.All_Road, 'â') - 1) AS REAL) / \n    (CAST(SUBSTR(bm.All_Road, 1, INSTR(bm.All_Road, 'â') - 1) AS REAL) + \n     CAST(SUBSTR(bm.All_Road, INSTR(bm.All_Road, 'â') + 1) AS REAL)) AS Road_Win_Percent,\n    CAST(SUBSTR(bm.All_Neutral, 1, INSTR(bm.All_Neutral, 'â') - 1) AS REAL) / \n    (CAST(SUBSTR(bm.All_Neutral, 1, INSTR(bm.All_Neutral, 'â') - 1) AS REAL) + \n     CAST(SUBSTR(bm.All_Neutral, INSTR(bm.All_Neutral, 'â') + 1) AS REAL)) AS Neutral_Win_Percent\nFROM \n    basketball_match AS bm\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nmelted_df = df.melt(id_vars=['Team_Name', 'Overall_Win_Percent'], \n                    value_vars=['Home_Win_Percent', 'Road_Win_Percent', 'Neutral_Win_Percent'],\n                    var_name='Game_Type', value_name='Win_Percent')\n\nselector = alt.selection_point(fields=['Team_Name'])\n\ncolor = (\n    alt.when(selector)\n    .then(alt.Color(\"Team_Name:N\").legend(None))\n    .otherwise(alt.value(\"lightgray\"))\n)\n\nbase = alt.Chart(df).properties(\n    width=250,\n    height=250\n).add_params(selector)\n\npoints = base.mark_point(filled=True, size=200).encode(\n    x=alt.X('Overall_Win_Percent:Q', title='Overall Win Percentage'),\n    y=alt.Y('Team_Name:N', title='Team Name'),\n    color=color\n)\n\nline = alt.Chart(melted_df).mark_line().encode(\n    x=alt.X('Game_Type:N', title='Game Type'),\n    y=alt.Y('Win_Percent:Q', title='Win Percentage', scale=alt.Scale(domain=(0, 1))),\n    color=alt.Color('Team_Name:N').legend(None)\n).transform_filter(\n    selector\n)\n\npoints | line"
    },
    {
        "type": "type_A",
        "db_id": "voter_1",
        "chart_category": "Bar Charts",
        "chart_type": "normalized_stacked_bar_chart",
        "NLQ": "Can you create a bar chart showing the vote distribution across states for each contestant? I'd like to see the contestants listed on the y-axis and the percentage of votes on the x-axis. Please use a normalized stacked bar chart where different colors represent different states, and title it \"Vote Distribution Across States for Each Contestant\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/voter_1.sqlite')\n\nquery = '''\nSELECT \n    CONTESTANTS.contestant_name AS contestant,\n    VOTES.state AS state,\n    COUNT(VOTES.vote_id) AS vote_count\nFROM VOTES\nJOIN CONTESTANTS ON VOTES.contestant_number = CONTESTANTS.contestant_number\nGROUP BY CONTESTANTS.contestant_name, VOTES.state\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('sum(vote_count)').stack(\"normalize\").title('Percentage of Votes'),\n    y='contestant:N',\n    color='state:N'\n).properties(\n    title='Vote Distribution Across States for Each Contestant'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "voter_2",
        "chart_category": "Bar Charts",
        "chart_type": "normalized_stacked_bar_chart",
        "NLQ": "Can you create a horizontal stacked bar chart showing the proportion of votes for President, Vice President, and Secretary positions across different election cycles? I'd like to see the breakdown as percentages so I can compare the relative distribution of votes between these positions for each election cycle. Please use different colors to distinguish between the vote types.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/voter_2.sqlite')\n\nquery = '''\nSELECT \n    Election_Cycle,\n    SUM(President_Vote) AS Total_President_Votes,\n    SUM(Vice_President_Vote) AS Total_Vice_President_Votes,\n    SUM(Secretary_Vote) AS Total_Secretary_Votes\nFROM Voting_record\nGROUP BY Election_Cycle\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['Election_Cycle'], \n                    value_vars=['Total_President_Votes', 'Total_Vice_President_Votes', 'Total_Secretary_Votes'],\n                    var_name='Vote_Type', value_name='Total_Votes')\n\nchart = alt.Chart(df_melted).mark_bar().encode(\n    x=alt.X('sum(Total_Votes)').stack(\"normalize\"),\n    y='Election_Cycle',\n    color='Vote_Type'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "voter_2",
        "chart_category": "Interactive Charts",
        "chart_type": "selection_histogram",
        "NLQ": "Can you create an interactive visualization showing the distribution of student ages who voted in the Spring election? I'd like to see a scatter plot of age versus count, where I can select specific age ranges. When I make a selection, I want to see a bar chart showing the count of students from each city code within my selected range. Please color-code both charts by city code, with unselected points appearing in light gray.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/voter_2.sqlite')\n\nquery = '''\nSELECT S.Age, S.city_code\nFROM Student AS S\nJOIN Voting_record AS V ON S.StuID = V.StuID\nWHERE V.Election_Cycle = 'Spring'\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df).mark_point().encode(\n    x='Age:Q',\n    y='count():Q',\n    color=alt.condition(brush, 'city_code:N', alt.value('lightgray'))\n).add_params(\n    brush\n)\n\nbars = alt.Chart(df).mark_bar().encode(\n    x='city_code:N',\n    y='count(city_code):Q',\n    color='city_code:N'\n).transform_filter(\n    brush\n)\n\npoints & bars"
    },
    {
        "type": "type_A",
        "db_id": "voter_2",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "polynomial_fit_plot_with_regression_transform",
        "NLQ": "Can you create a scatter plot showing the relationship between student age and advisor, with black dots for each student and colored trend lines? I'd like to see three different polynomial fits (linear, cubic, and 5th degree) overlaid on the same chart, with each trend line in a different color.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/voter_2.sqlite')\nquery = '''\nSELECT Age, Advisor FROM Student;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf.rename(columns={'Age': 'x', 'Advisor': 'y'}, inplace=True)\n\ndegree_list = [1, 3, 5]\n\nbase = alt.Chart(df).mark_circle(color=\"black\").encode(\n    alt.X(\"x\"),\n    alt.Y(\"y\")\n)\n\npolynomial_fit = [\n    base.transform_regression(\n        \"x\", \"y\", method=\"poly\", order=order, as_=[\"x\", str(order)]\n    )\n    .mark_line()\n    .transform_fold([str(order)], as_=[\"degree\", \"y\"])\n    .encode(alt.Color(\"degree:N\"))\n    for order in degree_list\n]\n\nchart = alt.layer(base, *polynomial_fit)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "workshop_paper",
        "chart_category": "Bar Charts",
        "chart_type": "sorted_bar_chart",
        "NLQ": "Can you create a horizontal bar chart showing colleges ranked by their average submission scores? I'd like to see the colleges sorted with the highest scoring ones at the top.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/workshop_paper.sqlite')\nquery = '''\nSELECT College, AVG(Scores) AS Average_Score\nFROM submission\nGROUP BY College\nORDER BY Average_Score DESC\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Average_Score:Q',\n    y=alt.Y('College:N').sort('-x')\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "world_1",
        "chart_category": "Bar Charts",
        "chart_type": "sorted_bar_chart",
        "NLQ": "Could you show me a horizontal bar chart of the 10 most populated cities in the world, with city names on the y-axis and population values on the x-axis, sorted from highest to lowest population?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/world_1.sqlite')\nquery = '''\nSELECT Name, Population\nFROM city\nORDER BY Population DESC\nLIMIT 10\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\nchart = alt.Chart(df).mark_bar().encode(\n    x='Population:Q',\n    y=alt.Y('Name:N').sort('-x')\n)\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "world_1",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "scatter_plot_with_loess_lines",
        "NLQ": "Can you create a scatter plot showing the relationship between population and gross national product for European countries? I'd like to see each country as a circle with 70% opacity, with population on the x-axis and GNP on the y-axis. Please add a smoothed trend line to help visualize the pattern. Only include countries that have GNP data and positive population values. Make the chart 600 pixels wide by 400 pixels tall.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/world_1.sqlite')\nquery = '''\nSELECT \n    country.Population, \n    country.GNP, \n    country.Continent\nFROM \n    country\nWHERE \n    country.Continent = 'Europe' AND country.GNP IS NOT NULL AND country.Population > 0\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).mark_circle(opacity=0.7).encode(\n    alt.X('Population:Q', title='Population'),\n    alt.Y('GNP:Q', title='Gross National Product (GNP)'),\n    alt.Color('Continent:N', title='Continent')\n)\nchart = base + base.transform_loess('Population', 'GNP', groupby=['Continent']).mark_line(size=3)\nchart.properties(width=600, height=400)"
    },
    {
        "type": "type_A",
        "db_id": "wrestler",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart",
        "NLQ": "Can you create a bar chart showing the total number of days wrestlers held their titles across different locations? I'd like to see the days stacked by event type, with each event shown in a different color.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/wrestler.sqlite')\n\nquery = '''\nSELECT Location, Event, SUM(CAST(Days_held AS INT)) AS Total_Days_Held\nFROM wrestler\nGROUP BY Location, Event\nORDER BY Location, Event\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Location:N',\n    y='Total_Days_Held:Q',\n    color='Event:N'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "wrestler",
        "chart_category": "Interactive Charts",
        "chart_type": "simple_interactive_colored_scatter_plot",
        "NLQ": "Can you create an interactive scatter plot showing the relationship between how many days wrestlers held their titles and how long they lasted in elimination matches? I'd like to see each wrestler represented as a circle, with the x-axis showing days held and the y-axis showing elimination time in seconds. Please color-code the circles based on which team each wrestler belonged to.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/wrestler.sqlite')\n\nquery = '''\nSELECT \n    w.Days_held, \n    e.Time, \n    e.Team\nFROM \n    wrestler AS w\nJOIN \n    Elimination AS e\nON \n    w.Wrestler_ID = e.Wrestler_ID\nWHERE \n    w.Days_held != '' AND e.Time != ''\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['Days_held'] = pd.to_numeric(df['Days_held'], errors='coerce')\ndf['Time'] = df['Time'].apply(lambda x: int(x.split(':')[0]) * 60 + int(x.split(':')[1]))\n\nchart = alt.Chart(df).mark_circle().encode(\n    x=alt.X('Days_held', title='Days Held'),\n    y=alt.Y('Time', title='Elimination Time (seconds)'),\n    color='Team'\n).interactive()\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "wrestler",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "scatter_plot_with_loess_lines",
        "NLQ": "Can you create a scatter plot showing the relationship between how many days wrestlers held their titles and their elimination times in seconds? I'd like to see the points colored by team, with smoothed trend lines for each team. Only include data from live events, and title the chart \"Relationship Between Days Held and Elimination Time by Team\". Make the scatter points slightly transparent so we can see overlapping data better.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/wrestler.sqlite')\n\nquery = '''\nSELECT \n    w.Days_held AS Days_Held,\n    CAST(substr(e.Time, 4, 2) AS INTEGER) * 60 + CAST(substr(e.Time, 7, 2) AS INTEGER) AS Elimination_Time_Seconds,\n    e.Team AS Team\nFROM \n    wrestler AS w\nJOIN \n    Elimination AS e\nON \n    w.Wrestler_ID = e.Wrestler_ID\nWHERE \n    w.Event = 'Live event'\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).mark_circle(opacity=0.5).encode(\n    alt.X('Days_Held:Q', title='Days Held'),\n    alt.Y('Elimination_Time_Seconds:Q', title='Elimination Time (Seconds)'),\n    alt.Color('Team:N', title='Team')\n)\n\nchart = base + base.transform_loess('Days_Held', 'Elimination_Time_Seconds', groupby=['Team']).mark_line(size=4)\n\nchart.properties(\n    title=\"Relationship Between Days Held and Elimination Time by Team\"\n)"
    },
    {
        "type": "type_A",
        "db_id": "apartment_rentals",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_sorted_segments",
        "NLQ": "Can you create a bar chart showing the total number of apartments by building type, with each bar broken down by facility code? I'd like the building types listed vertically on the y-axis, with the bars extending horizontally to show apartment counts. Please color-code each segment by facility code and sort the facility segments in ascending order. Title the chart \"Total Apartments by Building Type and Facilities\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/apartment_rentals.sqlite')\n\nquery = '''\nSELECT \n    AB.building_description AS building_type,\n    AF.facility_code,\n    COUNT(AF.apt_id) AS apartment_count\nFROM \n    Apartment_Buildings AS AB\nJOIN \n    Apartments AS A ON AB.building_id = A.building_id\nJOIN \n    Apartment_Facilities AS AF ON A.apt_id = AF.apt_id\nGROUP BY \n    AB.building_description, AF.facility_code\nORDER BY \n    AB.building_description, AF.facility_code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='sum(apartment_count):Q',\n    y='building_type:N',\n    color='facility_code:N',\n    order=alt.Order(\n        'facility_code:N',\n        sort='ascending'\n    )\n).properties(\n    title=\"Total Apartments by Building Type and Facilities\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "apartment_rentals",
        "chart_category": "Interactive Charts",
        "chart_type": "slider_cutoff",
        "NLQ": "Can you show me a scatter plot of apartment buildings and their bedroom counts? I'd like to see each building as a circle, with buildings having more bedrooms than a cutoff value highlighted in red and the rest in blue. Please include a slider that lets me adjust this bedroom count cutoff, starting at 3 bedrooms. Also, make it so I can see the building description and exact bedroom count when I hover over each circle.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/apartment_rentals.sqlite')\nquery = '''\nSELECT\n    AB.building_description,\n    A.bedroom_count\nFROM\n    Apartments AS A\nJOIN\n    Apartment_Buildings AS AB ON A.building_id = AB.building_id\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbedroom_slider = alt.binding_range(min=0, max=6, step=1, name='Bedroom Count Cutoff:')\ncutoff_param = alt.param(bind=bedroom_slider, value=3)\npredicate = alt.datum.bedroom_count > cutoff_param\n\nchart = alt.Chart(df).mark_circle().encode(\n    x='building_description:N',\n    y='bedroom_count:Q',\n    color=alt.condition(\n        predicate,\n        alt.value('red'),\n        alt.value('blue')\n    ),\n    tooltip=['building_description', 'bedroom_count']\n).add_params(\n    cutoff_param\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "architecture",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_sorted_segments",
        "NLQ": "Can you show me a horizontal bar chart of the total length of bridges by architect nationality? I'd like to see the bars colored by nationality and sorted alphabetically by country name, with a title \"Total Length of Bridges by Architect Nationality\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/architecture.sqlite')\n\nquery = '''\nSELECT \n    a.nationality AS nationality,\n    SUM(b.length_meters) AS total_length_meters\nFROM \n    architect AS a\nJOIN \n    bridge AS b ON a.id = b.architect_id\nGROUP BY \n    a.nationality\nORDER BY \n    a.nationality ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='sum(total_length_meters):Q',\n    y='nationality:N',\n    color='nationality:N',\n    order=alt.Order(\n        'nationality',\n        sort='ascending'\n    )\n).properties(\n    title=\"Total Length of Bridges by Architect Nationality\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "architecture",
        "chart_category": "Interactive Charts",
        "chart_type": "using_selection_interval_with_mark_area",
        "NLQ": "Can you create an interactive area chart showing the number of mills built each year, categorized by type? I'd like to be able to select specific time periods to see those areas highlighted more clearly, while the unselected areas remain visible but more transparent.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/architecture.sqlite')\n\nquery = '''\nSELECT \n    built_year AS year,\n    type,\n    COUNT(*) AS count\nFROM \n    mill\nGROUP BY \n    built_year, type\nORDER BY \n    built_year ASC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).mark_area(\n    opacity=0.3\n).encode(\n    x='year:O',\n    y='sum(count):Q',\n    color='type:N'\n)\n\nbrush = alt.selection_interval(encodings=['x'])\nbackground = base.add_params(brush)\nselected = base.transform_filter(brush).mark_area(opacity=1)\n\nchart = background + selected\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "battle_death",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_text_overlay",
        "NLQ": "Can you create a horizontal bar chart showing the total killed and injured in battles? I'd like to see the battle names on the y-axis and the casualty counts on the x-axis. Please color the bars based on the number of injured using shades of blue, and display the exact number of people killed as white text on each bar. Title the chart \"Total Killed and Injured in Battles\" and sort the battles by the highest number of casualties at the top.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/battle_death.sqlite')\n\nquery = '''\nSELECT \n    b.name AS battle_name,\n    SUM(d.killed) AS total_killed,\n    SUM(d.injured) AS total_injured\nFROM \n    battle AS b\nJOIN \n    death AS d ON b.id = d.caused_by_ship_id\nGROUP BY \n    b.name\nORDER BY \n    total_killed DESC, total_injured DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('total_killed:Q', stack='zero', title='Total Killed and Injured'),\n    y=alt.Y('battle_name:N', title='Battle Name'),\n    color=alt.Color('total_injured:Q', scale=alt.Scale(scheme='blues'), title='Injured')\n)\n\ntext = alt.Chart(df).mark_text(dx=-15, dy=3, color='white').encode(\n    x=alt.X('total_killed:Q', stack='zero'),\n    y=alt.Y('battle_name:N'),\n    detail='total_injured:Q',\n    text=alt.Text('total_killed:Q', format='.0f')\n)\n\n(bars + text).properties(\n    title='Total Killed and Injured in Battles'\n)"
    },
    {
        "type": "type_A",
        "db_id": "behavior_monitoring",
        "chart_category": "Circular Plots",
        "chart_type": "donut_chart",
        "NLQ": "Could you create a donut chart showing the breakdown of different behavior incident types? I'd like to see the count of each incident type represented as segments in the chart, with different colors for each incident type and a hollow center.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/behavior_monitoring.sqlite')\n\nquery = '''\nSELECT \n    Ref_Incident_Type.incident_type_description AS incident_type,\n    COUNT(Behavior_Incident.incident_id) AS incident_count\nFROM \n    Behavior_Incident\nJOIN \n    Ref_Incident_Type ON Behavior_Incident.incident_type_code = Ref_Incident_Type.incident_type_code\nGROUP BY \n    Ref_Incident_Type.incident_type_description\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndonut_chart = alt.Chart(df).mark_arc(innerRadius=50).encode(\n    theta=\"incident_count:Q\",\n    color=\"incident_type:N\"\n)\n\ndonut_chart"
    },
    {
        "type": "type_A",
        "db_id": "bike_1",
        "chart_category": "Circular Plots",
        "chart_type": "donut_chart",
        "NLQ": "Can you show me a donut chart of the number of bike trips by city? Include tooltips that show both the city name and the exact trip count when I hover over each segment.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/bike_1.sqlite')\n\nquery = '''\nSELECT s.city, COUNT(t.id) AS trip_count\nFROM trip AS t\nJOIN station AS s ON t.start_station_id = s.id\nGROUP BY s.city\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_arc(innerRadius=50).encode(\n    theta=\"trip_count\",\n    color=\"city:N\",\n    tooltip=[\"city\", \"trip_count\"]\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "body_builder",
        "chart_category": "Circular Plots",
        "chart_type": "donut_chart",
        "NLQ": "Can you create a donut chart showing the total weight lifted by bodybuilders grouped by their birth place? Make the inner radius 50 pixels and use different colors to represent each birth place.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/body_builder.sqlite')\n\nquery = '''\nSELECT p.Birth_Place AS BirthPlace, SUM(b.Total) AS TotalWeightLifted\nFROM body_builder AS b\nJOIN people AS p ON b.People_ID = p.People_ID\nGROUP BY p.Birth_Place\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_arc(innerRadius=50).encode(\n    theta=\"TotalWeightLifted:Q\",\n    color=\"BirthPlace:N\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "book_2",
        "chart_category": "Circular Plots",
        "chart_type": "pacman_chart",
        "NLQ": "Can you create a Pac-Man shape using a golden colored arc? Make it look like the classic Pac-Man with its mouth open at about the 2 o'clock position.",
        "code": "import numpy as np\nimport altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/book_2.sqlite')\nquery = \"SELECT COUNT(*) FROM publication\"\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart().mark_arc(color=\"gold\").encode(\n    theta=alt.ThetaDatum((5 / 8) * np.pi).scale(None),\n    theta2=alt.Theta2Datum((19 / 8) * np.pi),\n    radius=alt.RadiusDatum(100).scale(None),\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "city_record",
        "chart_category": "Circular Plots",
        "chart_type": "pie_chart",
        "NLQ": "Show me a pie chart of the top 5 cities by GDP. I want to see how the GDP is distributed among these cities, with each city represented by a different color.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/city_record.sqlite')\nquery = '''\nSELECT City, GDP\nFROM city\nORDER BY GDP DESC\nLIMIT 5\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_arc().encode(\n    theta=\"GDP\",\n    color=\"City\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "climbing",
        "chart_category": "Circular Plots",
        "chart_type": "pie_chart_with_labels",
        "NLQ": "Can you create a pie chart showing how climbers' points are distributed across different mountains? I'd like each slice to represent a mountain with its size showing the total points earned there. Please put the mountain names as labels outside the pie chart instead of using a legend, and make these labels a good size so they're easy to read.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/climbing.sqlite')\nquery = '''\nSELECT \n    m.Name AS Mountain_Name, \n    SUM(c.Points) AS Total_Points\nFROM climber AS c\nJOIN mountain AS m ON c.Mountain_ID = m.Mountain_ID\nGROUP BY m.Name\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"Total_Points:Q\").stack(True),\n    alt.Color(\"Mountain_Name:N\").legend(None)\n)\n\npie = base.mark_arc(outerRadius=120)\ntext = base.mark_text(radius=140, size=20).encode(text=\"Mountain_Name:N\")\n\nchart = pie + text\nchart"
    },
    {
        "type": "type_A",
        "db_id": "club_1",
        "chart_category": "Circular Plots",
        "chart_type": "pie_chart_with_labels",
        "NLQ": "Can you create a pie chart showing the gender distribution of students? Make it a good size with the gender labels placed outside the pie slices instead of using a legend.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/club_1.sqlite')\n\nquery = '''\nSELECT Sex, COUNT(*) AS count\nFROM Student\nGROUP BY Sex;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"count:Q\").stack(True),\n    alt.Color(\"Sex:N\").legend(None)\n)\n\npie = base.mark_arc(outerRadius=120)\ntext = base.mark_text(radius=140, size=20).encode(text=\"Sex:N\")\n\nchart = pie + text\nchart"
    },
    {
        "type": "type_A",
        "db_id": "coffee_shop",
        "chart_category": "Circular Plots",
        "chart_type": "pie_chart_with_labels",
        "NLQ": "Can you create a pie chart showing the distribution of membership card types? Make it a good size with the card type labels placed outside the pie slices instead of using a legend.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/coffee_shop.sqlite')\nquery = '''\nSELECT Membership_card, COUNT(*) AS count\nFROM member\nGROUP BY Membership_card;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"count:Q\").stack(True),\n    alt.Color(\"Membership_card:N\").legend(None)\n)\npie = base.mark_arc(outerRadius=120)\ntext = base.mark_text(radius=140, size=20).encode(text=\"Membership_card:N\")\nchart = pie + text\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "college_3",
        "chart_category": "Circular Plots",
        "chart_type": "polar_bar_chart",
        "NLQ": "Can you create a circular chart showing the number of courses offered by each department? I'd like to see the departments arranged in a circle with bars extending outward where the length represents the course count. Please include the department names around the outside and add grid lines to help read the values. Color the bars based on the number of courses and give it the title \"Number of Courses Offered by Each Department\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nimport math\n\nconn = sqlite3.connect('database\\college_3.sqlite')\n\nquery = \"\"\"\nSELECT D.DName, COUNT(C.CID) AS CourseCount\nFROM Department AS D\nLEFT JOIN Course AS C ON D.DNO = C.DNO\nGROUP BY D.DName;\n\"\"\"\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nnum_departments = len(df)\ndf['angle'] = (2 * math.pi / num_departments) * df.index\n\npolar_bars = alt.Chart(df).mark_arc(stroke='white', tooltip=True).encode(\n    theta=alt.Theta(\"angle:Q\", scale=alt.Scale(domain=[0, 2 * math.pi])),\n    radius=alt.Radius('CourseCount:Q').scale(type='linear'),\n    color=alt.Color('CourseCount:Q', legend=None),\n    radius2=alt.datum(1)\n)\n\nmax_count = df['CourseCount'].max()\naxis_rings = alt.Chart(pd.DataFrame({\"ring\": range(0, int(max_count) + 2, 2)})).mark_arc(stroke='lightgrey', fill=None).encode(\n    theta=alt.value(2 * math.pi),\n    radius=alt.Radius('ring:Q').stack(False)\n)\naxis_rings_labels = axis_rings.mark_text(color='grey', radiusOffset=5, align='left').encode(\n    text=\"ring:Q\",\n    theta=alt.value(math.pi / 4)\n)\n\naxis_lines_data = []\nfor i in range(num_departments):\n  angle = (2*math.pi/num_departments) * i\n  axis_lines_data.append({'radius':max_count+2, 'theta': angle, 'DName':df['DName'][i]})\naxis_lines_df = pd.DataFrame(axis_lines_data)\n\naxis_lines = alt.Chart(axis_lines_df).mark_arc(stroke='lightgrey', fill=None).encode(\n  theta=alt.Theta('theta:Q').stack(True),\n    radius=alt.Radius('radius:Q'),\n    radius2=alt.datum(1)\n)\n\naxis_lines_labels = axis_lines.mark_text(\n    color='grey',\n    radiusOffset=10,\n).encode(\n    text=\"DName:N\",\n    theta=alt.Theta('theta:Q')\n)\n\nchart = alt.layer(\n    axis_rings,\n    polar_bars,\n    axis_rings_labels,\n    axis_lines,\n    axis_lines_labels\n).properties(\n    title='Number of Courses Offered by Each Department'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "college_3",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_custom_order",
        "NLQ": "Can you create a line chart showing the trend of average grade points for each course in the Computer Science department (department 600)? I'd like to see the courses ordered by their Course ID on the x-axis, with the average grade points on the y-axis. Include points on the line and add tooltips showing the Course ID, Course Name, and exact Grade Point value when I hover. Please title it \"Trend of Average Grade Points by Course in Computer Science Department\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/college_3.sqlite')\n\nquery = '''\nSELECT \n    Course.CID AS CourseID,\n    Course.CName AS CourseName,\n    Enrolled_in.Grade,\n    Gradeconversion.gradepoint AS GradePoint\nFROM \n    Enrolled_in\nJOIN \n    Course ON Enrolled_in.CID = Course.CID\nJOIN \n    Gradeconversion ON Enrolled_in.Grade = Gradeconversion.lettergrade\nWHERE \n    Course.DNO = 600\nORDER BY \n    Course.CID;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ngrouped_df = df.groupby(['CourseID', 'CourseName'], as_index=False).agg({'GradePoint': 'mean'})\n\nchart = alt.Chart(grouped_df).mark_line(point=True).encode(\n    x=alt.X(\"CourseID:N\").title(\"Course ID\"),\n    y=alt.Y(\"GradePoint:Q\").title(\"Average Grade Points\"),\n    order=\"CourseID\",\n    tooltip=[\"CourseID\", \"CourseName\", \"GradePoint\"]\n).properties(\n    title=\"Trend of Average Grade Points by Course in Computer Science Department\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "company_1",
        "chart_category": "Circular Plots",
        "chart_type": "radial_chart",
        "NLQ": "Can you create a radial chart showing the number of employees in each department? I'd like the segments sized by employee count, with the department names in different colors. Also, please display the exact employee count as text on each segment.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_1.sqlite')\n\nquery = '''\nSELECT D.Dname, COUNT(E.Ssn) AS EmployeeCount\nFROM employee AS E\nJOIN department AS D ON E.Dno = D.Dnumber\nGROUP BY D.Dname;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"EmployeeCount:Q\").stack(True),\n    alt.Radius(\"EmployeeCount\").scale(type=\"sqrt\", zero=True, rangeMin=20),\n    color=\"Dname:N\",\n)\n\nc1 = base.mark_arc(innerRadius=20, stroke=\"#fff\")\n\nc2 = base.mark_text(radiusOffset=10).encode(text=\"EmployeeCount:Q\")\n\nchart = c1 + c2\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "company_office",
        "chart_category": "Circular Plots",
        "chart_type": "radial_chart",
        "NLQ": "Can you create a radial chart showing the number of companies moving into buildings by city and year? I'd like to see the cities in different colors, with the count represented by both the arc size and as text labels. Please title it \"Companies Moving Into Buildings by City and Year\" and include tooltips showing the city, year, and company count when I hover over sections.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_office.sqlite')\n\nquery = '''\nSELECT \n    b.City AS city,\n    o.move_in_year AS year,\n    COUNT(o.company_id) AS company_count\nFROM \n    Office_locations AS o\nJOIN \n    buildings AS b ON o.building_id = b.id\nGROUP BY \n    b.City, o.move_in_year\nORDER BY \n    b.City, o.move_in_year;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"company_count:Q\").stack(True),\n    alt.Radius(\"company_count\").scale(type=\"sqrt\", zero=True, rangeMin=20),\n    color=\"city:N\",\n    tooltip=[\"city:N\", \"year:Q\", \"company_count:Q\"]\n)\n\nc1 = base.mark_arc(innerRadius=20, stroke=\"#fff\")\n\nc2 = base.mark_text(radiusOffset=10).encode(text=\"company_count:Q\")\n\nchart = c1 + c2\n\nchart.properties(title=\"Companies Moving Into Buildings by City and Year\")"
    },
    {
        "type": "type_A",
        "db_id": "county_public_safety",
        "chart_category": "Distributions",
        "chart_type": "2d_histogram_heatmap",
        "NLQ": "Can you create a heatmap showing the relationship between crime rates and residents per police officer across counties? I'd like to see where these values tend to cluster, with the count shown using a greenblue color gradient. Please divide the crime rate into about 60 bins on the x-axis and residents per officer into about 40 bins on the y-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/county_public_safety.sqlite')\nquery = '''\nSELECT Crime_rate, Residents_per_officer\nFROM county_public_safety\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_rect().encode(\n    alt.X('Crime_rate:Q').bin(maxbins=60),\n    alt.Y('Residents_per_officer:Q').bin(maxbins=40),\n    alt.Color('count():Q').scale(scheme='greenblue')\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "cre_Doc_Tracking_DB",
        "chart_category": "Distributions",
        "chart_type": "boxplot_with_minmax_whiskers",
        "NLQ": "Can you create a boxplot showing the storage duration in days for different document types? I'd like to see the full range from minimum to maximum values for each document type, with the document types listed on the x-axis and the storage duration on the y-axis. This would help me understand how long different types of documents typically stay in storage.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/cre_Doc_Tracking_DB.sqlite')\n\nquery = '''\nSELECT \n    T1.Document_Type_Name,\n    (julianday(T2.Date_Stored) - julianday(T3.Date_in_Location_From)) AS Storage_Duration\nFROM \n    Ref_Document_Types AS T1\nJOIN \n    All_Documents AS T2 ON T1.Document_Type_Code = T2.Document_Type_Code\nJOIN \n    Document_Locations AS T3 ON T2.Document_ID = T3.Document_ID\nWHERE \n    T3.Date_in_Location_From IS NOT NULL AND T2.Date_Stored IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_boxplot(extent='min-max').encode(\n    x=alt.X('Document_Type_Name:N', title='Document Type'),\n    y=alt.Y('Storage_Duration:Q', title='Storage Duration (Days)')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "customers_campaigns_ecommerce",
        "chart_category": "Distributions",
        "chart_type": "distributions_and_medians_of_likert_scale_ratings",
        "NLQ": "Can you create a bubble chart showing how item order quantities are distributed across different product categories? I'd like to see the product categories listed vertically on the left side, with the order quantities along the bottom. Use blue bubbles where the size represents the number of orders. Also, mark the median quantity for each category with a black tick mark, and add \"Low Quantity\" and \"High Quantity\" labels on the left and right sides. Title it \"Distribution of Item Order Quantities by Product Category\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/customers_campaigns_ecommerce.sqlite')\nquery = '''\nSELECT p.product_category, CAST(oi.item_order_quantity AS INTEGER) AS item_order_quantity\nFROM Order_Items AS oi\nJOIN Products AS p ON oi.product_id = p.product_id\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nmedians_df = df.groupby('product_category')['item_order_quantity'].median().reset_index()\nmedians_df.columns = ['product_category', 'median_quantity']\nmedians_df['lo'] = 'Low Quantity'\nmedians_df['hi'] = 'High Quantity'\n\ny_axis = alt.Y(\"product_category\").axis(\n    title=\"Product Category\",\n    offset=50,\n    labelFontWeight=\"bold\",\n    ticks=False,\n    grid=True,\n    domain=False,\n)\n\nbase = alt.Chart(\n    medians_df,\n).encode(y_axis)\n\nbubbles = (\n    alt.Chart(df)\n    .mark_circle(color=\"#6EB4FD\")\n    .encode(\n        alt.X(\n            \"item_order_quantity:Q\",\n        ).title(\"Item Order Quantity\"),\n        y_axis,\n        alt.Size(\"count()\").legend(offset=75, title=\"Number of Orders\"),\n        tooltip=[alt.Tooltip(\"count()\").title(\"Number of Orders\")],\n    )\n)\n\nticks = base.mark_tick(color=\"black\").encode(\n    alt.X(\"median_quantity:Q\")\n    .axis(grid=False)\n)\n\ntexts_lo = base.mark_text(align=\"right\", x=-5).encode(text=\"lo\")\n\ntexts_hi = base.mark_text(align=\"left\", x=255).encode(text=\"hi\")\n\nchart = (bubbles + ticks + texts_lo + texts_hi).properties(\n    title=\"Distribution of Item Order Quantities by Product Category\", width=300, height=200\n).configure_view(stroke=None)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "customers_card_transactions",
        "chart_category": "Distributions",
        "chart_type": "distributions_and_medians_of_likert_scale_ratings",
        "NLQ": "Can you show me a bubble chart comparing customer satisfaction ratings for Payment and Refund transactions? I'd like to see how many ratings fall into each level from 1 to 5, with the size of the bubbles showing the number of ratings. Please include the median rating for each transaction type and label the ends of the scale as \"Very Dissatisfied\" and \"Very Satisfied\". Title it \"Customer Ratings for Transaction Types\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customers_card_transactions.sqlite')\nquery = '''\nSELECT \n    T1.transaction_type AS transaction_type,\n    CASE \n        WHEN T1.transaction_amount > 1000 THEN 5\n        WHEN T1.transaction_amount BETWEEN 500 AND 1000 THEN 4\n        WHEN T1.transaction_amount BETWEEN 200 AND 499 THEN 3\n        WHEN T1.transaction_amount BETWEEN 100 AND 199 THEN 2\n        ELSE 1\n    END AS rating\nFROM Financial_Transactions AS T1\nWHERE T1.transaction_type IN ('Payment', 'Refund')\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nmedians = df.groupby('transaction_type')['rating'].median().reset_index()\nmedians.columns = ['name', 'median']\nmedians['lo'] = 'Very Dissatisfied'\nmedians['hi'] = 'Very Satisfied'\n\nvalues = df.rename(columns={'transaction_type': 'name', 'rating': 'value'})\n\ny_axis = alt.Y(\"name\").axis(\n    title=None,\n    offset=50,\n    labelFontWeight=\"bold\",\n    ticks=False,\n    grid=True,\n    domain=False,\n)\n\nbase = alt.Chart(medians).encode(y_axis)\n\nbubbles = (\n    alt.Chart(values)\n    .mark_circle(color=\"#6EB4FD\")\n    .encode(\n        alt.X(\"value:Q\").title(None),\n        y_axis,\n        alt.Size(\"count()\").legend(offset=75, title=\"Number of ratings\"),\n        tooltip=[alt.Tooltip(\"count()\").title(\"Number of ratings\")],\n    )\n)\n\nticks = base.mark_tick(color=\"black\").encode(\n    alt.X(\"median:Q\")\n    .axis(grid=False, values=[1, 2, 3, 4, 5], format=\".0f\")\n    .scale(domain=[0, 6]),\n)\n\ntexts_lo = base.mark_text(align=\"right\", x=-5).encode(text=\"lo\")\ntexts_hi = base.mark_text(align=\"left\", x=255).encode(text=\"hi\")\n\n(bubbles + ticks + texts_lo + texts_hi).properties(\n    title=\"Customer Ratings for Transaction Types\", width=250, height=175\n).configure_view(stroke=None)"
    },
    {
        "type": "type_A",
        "db_id": "customer_complaints",
        "chart_category": "Distributions",
        "chart_type": "dot_dash_plot",
        "NLQ": "Can you create an interactive scatter plot showing the relationship between complaint IDs and product prices? I'd like the points to be colored by product category, but only when I select an area of the chart - otherwise, keep them grey. Also, add tick marks along the axes that show the distribution of complaint IDs and product prices, with the ticks also colored by product category when selected. I want to be able to brush over areas to highlight specific data points and see patterns across different product categories.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/customer_complaints.sqlite')\nquery = '''\nSELECT\n    C.complaint_id,\n    P.product_price,\n    P.product_category_code\nFROM\n    Complaints AS C\nJOIN\n    Products AS P ON C.product_id = P.product_id;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\nbrush_category = alt.when(brush).then(\"product_category_code\")\nbase = alt.Chart(df).add_params(brush)\n\npoints = base.mark_point().encode(\n    x=alt.X('complaint_id', title=''),\n    y=alt.Y('product_price', title=''),\n    color=brush_category.otherwise(alt.value(\"grey\")),\n)\n\ntick_axis = alt.Axis(labels=False, domain=False, ticks=False)\ntick_color = brush_category.otherwise(alt.value(\"lightgrey\"))\n\nx_ticks = base.mark_tick().encode(\n    alt.X('complaint_id', axis=tick_axis),\n    alt.Y('product_category_code', title='', axis=tick_axis),\n    color=tick_color\n)\n\ny_ticks = base.mark_tick().encode(\n    alt.X('product_category_code', title='', axis=tick_axis),\n    alt.Y('product_price', axis=tick_axis),\n    color=tick_color\n)\n\nchart = y_ticks | (points & x_ticks)\nchart"
    },
    {
        "type": "type_A",
        "db_id": "hr_1",
        "chart_category": "Distributions",
        "chart_type": "repeated_density_estimates",
        "NLQ": "Can you create a series of small density plots showing how employee salaries are distributed for each job title? I'd like to see them stacked vertically with one row per job title, where each plot shows the salary range from 0 to $25,000. Make each plot about 300 pixels wide and 50 pixels tall, with \"Salary\" labeled on the x-axis and \"Density\" on the y-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/hr_1.sqlite')\n\nquery = '''\nSELECT e.SALARY, j.JOB_TITLE\nFROM employees AS e\nJOIN jobs AS j ON e.JOB_ID = j.JOB_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_fold(\n    ['SALARY'],\n    as_=['Measurement_type', 'value']\n).transform_density(\n    density='value',\n    bandwidth=500,\n    groupby=['JOB_TITLE'],\n    extent=[0, 25000]\n).mark_area().encode(\n    alt.X(\"value:Q\", title=\"Salary\"),\n    alt.Y(\"density:Q\", title=\"Density\"),\n    alt.Row(\"JOB_TITLE:N\", title=\"Job Title\")\n).properties(\n    width=300, height=50\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "hr_1",
        "chart_category": "Scatter Plots",
        "chart_type": "brushing_scatter_plot_to_show_data_on_a_table",
        "NLQ": "Can you create a scatter plot showing the relationship between employee salary and commission percentage? I'd like the selected points to be highlighted in blue while the unselected ones appear in grey. When I select points on the scatter plot, please show me a table with the first name, last name, job title, and department for those employees (up to 15 records).",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/hr_1.sqlite')\n\nquery = '''\nSELECT \n    e.FIRST_NAME,\n    e.LAST_NAME,\n    e.SALARY,\n    e.COMMISSION_PCT,\n    j.JOB_TITLE,\n    d.DEPARTMENT_NAME\nFROM \n    employees AS e\nJOIN \n    jobs AS j ON e.JOB_ID = j.JOB_ID\nJOIN \n    departments AS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df).mark_point().encode(\n    x=alt.X('SALARY:Q', title='Salary'),\n    y=alt.Y('COMMISSION_PCT:Q', title='Commission Percentage'),\n    color=alt.condition(brush, alt.value(\"steelblue\"), alt.value(\"grey\"))\n).add_params(brush)\n\nranked_text = alt.Chart(df).mark_text(align='right').encode(\n    y=alt.Y('row_number:O').axis(None)\n).transform_filter(\n    brush\n).transform_window(\n    row_number='row_number()'\n).transform_filter(\n    alt.datum.row_number < 15\n)\n\nfirst_name = ranked_text.encode(text='FIRST_NAME:N').properties(\n    title=alt.Title(text='First Name', align='right')\n)\nlast_name = ranked_text.encode(text='LAST_NAME:N').properties(\n    title=alt.Title(text='Last Name', align='right')\n)\njob_title = ranked_text.encode(text='JOB_TITLE:N').properties(\n    title=alt.Title(text='Job Title', align='right')\n)\ndepartment_name = ranked_text.encode(text='DEPARTMENT_NAME:N').properties(\n    title=alt.Title(text='Department', align='right')\n)\ntext = alt.hconcat(first_name, last_name, job_title, department_name)\n\nchart = alt.hconcat(\n    points,\n    text\n).resolve_legend(\n    color=\"independent\"\n).configure_view(\n    stroke=None\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "performance_attendance",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_chart_with_aggregation",
        "NLQ": "Can you create a chart showing the relationship between performance attendance and the number of pieces played? I'd like to have an interactive slider to filter performances based on attendance threshold. For performances above the threshold, show them as individual circles, but for those below the threshold, group them into bins and show the count by circle size. Please add a vertical line showing the current threshold value, and title the chart \"Performance Attendance vs. Number of Pieces Played\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/performance_attendance.sqlite')\n\nquery = '''\nSELECT\n    p.Attendance,\n    ma.Num_of_Pieces\nFROM\n    performance AS p\nJOIN\n    member_attendance AS ma ON p.Performance_ID = ma.Performance_ID;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nmax_attendance = df['Attendance'].max()\nslider = alt.binding_range(min=0, max=max_attendance, step=100, name='Attendance Threshold')\nthreshold = alt.param(name=\"threshold\", value=max_attendance/2, bind=slider)\n\nchart = alt.layer(\n    alt.Chart(df).mark_circle().encode(\n        x=alt.X(\"Attendance:Q\").title(\"Performance Attendance\"),\n        y=alt.Y(\"Num_of_Pieces:Q\").title(\"Number of Pieces Played\")\n    ).transform_filter(\n        alt.datum[\"Attendance\"] >= threshold\n    ),\n    alt.Chart(df).mark_circle().encode(\n        x=alt.X(\"Attendance:Q\").bin(maxbins=10).title(\"Performance Attendance (binned)\"),\n        y=alt.Y(\"Num_of_Pieces:Q\").bin(maxbins=10).title(\"Number of Pieces Played (binned)\"),\n        size=alt.Size(\"count():Q\").scale(domain=[0, df.shape[0]])\n    ).transform_filter(\n        alt.datum[\"Attendance\"] < threshold\n    ),\n    alt.Chart().mark_rule(color=\"gray\").encode(\n        strokeWidth=alt.StrokeWidth(value=6),\n        x=alt.X(datum=alt.expr(threshold.name), type=\"quantitative\").title(\"Attendance Threshold\")\n    )\n).add_params(threshold).properties(\n    title=\"Performance Attendance vs. Number of Pieces Played\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "perpetrator",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_chart_with_cross-highlight",
        "NLQ": "Can you create a heatmap showing the relationship between total people killed and injured in attacks by country? I'd like to see how many countries fall into each range, with a color scale from light to dark green-blue showing the count. Below the heatmap, please add a bar chart showing individual countries that I can click on to highlight their position in the heatmap. When I select a country in the bar chart, I want to see its data point highlighted in the heatmap while others turn grey.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/perpetrator.sqlite')\n\nquery = '''\nSELECT Country, SUM(Killed) AS Total_Killed, SUM(Injured) AS Total_Injured\nFROM perpetrator\nGROUP BY Country\nORDER BY Total_Killed DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\npts = alt.selection_point(encodings=['x'])\n\nrect = alt.Chart(df).mark_rect().encode(\n    alt.X('Total_Killed:Q', bin=True, title='Total Killed'),\n    alt.Y('Total_Injured:Q', bin=True, title='Total Injured'),\n    alt.Color('count()').scale(scheme='greenblue').title('Number of Countries')\n)\n\ncirc = rect.mark_point().encode(\n    alt.ColorValue('grey'),\n    alt.Size('count()').title('Countries in Selection')\n).transform_filter(\n    pts\n)\n\nbar = alt.Chart(df, width=550, height=200).mark_bar().encode(\n    x='Country:N',\n    y='count()',\n    color=alt.when(pts).then(alt.ColorValue(\"steelblue\")).otherwise(alt.ColorValue(\"grey\"))\n).add_params(pts)\n\nchart = alt.vconcat(\n    rect + circ,\n    bar\n).resolve_legend(\n    color=\"independent\",\n    size=\"independent\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "pilot_record",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_crossfilter",
        "NLQ": "Can you create a dashboard with three histograms showing the distribution of pilots' ages, ranks, and join years? I'd like them to be interactive so I can select a range in any histogram and see how it filters the data in the other charts. Make the histograms simple with gray bars for unfiltered data and highlighted bars for the filtered selection.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/pilot_record.sqlite')\nquery = '''\nSELECT Age, Rank, Join_Year\nFROM pilot;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['Join_Year'] = pd.to_numeric(df['Join_Year'], errors='coerce')\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbase = alt.Chart(df).mark_bar().encode(\n    alt.X(alt.repeat('column'), bin=alt.Bin(maxbins=20)),\n    y='count()'\n).properties(\n    width=150,\n    height=100\n)\n\nbackground = base.encode(\n    color=alt.value('#ddd')\n).add_params(brush)\n\nhighlight = base.transform_filter(brush)\n\nchart = alt.layer(\n    background,\n    highlight\n).repeat(column=['Age', 'Rank', 'Join_Year'])\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "products_for_hire",
        "chart_category": "Simple Charts",
        "chart_type": "simple_heatmap",
        "NLQ": "Can you create a heatmap showing the total amount payable for bookings by month and year? I'd like to see months across the x-axis and years down the y-axis, with different colors representing the payment amounts. Please title it \"Total Amount Payable by Month and Year\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/products_for_hire.sqlite')\n\nquery = '''\nSELECT \n    strftime('%Y', booking_start_date) AS year,\n    strftime('%m', booking_start_date) AS month,\n    SUM(amount_payable) AS total_amount_payable\nFROM Bookings\nGROUP BY year, month\nORDER BY year, month\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nheatmap = alt.Chart(df).mark_rect().encode(\n    x=alt.X('month:O', title='Month'),\n    y=alt.Y('year:O', title='Year'),\n    color=alt.Color('total_amount_payable:Q', title='Total Amount Payable')\n).properties(\n    title='Total Amount Payable by Month and Year'\n)\n\nheatmap"
    },
    {
        "type": "type_A",
        "db_id": "roller_coaster",
        "chart_category": "Simple Charts",
        "chart_type": "simple_scatter_plot_with_tooltips",
        "NLQ": "Can you create an interactive scatter plot showing the relationship between roller coaster height and speed? I'd like to see height on the x-axis and speed on the y-axis, with each roller coaster represented by a medium-sized circle. Please color-code the circles by country and include tooltips that show the coaster name, park, height, and speed when I hover over each point. Only include roller coasters that have both height and speed data available.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/roller_coaster.sqlite')\n\nquery = '''\nSELECT \n    r.Name AS Coaster_Name,\n    r.Park,\n    r.Height,\n    CAST(r.Speed AS REAL) AS Speed,\n    c.Name AS Country\nFROM \n    roller_coaster AS r\nJOIN \n    country AS c\nON \n    r.Country_ID = c.Country_ID\nWHERE \n    r.Height IS NOT NULL AND r.Speed IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle(size=60).encode(\n    x='Height:Q',\n    y='Speed:Q',\n    color='Country:N',\n    tooltip=['Coaster_Name:N', 'Park:N', 'Height:Q', 'Speed:Q']\n).interactive()\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "store_product",
        "chart_category": "Interactive Charts",
        "chart_type": "multiple_interactions",
        "NLQ": "Can you create a scatter plot showing the relationship between store area size and number of product categories? I'd like three interactive views: one where I can filter stores by type using a dropdown menu, another where I can filter by ranking using a slider, and a third view where I can highlight specific rankings using radio buttons. Each point should show store name, type and ranking when I hover over it.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/store_product.sqlite')\n\nquery = '''\nSELECT Store_Name, Type, Area_size, Number_of_product_category, Ranking\nFROM store\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).mark_circle().encode(\n    x=alt.X('Area_size:Q', title='Store Area Size'),\n    y=alt.Y('Number_of_product_category:Q', title='Number of Product Categories'),\n    tooltip=['Store_Name:N', 'Type:N', 'Ranking:N']\n)\n\ntype_dropdown = alt.binding_select(options=df['Type'].unique().tolist(), name=\"Store Type\")\ntype_select = alt.selection_point(fields=['Type'], bind=type_dropdown)\n\nfilter_type = base.add_params(\n    type_select\n).transform_filter(\n    type_select\n).properties(title=\"Filter by Store Type\")\n\nranking_slider = alt.binding_range(min=df['Ranking'].min(), max=df['Ranking'].max(), step=1, name=\"Ranking\")\nranking_selection = alt.selection_point(bind=ranking_slider, fields=['Ranking'])\n\nfilter_ranking = base.add_params(\n    ranking_selection\n).transform_filter(\n    ranking_selection\n).properties(title=\"Filter by Ranking\")\n\nranking_radio = alt.binding_radio(options=df['Ranking'].unique().tolist(), name=\"Highlight Ranking\")\nranking_highlight = alt.selection_point(fields=['Ranking'], bind=ranking_radio)\n\nhighlight_ranking = base.add_params(\n    ranking_highlight\n).encode(\n    color=alt.condition(ranking_highlight, alt.Color('Ranking:N', legend=None), alt.value('lightgray'))\n).properties(title=\"Highlight by Ranking\")\n\n(filter_type | filter_ranking) & highlight_ranking"
    },
    {
        "type": "type_A",
        "db_id": "tracking_orders",
        "chart_category": "Interactive Charts",
        "chart_type": "scatter_plot_and_histogram_with_interval_selection",
        "NLQ": "Can you create a visualization with two charts side by side? On the left, I want a scatter plot showing order IDs on the x-axis and customer IDs on the y-axis with black filled points. On the right, I'd like a histogram showing the count of invoice numbers grouped into about 20 bins. Make both charts 300x300 in size. I want to be able to select a range on the histogram, and have the scatter plot automatically filter to show only the points within that selection. When I select points on the histogram, they should appear black while unselected points should be light gray.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/tracking_orders.sqlite')\n\nquery = '''\nSELECT\n    O.order_id,\n    O.customer_id,\n    I.invoice_number\nFROM Orders AS O\nJOIN Shipments AS S ON O.order_id = S.order_id\nJOIN Invoices AS I ON S.invoice_number = I.invoice_number;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\npts = alt.selection_interval(encodings=[\"x\", \"y\"])\n\npoints = alt.Chart(df).mark_point(filled=True, color=\"black\").encode(\n    x='order_id',\n    y='customer_id'\n).transform_filter(\n    pts\n).properties(\n    width=300,\n    height=300\n)\n\nmag = alt.Chart(df).mark_bar().encode(\n    x='invoice_number_bin:N',\n    y=\"count()\",\n    color=alt.condition(pts, alt.value(\"black\"), alt.value(\"lightgray\"))\n).properties(\n    width=300,\n    height=300\n).add_params(pts)\n\nchart = alt.hconcat(\n    points,\n    mag\n).transform_bin(\n    \"invoice_number_bin\",\n    field=\"invoice_number\",\n    bin=alt.Bin(maxbins=20)\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "wedding",
        "chart_category": "Interactive Charts",
        "chart_type": "selection_histogram",
        "NLQ": "Can you show me how many people from different countries got married each year? I'd like to see this as points on a chart where I can select a time period, and then see a bar chart showing the count of people from each country within that selection. Please color-code the countries to make them easy to distinguish.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/wedding.sqlite')\n\nquery = '''\nSELECT w.Year, p1.Country AS Male_Country, p2.Country AS Female_Country\nFROM wedding AS w\nJOIN people AS p1 ON w.Male_ID = p1.People_ID\nJOIN people AS p2 ON w.Female_ID = p2.People_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_combined = pd.melt(df, id_vars=['Year'], value_vars=['Male_Country', 'Female_Country'], \n                      var_name='Gender', value_name='Country')\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df_combined).mark_point().encode(\n    x='Year:Q',\n    y='count(Country):Q',\n    color=alt.condition(brush, 'Country:N', alt.value('lightgray'))\n).add_params(\n    brush\n)\n\nbars = alt.Chart(df_combined).mark_bar().encode(\n    y='Country:N',\n    color='Country:N',\n    x='count(Country):Q'\n).transform_filter(\n    brush\n)\n\npoints & bars"
    },
    {
        "type": "type_A",
        "db_id": "local_govt_and_lot",
        "chart_category": "Scatter Plots",
        "chart_type": "faceted_scatter_plot",
        "NLQ": "Can you create a scatter plot showing the number of satisfied residents for each service type? I'd like to see this broken down by property type, with each property type shown in its own row. Use dots to represent the data points.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_and_lot.sqlite')\n\nquery = '''\nSELECT \n    T1.service_type_code AS Service_Type,\n    COUNT(T2.resident_id) AS Resident_Count,\n    T3.property_type_code AS Property_Type\nFROM \n    Services AS T1\nJOIN \n    Residents_Services AS T2 ON T1.service_id = T2.service_id\nJOIN \n    Properties AS T3 ON T2.property_id = T3.property_id\nWHERE \n    T1.service_details = 'Satisfied'\nGROUP BY \n    T1.service_type_code, T3.property_type_code\nORDER BY \n    T1.service_type_code, T3.property_type_code;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, width=100, height=100).mark_point().encode(\n    x=\"Resident_Count:Q\",\n    y=\"Service_Type:N\",\n    row=\"Property_Type:N\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "machine_repair",
        "chart_category": "Scatter Plots",
        "chart_type": "multifeature_scatter_plot",
        "NLQ": "Can you create a scatter plot showing the relationship between machine making year and value points for machines made after 1990? I'd like to see each machine as a circle, with different colors representing the machine class and the size of each circle showing its quality rank. Please don't start either axis at zero so we can better see the patterns.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/machine_repair.sqlite')\nquery = '''\nSELECT Making_Year, value_points, Class, quality_rank\nFROM machine\nWHERE Making_Year > 1990\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    alt.X('Making_Year').scale(zero=False),\n    alt.Y('value_points').scale(zero=False, padding=1),\n    color='Class',\n    size='quality_rank'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "activity_1",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart",
        "NLQ": "Can you create a bar chart showing the number of students and faculty participating in each activity? I'd like to see the activities listed along the bottom, with bars showing the count of participants stacked by type (students vs faculty), using different colors to distinguish between them.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/activity_1.sqlite')\n\nquery = '''\nSELECT \n    A.activity_name,\n    COUNT(DISTINCT P.stuid) AS student_count,\n    COUNT(DISTINCT F.FacID) AS faculty_count\nFROM \n    Activity AS A\nLEFT JOIN \n    Participates_in AS P ON A.actid = P.actid\nLEFT JOIN \n    Faculty_Participates_in AS F ON A.actid = F.actid\nGROUP BY \n    A.activity_name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['activity_name'], \n                    value_vars=['student_count', 'faculty_count'], \n                    var_name='participant_type', \n                    value_name='count')\n\nchart = alt.Chart(df_melted).mark_bar().encode(\n    x='activity_name:N',\n    y='sum(count):Q',\n    color='participant_type:N'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "allergy_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "calculate_residuals",
        "NLQ": "Could you create a scatter plot showing student ages on the x-axis and their deviation from the average age on the y-axis? I'd like to see how each student's age differs from the average, with points colored based on their deviation using a viridis color scheme. Please title the chart \"Student Age Deviation from Average\" and label the axes as \"Student Age\" and \"Age Delta (Age - Average Age)\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/allergy_1.sqlite')\nquery = '''\nSELECT Age\nFROM Student;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point().transform_joinaggregate(\n    Average_Age='mean(Age)'\n).transform_calculate(\n    Age_Delta='datum.Age - datum.Average_Age'\n).encode(\n    x=alt.X('Age:Q').title('Student Age'),\n    y=alt.Y('Age_Delta:Q').title('Age Delta (Age - Average Age)'),\n    color=alt.Color('Age_Delta:Q').title('Age Delta').scale(scheme='viridis')\n).properties(\n    title='Student Age Deviation from Average'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "allergy_1",
        "chart_category": "Interactive Charts",
        "chart_type": "slider_cutoff",
        "NLQ": "Show me a bar chart of how many students have food allergies at each age. Add a slider that lets me highlight students below a certain age in red, while keeping the rest blue.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/allergy_1.sqlite')\n\nquery = '''\nSELECT S.Age, COUNT(*) AS NumStudents\nFROM Student AS S\nJOIN Has_Allergy AS HA ON S.StuID = HA.StuID\nJOIN Allergy_Type AS AT ON HA.Allergy = AT.Allergy\nWHERE AT.AllergyType = 'food'\nGROUP BY S.Age\nORDER BY S.Age\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nslider = alt.binding_range(min=df['Age'].min(), max=df['Age'].max(), step=1)\ncutoff = alt.param(bind=slider, value=df['Age'].min())\npredicate = alt.datum.Age < cutoff\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Age:O',\n    y='NumStudents:Q',\n    color=alt.when(predicate).then(alt.value(\"red\")).otherwise(alt.value(\"blue\")),\n).add_params(\n    cutoff\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "allergy_1",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_sorted_segments",
        "NLQ": "Show me a horizontal bar chart of how many students have each type of allergy across different majors. Stack the bars by allergy type and sort them in ascending order.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/allergy_1.sqlite')\n\nquery = '''\nSELECT \n    S.Major AS Major,\n    AT.AllergyType AS AllergyType,\n    COUNT(*) AS StudentCount\nFROM \n    Student AS S\nJOIN \n    Has_Allergy AS HA ON S.StuID = HA.StuID\nJOIN \n    Allergy_Type AS AT ON HA.Allergy = AT.Allergy\nGROUP BY \n    S.Major, AT.AllergyType\nORDER BY \n    S.Major, AT.AllergyType\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='sum(StudentCount):Q',\n    y='Major:N',\n    color='AllergyType:N',\n    order=alt.Order(\n        'AllergyType',\n        sort='ascending'\n    )\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "baseball_1",
        "chart_category": "Interactive Charts",
        "chart_type": "using_selection_interval_with_mark_area",
        "NLQ": "Can you show me the trend in total home runs hit each year as a blue area chart? I'd like to be able to select specific time periods to zoom in and see those sections in more detail.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/baseball_1.sqlite')\n\nquery = '''\nSELECT year, SUM(hr) AS total_hr\nFROM batting\nGROUP BY year\nORDER BY year\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbase = alt.Chart(df).mark_area(\n    color='steelblue',\n    opacity=0.3\n).encode(\n    x='year:T',\n    y='total_hr:Q'\n)\n\nbrush = alt.selection_interval(encodings=['x'])\nbackground = base.add_params(brush)\nselected = base.transform_filter(brush).mark_area(color='steelblue')\n\nbackground + selected"
    },
    {
        "type": "type_A",
        "db_id": "baseball_1",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_text_overlay",
        "NLQ": "Can you create a horizontal stacked bar chart showing the total home runs by the National League and American League for each year? I'd like the years listed vertically on the left side, with the total home runs extending to the right. Please color-code the bars by league and add the exact home run numbers on each bar segment in white text. Title the chart \"Total Home Runs by League Over the Years\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/baseball_1.sqlite')\n\nquery = '''\nSELECT \n    year,\n    league_id,\n    SUM(hr) AS total_hr\nFROM \n    batting\nWHERE \n    league_id IN ('NL', 'AL') AND hr IS NOT NULL\nGROUP BY \n    year, league_id\nORDER BY \n    year ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('sum(total_hr):Q').stack('zero').title('Total Home Runs'),\n    y=alt.Y('year:N').title('Year'),\n    color=alt.Color('league_id:N').title('League')\n)\n\ntext = alt.Chart(df).mark_text(dx=-15, dy=3, color='white').encode(\n    x=alt.X('sum(total_hr):Q').stack('zero'),\n    y=alt.Y('year:N'),\n    detail='league_id:N',\n    text=alt.Text('sum(total_hr):Q', format='.0f')\n)\n\nchart = bars + text\nchart.properties(title=\"Total Home Runs by League Over the Years\")"
    },
    {
        "type": "type_A",
        "db_id": "baseball_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "comet_chart",
        "NLQ": "Can you create a visualization comparing MLB teams' home run production between 2000 and 2001? I'd like to see the teams sorted by their change in home runs, with the biggest increases at the top. Use different trail thicknesses to show the number of home runs and color to show the percentage change. Please separate the teams by league and include a title like \"MLB Team Home Run Production: 2000 vs 2001\". When I hover over the chart, I want to see details about the season, home run count, and percentage change.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/baseball_1.sqlite')\nquery = '''\nSELECT \n    t1.team_id, \n    t1.name AS team_name,\n    t1.hr AS hr_2000,\n    t2.hr AS hr_2001,\n    t1.league_id,\n    t1.div_id\nFROM team AS t1\nJOIN team AS t2 ON t1.team_id = t2.team_id AND t1.league_id = t2.league_id\nWHERE t1.year = 2000 AND t2.year = 2001\nORDER BY t1.team_id\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['hr_change'] = df['hr_2001'] - df['hr_2000']\ndf['pct_change'] = (df['hr_change'] / df['hr_2000'] * 100).round(1)\n\nchart = alt.Chart(\n    df,\n    title='MLB Team Home Run Production: 2000 vs 2001'\n).transform_fold(\n    ['hr_2000', 'hr_2001'],\n    as_=['year', 'home_runs']\n).mark_trail().encode(\n    alt.X('year:N').title('Season'),\n    alt.Y('team_name:N').title('Team').sort(\n        field='hr_change', \n        op='sum', \n        order='descending'\n    ),\n    alt.Size('home_runs:Q')\n        .scale(range=[0, 20])\n        .legend(values=[100, 200, 250])\n        .title('Home Runs'),\n    alt.Color('pct_change:Q')\n        .scale(domainMid=0, scheme='blueorange')\n        .title('HR Change (%)'),\n    alt.Tooltip(['year:N', 'home_runs:Q', 'pct_change:Q']),\n    alt.Column('league_id:N').title('League')\n).configure_legend(\n    orient='bottom',\n    direction='horizontal'\n).configure_view(\n    stroke=None\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "chinook_1",
        "chart_category": "Circular Plots",
        "chart_type": "pie_chart",
        "NLQ": "Can you show me a pie chart of how many tracks belong to each music genre? I'd like to see which genres have the most tracks in the database.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/chinook_1.sqlite')\n\nquery = '''\nSELECT \n    g.Name AS GenreName,\n    COUNT(t.TrackId) AS TrackCount\nFROM \n    Track AS t\nJOIN \n    Genre AS g ON t.GenreId = g.GenreId\nGROUP BY \n    g.Name\nORDER BY \n    TrackCount DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_arc().encode(\n    theta=\"TrackCount\",\n    color=\"GenreName\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "chinook_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "gantt_chart",
        "NLQ": "Can you create a bar chart showing how long each employee has been with our company? I'd like to see each employee's full name listed on the left side, with horizontal bars extending from their hire year to the current year. Please title it \"Employee Tenure at the Company\" so I can understand at a glance who our longest-serving team members are.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nfrom datetime import datetime\n\nconn = sqlite3.connect('database/chinook_1.sqlite')\n\nquery = '''\nSELECT \n    EmployeeId,\n    FirstName || ' ' || LastName AS FullName,\n    HireDate\nFROM \n    Employee\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ntoday = datetime.today()\ndf['start'] = df['HireDate'].apply(lambda x: datetime.strptime(x, '%Y-%m-%d %H:%M:%S').year)\ndf['end'] = today.year\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='start:O',\n    x2='end:O',\n    y=alt.Y('FullName:N', title=\"Employee Name\")\n).properties(\n    title=\"Employee Tenure at the Company\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "browser_web",
        "chart_category": "Line Charts",
        "chart_type": "filled_step_chart",
        "NLQ": "Can you show me the cumulative browser market share over time since they became compatible with web client accelerators? I'd like to see this as a light blue area chart with a step-after pattern and an outline. Put years on the x-axis and cumulative market share on the y-axis, and title it \"Cumulative Browser Market Share Over Time\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/browser_web.sqlite')\nquery = '''\nSELECT \n    T3.compatible_since_year AS year,\n    SUM(T2.market_share) AS cumulative_market_share\nFROM \n    accelerator_compatible_browser AS T3\nJOIN \n    browser AS T2 ON T3.browser_id = T2.id\nGROUP BY \n    T3.compatible_since_year\nORDER BY \n    T3.compatible_since_year\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_area(\n    color=\"lightblue\",\n    interpolate='step-after',\n    line=True\n).encode(\n    x=alt.X('year:O', title='Year'),\n    y=alt.Y('cumulative_market_share:Q', title='Cumulative Market Share')\n).properties(\n    title=\"Cumulative Browser Market Share Over Time\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "candidate_poll",
        "chart_category": "Advanced Calculations",
        "chart_type": "gantt_chart",
        "NLQ": "Can you create a simple bar chart showing poll sources as horizontal bars, with candidate IDs on the x-axis? I'd like to see which poll sources correspond to which candidate IDs, with each bar spanning from the candidate's ID number to one number higher.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/candidate_poll.sqlite')\nquery = '''\nSELECT Poll_Source, Candidate_ID\nFROM candidate\nORDER BY Candidate_ID\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['start'] = df['Candidate_ID']\ndf['end'] = df['Candidate_ID'] + 1\ndf['task'] = df['Poll_Source']\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='start',\n    x2='end',\n    y='task'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "company_employee",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_custom_order",
        "NLQ": "Can you create a line chart showing the relationship between total work experience and average age of employees from different colleges? Include points on the line, label the x-axis as \"Total Work Experience (Years)\" and the y-axis as \"Average Age of Employees\", and title it \"Work Experience vs. Average Age by Graduation College\". Make sure I can hover over points to see the college name, total experience, and average age details.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_employee.sqlite')\n\nquery = '''\nSELECT \n    p.Graduation_College AS College,\n    AVG(p.Age) AS Avg_Age,\n    SUM(e.Year_working) AS Total_Experience\nFROM \n    people AS p\nJOIN \n    employment AS e ON p.People_ID = e.People_ID\nGROUP BY \n    p.Graduation_College\nORDER BY \n    AVG(p.Age)\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    x=alt.X(\"Total_Experience:Q\").scale(zero=False).title(\"Total Work Experience (Years)\"),\n    y=alt.Y(\"Avg_Age:Q\").scale(zero=False).title(\"Average Age of Employees\"),\n    order=\"Avg_Age\",\n    tooltip=[\"College\", \"Total_Experience\", \"Avg_Age\"]\n).properties(\n    title=\"Work Experience vs. Average Age by Graduation College\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "company_employee",
        "chart_category": "Advanced Calculations",
        "chart_type": "layered_chart_with_dual-axis",
        "NLQ": "Can you create a chart comparing industries by their workforce size and experience levels? I'd like to see the total number of employees for each industry as green bars, with a blue line showing the average years of experience for each industry. Please sort the industries by the number of employees in descending order, and use separate scales for the employee count and years of experience.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_employee.sqlite')\n\nquery = '''\nSELECT \n    c.Industry AS Industry,\n    COUNT(e.People_ID) AS Total_Employees,\n    AVG(e.Year_working) AS Avg_Years_Experience\nFROM \n    company AS c\nJOIN \n    employment AS e ON c.Company_ID = e.Company_ID\nGROUP BY \n    c.Industry\nORDER BY \n    Total_Employees DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.X('Industry:N').title('Industry')\n)\n\nbar = base.mark_bar(color='#57A44C', opacity=0.7).encode(\n    alt.Y('Total_Employees:Q').axis(title='Total Employees', titleColor='#57A44C')\n)\n\nline = base.mark_line(stroke='#5276A7', interpolate='monotone').encode(\n    alt.Y('Avg_Years_Experience:Q').axis(title='Average Years of Experience', titleColor='#5276A7')\n)\n\nchart = alt.layer(bar, line).resolve_scale(\n    y='independent'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "concert_singer",
        "chart_category": "Distributions",
        "chart_type": "2d_histogram_heatmap",
        "NLQ": "Can you create a heatmap showing the distribution of concerts by year and stadium capacity? I'd like to see the concert count represented by color intensity using a greenblue color scheme. Please use 30 bins for the stadium capacity ranges, and title the chart \"Distribution of Concerts by Year and Stadium Capacity\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/concert_singer.sqlite')\n\nquery = '''\nSELECT \n    c.Year AS Year,\n    s.Capacity AS Capacity\nFROM \n    concert AS c\nJOIN \n    stadium AS s\nON \n    c.Stadium_ID = s.Stadium_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_rect().encode(\n    alt.X('Year:O').title('Year'),\n    alt.Y('Capacity:Q').bin(maxbins=30).title('Stadium Capacity'),\n    alt.Color('count():Q').scale(scheme='greenblue').title('Concert Count')\n).properties(\n    title='Distribution of Concerts by Year and Stadium Capacity'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "culture_company",
        "chart_category": "Advanced Calculations",
        "chart_type": "ranged_dot_plot",
        "NLQ": "Can you create a ranged dot plot comparing movie budgets and worldwide earnings? I'd like to see each movie title listed vertically with horizontal lines connecting their budget and gross amounts. Please use red dots to mark the actual values - lighter red for the budget and darker red for the worldwide gross. This would help me see which movies had the biggest gap between what they cost to make and what they earned.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/culture_company.sqlite')\nquery = '''\nSELECT Title, Budget_million, Gross_worldwide\nFROM movie\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = pd.melt(df, id_vars=['Title'], value_vars=['Budget_million', 'Gross_worldwide'], var_name='Measure', value_name='Value')\n\nchart = alt.Chart(df_melted).mark_line(color=\"#db646f\").encode(\n    y=alt.Y('Title:N'),\n    x=alt.X('Value:Q'),\n    detail='Title:N'\n)\n\npoints = alt.Chart(df_melted).mark_point(\n    size=100,\n    opacity=1,\n    filled=True,\n).encode(\n    y=alt.Y('Title:N'),\n    x=alt.X('Value:Q'),\n    color=alt.Color('Measure:N').scale(domain=['Budget_million', 'Gross_worldwide'], range=[\"#e6959c\", \"#911a24\"])\n)\n\nfinal_chart = (chart + points)\nfinal_chart"
    },
    {
        "type": "type_A",
        "db_id": "customers_and_addresses",
        "chart_category": "Advanced Calculations",
        "chart_type": "sorted_error_bars_showing_confidence_interval",
        "NLQ": "Can you create a chart showing the average order quantity for each product with black dots, and sort the products from highest to lowest average quantity? Please include error bars showing the confidence intervals for each product. Make the chart 400 pixels wide and 250 pixels tall.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/customers_and_addresses.sqlite')\n\nquery = \"\"\"\nSELECT\n    P.product_details,\n    OI.order_quantity\nFROM Order_Items AS OI\nJOIN Products AS P\n    ON OI.product_id = P.product_id;\n\"\"\"\n\ndf = pd.read_sql_query(query, conn)\ndf['order_quantity'] = pd.to_numeric(df['order_quantity'])\n\nconn.close()\n\npoints = alt.Chart(df).mark_point(\n    filled=True,\n    color='black'\n).encode(\n    x=alt.X('mean(order_quantity)').title('Average Order Quantity'),\n    y=alt.Y('product_details').sort(\n        field='order_quantity',\n        op='mean',\n        order='descending'\n    )\n).properties(\n    width=400,\n    height=250\n)\n\nerror_bars = points.mark_rule().encode(\n    x='ci0(order_quantity)',\n    x2='ci1(order_quantity)',\n)\n\npoints + error_bars"
    },
    {
        "type": "type_A",
        "db_id": "customers_and_invoices",
        "chart_category": "Advanced Calculations",
        "chart_type": "sorted_error_bars_showing_confidence_interval",
        "NLQ": "Can you create a chart showing the average derived total cost for each product from the invoice line items? I'd like to see the products sorted from highest to lowest average cost, with black dots representing the averages and horizontal error bars showing the confidence intervals. Make the chart 400 pixels wide and 250 pixels tall.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/customers_and_invoices.sqlite')\n\nquery = '''\nSELECT product_title, derived_total_cost\nFROM Invoice_Line_Items\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\npoints = alt.Chart(df).mark_point(\n    filled=True,\n    color='black'\n).encode(\n    x=alt.X('mean(derived_total_cost)').title('Average Derived Total Cost'),\n    y=alt.Y('product_title').sort(\n        field='derived_total_cost',\n        op='mean',\n        order='descending'\n    )\n).properties(\n    width=400,\n    height=250\n)\n\nerror_bars = points.mark_rule().encode(\n    x='ci0(derived_total_cost)',\n    x2='ci1(derived_total_cost)',\n)\n\npoints + error_bars"
    },
    {
        "type": "type_A",
        "db_id": "customer_deliveries",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_items",
        "NLQ": "Can you create a bar chart showing the top 5 most expensive products with their prices? I'd like the bars to be sorted from highest to lowest price, and have the bars colored based on the price value.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customer_deliveries.sqlite')\n\nquery = '''\nSELECT product_name, product_price\nFROM Products\nORDER BY product_price DESC\nLIMIT 5\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X('product_name:N').sort('-y'),\n    alt.Y('product_price:Q'),\n    alt.Color('product_price:Q')\n).transform_window(\n    rank='rank(product_price)',\n    sort=[alt.SortField('product_price', order='descending')]\n).transform_filter(\n    (alt.datum.rank < 6)\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "debate",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_items",
        "NLQ": "Can you create a bar chart showing the top 5 debate venues by audience size? I'd like to see the venues sorted from highest to lowest attendance, with the bars colored according to audience size. Please label the y-axis as \"Number of Audience\" and title the chart \"Top 5 Debates by Audience Size\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/debate.sqlite')\n\nquery = '''\nSELECT Debate_ID, Venue, Date, Num_of_Audience\nFROM debate\nORDER BY Num_of_Audience DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X('Venue:N').sort('-y'),\n    alt.Y('Num_of_Audience:Q', title='Number of Audience'),\n    alt.Color('Num_of_Audience:Q', title='Audience Size')\n).transform_window(\n    rank='rank(Num_of_Audience)',\n    sort=[alt.SortField('Num_of_Audience', order='descending')]\n).transform_filter(\n    (alt.datum.rank < 6)\n).properties(\n    title='Top 5 Debates by Audience Size'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "device",
        "chart_category": "Distributions",
        "chart_type": "faceted_histogram",
        "NLQ": "Show me a histogram of device quantities broken down by software platform. I'd like to see the distribution of quantities with each platform displayed in its own row.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/device.sqlite')\nquery = '''\nSELECT \n    d.Software_Platform, \n    s.Quantity\nFROM \n    stock AS s\nJOIN \n    device AS d ON s.Device_ID = d.Device_ID\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"Quantity:Q\").bin(),\n    y=\"count()\",\n    row=\"Software_Platform:N\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "dog_kennels",
        "chart_category": "Distributions",
        "chart_type": "faceted_histogram",
        "NLQ": "Can you create a faceted histogram showing the distribution of treatment costs for dogs? I'd like to see separate rows for each treatment type, with the x-axis showing cost ranges and the y-axis showing the count of treatments in each range.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/dog_kennels.sqlite')\n\nquery = '''\nSELECT \n    T1.treatment_type_description AS treatment_type,\n    T2.cost_of_treatment AS cost\nFROM \n    Treatment_Types AS T1\nJOIN \n    Treatments AS T2\nON \n    T1.treatment_type_code = T2.treatment_type_code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"cost:Q\").bin(),\n    y=\"count()\",\n    row=\"treatment_type:N\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "driving_school",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_sequence_generator",
        "NLQ": "Could you create a line chart showing how cumulative payments have grown over time for each payment method? I'd like to see payment dates on the x-axis and the running total of payment amounts on the y-axis, with different payment methods shown in different colors and a legend labeled \"Payment Method\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/driving_school.sqlite')\n\nquery = '''\nSELECT \n    DATE(datetime_payment) AS payment_date,\n    payment_method_code,\n    SUM(amount_payment) AS total_payment\nFROM \n    Customer_Payments\nGROUP BY \n    payment_date, payment_method_code\nORDER BY \n    payment_date\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nline_chart = alt.Chart(df).mark_line().encode(\n    x=alt.X('payment_date:T', title='Payment Date'),\n    y=alt.Y('sum(total_payment):Q', title='Cumulative Payment Amount'),\n    color=alt.Color('payment_method_code:N', title='Payment Method')\n).transform_window(\n    cumulative_sum='sum(total_payment)',\n    frame=[None, 0],\n    groupby=['payment_method_code']\n).encode(\n    y=alt.Y('cumulative_sum:Q', title='Cumulative Payment Amount')\n)\n\nline_chart"
    },
    {
        "type": "type_A",
        "db_id": "election_representative",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_a_global_mean_overlay",
        "NLQ": "Can you create a histogram showing the distribution of vote percentages in elections? I'd like to see the frequency of different vote percentages with about 30 bins, and please add a thick red vertical line showing the mean vote percentage.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/election_representative.sqlite')\nquery = '''\nSELECT Vote_Percent\nFROM election;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df)\nbar = base.mark_bar().encode(\n    alt.X('Vote_Percent:Q', bin=alt.Bin(maxbins=30), title='Vote Percentage'),\n    alt.Y('count()', title='Frequency')\n)\nrule = base.mark_rule(color='red').encode(\n    alt.X('mean(Vote_Percent):Q', title='Average Vote Percentage'),\n    size=alt.value(5)\n)\nchart = bar + rule\nchart"
    },
    {
        "type": "type_A",
        "db_id": "election_representative",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_stroked_point_markers",
        "NLQ": "Can you create a line chart showing the votes trend over time by political party? I'd like to see how votes have changed across different dates, with each party shown in a different color and data points marked on the lines. Please title it \"Votes Trend Over Time by Party\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/election_representative.sqlite')\n\nquery = '''\nSELECT E.Date, E.Votes, R.Party\nFROM election AS E\nJOIN representative AS R ON E.Representative_ID = R.Representative_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndef convert_to_datetime(date_str):\n    try:\n        return pd.to_datetime(date_str, format='%B %Y')\n    except ValueError:\n        try:\n            return pd.to_datetime(date_str, format='%Y')\n        except ValueError:\n            try:\n                return pd.to_datetime(date_str)\n            except:\n                return pd.to_datetime(date_str + ' January 1', format='%Y %B %d')\ndf['Date'] = df['Date'].apply(convert_to_datetime)\n\nalt.Chart(df).mark_line(point=True).encode(\n    x='Date:T',\n    y='Votes:Q',\n    color='Party:N'\n).properties(\n    title='Votes Trend Over Time by Party'\n)"
    },
    {
        "type": "type_A",
        "db_id": "employee_hire_evaluation",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_a_global_mean_overlay",
        "NLQ": "Can you create a histogram showing the distribution of employee ages? I'd like to see how many employees fall into each age group, with bins dividing the age range into about 30 groups. Also, please mark the average age with a thick red vertical line on the chart. When I hover over the bars, I want to see both the count and the age range for that bar.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/employee_hire_evaluation.sqlite')\nquery = \"SELECT Age FROM employee;\"\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df)\n\nbar = base.mark_bar().encode(\n    alt.X('Age:Q', bin=alt.Bin(maxbins=30), title='Employee Age'),\n    y='count()',\n    tooltip=['count()', 'Age']\n)\n\nrule = base.mark_rule(color='red').encode(\n    x='mean(Age):Q',\n    size=alt.value(5)\n)\n\nchart = bar + rule\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "entrepreneur",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_gradient_color",
        "NLQ": "Can you create a histogram showing the distribution of people's weights? I'd like to see the data grouped into about 20 bins, with the bars colored in a pink-yellow-green gradient based on the weight values.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/entrepreneur.sqlite')\nquery = '''\nSELECT Weight\nFROM people\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nalt.Chart(df).mark_bar().encode(\n    alt.X(\"Weight:Q\").bin(maxbins=20),\n    alt.Y('count()'),\n    alt.Color(\"Weight:Q\").bin(maxbins=20).scale(scheme='pinkyellowgreen')\n)"
    },
    {
        "type": "type_A",
        "db_id": "epinions_1",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_varying_size",
        "NLQ": "Can you create a trail chart showing trust ratings for different source users? I'd like to see the source user IDs along the x-axis and their trust ratings on the y-axis. Make the thickness of the trails represent the strength of the trust rating, so I can easily see which users have stronger trust relationships.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/epinions_1.sqlite')\nquery = '''\nSELECT \n    T.source_u_id AS source_user,\n    T.trust AS trust_rating\nFROM \n    trust AS T\nORDER BY \n    T.source_u_id\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_trail().encode(\n    x=alt.X('source_user:O', title='Source User ID'),\n    y=alt.Y('trust_rating:Q', title='Trust Rating'),\n    size=alt.Size('trust_rating:Q', title='Strength of Trust')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "e_learning",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_responsive_bins",
        "NLQ": "Can you create a bar chart showing the number of student registrations by hour of the day? I'd like to see two connected views - a main chart on top that I can zoom into specific time ranges, and a smaller overview chart below that lets me select which hours to focus on. Make the charts wide but not too tall.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/e_learning.sqlite')\nquery = '''\nSELECT \n    strftime('%H', date_of_registration) AS hour_of_registration,\n    COUNT(*) AS registration_count\nFROM Students\nGROUP BY hour_of_registration\nORDER BY hour_of_registration\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbase = alt.Chart(df).mark_bar().encode(\n    y='registration_count:Q'\n).properties(\n    width=600,\n    height=100\n)\n\nchart = alt.vconcat(\n    base.encode(\n        alt.X('hour_of_registration:Q')\n          .bin(maxbins=24, extent=brush)\n          .scale(domain=brush),\n        y='registration_count:Q'\n    ),\n    base.encode(\n        alt.X('hour_of_registration:Q').bin(maxbins=24),\n        y='registration_count:Q'\n    ).add_params(brush)\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "farm",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_responsive_bins",
        "NLQ": "Can you create a histogram showing the distribution of total cattle across farms? I'd like to see two connected histograms - one on top that I can zoom into specific ranges, and one below showing the full distribution with 30 bins. Make the charts 600 pixels wide and the top one 100 pixels tall. I want to be able to select a range in the bottom chart to focus on that area in the top chart.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/farm.sqlite')\nquery = '''\nSELECT Total_Cattle\nFROM farm\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbase = alt.Chart(df).mark_bar().encode(\n    y='count():Q'\n).properties(\n    width=600,\n    height=100\n)\n\nchart = alt.vconcat(\n    base.encode(\n        alt.X('Total_Cattle:Q')\n            .bin(maxbins=30, extent=brush)\n            .scale(domain=brush)\n    ),\n    base.encode(\n        alt.X('Total_Cattle:Q').bin(maxbins=30),\n    ).add_params(brush)\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "farm",
        "chart_category": "Line Charts",
        "chart_type": "multiple_series_line_chart",
        "NLQ": "Can you create a line chart showing how the total number of horses and cattle have changed over the years? I'd like to see each animal type represented by a different colored line, with years on the x-axis and the count on the y-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/farm.sqlite')\nquery = '''\nSELECT Year, Total_Horses, Total_Cattle\nFROM farm\nORDER BY Year\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['Year'], value_vars=['Total_Horses', 'Total_Cattle'], \n                    var_name='Animal_Type', value_name='Count')\n\nchart = alt.Chart(df_melted).mark_line().encode(\n    x='Year:T',\n    y='Count:Q',\n    color='Animal_Type:N'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "game_injury",
        "chart_category": "Line Charts",
        "chart_type": "step_chart",
        "NLQ": "Can you create a step chart showing the total number of injuries per season? I'd like to see seasons on the x-axis and the injury count on the y-axis, with a title \"Total Injuries Per Season\". Please connect the data points with step-after lines rather than smooth curves.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/game_injury.sqlite')\nquery = '''\nSELECT \n    g.Season AS season,\n    COUNT(i.id) AS injury_count\nFROM \n    game AS g\nJOIN \n    injury_accident AS i ON g.id = i.game_id\nGROUP BY \n    g.Season\nORDER BY \n    g.Season\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(interpolate='step-after').encode(\n    x=alt.X('season:O', title='Season'),\n    y=alt.Y('injury_count:Q', title='Total Injuries')\n).properties(\n    title='Total Injuries Per Season'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "game_injury",
        "chart_category": "Distributions",
        "chart_type": "quantile-quantile_plot",
        "NLQ": "Can you create two QQ-plots side by side comparing stadium attendance data against a uniform distribution? I'd like one plot showing Average Attendance quantiles and another showing Total Attendance quantiles. Label the x-axis as \"Uniform Distribution Quantiles\" and the y-axes as \"Average Attendance Quantiles\" and \"Total Attendance Quantiles\" respectively. Please title the charts \"QQ-Plot of Average Attendance vs. Uniform Distribution\" and \"QQ-Plot of Total Attendance vs. Uniform Distribution\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/game_injury.sqlite')\nquery = '''\nSELECT Average_Attendance, Total_Attendance\nFROM stadium\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase_avg_attendance = alt.Chart(df).transform_quantile(\n    'Average_Attendance',\n    step=0.01,\n    as_=['p', 'v']\n).transform_calculate(\n    uniform='quantileUniform(datum.p)'\n).mark_point().encode(\n    alt.Y('v:Q', title='Average Attendance Quantiles'),\n    alt.X('uniform:Q', title='Uniform Distribution Quantiles')\n).properties(\n    title='QQ-Plot of Average Attendance vs. Uniform Distribution'\n)\n\nbase_total_attendance = alt.Chart(df).transform_quantile(\n    'Total_Attendance',\n    step=0.01,\n    as_=['p', 'v']\n).transform_calculate(\n    uniform='quantileUniform(datum.p)'\n).mark_point().encode(\n    alt.Y('v:Q', title='Total Attendance Quantiles'),\n    alt.X('uniform:Q', title='Uniform Distribution Quantiles')\n).properties(\n    title='QQ-Plot of Total Attendance vs. Uniform Distribution'\n)\n\nchart = base_avg_attendance | base_total_attendance\nchart"
    },
    {
        "type": "type_A",
        "db_id": "insurance_and_eClaims",
        "chart_category": "Scatter Plots",
        "chart_type": "brushing_scatter_plot_to_show_data_on_a_table",
        "NLQ": "Can you create a scatter plot showing the relationship between amount claimed and amount paid for insurance claims? Make the dots blue when I select them and gray otherwise. When I select points by drawing a box around them, show me a small table on the right with the claim type and settlement date for up to 15 selected claims. I'd like to see tooltips with claim type and settlement date when I hover over points too.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_and_eClaims.sqlite')\n\nquery = '''\nSELECT \n    ch.Claim_Header_ID,\n    ch.Amount_Claimed,\n    ch.Amount_Piad AS Amount_Paid,\n    ch.Claim_Type_Code,\n    ch.Date_of_Settlement\nFROM \n    Claim_Headers AS ch\nWHERE \n    ch.Amount_Claimed IS NOT NULL AND ch.Amount_Piad IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df).mark_point().encode(\n    x=alt.X('Amount_Claimed:Q', title='Amount Claimed'),\n    y=alt.Y('Amount_Paid:Q', title='Amount Paid'),\n    color=alt.condition(brush, alt.value(\"steelblue\"), alt.value(\"grey\")),\n    tooltip=['Claim_Type_Code:N', 'Date_of_Settlement:T']\n).add_params(brush).properties(\n    width=400,\n    height=400\n)\n\nranked_text = alt.Chart(df).mark_text(align='right').encode(\n    y=alt.Y('row_number:O').axis(None)\n).transform_filter(\n    brush\n).transform_window(\n    row_number='row_number()'\n).transform_filter(\n    alt.datum.row_number < 15\n)\n\nclaim_type = ranked_text.encode(text='Claim_Type_Code:N').properties(\n    title=alt.Title(text='Claim Type', align='right')\n)\nsettlement_date = ranked_text.encode(text='Date_of_Settlement:T').properties(\n    title=alt.Title(text='Settlement Date', align='right')\n)\ntext = alt.hconcat(claim_type, settlement_date)\n\nchart = alt.hconcat(\n    points,\n    text\n).resolve_legend(\n    color=\"independent\"\n).configure_view(\n    stroke=None\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "insurance_fnol",
        "chart_category": "Scatter Plots",
        "chart_type": "bubble_plot",
        "NLQ": "Can you create a bubble chart showing the relationship between the number of claims filed by each customer and their total settlement amounts? I'd like each point to represent a customer, with the size of the bubble indicating the average time it takes to settle their claims. Please include a tooltip that shows the customer name, number of claims, total settlement amount, and average settlement time when I hover over each bubble. Title the chart \"Claims vs. Settlements with Average Settlement Time\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_fnol.sqlite')\nquery = '''\nSELECT \n    c.Customer_name AS Customer,\n    COUNT(cl.Claim_ID) AS Number_of_Claims,\n    SUM(s.Settlement_Amount) AS Total_Settlement_Amount,\n    AVG(julianday(s.Effective_Date) - julianday(cl.Effective_Date)) AS Avg_Settlement_Time\nFROM \n    Customers AS c\nJOIN \n    First_Notification_of_Loss AS fnol ON c.Customer_ID = fnol.Customer_ID\nJOIN \n    Claims AS cl ON fnol.FNOL_ID = cl.FNOL_ID\nJOIN \n    Settlements AS s ON cl.Claim_ID = s.Claim_ID\nGROUP BY \n    c.Customer_name\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point().encode(\n    x='Number_of_Claims:Q',\n    y='Total_Settlement_Amount:Q',\n    size='Avg_Settlement_Time:Q',\n    tooltip=['Customer:N', 'Number_of_Claims:Q', 'Total_Settlement_Amount:Q', 'Avg_Settlement_Time:Q']\n).properties(\n    title=\"Claims vs. Settlements with Average Settlement Time\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "insurance_policies",
        "chart_category": "Scatter Plots",
        "chart_type": "bubble_plot",
        "NLQ": "Can you create a bubble chart showing the relationship between amount claimed and amount settled for insurance claims made in 2017? I'd like each point to represent a claim, with the size of the point showing the difference between claimed and settled amounts. Please color-code the points by policy type and title the chart \"Relationship Between Amount Claimed and Amount Settled (2017)\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_policies.sqlite')\n\nquery = '''\nSELECT \n    Claims.Claim_ID,\n    Claims.Amount_Claimed,\n    Claims.Amount_Settled,\n    (Claims.Amount_Claimed - Claims.Amount_Settled) AS Difference,\n    Customer_Policies.Policy_Type_Code\nFROM \n    Claims\nJOIN \n    Customer_Policies ON Claims.Policy_ID = Customer_Policies.Policy_ID\nWHERE \n    strftime('%Y', Claims.Date_Claim_Made) = '2017'\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point().encode(\n    x='Amount_Claimed:Q',\n    y='Amount_Settled:Q',\n    size='Difference:Q',\n    color='Policy_Type_Code:N'\n).properties(\n    title='Relationship Between Amount Claimed and Amount Settled (2017)'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "medicine_enzyme_interaction",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_labels",
        "NLQ": "Can you create a horizontal bar chart showing the number of medicines that interact with different enzymes? I'd like to see the enzymes listed on the y-axis, sorted by the highest number of interactions at the top. Please color-code the bars based on the interaction type, and include the actual count numbers as labels next to each bar. Title the chart \"Medicine-Enzyme Interaction Counts by Type\" and make sure the x-axis is labeled \"Number of Medicines\" and the y-axis \"Enzyme Name\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/medicine_enzyme_interaction.sqlite')\n\nquery = '''\nSELECT \n    e.name AS enzyme_name,\n    mei.interaction_type,\n    COUNT(m.id) AS medicine_count\nFROM \n    medicine_enzyme_interaction AS mei\nJOIN \n    enzyme AS e ON mei.enzyme_id = e.id\nJOIN \n    medicine AS m ON mei.medicine_id = m.id\nGROUP BY \n    e.name, mei.interaction_type\nORDER BY \n    e.name, medicine_count DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('medicine_count:Q', title='Number of Medicines'),\n    y=alt.Y('enzyme_name:N', title='Enzyme Name', sort='-x'),\n    color=alt.Color('interaction_type:N', title='Interaction Type'),\n    text='medicine_count:Q'\n)\n\nchart = base.mark_bar() + base.mark_text(align='left', dx=2)\nchart.properties(title=\"Medicine-Enzyme Interaction Counts by Type\")"
    },
    {
        "type": "type_A",
        "db_id": "mountain_photos",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_plot_with_href",
        "NLQ": "Can you create a scatter plot showing the height versus prominence of mountains in Ethiopia? I'd like the points colored by mountain range, with a tooltip showing each mountain's name, height, and prominence. Also, make it so I can click on any point to search for that mountain on Google. Title it \"Height vs Prominence of Mountains in Ethiopia\" and label the axes as \"Mountain Height (m)\" and \"Mountain Prominence (m)\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/mountain_photos.sqlite')\n\nquery = '''\nSELECT name, Height, Prominence, Range\nFROM mountain\nWHERE Country = 'Ethiopia'\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_calculate(\n    url='https://www.google.com/search?q=' + alt.datum.name\n).mark_point().encode(\n    x=alt.X('Height:Q', title='Mountain Height (m)'),\n    y=alt.Y('Prominence:Q', title='Mountain Prominence (m)'),\n    color=alt.Color('Range:N', title='Mountain Range'),\n    href='url:N',\n    tooltip=['name:N', 'Height:Q', 'Prominence:Q']\n).properties(\n    title='Height vs Prominence of Mountains in Ethiopia'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "mountain_photos",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_labels",
        "NLQ": "Can you create a horizontal bar chart showing the total number of photos taken per mountain range? I'd like to see the mountain ranges sorted with the most photographed at the top, and include the exact photo count displayed next to each bar. Please title the chart \"Total Photos Taken per Mountain Range\" and label the axes as \"Mountain Range\" and \"Number of Photos\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/mountain_photos.sqlite')\n\nquery = '''\nSELECT \n    m.Range AS mountain_range, \n    COUNT(p.id) AS photo_count\nFROM \n    mountain AS m\nJOIN \n    photos AS p ON m.id = p.mountain_id\nGROUP BY \n    m.Range\nORDER BY \n    photo_count DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('photo_count:Q', title='Number of Photos'),\n    y=alt.Y('mountain_range:N', sort='-x', title='Mountain Range'),\n    text='photo_count:Q'\n)\n\nchart = base.mark_bar() + base.mark_text(align='left', dx=2)\nchart.properties(title=\"Total Photos Taken per Mountain Range\")"
    },
    {
        "type": "type_A",
        "db_id": "movie_1",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_plot_with_href",
        "NLQ": "Can you create a scatter plot showing the relationship between movie release years and their average ratings? I'd like each movie to be represented by a point, with different colors for different directors. When I hover over a point, I want to see the movie title, director name, and the exact average rating. Also, make it so I can click on any point to search for that movie on Google.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/movie_1.sqlite')\n\nquery = '''\nSELECT \n    M.year AS release_year,\n    AVG(R.stars) AS avg_rating,\n    M.director AS director,\n    M.title AS title\nFROM \n    Movie AS M\nJOIN \n    Rating AS R ON M.mID = R.mID\nGROUP BY \n    M.mID, M.year, M.director, M.title\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).transform_calculate(\n    url='https://www.google.com/search?q=' + alt.datum.title\n).mark_point().encode(\n    x=alt.X('release_year:Q', title='Release Year'),\n    y=alt.Y('avg_rating:Q', title='Average Rating'),\n    color=alt.Color('director:N', title='Director'),\n    href='url:N',\n    tooltip=['title:N', 'director:N', 'avg_rating:Q']\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "museum_visit",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_labels_based_on_measured_luminance",
        "NLQ": "Can you create a horizontal bar chart showing the total number of tickets sold for each museum? I'd like the museums sorted from highest to lowest ticket sales, with the bars colored in shades of blue where darker blue means more tickets sold. Please display the exact ticket numbers on each bar, and make sure the chart has a title \"Total Tickets Sold Per Museum\". I'd also like to see the actual numbers when I hover over the bars.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/museum_visit.sqlite')\n\nquery = '''\nSELECT \n    m.Name AS Museum_Name, \n    SUM(v.Num_of_Ticket) AS Total_Tickets\nFROM \n    visit AS v\nJOIN \n    museum AS m ON v.Museum_ID = m.Museum_ID\nGROUP BY \n    m.Name\nORDER BY \n    Total_Tickets DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('Total_Tickets:Q', title='Total Tickets Sold'),\n    y=alt.Y('Museum_Name:O', sort='-x', title='Museum'),\n    text=alt.Text('Total_Tickets:Q', format='.0f')\n)\n\nbars = base.mark_bar().encode(\n    color=alt.Color('Total_Tickets:Q', scale=alt.Scale(scheme='blues'), title='Tickets Sold'),\n    tooltip=alt.Tooltip('Total_Tickets:Q', format='.0f')\n)\n\ntext = base.mark_text(\n    align='left',\n    dx=3,\n    color=alt.expr(\"luminance(scale('color', datum.Total_Tickets)) > 0.5 ? 'black' : 'white'\")\n)\n\nchart = bars + text\n\nchart.properties(\n    title='Total Tickets Sold Per Museum',\n    width=600,\n    height=400\n)"
    },
    {
        "type": "type_A",
        "db_id": "museum_visit",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_plot_with_href",
        "NLQ": "Can you create a scatter plot showing the relationship between number of tickets purchased and total money spent for different museums? I'd like each point to represent a museum, with tooltips showing the museum name, number of tickets, and total spent. Also, make each point clickable so it takes me to a Google search for that museum.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/museum_visit.sqlite')\n\nquery = '''\nSELECT \n    m.Name AS Museum_Name,\n    v.Num_of_Ticket,\n    v.Total_spent\nFROM \n    visit AS v\nJOIN \n    museum AS m ON v.Museum_ID = m.Museum_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_calculate(\n    url='https://www.google.com/search?q=' + alt.datum.Museum_Name\n).mark_point().encode(\n    x='Num_of_Ticket:Q',\n    y='Total_spent:Q',\n    href='url:N',\n    tooltip=['Museum_Name:N', 'Num_of_Ticket:Q', 'Total_spent:Q']\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "orchestra",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_plot_with_shaded_area",
        "NLQ": "Can you create a scatter plot showing the relationship between conductor age and their years of work? Use \"Conductor Age\" as the x-axis title and \"Years of Work\" as the y-axis title. Also, highlight the age range between 40 and 42 with a semi-transparent red shaded area.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/orchestra.sqlite')\nquery = '''\nSELECT Age, Year_of_Work\nFROM conductor\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nshaded_area = pd.DataFrame({\n    \"x1\": [40],\n    \"x2\": [42]\n})\n\npoints = alt.Chart(df).mark_point().encode(\n    x=alt.X(\"Age:Q\", title=\"Conductor Age\"),\n    y=alt.Y(\"Year_of_Work:Q\", title=\"Years of Work\")\n)\n\ninterval = alt.Chart(shaded_area).mark_rect(opacity=0.3, color=\"#FF0000\").encode(\n    x=\"x1:Q\",\n    x2=\"x2:Q\"\n)\n\nchart = points + interval\nchart"
    },
    {
        "type": "type_A",
        "db_id": "phone_1",
        "chart_category": "Simple Charts",
        "chart_type": "simple_bar_chart",
        "NLQ": "Can you create a bar chart showing the total number of phone models launched each year? Please label the x-axis as \"Launch Year\" and the y-axis as \"Total Models Launched\", and title the chart \"Total Phone Models Launched Each Year\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/phone_1.sqlite')\n\nquery = '''\nSELECT Launch_year, COUNT(Model_name) AS Total_Models\nFROM chip_model\nGROUP BY Launch_year\nORDER BY Launch_year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Launch_year:O', title='Launch Year'),\n    y=alt.Y('Total_Models:Q', title='Total Models Launched')\n).properties(\n    title='Total Phone Models Launched Each Year'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "phone_market",
        "chart_category": "Simple Charts",
        "chart_type": "simple_bar_chart",
        "NLQ": "Can you create a bar chart showing the total number of phones in stock for each district? I'd like to see the districts ordered from highest to lowest inventory so I can easily identify which areas have the most phones available.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/phone_market.sqlite')\n\nquery = '''\nSELECT \n    m.District AS District, \n    SUM(pm.Num_of_stock) AS Total_Stock\nFROM \n    phone_market AS pm\nJOIN \n    market AS m ON pm.Market_ID = m.Market_ID\nGROUP BY \n    m.District\nORDER BY \n    Total_Stock DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('District:N', title='District'),\n    y=alt.Y('Total_Stock:Q', title='Total Phones in Stock')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "phone_market",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_crossfilter",
        "NLQ": "Can you create three small bar charts side by side showing the distribution of number of employees, number of shops, and market rankings? Make the charts interactive so when I select a range on one chart, it highlights those data points in blue across all charts while keeping the unselected data gray. Each chart should group the data into about 20 bins.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/phone_market.sqlite')\n\nquery = '''\nSELECT Num_of_employees, Num_of_shops, Ranking\nFROM market\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbase = alt.Chart(width=160, height=130).mark_bar().encode(\n    x=alt.X(alt.repeat('column')).bin(maxbins=20),\n    y='count()'\n)\n\nbackground = base.encode(\n    color=alt.value('#ddd')\n).add_params(brush)\n\nhighlight = base.transform_filter(brush)\n\nalt.layer(\n    background,\n    highlight,\n    data=df\n).repeat(column=[\"Num_of_employees\", \"Num_of_shops\", \"Ranking\"])"
    },
    {
        "type": "type_A",
        "db_id": "poker_player",
        "chart_category": "Simple Charts",
        "chart_type": "simple_heatmap",
        "NLQ": "Can you create a heatmap showing the total earnings of poker players by their nationality and how many final tables they've made? I'd like to see nationalities listed vertically and the number of final tables horizontally, with the color intensity showing the amount of earnings. Please use a viridis color scheme and title it \"Heatmap of Poker Players' Earnings by Nationality and Final Tables Made\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/poker_player.sqlite')\n\nquery = '''\nSELECT \n    p.Nationality,\n    pp.Final_Table_Made,\n    SUM(pp.Earnings) AS Total_Earnings\nFROM \n    poker_player AS pp\nJOIN \n    people AS p ON pp.People_ID = p.People_ID\nGROUP BY \n    p.Nationality, pp.Final_Table_Made\nORDER BY \n    p.Nationality, pp.Final_Table_Made;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nheatmap = alt.Chart(df).mark_rect().encode(\n    x=alt.X('Final_Table_Made:O', title='Final Tables Made'),\n    y=alt.Y('Nationality:O', title='Nationality'),\n    color=alt.Color('Total_Earnings:Q', title='Total Earnings', scale=alt.Scale(scheme='viridis'))\n).properties(\n    width=600,\n    height=400,\n    title=\"Heatmap of Poker Players' Earnings by Nationality and Final Tables Made\"\n)\n\nheatmap"
    },
    {
        "type": "type_A",
        "db_id": "products_gen_characteristics",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_rounded_edges",
        "NLQ": "Can you create a bar chart showing the count of products for each product category, broken down by selling price range (low, medium, high)? I'd like the bars to have slightly rounded tops and a title that says \"Count of Products by Category and Selling Price Range\". Make sure to label the x-axis as \"Product Category\" and the y-axis as \"Number of Products\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/products_gen_characteristics.sqlite')\n\nquery = '''\nSELECT \n    T1.product_category_description AS category,\n    CASE \n        WHEN CAST(T2.typical_selling_price AS FLOAT) < 100 THEN 'Low'\n        WHEN CAST(T2.typical_selling_price AS FLOAT) BETWEEN 100 AND 1000 THEN 'Medium'\n        ELSE 'High'\n    END AS price_range\nFROM Ref_Product_Categories AS T1\nJOIN Products AS T2 ON T1.product_category_code = T2.product_category_code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar(\n    cornerRadiusTopLeft=3,\n    cornerRadiusTopRight=3\n).encode(\n    x=alt.X('category:N', title='Product Category'),\n    y=alt.Y('count():Q', title='Number of Products'),\n    color=alt.Color('price_range:N', title='Selling Price Range')\n).properties(\n    title='Count of Products by Category and Selling Price Range'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "product_catalog",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_legend",
        "NLQ": "Can you create a stacked area chart showing how total stock has changed over the years for different catalog levels? I'd like the areas to be stacked in the center with no axis labels on the y-axis. Please use the category20b color scheme and let me click on the legend to highlight specific catalog levels while fading the others.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/product_catalog.sqlite')\n\nquery = '''\nSELECT \n    T2.catalog_level_name AS level_name,\n    strftime('%Y', T1.date_of_publication) AS year,\n    COUNT(T3.catalog_entry_id) AS total_stock\nFROM \n    Catalogs AS T1\nJOIN \n    Catalog_Structure AS T2 ON T1.catalog_id = T2.catalog_id\nJOIN \n    Catalog_Contents AS T3 ON T2.catalog_level_number = T3.catalog_level_number\nGROUP BY \n    T2.catalog_level_name, strftime('%Y', T1.date_of_publication)\nORDER BY \n    year ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselection = alt.selection_point(fields=['level_name'], bind='legend')\n\nchart = alt.Chart(df).mark_area().encode(\n    alt.X('year:T').axis(domain=False, format='%Y', tickSize=0),\n    alt.Y('sum(total_stock):Q').stack('center').axis(None),\n    alt.Color('level_name:N').scale(scheme='category20b'),\n    opacity=alt.condition(selection, alt.value(1), alt.value(0.2))\n).add_params(\n    selection\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "program_share",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_rectangular_brush",
        "NLQ": "Can you create a scatter plot showing the relationship between program launch years and their share percentages? I'd like to see the points colored by the program's country of origin, with non-selected points appearing in grey. Make it interactive so I can select areas to highlight using a brush tool. When I hover over points, show me details including the program name, origin, launch year, and share percentage. Title the chart \"Program Share Percentage vs Launch Year\" and make it a good size - about 600 by 400.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/program_share.sqlite')\nquery = '''\nSELECT p.Program_ID, p.Name, p.Origin, p.Launch, b.Share_in_percent\nFROM program AS p\nJOIN broadcast_share AS b ON p.Program_ID = b.Program_ID\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\nchart = alt.Chart(df).mark_point().encode(\n    x='Launch:Q',\n    y='Share_in_percent:Q',\n    color=alt.condition(brush, 'Origin:N', alt.value('grey')),\n    tooltip=['Name:N', 'Origin:N', 'Launch:Q', 'Share_in_percent:Q']\n).add_params(\n    brush\n).properties(\n    width=600,\n    height=400,\n    title=\"Program Share Percentage vs Launch Year\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "program_share",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_rounded_edges",
        "NLQ": "Can you create a bar chart showing the average share percentage of TV programs at different times of day? I'd like to see the time of day on the x-axis and the average share percentage on the y-axis. Please color-code the bars by program name, use rounded corners on the top of the bars, and title it \"Average Share Percentage by Time of Day and Program\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/program_share.sqlite')\n\nquery = '''\nSELECT \n    b.Time_of_day AS Time_of_day,\n    p.Name AS Program_Name,\n    AVG(bs.Share_in_percent) AS Avg_Share_Percent\nFROM \n    broadcast AS b\nJOIN \n    program AS p ON b.Program_ID = p.Program_ID\nJOIN \n    broadcast_share AS bs ON b.Channel_ID = bs.Channel_ID AND b.Program_ID = bs.Program_ID\nGROUP BY \n    b.Time_of_day, p.Name\nORDER BY \n    b.Time_of_day;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar(\n    cornerRadiusTopLeft=3,\n    cornerRadiusTopRight=3\n).encode(\n    x=alt.X('Time_of_day:O', title='Time of Day'),\n    y=alt.Y('Avg_Share_Percent:Q', title='Average Share Percentage'),\n    color=alt.Color('Program_Name:N', title='Program Name')\n).properties(\n    title='Average Share Percentage by Time of Day and Program'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "protein_institute",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_rectangular_brush",
        "NLQ": "Can you create a scatter plot showing the relationship between building heights (in feet) and number of floors? I'd like to be able to select areas of the chart to highlight buildings based on how many years they held the record as the tallest building. Please include a title that explains what the chart shows, and when I hover over points, show me the building name, height, floors, and years as tallest.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/protein_institute.sqlite')\nquery = '''\nSELECT Name, Height_feet, Floors, Years_as_tallest\nFROM building\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\nchart = alt.Chart(df).mark_point().encode(\n    x='Height_feet:Q',\n    y='Floors:Q',\n    color=alt.condition(brush, 'Years_as_tallest:N', alt.value('grey')),\n    tooltip=['Name:N', 'Height_feet:Q', 'Floors:Q', 'Years_as_tallest:N']\n).add_params(\n    brush\n).properties(\n    title=\"Building Height vs. Number of Floors with Highlight for Tallest Buildings\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "protein_institute",
        "chart_category": "Bar Charts",
        "chart_type": "calculating_percentage_of_total",
        "NLQ": "Can you create a horizontal bar chart showing what percentage each building contributes to the total height of all buildings? I'd like to see the building names on the y-axis and the percentage values on the x-axis, with the x-axis formatted as percentages without decimal places.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nconn = sqlite3.connect('database/protein_institute.sqlite')\nquery = '''\nSELECT Name, Height_feet\nFROM building\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\nchart = alt.Chart(df).transform_joinaggregate(\n    TotalHeight='sum(Height_feet)',\n).transform_calculate(\n    PercentOfTotal=\"datum.Height_feet / datum.TotalHeight\"\n).mark_bar().encode(\n    alt.X('PercentOfTotal:Q').axis(format='.0%'),\n    y='Name:N'\n)\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "race_track",
        "chart_category": "Bar Charts",
        "chart_type": "calculating_percentage_of_total",
        "NLQ": "Can you show me a horizontal bar chart of the percentage of races held at each track location? I'd like to see the track locations listed on the y-axis and the percentage of total races on the x-axis, with the x-axis formatted as percentages without decimal places.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/race_track.sqlite')\n\nquery = '''\nSELECT \n    t.Location AS Track_Location,\n    COUNT(r.Race_ID) AS Race_Count\nFROM \n    race AS r\nJOIN \n    track AS t\nON \n    r.Track_ID = t.Track_ID\nGROUP BY \n    t.Location\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).transform_joinaggregate(\n    TotalRaces='sum(Race_Count)',\n).transform_calculate(\n    PercentOfTotal=\"datum.Race_Count / datum.TotalRaces\"\n).mark_bar().encode(\n    alt.X('PercentOfTotal:Q').axis(format='.0%'),\n    y='Track_Location:N'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "race_track",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_rectangular_brush",
        "NLQ": "Can you create an interactive scatter plot showing the relationship between seating capacity and the year opened for race tracks that hosted DP/GT class races? I'd like to be able to select groups of points to highlight them, with the non-selected points appearing in grey. Please include tooltips that show the track name, seating capacity, and year opened when I hover over each point.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/race_track.sqlite')\nquery = '''\nSELECT T.Track_ID, T.Name AS Track_Name, T.Seating, T.Year_Opened\nFROM track AS T\nJOIN race AS R ON T.Track_ID = R.Track_ID\nWHERE R.Class = 'DP/GT'\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\n\nchart = alt.Chart(df).mark_point().encode(\n    x='Seating:Q',\n    y='Year_Opened:Q',\n    color=alt.condition(brush, 'Track_Name:N', alt.value('grey')),\n    tooltip=['Track_Name:N', 'Seating:Q', 'Year_Opened:Q']\n).add_params(brush)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "restaurant_1",
        "chart_category": "Bar Charts",
        "chart_type": "compact_faceted_grid_of_bar_charts",
        "NLQ": "Can you show me the average amount spent by male and female students at different types of restaurants? I'd like to see small horizontal bar charts stacked vertically by restaurant type, with bars colored by gender and a legend at the bottom. Please keep the charts compact and make sure the restaurant types are clearly labeled.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/restaurant_1.sqlite')\n\nquery = '''\nSELECT \n    RT.ResTypeName AS Restaurant_Type,\n    S.Sex AS Gender,\n    AVG(VR.Spent) AS Average_Spent\nFROM \n    Visits_Restaurant AS VR\nJOIN \n    Student AS S ON VR.StuID = S.StuID\nJOIN \n    Type_Of_Restaurant AS TOR ON VR.ResID = TOR.ResID\nJOIN \n    Restaurant_Type AS RT ON TOR.ResTypeID = RT.ResTypeID\nGROUP BY \n    RT.ResTypeName, S.Sex\nORDER BY \n    RT.ResTypeName, S.Sex;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, width=60, height=alt.Step(8)).mark_bar().encode(\n    alt.Y(\"Gender:N\").axis(None),\n    alt.X(\"Average_Spent:Q\").title(\"Average Amount Spent\"),\n    alt.Color(\"Gender:N\").title(\"Gender\").legend(orient=\"bottom\", titleOrient=\"left\"),\n    alt.Row(\"Restaurant_Type:N\").title(\"Restaurant Type\").header(labelAngle=0)\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "restaurant_1",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_scatter_plot_and_linked_layered_histogram",
        "NLQ": "Can you create a visualization showing the relationship between student age and average amount spent at restaurants? I'd like to see this as a scatter plot with student age on the x-axis and average spending in dollars on the y-axis. Please color-code the points by gender using teal for males and purple for females. Next to this, I'd like to see a histogram showing the distribution of restaurant ratings from 0 to 5 for each gender. Make the visualization interactive so that when I click on a gender in either chart, it highlights that gender and grays out the other one. Both charts should be the same height and placed side by side.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/restaurant_1.sqlite')\nquery = '''\nSELECT \n    S.Age,\n    S.Sex AS Gender,\n    AVG(V.Spent) AS AvgSpent,\n    R.Rating\nFROM \n    Student AS S\nJOIN \n    Visits_Restaurant AS V ON S.StuID = V.StuID\nJOIN \n    Restaurant AS R ON V.ResID = R.ResID\nGROUP BY \n    S.Age, S.Sex, R.Rating\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselector = alt.selection_point(fields=['Gender'])\n\ncolor_scale = alt.Scale(domain=['M', 'F'], range=['#1FC3AA', '#8624F5'])\ncolor = (\n    alt.when(selector)\n    .then(alt.Color(\"Gender:N\").scale(color_scale))\n    .otherwise(alt.value(\"lightgray\"))\n)\n\nbase = alt.Chart(df).properties(\n    width=250,\n    height=250\n).add_params(selector)\n\npoints = base.mark_point(filled=True, size=200).encode(\n    alt.X('Age:Q').title('Student Age'),\n    alt.Y('AvgSpent:Q').title('Average Amount Spent ($)'),\n    color=color\n)\n\nhists = base.mark_bar(opacity=0.5, thickness=100).encode(\n    alt.X('Rating:Q')\n        .bin(step=1)\n        .scale(domain=[0, 5]),\n    alt.Y('count()')\n        .stack(None),\n    alt.Color('Gender:N').scale(color_scale)\n).transform_filter(\n    selector\n)\n\npoints | hists"
    },
    {
        "type": "type_A",
        "db_id": "riding_club",
        "chart_category": "Bar Charts",
        "chart_type": "compact_faceted_grid_of_bar_charts",
        "NLQ": "Can you create a grid of small horizontal bar charts showing the total votes for male and female players at each rank? I'd like each rank to be in its own row, with colored bars representing gender. Please keep the charts compact, remove the y-axis labels since the colors will identify gender, and put the gender legend at the bottom of the visualization.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/riding_club.sqlite')\n\nquery = '''\nSELECT Gender, Rank, SUM(Votes) AS Total_Votes\nFROM player\nGROUP BY Gender, Rank\nORDER BY Rank\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df, width=60, height=alt.Step(8)).mark_bar().encode(\n    alt.Y(\"Gender:N\").axis(None),\n    alt.X(\"Total_Votes:Q\").title(None),\n    alt.Color(\"Gender:N\").title(\"Gender\").legend(orient=\"bottom\", titleOrient=\"left\"),\n    alt.Row(\"Rank:N\").title(\"Rank\").header(labelAngle=0)\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "riding_club",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_selection_of_columns",
        "NLQ": "Can you create a visualization showing the correlation between Gold, Big Silver, and Small Silver awards? I'd like a heatmap with a blue-orange color scheme that I can click on to select pairs of awards to compare. Next to the heatmap, show two charts: one displaying the selected award categories as time series lines from January to December 2023, and another showing the difference between the selected categories over time. Make the heatmap interactive so when I click on different tiles, the time series and difference charts update accordingly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/riding_club.sqlite')\nquery = '''\nSELECT Gold, Big_Silver, Small_Silver, Club_ID\nFROM match_result\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['date'] = pd.date_range(start='1/1/2023', periods=len(df), freq='D')\ndf['date'] = df['date'].dt.strftime('%Y-%m-%d')\n\nselect_x = alt.selection_point(fields=['level_0'], name='select_x', value='Gold')\nselect_y = alt.selection_point(fields=['level_1'], name='select_y', value='Big_Silver')\nheatmap = alt.Chart(\n    df.drop(columns=['date', 'Club_ID']).corr().stack().reset_index().rename(columns={0: 'correlation'}),\n    title='Click a tile to compare timeseries',\n    height=250,\n    width=250,\n).mark_rect().encode(\n    alt.X('level_0').title(None),\n    alt.Y('level_1').title(None),\n    alt.Color('correlation').scale(domain=[-1, 1], scheme='blueorange'),\n    opacity=alt.when(select_x, select_y).then(alt.value(1)).otherwise(alt.value(0.4)),\n).add_params(\n    select_x, select_y\n)\n\nbase = alt.Chart(\n    df.melt(\n        id_vars=['date', 'Club_ID'],\n        var_name='category',\n        value_name='value',\n    ),\n    height=100,\n    width=300,\n    title='Individual timeseries',\n)\nlines = base.transform_filter(\n    'indexof(datum.category, select_x.level_0) !== -1'\n   '| indexof(datum.category, select_y.level_1) !== -1'\n).mark_line().encode(\n    alt.X('date:T').axis(labels=False).title(None),\n    alt.Y('value'),\n    alt.Color('category').legend(orient='top', offset=-20).title(None)\n)\n\ndynamic_title = alt.Title(alt.expr(f'\"Difference \" + {select_x.name}.level_0 + \" - \" + {select_y.name}.level_1'))\nlines_diff = base.transform_pivot(\n    'category', 'value', groupby=['date', 'Club_ID']\n).transform_calculate(\n    difference = f'datum[{select_x.name}.level_0] - datum[{select_y.name}.level_1]'\n).mark_line(color='grey').encode(\n    alt.X('date:T').axis(format='%Y-%m-%d').title(None),\n    alt.Y('difference:Q'),\n).properties(\n    title=dynamic_title\n)\n\n(lines & lines_diff) | heatmap"
    },
    {
        "type": "type_A",
        "db_id": "school_bus",
        "chart_category": "Bar Charts",
        "chart_type": "diverging_stacked_bar_chart",
        "NLQ": "Can you show me how school bus drivers' experience levels compare across different political parties? I'd like to see a horizontal bar chart with the political parties on the y-axis and the percentage distribution on the x-axis. Please use orange for drivers with 0-5 years experience, gray for 6-10 years, and blue for 11+ years. Make sure the experience ranges are centered around the middle of each bar.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/school_bus.sqlite')\n\nquery = '''\nSELECT \n    d.Party AS Party,\n    CASE \n        WHEN sb.Years_Working BETWEEN 0 AND 5 THEN '0-5 years'\n        WHEN sb.Years_Working BETWEEN 6 AND 10 THEN '6-10 years'\n        ELSE '11+ years'\n    END AS Experience_Range,\n    COUNT(*) AS Driver_Count\nFROM \n    driver AS d\nJOIN \n    school_bus AS sb ON d.Driver_ID = sb.Driver_ID\nGROUP BY \n    d.Party, Experience_Range\nORDER BY \n    d.Party, Experience_Range;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['Experience_Code'] = df['Experience_Range'].map({'0-5 years': 1, '6-10 years': 2, '11+ years': 3})\n\ndef compute_percentages(group):\n    group = group.set_index('Experience_Code').sort_index()\n    perc = (group['Driver_Count'] / group['Driver_Count'].sum()) * 100\n    group['Percentage'] = perc\n    group['Percentage_End'] = perc.cumsum() - (perc.sum() / 2)\n    group['Percentage_Start'] = group['Percentage_End'] - perc\n    return group\n\ndf = df.groupby('Party').apply(compute_percentages).reset_index(drop=True)\n\ncolor_scale = alt.Scale(\n    domain=['0-5 years', '6-10 years', '11+ years'],\n    range=['#f3a583', '#cccccc', '#94c6da']\n)\n\ny_axis = alt.Axis(title=\"Political Party\", offset=5, ticks=False, minExtent=60, domain=False)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"Percentage_Start:Q\", title=\"Percentage\"),\n    x2=\"Percentage_End:Q\",\n    y=alt.Y(\"Party:N\").axis(y_axis),\n    color=alt.Color(\"Experience_Range:N\").title(\"Experience Range\").scale(color_scale)\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "school_bus",
        "chart_category": "Interactive Charts",
        "chart_type": "interval_selection_with_initial_date_range",
        "NLQ": "Can you create a bar chart showing the number of school bus drivers for each year of experience? I'd like to see the years working on the x-axis and the count of drivers on the y-axis. Also, could you add a smaller chart below that lets me select and zoom in on specific ranges of years? I want to be able to focus on drivers with between 5-10 years of experience initially, but then adjust that range as needed.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/school_bus.sqlite')\n\nquery = '''\nSELECT sb.Years_Working, COUNT(*) AS Driver_Count\nFROM school_bus AS sb\nJOIN driver AS d ON sb.Driver_ID = d.Driver_ID\nGROUP BY sb.Years_Working\nORDER BY sb.Years_Working\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ninitial_range = (5, 10)\nbrush = alt.selection_interval(encodings=['x'], value={'x': initial_range})\n\nbase = alt.Chart(df, width=600, height=200).mark_bar().encode(\n    x=alt.X('Years_Working:Q', title='Years Working'),\n    y=alt.Y('Driver_Count:Q', title='Number of Drivers')\n)\n\nupper = base.encode(\n    alt.X('Years_Working:Q').scale(domain=brush)\n)\n\nlower = base.properties(\n    height=60\n).add_params(brush)\n\nchart = upper & lower\nchart"
    },
    {
        "type": "type_A",
        "db_id": "school_finance",
        "chart_category": "Interactive Charts",
        "chart_type": "interval_selection_with_initial_date_range",
        "NLQ": "Can you create an interactive chart showing how the total budgeted amounts for schools have changed over the years? I'd like a blue line chart with a smaller area chart below that lets me select specific time periods to zoom in on. The main chart should show the amount in dollars on the y-axis and years on the x-axis, with the ability to focus on particular time ranges I select from the smaller chart below.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nimport datetime as dt\n\nconn = sqlite3.connect('database/school_finance.sqlite')\n\nquery = '''\nSELECT \n    b.Year, \n    SUM(b.Budgeted) AS Total_Budgeted, \n    SUM(b.Invested) AS Total_Invested\nFROM \n    budget AS b\nGROUP BY \n    b.Year\nORDER BY \n    b.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndate_range = (dt.date(df['Year'].min(), 1, 1), dt.date(df['Year'].max(), 1, 1))\nbrush = alt.selection_interval(encodings=['x'], value={'x': date_range})\n\nbase = alt.Chart(df, width=600, height=200).mark_line().encode(\n    x=alt.X('Year:T', title='Year'),\n    y=alt.Y('Total_Budgeted:Q', title='Amount ($)'),\n    color=alt.value('blue')\n)\n\nupper = base.encode(\n    alt.X('Year:T').scale(domain=brush)\n)\n\nlower = base.mark_area(opacity=0.5).properties(\n    height=60\n).add_params(brush)\n\nchart = upper & lower\nchart"
    },
    {
        "type": "type_A",
        "db_id": "school_finance",
        "chart_category": "Simple Charts",
        "chart_type": "simple_stacked_area_chart",
        "NLQ": "Can you create a stacked area chart showing yearly trends of budgeted and invested amounts for each school? I'd like to see the schools distinguished by different colors, with separate rows for budgeted versus invested amounts. Make the chart about 600 pixels wide.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/school_finance.sqlite')\n\nquery = '''\nSELECT \n    S.School_name AS School,\n    B.Year AS Year,\n    SUM(B.Budgeted) AS Total_Budgeted,\n    SUM(B.Invested) AS Total_Invested\nFROM \n    budget AS B\nJOIN \n    School AS S ON B.School_id = S.School_id\nGROUP BY \n    S.School_name, B.Year\nORDER BY \n    B.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['School', 'Year'], value_vars=['Total_Budgeted', 'Total_Invested'], \n                    var_name='Category', value_name='Amount')\n\nchart = alt.Chart(df_melted).mark_area().encode(\n    x=alt.X(\"Year:O\", title=\"Year\"),\n    y=alt.Y(\"Amount:Q\", title=\"Amount\"),\n    color=alt.Color(\"School:N\", title=\"School\"),\n    row=alt.Row(\"Category:N\", title=\"Category\")\n).properties(\n    width=600,\n    height=150\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "school_finance",
        "chart_category": "Bar Charts",
        "chart_type": "faceted_stacked_bar_chart",
        "NLQ": "Can you show me a comparison of budgeted versus invested amounts for each school from 1999 to 2001? I'd like to see this as a bar chart with a separate panel for each school. Put the years on the vertical axis and the dollar amounts on the horizontal axis. Use different colors to distinguish between budgeted and invested amounts, and include a title that mentions it's a comparison of budgeted and invested amounts by school from 1999-2001.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/school_finance.sqlite')\n\nquery = '''\nSELECT \n    S.School_name AS School,\n    B.Year AS Year,\n    B.Budgeted AS Budgeted,\n    B.Invested AS Invested\nFROM \n    School AS S\nJOIN \n    budget AS B\nON \n    S.School_id = B.School_id\nWHERE \n    B.Year BETWEEN 1999 AND 2001\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['School', 'Year'], value_vars=['Budgeted', 'Invested'], \n                    var_name='Category', value_name='Amount')\n\nchart = alt.Chart(df_melted).mark_bar().encode(\n    column=alt.Column(\"School:N\", title=\"School\"),\n    x=alt.X(\"Amount:Q\", title=\"Amount ($)\"),\n    y=alt.Y(\"Year:O\", title=\"Year\"),\n    color=alt.Color(\"Category:N\", title=\"Category\")\n).properties(\n    width=200,\n    title=\"Comparison of Budgeted and Invested Amounts by School (1999-2001)\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "school_player",
        "chart_category": "Simple Charts",
        "chart_type": "simple_strip_plot",
        "NLQ": "Can you show me a strip plot comparing school enrollment numbers across different religious denominations? I'd like to see how enrollment is distributed for each denomination.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/school_player.sqlite')\nquery = '''\nSELECT Enrollment, Denomination\nFROM school\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_tick().encode(\n    x='Enrollment:Q',\n    y='Denomination:O'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "school_player",
        "chart_category": "Bar Charts",
        "chart_type": "faceted_stacked_bar_chart",
        "NLQ": "Can you show me a bar chart displaying the distribution of players by position for each school? I'd like to see the number of players on the y-axis, with positions grouped by school and colored by team. Please title it \"Distribution of Players by Position Across Schools\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/school_player.sqlite')\n\nquery = '''\nSELECT \n    s.School AS School_Name,\n    p.Position,\n    p.Team,\n    COUNT(p.Player_ID) AS Player_Count\nFROM \n    player AS p\nJOIN \n    school AS s ON p.School_ID = s.School_ID\nGROUP BY \n    s.School, p.Position, p.Team\nORDER BY \n    s.School, p.Position\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    column=alt.Column(\"School_Name:N\", title=\"School\"),\n    x=alt.X(\"Player_Count:Q\", title=\"Number of Players\"),\n    y=alt.Y(\"Position:N\", title=\"Position\"),\n    color=alt.Color(\"Team:N\", title=\"Team\")\n).properties(\n    width=200,\n    title=\"Distribution of Players by Position Across Schools\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "school_player",
        "chart_category": "Interactive Charts",
        "chart_type": "interval_selection_with_initial_date_range",
        "NLQ": "Can you create a line chart showing school enrollment numbers based on the year they entered competition? I'd like to see the trend over time with points marking each school. Include a smaller chart below that lets me select and zoom into specific time periods, and when I hover over points, show me the school name, year, and enrollment number.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nimport datetime as dt\n\nconn = sqlite3.connect('database/school_player.sqlite')\n\nquery = '''\nSELECT School, Year_Entered_Competition, Enrollment\nFROM school\nWHERE Year_Entered_Competition IS NOT NULL AND Enrollment IS NOT NULL\nORDER BY Year_Entered_Competition\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndate_range = (dt.date(1900, 1, 1), dt.date(2000, 1, 1))\nbrush = alt.selection_interval(encodings=['x'], value={'x': date_range})\n\nbase = alt.Chart(df, width=600, height=200).mark_line(point=True).encode(\n    x=alt.X('Year_Entered_Competition:T', title='Year Entered Competition'),\n    y=alt.Y('Enrollment:Q', title='Enrollment'),\n    tooltip=['School:N', 'Year_Entered_Competition:T', 'Enrollment:Q']\n)\n\nupper = base.encode(\n    alt.X('Year_Entered_Competition:T').scale(domain=brush)\n)\n\nlower = base.properties(\n    height=60\n).add_params(brush)\n\nchart = upper & lower\nchart"
    },
    {
        "type": "type_A",
        "db_id": "scientist_1",
        "chart_category": "Simple Charts",
        "chart_type": "simple_strip_plot",
        "NLQ": "Can you show me a strip plot that displays the hours for each project code? I'd like to see the project codes listed vertically with horizontal tick marks showing the hours for each one.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/scientist_1.sqlite')\nquery = '''\nSELECT Code, Hours\nFROM Projects\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_tick().encode(\n    x='Hours:Q',\n    y='Code:O'\n)\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "scientist_1",
        "chart_category": "Bar Charts",
        "chart_type": "faceted_stacked_bar_chart",
        "NLQ": "Can you create a bar chart showing the total hours each scientist spent on different projects? I'd like to see a separate column for each scientist, with colored bars representing different projects. Please include a title \"Total Hours Spent by Scientists on Projects\" and make each column about 200 pixels wide.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/scientist_1.sqlite')\n\nquery = '''\nSELECT \n    S.Name AS ScientistName,\n    P.Name AS ProjectName,\n    SUM(P.Hours) AS TotalHours\nFROM \n    AssignedTo AS A\nJOIN \n    Scientists AS S ON A.Scientist = S.SSN\nJOIN \n    Projects AS P ON A.Project = P.Code\nGROUP BY \n    S.Name, P.Name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    column=alt.Column(\"ScientistName:N\", title=\"Scientist\"),\n    x=\"TotalHours:Q\",\n    y=\"ProjectName:N\",\n    color=\"ProjectName:N\"\n).properties(\n    width=200,\n    title=\"Total Hours Spent by Scientists on Projects\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "ship_1",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart",
        "NLQ": "Can you create a bar chart showing the number of captains by their rank for each ship class? I'd like to see the bars colored by captain rank, with separate panels for each ship class. Please title it \"Number of Captains Grouped by Rank and Ship Class\" and label the axes as \"Captain Rank\" and \"Number of Captains\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/ship_1.sqlite')\n\nquery = '''\nSELECT \n    c.Rank AS Captain_Rank, \n    c.Class AS Ship_Class, \n    COUNT(c.Captain_ID) AS Captain_Count\nFROM \n    captain AS c\nGROUP BY \n    c.Rank, c.Class\nORDER BY \n    c.Rank, c.Class;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Captain_Rank:N', title='Captain Rank'),\n    y=alt.Y('sum(Captain_Count):Q', title='Number of Captains'),\n    color=alt.Color('Captain_Rank:N', legend=alt.Legend(title=\"Rank\")),\n    column=alt.Column('Ship_Class:N', title='Ship Class')\n).properties(\n    title=\"Number of Captains Grouped by Rank and Ship Class\"\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "ship_1",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-line_highlight",
        "NLQ": "Can you create a line chart showing the number of ships built each year by ship class? I'd like to see how different classes trend over time, with the year on the x-axis and ship count on the y-axis. Make the lines different colors for each ship class, and add an interactive feature where hovering over a specific ship class highlights that line by making it thicker. The chart should be fairly wide to show the time trends clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/ship_1.sqlite')\n\nquery = '''\nSELECT \n    Built_Year AS year,\n    Class AS ship_class,\n    COUNT(*) AS ship_count\nFROM \n    Ship\nGROUP BY \n    Built_Year, Class\nORDER BY \n    Built_Year ASC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nhighlight = alt.selection_point(on='pointerover', fields=['ship_class'], nearest=True)\n\nbase = alt.Chart(df).encode(\n    x='year:T',\n    y='ship_count:Q',\n    color='ship_class:N'\n)\n\npoints = base.mark_circle().encode(\n    opacity=alt.value(0)\n).add_params(\n    highlight\n).properties(\n    width=600\n)\n\nlines = base.mark_line().encode(\n    size=alt.when(~highlight).then(alt.value(1)).otherwise(alt.value(3))\n)\n\nchart = points + lines\nchart"
    },
    {
        "type": "type_A",
        "db_id": "ship_mission",
        "chart_category": "Interactive Charts",
        "chart_type": "multi-line_highlight",
        "NLQ": "Can you create a line chart showing the average tonnage of ships by nationality for each year after 1920? I'd like to see how ship sizes changed over time for different countries, with lines of different colors for each nationality. Make it interactive so when I hover over a line, it highlights that specific nationality by making the line thicker. The chart should be fairly wide to show the time progression clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/ship_mission.sqlite')\n\nquery = '''\nSELECT\n    M.Launched_Year,\n    S.Nationality,\n    AVG(S.Tonnage) AS AverageTonnage\nFROM ship AS S\nJOIN mission AS M\n    ON S.Ship_ID = M.Ship_ID\nWHERE M.Launched_Year > 1920\nGROUP BY\n    M.Launched_Year,\n    S.Nationality\nORDER BY\n    M.Launched_Year,\n    S.Nationality;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nhighlight = alt.selection_point(on='pointerover', fields=['Nationality'], nearest=True)\n\nbase = alt.Chart(df).encode(\n    x='Launched_Year:O',\n    y='AverageTonnage:Q',\n    color='Nationality:N'\n)\n\npoints = base.mark_circle().encode(\n    opacity=alt.value(0)\n).add_params(\n    highlight\n).properties(\n    width=600\n)\n\nlines = base.mark_line().encode(\n    size=alt.when(~highlight).then(alt.value(1)).otherwise(alt.value(3))\n)\n\npoints + lines"
    },
    {
        "type": "type_A",
        "db_id": "ship_mission",
        "chart_category": "Tables",
        "chart_type": "annual_weather_heatmap",
        "NLQ": "Can you create a heatmap showing the number of missions launched each year by nationality? I'd like to see launch years on the x-axis and nationalities on the y-axis, with color intensity representing the mission count. Please include a title \"Number of Missions Launched Each Year by Nationality\" and make sure I can hover over each cell to see the exact launch year, nationality, and mission count. Can you remove grid lines and axis borders to keep it clean?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/ship_mission.sqlite')\n\nquery = '''\nSELECT \n    s.Nationality AS Nationality,\n    m.Launched_Year AS Launched_Year,\n    COUNT(m.Mission_ID) AS Mission_Count\nFROM \n    mission AS m\nJOIN \n    ship AS s\nON \n    m.Ship_ID = s.Ship_ID\nGROUP BY \n    s.Nationality, m.Launched_Year\nORDER BY \n    s.Nationality, m.Launched_Year;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Number of Missions Launched Each Year by Nationality\").mark_rect().encode(\n    alt.X(\"Launched_Year:O\").title(\"Launch Year\"),\n    alt.Y(\"Nationality:O\").title(\"Nationality\"),\n    alt.Color(\"Mission_Count:Q\").title(\"Missions\"),\n    tooltip=[\n        alt.Tooltip(\"Launched_Year\", title=\"Launch Year\"),\n        alt.Tooltip(\"Nationality\", title=\"Nationality\"),\n        alt.Tooltip(\"Mission_Count\", title=\"Mission Count\"),\n    ],\n).configure_view(\n    step=13,\n    strokeWidth=0\n).configure_axis(\n    domain=False\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "ship_mission",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart",
        "NLQ": "Can you create a bar chart showing the total tonnage of ships grouped by nationality? I'd like to see separate charts for each ship type, with the bars colored by nationality so I can compare tonnage across different countries for each type of ship.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/ship_mission.sqlite')\n\nquery = '''\nSELECT \n    Type, \n    Nationality, \n    SUM(Tonnage) AS Total_Tonnage\nFROM \n    ship\nGROUP BY \n    Type, \n    Nationality\nORDER BY \n    Type, \n    Nationality;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Nationality:N',\n    y='Total_Tonnage:Q',\n    color='Nationality:N',\n    column='Type:N'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "shop_membership",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart",
        "NLQ": "Can you show me a comparison of membership registrations by city from 2016 to 2018? I'd like to see the data as grouped bar charts for each city, with different colored bars representing each year and the height showing the number of registrations.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/shop_membership.sqlite')\n\nquery = '''\nSELECT \n    b.City AS City, \n    mrb.Register_Year AS Register_Year, \n    COUNT(mrb.Member_ID) AS Registration_Count\nFROM \n    membership_register_branch AS mrb\nJOIN \n    branch AS b ON mrb.Branch_ID = b.Branch_ID\nWHERE \n    mrb.Register_Year BETWEEN '2016' AND '2018'\nGROUP BY \n    b.City, mrb.Register_Year\nORDER BY \n    b.City, mrb.Register_Year;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Register_Year:O',\n    y='sum(Registration_Count):Q',\n    color='Register_Year:N',\n    column='City:N'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "shop_membership",
        "chart_category": "Tables",
        "chart_type": "annual_weather_heatmap",
        "NLQ": "Can you create a heatmap showing total purchase amounts by branch and year? I'd like to see branches listed on the y-axis and years on the x-axis, with blue color intensity showing the total purchase amounts in pounds. Please include \"Total Purchase Amounts by Branch and Year\" as the title and add tooltips that show the branch name, year, and exact purchase amount when I hover over each cell. Also, can you remove grid lines and axis borders to keep it clean?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/shop_membership.sqlite')\n\nquery = '''\nSELECT \n    b.Name AS Branch_Name,\n    p.Year AS Purchase_Year,\n    SUM(p.Total_pounds) AS Total_Purchase_Amount\nFROM \n    purchase AS p\nJOIN \n    branch AS b ON p.Branch_ID = b.Branch_ID\nGROUP BY \n    b.Name, p.Year\nORDER BY \n    b.Name, p.Year;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Total Purchase Amounts by Branch and Year\").mark_rect().encode(\n    alt.X(\"Purchase_Year:O\").title(\"Year\"),\n    alt.Y(\"Branch_Name:O\").title(\"Branch\"),\n    alt.Color(\"Total_Purchase_Amount:Q\").title(\"Total Purchase Amount (Â£)\").scale(scheme=\"blues\"),\n    tooltip=[\n        alt.Tooltip(\"Branch_Name\", title=\"Branch\"),\n        alt.Tooltip(\"Purchase_Year\", title=\"Year\"),\n        alt.Tooltip(\"Total_Purchase_Amount\", title=\"Total Purchase Amount (Â£)\", format=\".2f\"),\n    ],\n).configure_view(\n    step=13,\n    strokeWidth=0\n).configure_axis(\n    domain=False\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "singer",
        "chart_category": "Tables",
        "chart_type": "annual_weather_heatmap",
        "NLQ": "Can you create a heatmap showing the best chart positions achieved by songs, with song titles along the x-axis and singers' birth years on the y-axis? I'd like the colors to represent the highest position each song reached on the charts, with a title \"Best Chart Positions by Singer Birth Year\". Please include tooltips that show the song title, singer's birth year, and best position when I hover over each cell. Can you remove grid lines and axis borders to keep it clean?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/singer.sqlite')\n\nquery = '''\nSELECT \n    s.Birth_Year AS Singer_Birth_Year,\n    so.Title AS Song_Title,\n    MIN(so.Highest_Position) AS Best_Position\nFROM \n    singer AS s\nJOIN \n    song AS so\nON \n    s.Singer_ID = so.Singer_ID\nGROUP BY \n    s.Birth_Year, so.Title\nORDER BY \n    s.Birth_Year ASC, Best_Position ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Best Chart Positions by Singer Birth Year\").mark_rect().encode(\n    alt.X(\"Song_Title:N\").title(\"Song Title\"),\n    alt.Y(\"Singer_Birth_Year:N\").title(\"Singer Birth Year\"),\n    alt.Color(\"Best_Position:Q\").title(\"Highest Position\"),\n    tooltip=[\n        alt.Tooltip(\"Song_Title\", title=\"Song Title\"),\n        alt.Tooltip(\"Singer_Birth_Year\", title=\"Singer Birth Year\"),\n        alt.Tooltip(\"Best_Position\", title=\"Best Position\"),\n    ],\n).configure_view(\n    step=13,\n    strokeWidth=0\n).configure_axis(\n    domain=False\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "singer",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_error_bars",
        "NLQ": "Can you create a bar chart comparing the average net worth of singers by their citizenship? I'd like to see the average net worth in millions on the y-axis, with different colored bars for each citizenship. Also, could you add error bars showing the range from minimum to maximum net worth for each citizenship group? Please title the chart \"Comparison of Average Net Worth by Citizenship with Variability\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/singer.sqlite')\n\nquery = '''\nSELECT Citizenship, AVG(Net_Worth_Millions) AS Avg_Net_Worth, \n       COUNT(*) AS Singer_Count, \n       MIN(Net_Worth_Millions) AS Min_Net_Worth, \n       MAX(Net_Worth_Millions) AS Max_Net_Worth\nFROM singer\nGROUP BY Citizenship\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbars = alt.Chart(df).mark_bar().encode(\n    x='Citizenship:N',\n    y=alt.Y('Avg_Net_Worth:Q').title('Average Net Worth (Millions)'),\n    color='Citizenship:N'\n)\n\nerror_bars = alt.Chart(df).mark_errorbar(extent='ci').encode(\n    x='Citizenship:N',\n    y=alt.Y('Min_Net_Worth:Q').title('Net Worth Range'),\n    y2='Max_Net_Worth:Q'\n)\n\nchart = alt.layer(bars, error_bars).properties(\n    title='Comparison of Average Net Worth by Citizenship with Variability'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "soccer_1",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_error_bars",
        "NLQ": "Can you show me a comparison of average overall ratings and potential for soccer players based on their preferred foot? I'd like to see this as a bar chart with error bars showing the standard deviation, and have the rating types displayed in separate columns.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/soccer_1.sqlite')\nquery = '''\nSELECT \n    preferred_foot,\n    AVG(overall_rating) AS avg_overall_rating,\n    AVG(potential) AS avg_potential,\n    COUNT(*) AS count\nFROM Player_Attributes\nWHERE overall_rating IS NOT NULL AND potential IS NOT NULL\nGROUP BY preferred_foot\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['preferred_foot'], \n                    value_vars=['avg_overall_rating', 'avg_potential'], \n                    var_name='rating_type', \n                    value_name='average_value')\n\nbars = alt.Chart(df_melted).mark_bar().encode(\n    x=alt.X('preferred_foot:N').title('Preferred Foot'),\n    y=alt.Y('average_value:Q').title('Average Rating'),\n    color=alt.Color('rating_type:N').title('Rating Type')\n)\n\nerror_bars = alt.Chart(df_melted).mark_errorbar(extent='stdev').encode(\n    x=alt.X('preferred_foot:N'),\n    y=alt.Y('average_value:Q')\n)\n\nchart = alt.layer(bars, error_bars).facet(\n    column=alt.Column('rating_type:N').title('Rating Type')\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "sports_competition",
        "chart_category": "Tables",
        "chart_type": "lasagna_plot_dense_time-series_heatmap",
        "NLQ": "Can you create a heatmap showing the total medals won by each club over time? Put years on the x-axis and club names on the y-axis, with blue color intensity representing the total number of medals (gold, silver, and bronze combined). Title it \"Total Medals Won by Clubs Over Time\" and make the chart 400 pixels wide by 200 pixels tall.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/sports_competition.sqlite')\n\nquery = '''\nSELECT \n    c.name AS Club_Name,\n    cr.Year AS Year,\n    SUM(clr.Gold + clr.Silver + clr.Bronze) AS Total_Medals\nFROM \n    club AS c\nJOIN \n    club_rank AS clr ON c.Club_ID = clr.Club_ID\nJOIN \n    competition AS cr ON cr.Competition_ID = clr.Club_ID\nGROUP BY \n    c.name, cr.Year\nORDER BY \n    cr.Year, c.name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = (\n    alt.Chart(df, width=400, height=200)\n    .mark_rect()\n    .encode(\n        alt.X(\"Year:O\").title(\"Year\"),\n        alt.Y(\"Club_Name:N\").title(\"Club\"),\n        alt.Color(\"Total_Medals:Q\")\n        .title(\"Total Medals\")\n        .scale(scheme=\"blues\"),\n    )\n    .properties(title=\"Total Medals Won by Clubs Over Time\")\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "sports_competition",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_xoffset",
        "NLQ": "Can you create a grouped bar chart showing the medal counts for the top 3 clubs in the sports competition? I'd like to see gold, silver, and bronze medals compared side by side for each club, with the club names on the x-axis and the medal count on the y-axis. Please title it \"Medal Counts by Top 3 Clubs\" and include a color legend for the different medal types.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/sports_competition.sqlite')\n\nquery = '''\nSELECT \n    c.name AS Club_Name,\n    cr.Gold,\n    cr.Silver,\n    cr.Bronze\nFROM \n    club_rank AS cr\nJOIN \n    club AS c ON cr.Club_ID = c.Club_ID\nWHERE \n    cr.Rank <= 3\nORDER BY \n    cr.Rank;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=[\"Club_Name\"], value_vars=[\"Gold\", \"Silver\", \"Bronze\"], \n                    var_name=\"Medal_Type\", value_name=\"Count\")\n\nchart = alt.Chart(df_melted).mark_bar().encode(\n    x=alt.X(\"Club_Name:N\", title=\"Club\"),\n    y=alt.Y(\"Count:Q\", title=\"Medal Count\"),\n    xOffset=\"Medal_Type:N\",\n    color=alt.Color(\"Medal_Type:N\", title=\"Medal Type\")\n).properties(\n    title=\"Medal Counts by Top 3 Clubs\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "station_weather",
        "chart_category": "Tables",
        "chart_type": "lasagna_plot_dense_time-series_heatmap",
        "NLQ": "Can you create a heatmap showing high temperatures by station and day of week? I'd like to see the stations listed vertically and days of the week horizontally, with colors representing the high temperature in Fahrenheit. Please use the viridis color scheme and title it \"High Temperatures by Station and Day of Week\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/station_weather.sqlite')\nquery = '''\nSELECT \n    s.network_name AS station_name,\n    w.day_of_week,\n    w.high_temperature\nFROM \n    weekly_weather AS w\nJOIN \n    station AS s\nON \n    w.station_id = s.id\nORDER BY \n    s.network_name, \n    CASE w.day_of_week \n        WHEN 'Monday' THEN 1\n        WHEN 'Tuesday' THEN 2\n        WHEN 'Wednesday' THEN 3\n        WHEN 'Thursday' THEN 4\n        WHEN 'Friday' THEN 5\n        WHEN 'Saturday' THEN 6\n        WHEN 'Sunday' THEN 7\n    END\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\nchart = alt.Chart(df, width=400, height=200).mark_rect().encode(\n    alt.X(\"day_of_week:N\").title(\"Day of Week\"),\n    alt.Y(\"station_name:N\").title(\"Station\"),\n    alt.Color(\"high_temperature:Q\").title(\"High Temperature (Â°F)\").scale(scheme=\"viridis\")\n).properties(\n    title=\"High Temperatures by Station and Day of Week\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "storm_record",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_bar_chart",
        "NLQ": "Show me a horizontal bar chart of the total number of cities affected by storms in each region. Order the regions from highest to lowest number of affected cities and title it \"Total Cities Affected by Storms in Each Region\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/storm_record.sqlite')\nquery = '''\nSELECT \n    r.Region_name AS Region,\n    SUM(ar.Number_city_affected) AS Total_Cities_Affected\nFROM \n    affected_region AS ar\nJOIN \n    region AS r ON ar.Region_id = r.Region_id\nGROUP BY \n    r.Region_name\nORDER BY \n    Total_Cities_Affected DESC;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Total_Cities_Affected:Q', title='Total Cities Affected'),\n    y=alt.Y('Region:O', sort='-x', title='Region')\n).properties(\n    title='Total Cities Affected by Storms in Each Region'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "student_assessment",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_bar_chart",
        "NLQ": "Can you create a horizontal bar chart showing the number of courses each student is registered for? I'd like to see the student names on the y-axis and the number of courses on the x-axis, with students sorted from most to least courses. Please title it \"Number of Courses Registered per Student\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/student_assessment.sqlite')\n\nquery = '''\nSELECT \n    s.student_id,\n    p.first_name || ' ' || p.last_name AS student_name,\n    COUNT(sc.course_id) AS course_count\nFROM \n    Students AS s\nJOIN \n    People AS p ON s.student_id = p.person_id\nLEFT JOIN \n    Student_Course_Registrations AS sc ON s.student_id = sc.student_id\nGROUP BY \n    s.student_id, student_name\nORDER BY \n    course_count DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('course_count:Q', title='Number of Courses Registered'),\n    y=alt.Y('student_name:O', sort='-x', title='Student Name')\n).properties(\n    title='Number of Courses Registered per Student'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "student_assessment",
        "chart_category": "Interactive Charts",
        "chart_type": "multiple_interactions",
        "NLQ": "Can you create a dashboard with three interactive scatter plots showing the relationship between student attendance dates and assessment dates? I'd like one chart where I can filter by qualification using a dropdown menu, another chart where I can highlight pass/fail outcomes in green and red using radio buttons, and a third chart where I can toggle point sizes to show students who attended multiple courses using a checkbox. For all charts, I want to see circles representing students with tooltips showing student ID, course ID, qualification, and assessment outcome when I hover over them.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/student_assessment.sqlite')\n\nquery = '''\nSELECT \n    sca.student_id,\n    sca.course_id,\n    sca.date_of_attendance,\n    ca.qualification,\n    ca.assessment_date,\n    ca.asessment_outcome_code,\n    COUNT(sca.course_id) OVER (PARTITION BY sca.student_id) AS course_count\nFROM \n    Student_Course_Attendance AS sca\nJOIN \n    Candidates AS c ON sca.student_id = c.candidate_id\nJOIN \n    Candidate_Assessments AS ca ON c.candidate_id = ca.candidate_id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['date_of_attendance'] = pd.to_datetime(df['date_of_attendance'])\ndf['assessment_date'] = pd.to_datetime(df['assessment_date'])\n\nbase = alt.Chart(df).mark_circle().encode(\n    x=alt.X('date_of_attendance:T', title='Date of Attendance'),\n    y=alt.Y('assessment_date:T', title='Assessment Date'),\n    tooltip=['student_id:N', 'course_id:N', 'qualification:N', 'asessment_outcome_code:N']\n)\n\nqualification_dropdown = alt.binding_select(options=df['qualification'].unique().tolist(), name=\"Qualification: \")\nqualification_select = alt.selection_point(fields=['qualification'], bind=qualification_dropdown)\nfilter_qualification = base.add_params(\n    qualification_select\n).transform_filter(\n    qualification_select\n).properties(title=\"Filter by Qualification\")\n\noutcome_radio = alt.binding_radio(options=['Pass', 'Fail'], name=\"Outcome: \")\noutcome_select = alt.selection_point(fields=['asessment_outcome_code'], bind=outcome_radio)\ncolor_condition = (\n    alt.when(outcome_select)\n    .then(alt.Color('asessment_outcome_code:N').scale(domain=['Pass', 'Fail'], range=['green', 'red']))\n    .otherwise(alt.value('lightgray'))\n)\nhighlight_outcomes = base.add_params(\n    outcome_select\n).encode(\n    color=color_condition\n).properties(title=\"Highlight by Outcome\")\n\nsize_checkbox = alt.binding_checkbox(name=\"Highlight Multiple Course Attendees: \")\nsize_select = alt.param(bind=size_checkbox)\nsize_condition = (\n    alt.when(size_select)\n    .then(alt.Size('course_count:Q').scale(range=[50, 200]))\n    .otherwise(alt.value(50))\n)\ntoggle_size = base.add_params(\n    size_select\n).encode(\n    size=size_condition\n).properties(title=\"Toggle Size by Course Count\")\n\n(filter_qualification | highlight_outcomes) & toggle_size"
    },
    {
        "type": "type_A",
        "db_id": "student_assessment",
        "chart_category": "Tables",
        "chart_type": "text_over_a_heatmap",
        "NLQ": "Can you create a heatmap showing the average course attendance by city and course name? I'd like to see the course names along the x-axis and cities on the y-axis, with attendance values represented by color intensity using the viridis color scheme. Please display the exact attendance values as text on each cell, with black text for values above the mean and white text for values below. Title the chart \"Average Course Attendance by City and Course Name.\"",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/student_assessment.sqlite')\n\nquery = '''\nSELECT \n    a.city AS City,\n    c.course_name AS Course_Name,\n    COUNT(sca.student_id) * 1.0 / COUNT(DISTINCT sca.student_id) AS Avg_Attendance\nFROM \n    Student_Course_Attendance sca\nJOIN \n    Courses c ON sca.course_id = c.course_id\nJOIN \n    Students s ON sca.student_id = s.student_id\nJOIN \n    People p ON s.student_id = p.person_id\nJOIN \n    People_Addresses pa ON p.person_id = pa.person_id\nJOIN \n    Addresses a ON pa.address_id = a.address_id\nGROUP BY \n    a.city, c.course_name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.X('Course_Name:O', title='Course Name'),\n    alt.Y('City:O', title='City')\n)\n\nheatmap = base.mark_rect().encode(\n    alt.Color('Avg_Attendance:Q')\n        .scale(scheme='viridis')\n        .title(\"Average Attendance\")\n)\n\ntext = base.mark_text(baseline='middle').encode(\n    alt.Text('Avg_Attendance:Q', format=\".2f\"),\n    color=alt.condition(\n        alt.datum.Avg_Attendance > df['Avg_Attendance'].mean(),\n        alt.value(\"black\"),\n        alt.value(\"white\")\n    )\n)\n\nchart = heatmap + text\nchart.properties(title=\"Average Course Attendance by City and Course Name\")"
    },
    {
        "type": "type_A",
        "db_id": "student_transcripts_tracking",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_bar_chart",
        "NLQ": "Can you create a horizontal bar chart showing the number of courses enrolled per student grouped by degree program? I'd like the degree programs sorted by the highest course count, with each program shown in a different color. Please include tooltips that show the student's name and their exact course count when I hover over a bar.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/student_transcripts_tracking.sqlite')\n\nquery = '''\nSELECT \n    dp.degree_summary_name AS Degree_Program,\n    s.first_name || ' ' || s.last_name AS Student_Name,\n    COUNT(sec.course_id) AS Course_Count\nFROM \n    Student_Enrolment AS se\nJOIN \n    Degree_Programs AS dp ON se.degree_program_id = dp.degree_program_id\nJOIN \n    Students AS s ON se.student_id = s.student_id\nJOIN \n    Student_Enrolment_Courses AS sec ON se.student_enrolment_id = sec.student_enrolment_id\nGROUP BY \n    dp.degree_summary_name, s.student_id\nORDER BY \n    dp.degree_summary_name, Course_Count DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Course_Count:Q',\n    y=alt.Y('Degree_Program:N', sort='-x'),\n    color='Degree_Program:N',\n    tooltip=['Student_Name:N', 'Course_Count:Q']\n).properties(\n    title=\"Number of Courses Enrolled per Student Grouped by Degree Program\"\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "student_transcripts_tracking",
        "chart_category": "Tables",
        "chart_type": "text_over_a_heatmap",
        "NLQ": "Can you create a heatmap showing the average number of courses enrolled for each degree program across different semesters? I'd like to see the exact average values displayed on each cell of the heatmap, with white text for lower values and black text for values above 5. Please use a viridis color scheme where darker colors represent higher enrollment numbers, and title the chart \"Average Courses Enrolled by Degree Program and Semester\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/student_transcripts_tracking.sqlite')\n\nquery = '''\nSELECT \n    dp.degree_summary_name AS Degree_Program,\n    s.semester_name AS Semester,\n    AVG(COUNT(sec.course_id)) OVER (PARTITION BY dp.degree_summary_name, s.semester_name) AS Avg_Courses_Enrolled\nFROM \n    Student_Enrolment AS se\nJOIN \n    Degree_Programs AS dp ON se.degree_program_id = dp.degree_program_id\nJOIN \n    Semesters AS s ON se.semester_id = s.semester_id\nJOIN \n    Student_Enrolment_Courses AS sec ON se.student_enrolment_id = sec.student_enrolment_id\nGROUP BY \n    dp.degree_summary_name, s.semester_name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.X('Semester:O', title='Semester'),\n    alt.Y('Degree_Program:O', title='Degree Program')\n)\n\nheatmap = base.mark_rect().encode(\n    alt.Color('Avg_Courses_Enrolled:Q')\n        .scale(scheme='viridis')\n        .title(\"Average Courses Enrolled\")\n)\n\ncolor = (\n    alt.when(alt.datum.Avg_Courses_Enrolled > 5)\n    .then(alt.value(\"black\"))\n    .otherwise(alt.value(\"white\"))\n)\n\ntext = base.mark_text(baseline='middle').encode(\n    alt.Text('Avg_Courses_Enrolled:Q', format=\".1f\"), color=color\n)\n\nchart = heatmap + text\nchart.properties(title=\"Average Courses Enrolled by Degree Program and Semester\")"
    },
    {
        "type": "type_A",
        "db_id": "swimming",
        "chart_category": "Tables",
        "chart_type": "text_over_a_heatmap",
        "NLQ": "Can you create a heatmap showing the average 100-meter swim times by country? I'd like to see the countries listed horizontally with their average times displayed from highest to lowest. Please include the exact time values (with two decimal places) overlaid on each colored cell, with white text on darker cells and black text on lighter ones. Use the viridis color scheme to represent the time values, and make the visualization about 600 by 400 in size. Label the x-axis as \"Country\" and the y-axis as \"Average 100m Time (seconds)\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/swimming.sqlite')\nquery = '''\nSELECT Nationality, AVG(meter_100) AS avg_time\nFROM swimmer\nGROUP BY Nationality\nORDER BY avg_time DESC\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.X('Nationality:O', title='Country'),\n    alt.Y('avg_time:Q', title='Average 100m Time (seconds)')\n)\n\nheatmap = base.mark_rect().encode(\n    alt.Color('avg_time:Q')\n        .scale(scheme='viridis')\n        .title(\"Average Time (s)\")\n)\n\ncolor = (\n    alt.when(alt.datum.avg_time > df['avg_time'].mean())\n    .then(alt.value(\"black\"))\n    .otherwise(alt.value(\"white\"))\n)\n\ntext = base.mark_text(baseline='middle').encode(\n    alt.Text('avg_time:Q', format=\".2f\"), color=color\n)\n\nchart = heatmap + text\nchart.properties(width=600, height=400)"
    },
    {
        "type": "type_A",
        "db_id": "swimming",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_grouped_bar_chart",
        "NLQ": "Can you create a horizontal bar chart showing 100-meter swim times organized by nationality? I'd like each swimmer to be represented by a different color, with their names, nationalities, and exact times showing when I hover over the bars. Please make it a good size (600x400) with the title \"100-Meter Swim Times by Nationality\" at the top. For each nationality, I want to see the swimmers sorted from fastest to slowest.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/swimming.sqlite')\n\nquery = '''\nSELECT name, Nationality, meter_100\nFROM swimmer\nORDER BY Nationality, meter_100 ASC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='meter_100:Q',\n    y='Nationality:N',\n    color='name:N',\n    tooltip=['name', 'Nationality', 'meter_100']\n).properties(\n    width=600,\n    height=400,\n    title='100-Meter Swim Times by Nationality'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "tracking_grants_for_research",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "error_bars_with_confidence_interval",
        "NLQ": "Can you create an error bar chart showing the range of grant amounts for different organization types? I'd like to see the minimum and maximum grant amounts as horizontal bars for each organization type, with a black dot showing the average grant amount. Label the x-axis as \"Grant Amount\" and the y-axis as \"Organisation Type\" so I can easily compare which types of organizations receive more consistent funding versus those with wider variations.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/tracking_grants_for_research.sqlite')\n\nquery = '''\nSELECT\n    OT.organisation_type_description,\n    AVG(G.grant_amount) AS avg_grant_amount,\n    MIN(G.grant_amount) AS min_grant_amount,\n    MAX(G.grant_amount) AS max_grant_amount\nFROM Grants AS G\nJOIN Organisations AS O ON G.organisation_id = O.organisation_id\nJOIN Organisation_Types AS OT ON O.organisation_type = OT.organisation_type\nGROUP BY OT.organisation_type_description;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nerror_bars = alt.Chart(df).mark_errorbar().encode(\n    x=alt.X('min_grant_amount:Q', title='Grant Amount'),\n    x2='max_grant_amount:Q',\n    y=alt.Y('organisation_type_description:N', title='Organisation Type')\n)\n\npoints = alt.Chart(df).mark_point(filled=True, color='black').encode(\n    x=alt.X('avg_grant_amount:Q', title='Grant Amount'),\n    y=alt.Y('organisation_type_description:N', title='Organisation Type')\n)\n\nerror_bars + points"
    },
    {
        "type": "type_A",
        "db_id": "tracking_software_problems",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "error_bars_with_standard_deviation",
        "NLQ": "Can you create a chart showing the average number of days it takes to close different problem categories? I'd like to see the mean values as black dots with error bars showing the standard deviation for each category. Please put the problem categories on the y-axis and the number of days to close on the x-axis. Label the x-axis as \"Days to Close Problem\" and the y-axis as \"Problem Category\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/tracking_software_problems.sqlite')\n\nquery = '''\nSELECT\n    PCC.problem_category_description AS variety,\n    STRFTIME('%J', P.date_problem_closed) - STRFTIME('%J', P.date_problem_reported) AS yield\nFROM Problems AS P\nJOIN Problem_Log AS PL\n    ON P.problem_id = PL.problem_id\nJOIN Problem_Category_Codes AS PCC\n    ON PL.problem_category_code = PCC.problem_category_code\nWHERE\n    P.date_problem_closed IS NOT NULL AND P.date_problem_reported IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nerror_bars = alt.Chart(df).mark_errorbar(extent='stdev').encode(\n  x=alt.X('yield:Q', scale=alt.Scale(zero=False), title='Days to Close Problem'),\n  y=alt.Y('variety:N', title='Problem Category')\n)\n\npoints = alt.Chart(df).mark_point(filled=True, color='black').encode(\n  x=alt.X('mean(yield):Q', title='Days to Close Problem'),\n  y=alt.Y('variety:N'),\n)\n\nerror_bars + points"
    },
    {
        "type": "type_A",
        "db_id": "workshop_paper",
        "chart_category": "Interactive Charts",
        "chart_type": "selection_histogram",
        "NLQ": "Show me a bar chart comparing the number of accepted and rejected papers across different workshops. I want to be able to select specific workshops to see their acceptance results in a separate bar chart. Use color to highlight my selections and show acceptance results.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/workshop_paper.sqlite')\n\nquery = '''\nSELECT \n    w.Name AS Workshop_Name,\n    a.Result AS Acceptance_Result,\n    COUNT(*) AS Count\nFROM \n    Acceptance AS a\nJOIN \n    workshop AS w ON a.Workshop_ID = w.Workshop_ID\nGROUP BY \n    w.Name, a.Result\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df).mark_bar().encode(\n    x='Workshop_Name:N',\n    y='Count:Q',\n    color=alt.condition(brush, 'Acceptance_Result:N', alt.value('lightgray'))\n).add_params(\n    brush\n)\n\nbars = alt.Chart(df).mark_bar().encode(\n    y='Acceptance_Result:N',\n    color='Acceptance_Result:N',\n    x='sum(Count):Q'\n).transform_filter(\n    brush\n)\n\npoints & bars"
    },
    {
        "type": "type_A",
        "db_id": "world_1",
        "chart_category": "Interactive Charts",
        "chart_type": "simple_interactive_colored_scatter_plot",
        "NLQ": "Could you show me an interactive scatter plot that compares population and GNP for countries with more than 10 million people? I'd like to see the relationship between these two factors, with each country shown as a circle and colored by their continent so I can identify regional patterns.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/world_1.sqlite')\n\nquery = '''\nSELECT \n    country.Population, \n    country.GNP, \n    country.Continent\nFROM \n    country\nWHERE \n    country.Population > 10000000\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    x='Population:Q',\n    y='GNP:Q',\n    color='Continent:N'\n).interactive()\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "assets_maintenance",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_text_overlay",
        "NLQ": "Can you create a stacked bar chart showing the total number of faults for each asset, broken down by fault status? I'd like to see the assets listed on the y-axis and the total fault count on the x-axis. Please include the actual count numbers as white text on each colored section of the bars, and title the chart \"Fault Counts by Asset and Status\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/assets_maintenance.sqlite')\n\nquery = '''\nSELECT \n    A.asset_details AS asset,\n    FLP.fault_status AS status,\n    COUNT(FLP.fault_status) AS fault_count\nFROM \n    Fault_Log_Parts AS FLP\nJOIN \n    Fault_Log AS FL ON FLP.fault_log_entry_id = FL.fault_log_entry_id\nJOIN \n    Assets AS A ON FL.asset_id = A.asset_id\nGROUP BY \n    A.asset_details, FLP.fault_status\nORDER BY \n    A.asset_details, FLP.fault_status;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('sum(fault_count):Q', stack='zero', title='Total Faults'),\n    y=alt.Y('asset:N', title='Asset'),\n    color=alt.Color('status:N', title='Fault Status')\n)\n\ntext = alt.Chart(df).mark_text(dx=-15, dy=3, color='white').encode(\n    x=alt.X('sum(fault_count):Q', stack='zero'),\n    y=alt.Y('asset:N'),\n    detail='status:N',\n    text=alt.Text('sum(fault_count):Q', format='.0f')\n)\n\nchart = bars + text\nchart.properties(title=\"Fault Counts by Asset and Status\")"
    },
    {
        "type": "type_A",
        "db_id": "assets_maintenance",
        "chart_category": "Interactive Charts",
        "chart_type": "using_selection_interval_with_mark_area",
        "NLQ": "Can you create an interactive area chart showing the total number of faults logged each month? I'd like the chart to use a light steelblue color with some transparency. Make sure to label the x-axis as \"Month\" and the y-axis as \"Total Faults Logged\". I want to be able to select specific time periods on the chart, and when I do, have those selected areas highlighted in a darker steelblue color while keeping the rest of the chart visible in the background.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/assets_maintenance.sqlite')\nquery = '''\nSELECT \n    strftime('%Y-%m', fault_log_entry_datetime) AS month,\n    COUNT(fault_log_entry_id) AS total_faults\nFROM Fault_Log\nGROUP BY month\nORDER BY month\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).mark_area(\n    color='steelblue',\n    opacity=0.3\n).encode(\n    x=alt.X('month:T', title='Month'),\n    y=alt.Y('total_faults:Q', title='Total Faults Logged')\n)\nbrush = alt.selection_interval(encodings=['x'])\nbackground = base.add_params(brush)\nselected = base.transform_filter(brush).mark_area(color='steelblue')\nbackground + selected"
    },
    {
        "type": "type_A",
        "db_id": "body_builder",
        "chart_category": "Line Charts",
        "chart_type": "filled_step_chart",
        "NLQ": "Can you create an area chart showing the total weight lifted by each bodybuilder? I'd like to see their names on the x-axis and the total weight lifted on the y-axis, with the bodybuilders ordered by their birth dates. Please use a light blue color for the area and include step lines between each data point.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/body_builder.sqlite')\n\nquery = '''\nSELECT p.Name, bb.Total, p.Birth_Date\nFROM body_builder AS bb\nJOIN people AS p ON bb.People_ID = p.People_ID\nORDER BY p.Birth_Date\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_area(\n    color=\"lightblue\",\n    interpolate='step-after',\n    line=True\n).encode(\n    x=alt.X('Name:N', title='Bodybuilder Name'),\n    y=alt.Y('Total:Q', title='Total Weight Lifted')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "climbing",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_cumulative_sum",
        "NLQ": "Can you create a line chart showing the cumulative sum of mountain heights as we go through them in order of their Mountain IDs? I'd like to see how the total height adds up with each mountain, with Mountain IDs on the x-axis and the running total height on the y-axis. Make the chart about 600 pixels wide.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/climbing.sqlite')\n\nquery = '''\nSELECT Mountain_ID, Height\nFROM mountain\nORDER BY Mountain_ID;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, width=600).mark_line().transform_window(\n    sort=[{'field': 'Mountain_ID'}],\n    frame=[None, 0],\n    cumulative_height='sum(Height)'\n).encode(\n    x='Mountain_ID:O',\n    y='cumulative_height:Q'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "company_1",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_custom_order",
        "NLQ": "Can you show me a line chart with points that displays the trend in total hours worked across different projects? I'd like the projects ordered by their project number along the x-axis, with total hours worked on the y-axis. When I hover over points, I want to see tooltips showing the project name, total hours worked, and project number.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_1.sqlite')\n\nquery = '''\nSELECT \n    p.Pname AS Project_Name,\n    p.Pnumber AS Project_Number,\n    SUM(w.Hours) AS Total_Hours\nFROM \n    works_on AS w\nJOIN \n    project AS p ON w.Pno = p.Pnumber\nGROUP BY \n    p.Pnumber, p.Pname\nORDER BY \n    p.Pnumber\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    x=alt.X(\"Project_Number:O\").title(\"Project Number\"),\n    y=alt.Y(\"Total_Hours:Q\").title(\"Total Hours Worked\"),\n    order=\"Project_Number\",\n    tooltip=[\"Project_Name\", \"Total_Hours\", \"Project_Number\"]\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "company_office",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_datum",
        "NLQ": "Can you create a line chart showing how many companies moved into office locations each year? Please highlight the year 2022 with a cyan vertical line and show the average number of companies per year with a dashed horizontal line. I'd also like to see the exact values when I hover over each point.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nconn = sqlite3.connect('database/company_office.sqlite')\nquery = '''\nSELECT \n    move_in_year AS Year, \n    COUNT(company_id) AS Company_Count\nFROM Office_locations\nGROUP BY move_in_year\nORDER BY move_in_year\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\naverage_companies = df['Company_Count'].mean()\nlines = (\n    alt.Chart(df)\n    .mark_line()\n    .encode(\n        x=alt.X(\"Year:O\", title=\"Year\"),\n        y=alt.Y(\"Company_Count:Q\", title=\"Number of Companies\"),\n        tooltip=[\"Year\", \"Company_Count\"]\n    )\n)\nxrule = (\n    alt.Chart().mark_rule(color=\"cyan\", strokeWidth=2)\n    .encode(x=alt.datum(2022))\n)\nyrule = (\n    alt.Chart().mark_rule(strokeDash=[12, 6], size=2)\n    .encode(y=alt.datum(average_companies))\n)\nchart = lines + xrule + yrule\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "course_teach",
        "chart_category": "Distributions",
        "chart_type": "2d_histogram_heatmap",
        "NLQ": "Can you create a heatmap showing the relationship between grades and teacher ages? I'd like to see grades on the x-axis and teacher ages on the y-axis, both divided into about 10 equal bins. Use a greenblue color scheme where darker colors represent higher counts of teachers in each grade-age combination.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/course_teach.sqlite')\n\nquery = '''\nSELECT T1.Grade AS Grade, T3.Age AS Age\nFROM course_arrange AS T1\nJOIN teacher AS T3 ON T1.Teacher_ID = T3.Teacher_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_rect().encode(\n    alt.X('Grade:Q').bin(maxbins=10),\n    alt.Y('Age:Q').bin(maxbins=10),\n    alt.Color('count():Q').scale(scheme='greenblue')\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "course_teach",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_datum_for_color",
        "NLQ": "Can you show me how the average US Gross and Worldwide Gross compare across different IMDB Rating ranges? I'd like to see this as a line chart with separate colored lines for each type of gross.",
        "code": "import altair as alt\nfrom vega_datasets import data\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/course_teach.sqlite')\n\nquery = '''\nSELECT C.Course_ID as IMDB_Rating, T.Teacher_ID as US_Gross, CA.Grade as Worldwide_Gross\nFROM Course AS C\nJOIN course_arrange AS CA ON C.Course_ID = CA.Course_ID\nJOIN Teacher AS T ON CA.Teacher_ID = T.Teacher_ID;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nalt.Chart(df).mark_line().encode(\n    alt.X(\"IMDB_Rating\").bin(True),\n    alt.Y(alt.repeat(\"layer\"))\n        .aggregate(\"mean\")\n        .title(\"Mean of US and Worldwide Gross\"),\n    color=alt.datum(alt.repeat(\"layer\")),\n).repeat(\n    layer=[\"US_Gross\", \"Worldwide_Gross\"]\n)"
    },
    {
        "type": "type_A",
        "db_id": "cre_Doc_Control_Systems",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_datum_for_color",
        "NLQ": "Can you create a line chart showing how the average number of drafts for each document type has changed over the years? I'd like to see the years on the x-axis and the average draft count on the y-axis, with each document type shown as a separate colored line.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/cre_Doc_Control_Systems.sqlite')\n\nquery = '''\nSELECT \n    T1.document_type_code,\n    strftime('%Y', T2.receipt_date) AS year,\n    COUNT(T3.draft_number) AS draft_count\nFROM \n    Documents AS T2\nJOIN \n    Ref_Document_Types AS T1 ON T2.document_type_code = T1.document_type_code\nLEFT JOIN \n    Document_Drafts AS T3 ON T2.document_id = T3.document_id\nGROUP BY \n    T1.document_type_code, year\nORDER BY \n    year ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line().encode(\n    alt.X(\"year:N\", title=\"Year\"),\n    alt.Y(\"mean(draft_count):Q\", title=\"Average Number of Drafts\"),\n    color=alt.datum(\"document_type_code:N\")\n).repeat(\n    layer=[\"document_type_code\"]\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "cre_Doc_Control_Systems",
        "chart_category": "Distributions",
        "chart_type": "2d_histogram_scatter_plot",
        "NLQ": "Can you create a bubble chart showing how many drafts each document has based on the year it was received? I'd like to see receipt years on the x-axis and number of drafts grouped into bins on the y-axis. Make the size of each bubble represent how many documents fall into that particular combination of year and draft count. This should help me see if documents from certain years tend to have more drafts than others. Please use data from the Documents and Document_Drafts tables in the cre_Doc_Control_Systems database.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/cre_Doc_Control_Systems.sqlite')\n\nquery = '''\nSELECT \n    strftime('%Y', T1.receipt_date) AS receipt_year,\n    COUNT(T2.draft_number) AS draft_count\nFROM \n    Documents AS T1\nJOIN \n    Document_Drafts AS T2 ON T1.document_id = T2.document_id\nGROUP BY \n    receipt_year, T1.document_id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    alt.X('receipt_year:N').title('Receipt Year'),\n    alt.Y('draft_count:Q').bin().title('Number of Drafts'),\n    size='count()'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "cre_Doc_Template_Mgt",
        "chart_category": "Distributions",
        "chart_type": "2d_histogram_scatter_plot",
        "NLQ": "Can you create a 2D histogram that shows the relationship between document effective dates and paragraph counts? I'd like to see a bubble chart where the size of each circle represents how many documents fall into each bin. Group the effective dates from templates on the x-axis and paragraph counts on the y-axis, with larger bubbles showing where more documents are concentrated.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/cre_Doc_Template_Mgt.sqlite')\nquery = '''\nSELECT \n    T.Date_Effective_From AS Effective_Date,\n    COUNT(P.Paragraph_ID) AS Paragraph_Count\nFROM Templates AS T\nJOIN Documents AS D ON T.Template_ID = D.Template_ID\nJOIN Paragraphs AS P ON D.Document_ID = P.Document_ID\nGROUP BY T.Date_Effective_From\nORDER BY T.Date_Effective_From;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle().encode(\n    alt.X('Effective_Date:T').bin(),\n    alt.Y('Paragraph_Count:Q').bin(),\n    size='count()'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "customers_and_products_contacts",
        "chart_category": "Distributions",
        "chart_type": "distributions_and_medians_of_likert_scale_ratings",
        "NLQ": "Can you create a chart showing the distribution of product price ranges by product type? I'd like to see products grouped into 5 price categories from low to high, with bubble sizes showing the number of products in each category. Please include the median price range for each product type as a black tick mark, and add \"Low Range\" and \"High Range\" labels on the sides. Title it \"Product Price Range Distribution by Product Type\".",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/customers_and_products_contacts.sqlite')\n\nquery = \"\"\"\nSELECT\n    product_type_code,\n    CASE\n        WHEN product_price < 10000 THEN 1\n        WHEN product_price < 100000 THEN 2\n        WHEN product_price < 1000000 THEN 3\n        WHEN product_price < 10000000 THEN 4\n        ELSE 5\n    END AS price_range_rating\nFROM Products;\n\"\"\"\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nmedians_df = df.groupby('product_type_code')['price_range_rating'].median().reset_index()\nmedians_df.rename(columns={'product_type_code': 'name', 'price_range_rating': 'median'}, inplace=True)\nmedians_df['lo'] = 'Low Range'\nmedians_df['hi'] = 'High Range'\n\nvalues_df = pd.DataFrame()\nfor index, row in df.iterrows():\n    values_df = pd.concat([values_df, pd.DataFrame([{'name': row['product_type_code'], 'value': row['price_range_rating']}])])\n\ny_axis = alt.Y(\"name\").axis(\n    title=None,\n    offset=50,\n    labelFontWeight=\"bold\",\n    ticks=False,\n    grid=True,\n    domain=False,\n)\n\nbase = alt.Chart(\n    medians_df,\n).encode(y_axis)\n\nbubbles = (\n    alt.Chart(values_df)\n    .mark_circle(color=\"#6EB4FD\")\n    .encode(\n        alt.X(\n            \"value:Q\",\n        ).title(None),\n        y_axis,\n        alt.Size(\"count()\").legend(offset=75, title=\"Number of products\"),\n        tooltip=[alt.Tooltip(\"count()\").title(\"Number of products\")],\n    )\n)\n\nticks = base.mark_tick(color=\"black\").encode(\n    alt.X(\"median:Q\")\n    .axis(grid=False, values=[1, 2, 3, 4, 5], format=\".0f\")\n    .scale(domain=[0, 6]),\n)\n\ntexts_lo = base.mark_text(align=\"right\", x=-5).encode(text=\"lo\")\n\ntexts_hi = base.mark_text(align=\"left\", x=255).encode(text=\"hi\")\n\nchart = (bubbles + ticks + texts_lo + texts_hi).properties(\n    title=\"Product Price Range Distribution by Product Type\", width=300, height=200\n).configure_view(stroke=None)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "game_1",
        "chart_category": "Distributions",
        "chart_type": "quantile-quantile_plot",
        "NLQ": "Can you create a quantile-quantile plot comparing the distribution of hours played by students on sports scholarships versus those not on scholarships? I'd like to see the plots side by side with \"Hours Played\" on the y-axis and the uniform quantile on the x-axis. Please label the columns to indicate whether students are on scholarship or not.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/game_1.sqlite')\n\nquery = '''\nSELECT \n    S.OnScholarship,\n    PG.Hours_Played\nFROM \n    Plays_Games AS PG\nJOIN \n    SportsInfo AS S ON PG.StuID = S.StuID\nWHERE \n    S.OnScholarship IN ('Y', 'N')\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).transform_quantile(\n    'Hours_Played',\n    step=0.01,\n    as_=['p', 'v']\n).transform_calculate(\n    uniform='quantileUniform(datum.p)',\n    normal='quantileNormal(datum.p)'\n).mark_point().encode(\n    alt.Y('v:Q', title='Hours Played')\n)\n\nchart = base.encode(x='uniform:Q').facet(\n    column=alt.Column('OnScholarship:N', title='On Scholarship')\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "performance_attendance",
        "chart_category": "Scatter Plots",
        "chart_type": "simple_scatter_plot_with_labels",
        "NLQ": "Can you create a horizontal scatter plot showing attendance numbers for different performance locations? I'd like each point to have its location name displayed as a label to the right of the point.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/performance_attendance.sqlite')\n\nquery = '''\nSELECT Location, Attendance\nFROM performance\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\npoints = alt.Chart(df).mark_point().encode(\n    x='Attendance:Q',\n    y='Location:N'\n)\n\ntext = points.mark_text(\n    align='left',\n    baseline='middle',\n    dx=7\n).encode(\n    text='Location:N'\n)\n\npoints + text"
    },
    {
        "type": "type_A",
        "db_id": "perpetrator",
        "chart_category": "Scatter Plots",
        "chart_type": "simple_scatter_plot_with_labels",
        "NLQ": "Can you create a scatter plot showing the number of people killed versus the number injured in different locations? Please label each data point with its location name positioned slightly to the right of the point.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/perpetrator.sqlite')\nquery = '''\nSELECT Location, Killed, Injured\nFROM perpetrator\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\npoints = alt.Chart(df).mark_point().encode(\n    x='Killed:Q',\n    y='Injured:Q'\n)\n\ntext = points.mark_text(\n    align='left',\n    baseline='middle',\n    dx=7\n).encode(\n    text='Location'\n)\n\nchart = points + text\nchart"
    },
    {
        "type": "type_A",
        "db_id": "pilot_record",
        "chart_category": "Simple Charts",
        "chart_type": "simple_bar_chart",
        "NLQ": "Show me a simple bar chart of the total number of flights per year from the pilot records. Just display the year on the x-axis and the count of flights on the y-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/pilot_record.sqlite')\n\nquery = '''\nSELECT \n    SUBSTR(Date, 1, 4) AS Year,\n    COUNT(*) AS Total_Flights\nFROM pilot_record\nGROUP BY Year\nORDER BY Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Year:N',\n    y='Total_Flights:Q'\n)\n\nchart"
    },
    {
        "type": "type_A",
        "db_id": "products_for_hire",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_legend",
        "NLQ": "Can you create a bar chart showing the total amount paid for each payment type? Make the bars different colors using a colorful scheme, and let me click on the legend to highlight specific payment types. Title the chart \"Total Amount Paid by Payment Type\" with payment types on the x-axis and the payment amounts on the y-axis.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/products_for_hire.sqlite')\n\nquery = '''\nSELECT \n    payment_type_code AS Payment_Type,\n    SUM(amount_paid) AS Total_Amount_Paid\nFROM Payments\nGROUP BY payment_type_code\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nselection = alt.selection_point(fields=['Payment_Type'], bind='legend')\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Payment_Type:N', title='Payment Type'),\n    y=alt.Y('Total_Amount_Paid:Q', title='Total Amount Paid'),\n    color=alt.Color('Payment_Type:N', scale=alt.Scale(scheme='category20b')),\n    opacity=alt.condition(selection, alt.value(1), alt.value(0.2))\n).add_params(\n    selection\n).properties(\n    title='Total Amount Paid by Payment Type'\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "real_estate_properties",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_scatter_plot_and_linked_layered_histogram",
        "NLQ": "Can you create an interactive visualization showing the relationship between number of rooms and selling price for properties? I'd like a scatter plot with room count on the x-axis and agreed selling price on the y-axis, colored by property type. Next to it, show a histogram of room count distribution that updates when I click on different property types in the scatter plot. Include tooltips showing property type description, room count, and price when I hover over points. Use different colors for each property type, and make the unselected points light gray.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/real_estate_properties.sqlite')\n\nquery = '''\nSELECT \n    P.property_id,\n    P.property_type_code,\n    P.room_count,\n    P.agreed_selling_price,\n    RPT.property_type_description\nFROM \n    Properties AS P\nJOIN \n    Ref_Property_Types AS RPT\nON \n    P.property_type_code = RPT.property_type_code\nWHERE \n    P.room_count IS NOT NULL AND P.agreed_selling_price IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselector = alt.selection_point(fields=['property_type_code'])\n\ncolor_scale = alt.Scale(domain=df['property_type_code'].unique(), range=['#1FC3AA', '#8624F5', '#FFA726', '#2196F3'])\n\ncolor = (\n    alt.when(selector)\n    .then(alt.Color(\"property_type_code:N\").scale(color_scale))\n    .otherwise(alt.value(\"lightgray\"))\n)\n\nbase = alt.Chart(df).properties(\n    width=250,\n    height=250\n).add_params(selector)\n\npoints = base.mark_point(filled=True, size=200).encode(\n    alt.X('room_count:Q', title='Number of Rooms').scale(domain=[0, df['room_count'].max() + 1]),\n    alt.Y('agreed_selling_price:Q', title='Agreed Selling Price').scale(domain=[0, df['agreed_selling_price'].max() * 1.1]),\n    color=color,\n    tooltip=['property_type_description:N', 'room_count:Q', 'agreed_selling_price:Q']\n)\n\nhists = base.mark_bar(opacity=0.5, thickness=100).encode(\n    alt.X('room_count:Q')\n        .bin(step=1)\n        .scale(domain=[0, df['room_count'].max() + 1]),\n    alt.Y('count()', title='Count of Properties')\n        .stack(None)\n        .scale(domain=[0, df.groupby('room_count').size().max() * 1.1]),\n    alt.Color('property_type_code:N').scale(color_scale),\n    tooltip=['property_type_description:N', 'room_count:Q', 'count():Q']\n).transform_filter(\n    selector\n)\n\nchart = points | hists\nchart"
    },
    {
        "type": "type_A",
        "db_id": "roller_coaster",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_selection_of_columns",
        "NLQ": "Can you create a scatter plot showing the relationship between roller coaster height in feet and speed in mph? I'd like to see data points for different countries with the ability to select specific countries to highlight them while fading others to light gray. Please include tooltips showing the roller coaster name, height, speed, and country when I hover over points. Title the chart \"Roller Coaster Height vs Speed by Country\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/roller_coaster.sqlite')\n\nquery = '''\nSELECT rc.Name AS Roller_Coaster_Name, rc.Height, CAST(rc.Speed AS REAL) AS Speed, c.Name AS Country_Name\nFROM roller_coaster AS rc\nJOIN country AS c ON rc.Country_ID = c.Country_ID\nWHERE rc.Height IS NOT NULL AND rc.Speed IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselect_country = alt.selection_point(fields=['Country_Name'], name='select_country', value='Austria')\n\nscatter = alt.Chart(df, title='Roller Coaster Height vs Speed by Country').mark_circle().encode(\n    x=alt.X('Height:Q', title='Height (feet)'),\n    y=alt.Y('Speed:Q', title='Speed (mph)'),\n    color=alt.condition(select_country, 'Country_Name:N', alt.value('lightgray')),\n    tooltip=['Roller_Coaster_Name', 'Height', 'Speed', 'Country_Name']\n).add_params(\n    select_country\n)\n\nscatter"
    },
    {
        "type": "type_A",
        "db_id": "cre_Docs_and_Epenses",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_datum_for_color",
        "NLQ": "Can you create a line chart showing how the mean US Gross and Worldwide Gross values change across different IMDB Rating bins? I'd like to see both metrics on the same chart with different colored lines for each, and have the y-axis labeled \"Mean of US and Worldwide Gross.\"",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/cre_Docs_and_Epenses.sqlite')\n\nquery = \"\"\"\nSELECT\n    Document_ID as IMDB_Rating,\n    Project_ID * 100000 as US_Gross,\n    Project_ID * 150000 as Worldwide_Gross\nFROM Documents\nLIMIT 10;\n\"\"\"\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nalt.Chart(df).mark_line().encode(\n    alt.X(\"IMDB_Rating:Q\").bin(True),\n    alt.Y(alt.repeat(\"layer\"), type='quantitative')\n        .aggregate(\"mean\")\n        .title(\"Mean of US and Worldwide Gross\"),\n    color=alt.datum(alt.repeat(\"layer\")),\n).repeat(\n    layer=[\"US_Gross\", \"Worldwide_Gross\"]\n)"
    },
    {
        "type": "type_A",
        "db_id": "icfp_1",
        "chart_category": "Scatter Plots",
        "chart_type": "brushing_scatter_plot_to_show_data_on_a_table",
        "NLQ": "Can you create a scatter plot showing the number of papers published by institutions across different countries? I'd like to see countries listed along the y-axis and paper counts on the x-axis. When I select points on the chart, I want them to highlight in blue while the unselected points turn grey. Also, please show a table next to the chart that displays the institution name, country, and paper count for up to 14 of my selected institutions. Make sure each point has a tooltip showing the institution name, country, and paper count when I hover over it.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/icfp_1.sqlite')\n\nquery = '''\nSELECT \n    T1.name AS Institution,\n    T1.country AS Country,\n    COUNT(T4.paperID) AS PaperCount\nFROM \n    Inst AS T1\nJOIN \n    Authorship AS T4 ON T1.instID = T4.instID\nGROUP BY \n    T1.instID\nORDER BY \n    PaperCount DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df).mark_point().encode(\n    x='PaperCount:Q',\n    y='Country:N',\n    color=alt.condition(brush, alt.value(\"steelblue\"), alt.value(\"grey\")),\n    tooltip=['Institution:N', 'Country:N', 'PaperCount:Q']\n).add_params(brush)\n\nranked_text = alt.Chart(df).mark_text(align='right').encode(\n    y=alt.Y('row_number:O').axis(None)\n).transform_filter(\n    brush\n).transform_window(\n    row_number='row_number()'\n).transform_filter(\n    alt.datum.row_number < 15\n)\n\ninstitution = ranked_text.encode(text='Institution:N').properties(\n    title=alt.Title(text='Institution', align='right')\n)\ncountry = ranked_text.encode(text='Country:N').properties(\n    title=alt.Title(text='Country', align='right')\n)\npaper_count = ranked_text.encode(text='PaperCount:N').properties(\n    title=alt.Title(text='Papers', align='right')\n)\ntext = alt.hconcat(institution, country, paper_count)\n\nchart = alt.hconcat(\n    points,\n    text\n).resolve_legend(\n    color=\"independent\"\n).configure_view(\n    stroke=None\n)\n\nchart.show()"
    },
    {
        "type": "type_A",
        "db_id": "game_1",
        "chart_category": "Line Charts",
        "chart_type": "step_chart",
        "NLQ": "Can you create a step chart showing the total hours played for each video game type? I'd like to see the game types along the x-axis and the total hours played on the y-axis. Please title it \"Total Hours Played by Game Type\" and connect the data points with step-after lines rather than smooth curves.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/game_1.sqlite')\n\nquery = '''\nSELECT VG.GType AS Game_Type, SUM(PG.Hours_Played) AS Total_Hours_Played\nFROM Plays_Games AS PG\nJOIN Video_Games AS VG ON PG.GameID = VG.GameID\nGROUP BY VG.GType\nORDER BY Total_Hours_Played DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(interpolate='step-after').encode(\n    x=alt.X('Game_Type:N', title='Game Type'),\n    y=alt.Y('Total_Hours_Played:Q', title='Total Hours Played')\n).properties(\n    title='Total Hours Played by Game Type'\n)\n\nchart"
    }
]