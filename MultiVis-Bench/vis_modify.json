[
    {
        "type": "type_D",
        "db_id": "activity_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "calculate_residuals",
        "NLQ": "The chart is great for showing the age differences, but it's a little hard to read with all the activity names crammed together at the bottom. Could you rotate the x-axis labels to make them easier to read? Also, I think it would be clearer if we added thin grid lines for the y-axis. That would help me quickly see the exact age difference for each activity without having to guess. Finally, could you make the points a bit larger and hollow, but still fill them with the same colors we're using now? That might make the visualization stand out better.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/activity_1.sqlite')\n\nquery = '''\nSELECT \n    A.activity_name,\n    AVG(S.Age) AS Avg_Age\nFROM \n    Activity AS A\nJOIN \n    Participates_in AS P ON A.actid = P.actid\nJOIN \n    Student AS S ON P.stuid = S.StuID\nGROUP BY \n    A.actid, A.activity_name\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\noverall_avg_age = df['Avg_Age'].mean()\n\nchart = (\n    alt.Chart(df)\n    .mark_point(filled=False, size=50)\n    .transform_calculate(\n        Age_Delta=\"datum.Avg_Age - \" + str(overall_avg_age)\n    )\n    .encode(\n        x=alt.X(\"activity_name:N\", axis=alt.Axis(labelAngle=-90)).title(\n            \"Activity Name\"\n        ),\n        y=alt.Y(\"Age_Delta:Q\", axis=alt.Axis(grid=True)).title(\n            \"Age Delta (Years)\"\n        ),\n        color=alt.Color(\"Age_Delta:Q\")\n        .title(\"Age Delta\")\n        .scale(domainMid=0, scheme=\"redblue\"),\n        fill=alt.Fill(\"Age_Delta:Q\")\n        .title(\"Age Delta\")\n        .scale(domainMid=0, scheme=\"redblue\")\n    )\n    .properties(title=\"Difference in Average Age by Activity\")\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___calculate_residuals___activity_1.py"
    },
    {
        "type": "type_D",
        "db_id": "activity_1",
        "chart_category": "Interactive Charts",
        "chart_type": "simple_interactive_colored_scatter_plot",
        "NLQ": "This scatter plot is pretty useful for seeing how age relates to the number of activities students are in, but the colors for the majors are a bit hard to distinguish, especially some of the lighter shades. Could we maybe use a color scheme that's a bit more vibrant and easier to tell apart? Also, when I hover over the points, it would be really helpful to see the exact age, activity count, and major pop up in a little tooltip, instead of just guessing the values. And lastly, the points are a little small, especially where they overlap, would it be possible to make them just a bit bigger so they stand out more?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/activity_1.sqlite')\n\nquery = '''\nSELECT\n    S.Age,\n    COUNT(P.actid) AS ActivityCount,\n    S.Major\nFROM\n    Student AS S\nLEFT JOIN\n    Participates_in AS P ON S.StuID = P.stuid\nGROUP BY\n    S.StuID, S.Age, S.Major\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle(size=100).encode(\n    x='Age:Q',\n    y='ActivityCount:Q',\n    color=alt.Color('Major:N', scale=alt.Scale(scheme='viridis')),\n    tooltip=['Age', 'ActivityCount', 'Major']\n).interactive()\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___simple_interactive_colored_scatter_plot___activity_1.py"
    },
    {
        "type": "type_D",
        "db_id": "activity_1",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "simple_scatter_plot_with_errorbars",
        "NLQ": "Can you make the points bigger and blue instead of black? Also, I'd like to sort the activities by average age from lowest to highest. It would be helpful if I could hover over each point to see more details like the activity name, average age, minimum age, and maximum age.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/activity_1.sqlite')\n\nquery = '''\nSELECT\n    A.activity_name,\n    AVG(S.Age) AS average_age,\n    MIN(S.Age) AS min_age,\n    MAX(S.Age) AS max_age\nFROM\n    Participates_in AS P\nJOIN\n    Student AS S ON P.stuid = S.StuID\nJOIN\n    Activity AS A ON P.actid = A.actid\nGROUP BY\n    A.activity_name;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).transform_calculate(\n    ymin=\"datum.min_age\",\n    ymax=\"datum.max_age\"\n)\n\npoints = base.mark_point(\n    filled=True,\n    size=75,\n    color='blue'\n).encode(\n    alt.X('activity_name', sort=alt.EncodingSortField(field='average_age', order='ascending')),\n    alt.Y('average_age:Q', title='Average Age of Participants'),\n    tooltip=['activity_name', 'average_age', 'min_age', 'max_age']\n)\n\nerrorbars = base.mark_errorbar().encode(\n    x=\"activity_name\",\n    y=\"ymin:Q\",\n    y2=\"ymax:Q\"\n)\n\nchart = points + errorbars\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Uncertainties And Trends___simple_scatter_plot_with_errorbars___activity_1.py"
    },
    {
        "type": "type_D",
        "db_id": "aircraft",
        "chart_category": "Advanced Calculations",
        "chart_type": "calculate_residuals",
        "NLQ": "Can you make the points in my chart bigger and filled so they're easier to see? Also, I'd like to change the color scheme to use red and blue colors to better distinguish between positive and negative weight residuals. And could you add the average weight to the tooltips so I can compare each aircraft to the average when I hover over the points?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\n\nquery = '''\nSELECT \n    Aircraft, \n    CAST(REPLACE(Max_Gross_Weight, ',', '') AS REAL) AS Max_Gross_Weight,\n    CAST(REPLACE(Total_disk_area, ' ft²', '') AS REAL) AS Total_Disk_Area\nFROM \n    aircraft\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = (\n    alt.Chart(df)\n    .mark_point(size=100, filled=True)\n    .transform_joinaggregate(Average_Weight=\"mean(Max_Gross_Weight)\")\n    .transform_calculate(\n        Weight_Residual=\"datum.Max_Gross_Weight - datum.Average_Weight\",\n        Average_Weight=\"datum.Average_Weight\"\n    )\n    .encode(\n        x=alt.X(\"Total_Disk_Area:Q\").title(\"Total Disk Area (sq ft)\"),\n        y=alt.Y(\"Weight_Residual:Q\").title(\"Weight Residual (lbs)\"),\n        color=alt.Color(\n            \"Weight_Residual:Q\",\n            scale=alt.Scale(scheme=\"redblue\", domainMid=0)\n        ).title(\"Weight Residual\"),\n        tooltip=[\n            \"Aircraft:N\", \n            \"Max_Gross_Weight:Q\", \n            \"Total_Disk_Area:Q\", \n            \"Average_Weight:Q\"\n        ]\n    )\n    .properties(\n        title=\"Aircraft Weight Residuals vs. Total Disk Area\"\n    )\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___calculate_residuals___aircraft.py"
    },
    {
        "type": "type_D",
        "db_id": "aircraft",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart",
        "NLQ": "Can you improve this bar chart showing international and domestic passengers at each airport? I'd like to see the airports sorted by total passenger numbers from highest to lowest so I can quickly spot the busiest ones. Also, could you use blue and green colors to better distinguish between international and domestic passengers? It would be helpful to add tooltips so I can see the exact passenger numbers when I hover over each bar segment. And please add a title to the chart that says \"Total Passengers by Airport\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\n\nquery = '''\nSELECT \n    Airport_Name,\n    International_Passengers AS Passengers,\n    'International' AS Passenger_Type\nFROM \n    airport\nUNION ALL\nSELECT \n    Airport_Name,\n    Domestic_Passengers AS Passengers,\n    'Domestic' AS Passenger_Type\nFROM \n    airport\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ntotal_passengers_df = df.groupby('Airport_Name').sum().reset_index()\ntotal_passengers_df = total_passengers_df.sort_values('Passengers', ascending=False)\n\nairport_order = total_passengers_df['Airport_Name'].tolist()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Airport_Name:N', sort=airport_order),\n    y='sum(Passengers):Q',\n    color=alt.Color('Passenger_Type:N', scale=alt.Scale(range=['#1f77b4', '#2ca02c'])),\n    tooltip=['Airport_Name', 'Passenger_Type', 'sum(Passengers):Q']\n).properties(\n    title='Total Passengers by Airport'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___stacked_bar_chart___aircraft.py"
    },
    {
        "type": "type_D",
        "db_id": "aircraft",
        "chart_category": "Interactive Charts",
        "chart_type": "slider_cutoff",
        "NLQ": "Could we add tooltips to the bars so I can see the exact passenger numbers when I hover? Also, the blue and red colors are a bit harsh - maybe we could use light grey for the lower values and dark blue for the higher ones instead? And it would be helpful to have a title at the top that says something about airports and passenger numbers.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\nquery = '''\nSELECT Airport_Name, Total_Passengers\nFROM airport\nORDER BY Total_Passengers DESC\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nslider = alt.binding_range(min=0, max=int(df['Total_Passengers'].max()), step=100000)\ncutoff = alt.param(bind=slider, value=int(df['Total_Passengers'].median()))\npredicate = alt.datum.Total_Passengers < cutoff\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Total_Passengers:Q',\n    y=alt.Y('Airport_Name:N', sort='-x'),\n    color=alt.condition(predicate, alt.value(\"lightgrey\"), alt.value(\"darkblue\")),\n    tooltip=['Airport_Name', 'Total_Passengers']\n).add_params(\n    cutoff\n).properties(\n    title='Airports Sorted by Total Passenger Numbers'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___slider_cutoff___aircraft.py"
    },
    {
        "type": "type_D",
        "db_id": "aircraft",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "simple_scatter_plot_with_errorbars",
        "NLQ": "This chart is pretty helpful for seeing the relationship between disk area and max weight, but it's a bit plain looking. Could we maybe make it a bit more visually engaging? Perhaps use a blue color for the points and error bars, something a bit more modern and less stark than just black? Also, when I look at the chart, it's hard to know the exact weight and disk area for each point. It would be super useful if I could hover over a point and see those exact numbers pop up. Finally, just to get a clearer sense of the overall trend, would it be possible to add a red line of best fit to the chart? That would really help to visualize the general relationship between these two factors. Oh, and could you add a title to the chart that explains what we're looking at?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/aircraft.sqlite')\n\nquery = '''\nSELECT\n    CAST(REPLACE(Max_Gross_Weight, ',', '') AS REAL) AS Max_Gross_Weight,\n    CAST(REPLACE(Total_disk_area, ',', '') AS REAL) AS Total_Disk_Area\nFROM\n    aircraft\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['yerr'] = df['Max_Gross_Weight'] * 0.1\n\nbase = alt.Chart(df).transform_calculate(\n    ymin=\"datum.Max_Gross_Weight - datum.yerr\",\n    ymax=\"datum.Max_Gross_Weight + datum.yerr\"\n)\n\npoints = base.mark_point(\n    filled=True,\n    size=50,\n    color='steelblue'\n).encode(\n    x=alt.X('Total_Disk_Area:Q', title='Total Disk Area (sq ft)'),\n    y=alt.Y('Max_Gross_Weight:Q', title='Max Gross Weight (lb)', scale=alt.Scale(zero=False)),\n    tooltip=['Total_Disk_Area', 'Max_Gross_Weight']\n)\n\nerrorbars = base.mark_errorbar(\n    color='steelblue'\n).encode(\n    x=\"Total_Disk_Area:Q\",\n    y=\"ymin:Q\",\n    y2=\"ymax:Q\"\n)\n\nregression_line = points.transform_regression(\n    \"Total_Disk_Area\", \"Max_Gross_Weight\"\n).mark_line(color='red')\n\nchart = (points + errorbars + regression_line).properties(\n    title='Maximum Gross Weight vs. Total Disk Area of Aircraft'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Uncertainties And Trends___simple_scatter_plot_with_errorbars___aircraft.py"
    },
    {
        "type": "type_D",
        "db_id": "baseball_1",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "line_chart_with_confidence_interval_band",
        "NLQ": "This chart is really helpful for seeing the trend in home runs over time! It's a bit hard to read the years on the bottom though because they're all squished together and rotated. Could we maybe angle the year labels differently so they're easier to read? Also, the blue color is okay, but it kind of blends in with the confidence interval shading. Would it be possible to make the line a different color like green so it stands out more from the shaded area? Maybe make the line a bit thicker too? And finally, those gridlines are a little distracting, could we get rid of them altogether to make the line and the shaded area the main focus? Also, could you make the confidence interval band a lighter blue with some transparency?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/baseball_1.sqlite')\n\nquery = '''\nSELECT\n    year,\n    team_id,\n    SUM(hr) AS team_hr\nFROM batting\nWHERE hr IS NOT NULL\nGROUP BY year, team_id;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nline = alt.Chart(df).mark_line(color='darkgreen', size=3).encode(\n    x=alt.X('year:O', title='Year', axis=alt.Axis(labelAngle=-45)),\n    y=alt.Y('mean(team_hr):Q', title='Average Home Runs per Team')\n)\n\nband = alt.Chart(df).mark_errorband(extent='ci', color='lightsteelblue', opacity=0.5).encode(\n    x='year:O',\n    y=alt.Y('team_hr:Q')\n)\n\nchart = (band + line).properties(\n    title='Average Team Home Runs per Year with 95% Confidence Interval'\n).configure_axis(\n    grid=False\n)\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Uncertainties And Trends___line_chart_with_confidence_interval_band___baseball_1.py"
    },
    {
        "type": "type_D",
        "db_id": "browser_web",
        "chart_category": "Advanced Calculations",
        "chart_type": "gantt_chart",
        "NLQ": "Can you make this Gantt chart more visually appealing? I'd like each task bar to have a different color instead of them all being the same. Also, could you sort the tasks by their start time so it's easier to follow? Adding some gridlines on the x-axis would help me see the timing better. Oh, and please add a title to the chart - something like \"Web Client Accelerator Gantt Chart\" would be perfect.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/browser_web.sqlite')\n\nquery = '''\nSELECT id, name\nFROM Web_client_accelerator\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['start'] = df['id']\ndf['end'] = df['id'] + 2\ndf = df.rename(columns={'name': 'task'})\n\ndf = df.sort_values('start')\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('start:Q', axis=alt.Axis(grid=True)),\n    x2='end:Q',\n    y=alt.Y('task:N', sort='-x'),\n    color=alt.Color('task:N', scale=alt.Scale(scheme='category20'))\n).properties(\n    title='Web Client Accelerator Gantt Chart'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___gantt_chart___browser_web.py"
    },
    {
        "type": "type_D",
        "db_id": "company_employee",
        "chart_category": "Circular Plots",
        "chart_type": "radial_chart",
        "NLQ": "The radial chart is a great start, but it's a bit overwhelming with all those colors. Could we simplify the color scheme to something more visually appealing, perhaps focusing on different shades of a single color, like blue? It would make it easier to distinguish between the industries. Also, the labels are a bit hard to read. Is it possible to show the industry name directly on the chart instead of just showing the employee count numbers? Finally, could we arrange the colleges so the one with largest total number of employees is at the top, and then proceeding clockwise in descending order? That would allow a quick overview of which colleges contribute most to the workforce in these industries.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_employee.sqlite')\n\nquery = '''\nSELECT \n    p.Graduation_College AS College,\n    c.Industry AS Industry,\n    COUNT(*) AS Employee_Count\nFROM \n    employment AS e\nJOIN \n    people AS p ON e.People_ID = p.People_ID\nJOIN \n    company AS c ON e.Company_ID = c.Company_ID\nGROUP BY \n    p.Graduation_College, c.Industry\nORDER BY \n    p.Graduation_College, c.Industry;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ncollege_totals = df.groupby('College')['Employee_Count'].sum().reset_index()\ncollege_totals.columns = ['College', 'Total_Employees']\ndf = pd.merge(df, college_totals, on='College')\ndf = df.sort_values('Total_Employees', ascending=False)\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"Employee_Count:Q\").stack(True),\n    alt.Radius(\"Employee_Count\").scale(type=\"sqrt\", zero=True, rangeMin=20),\n    alt.Color(\"Industry:N\", scale=alt.Scale(scheme='blues')),\n    tooltip=[\"College:N\", \"Industry:N\", \"Employee_Count:Q\"],\n    order=alt.Order('Total_Employees', sort='descending')\n)\n\nc1 = base.mark_arc(innerRadius=20, stroke=\"#fff\")\nc2 = base.mark_text(radiusOffset=20, fontSize=10).encode(text=\"Industry:N\")\n\nchart = c1 + c2\nchart.properties(title=\"Employee Distribution by Graduation College and Industry\")",
        "original_code_path": "./vis_bench/vis_modify/Circular Plots___radial_chart___company_employee.py"
    },
    {
        "type": "type_D",
        "db_id": "concert_singer",
        "chart_category": "Advanced Calculations",
        "chart_type": "layered_chart_with_dual-axis",
        "NLQ": "Can you sort the stadium names by capacity from highest to lowest? Also, could you rotate the stadium names on the x-axis so they don't overlap? I'd like to add tooltips to show the stadium name and capacity when hovering over the bars, and also show the stadium name and average attendance when hovering over the line. Please add commas to the capacity numbers to make them easier to read. Could you add a title \"Stadium Capacity vs. Average Attendance\" to the chart? For the grid lines, can you remove the vertical ones but keep the horizontal ones, making them light gray and dashed? Finally, can you make the points on the average attendance line bigger and more visible?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/concert_singer.sqlite')\n\nquery = '''\nSELECT Name, Capacity, Average\nFROM stadium;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.X('Name:N', sort='-y').title('Stadium Name').axis(labelAngle=-45)\n)\n\nbars = base.mark_bar(color='#57A44C').encode(\n    alt.Y('Capacity:Q').axis(title='Stadium Capacity', titleColor='#57A44C', format=',d'),\n    tooltip=['Name', 'Capacity']\n)\n\nline = base.mark_line(color='#5276A7').encode(\n    alt.Y('Average:Q').axis(title='Average Attendance', titleColor='#5276A7'),\n)\n\npoints = base.mark_point(color='#5276A7', size=100, opacity=1).encode(\n    alt.Y('Average:Q'),\n    tooltip=['Name', 'Average']\n)\n\nchart = alt.layer(bars, line, points).resolve_scale(\n    y='independent'\n).properties(\n    title='Stadium Capacity vs. Average Attendance'\n).configure_axis(\n    gridColor='#ddd',\n    gridDash=[5, 5],\n    domainColor='black',\n).configure_axisX(\n    grid=False\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___layered_chart_with_dual-axis___concert_singer.py"
    },
    {
        "type": "type_D",
        "db_id": "cre_Theme_park",
        "chart_category": "Distributions",
        "chart_type": "boxplot_with_minmax_whiskers",
        "NLQ": "Can you make my boxplot easier to understand? I'd like to add tooltips so I can see the exact values for the median, quartiles, and min/max when I hover over each box. Also, could you change the color of the boxes to something green-blue like sea green? The x-axis labels look tilted and hard to read - can you make them straight up and down? And please add a title that explains what the chart is showing - something like \"Distribution of Visits by Age Group\" would be good.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/cre_Theme_park.sqlite')\n\nquery = '''\nSELECT CAST(Tourist_ID AS TEXT) AS age, Visit_ID AS people FROM Visits\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_boxplot(extent='min-max', color='seagreen').encode(\n    x=alt.X('age:O', axis=alt.Axis(labelAngle=0)),\n    y='people:Q',\n    tooltip=[\n        alt.Tooltip('min(people):Q', title='Min'),\n        alt.Tooltip('q1(people):Q', title='Q1'),\n        alt.Tooltip('median(people):Q', title='Median'),\n        alt.Tooltip('q3(people):Q', title='Q3'),\n        alt.Tooltip('max(people):Q', title='Max')\n    ]\n).properties(\n    title='Distribution of Visits by Age Group (Tourist ID)'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Distributions___boxplot_with_minmax_whiskers___cre_Theme_park.py"
    },
    {
        "type": "type_D",
        "db_id": "culture_company",
        "chart_category": "Distributions",
        "chart_type": "cumulative_count_chart",
        "NLQ": "I like how this chart visually tracks the cumulative growth of books over the years, but it feels a little dry right now. Could we use a more vibrant color palette, maybe shades of blue, to make it feel more alive? Also, I'd really love to see the exact cumulative count when I hover over the chart—right now, I can only estimate the value based on the y-axis. One more thing, the axis labels look fine, but I think a clearer title for the chart would make it more immediately understandable, like \"Cumulative Growth of Books Over the Years.\"",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/culture_company.sqlite')\nquery = '''\nSELECT Year, COUNT(*) AS Book_Count\nFROM book_club\nGROUP BY Year\nORDER BY Year\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ncumulative_chart = alt.Chart(df, title=\"Cumulative Growth of Books Over the Years\").transform_window(\n    cumulative_count=\"sum(Book_Count)\",\n    sort=[{\"field\": \"Year\"}],\n).mark_area(\n    color=alt.Gradient(\n        gradient='linear',\n        stops=[alt.GradientStop(color='lightblue', offset=0), alt.GradientStop(color='darkblue', offset=1)],\n        x1=1,\n        x2=1,\n        y1=1,\n        y2=0\n    ),\n    opacity=0.8\n).encode(\n    x=alt.X(\"Year:Q\", title=\"Year\"),\n    y=alt.Y(\"cumulative_count:Q\", title=\"Cumulative Count of Books\").stack(False),\n    tooltip=[alt.Tooltip(\"Year:Q\", title=\"Year\"), alt.Tooltip(\"cumulative_count:Q\", title=\"Cumulative Count\")]\n)\n\ncumulative_chart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___cumulative_count_chart___culture_company.py"
    },
    {
        "type": "type_D",
        "db_id": "customers_and_addresses",
        "chart_category": "Distributions",
        "chart_type": "cumulative_count_chart",
        "NLQ": "Can you change the colors in this cumulative order chart to something more muted and professional? Maybe use the viridis color scheme we have in other reports? Also, it would be helpful if I could see the exact numbers when I hover over the chart - could you add tooltips that show the date, order status, and cumulative count? That would make it easier to get specific figures during meetings.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customers_and_addresses.sqlite')\n\nquery = '''\nSELECT\n    order_status,\n    order_date\nFROM\n    Customer_Orders\nORDER BY\n    order_date ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['order_date'] = pd.to_datetime(df['order_date'])\n\ncumulative_chart_modified = alt.Chart(df).transform_window(\n    cumulative_count=\"count()\",\n    sort=[{\"field\": \"order_date\"}],\n    groupby=[\"order_status\"]\n).mark_area().encode(\n    x=alt.X(\"order_date:T\", title=\"Order Date\"),\n    y=alt.Y(\"cumulative_count:Q\", stack=False, title=\"Cumulative Count\"),\n    color=alt.Color(\"order_status:N\", title=\"Order Status\", scale=alt.Scale(scheme='viridis')),\n    tooltip=['order_date:T', 'order_status:N', 'cumulative_count:Q']\n).properties(\n    title=\"Cumulative Count of Orders by Status Over Time (Modified)\"\n)\n\ncumulative_chart_modified",
        "original_code_path": "./vis_bench/vis_modify/Distributions___cumulative_count_chart___customers_and_addresses.py"
    },
    {
        "type": "type_D",
        "db_id": "customers_and_addresses",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_last_value_labeled",
        "NLQ": "Could you make the line a stronger blue and add dots to each point on the line? Also, it would be great to have tooltips to see the exact numbers when hovering, and can we adjust the final label so it doesn't overlap the line?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customers_and_addresses.sqlite')\n\nquery = '''\nSELECT\n    DATE(order_date) AS order_date,\n    COUNT(order_id) AS total_orders\nFROM\n    Customer_Orders\nGROUP BY\n    DATE(order_date)\nORDER BY\n    order_date\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).encode(\n    x=alt.X(\"order_date:T\", title=\"Order Date\"),\n    y=alt.Y(\"total_orders:Q\", title=\"Total Orders\"),\n    tooltip=['order_date:T', 'total_orders:Q']\n)\n\nline = chart.mark_line(color='royalblue').encode()\n\npoints = chart.mark_circle(color='royalblue', size=50).encode()\n\nlabel = chart.encode(\n    x='max(order_date):T',\n    y=alt.Y('total_orders:Q').aggregate(argmax='order_date'),\n    text=alt.Text('total_orders:Q', format='.0f')\n)\n\ntext = label.mark_text(align='left', dx=4, dy=-10)\n\ncircle = label.mark_circle()\n\nfinal_chart = line + points + circle + text\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_last_value_labeled___customers_and_addresses.py"
    },
    {
        "type": "type_D",
        "db_id": "customers_and_invoices",
        "chart_category": "Distributions",
        "chart_type": "cumulative_count_chart",
        "NLQ": "Can you improve this chart by adding a title like \"Running Total of Orders Over Time\"? Also, I'd like to group the data by month instead of showing every single day on the x-axis. Could you add tooltips so I can see the exact month and cumulative order count when I hover over the chart? And instead of the plain area fill, can you make it a nice blue gradient from light to dark to better show the growth over time?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customers_and_invoices.sqlite')\n\nquery = '''\nSELECT \n    date_order_placed AS order_date\nFROM \n    Orders\nORDER BY \n    date_order_placed ASC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ncumulative_chart = alt.Chart(df).transform_timeunit(\n    timeUnit='yearmonth',\n    field='order_date',\n    as_='order_date_month'\n).transform_aggregate(\n    order_count='count()',\n    groupby=['order_date_month']\n).transform_window(\n    cumulative_count='sum(order_count)',\n    sort=[{'field': 'order_date_month'}]\n).mark_area(\n    color=alt.Gradient(gradient='linear', stops=[alt.GradientStop(color='lightblue', offset=0), alt.GradientStop(color='darkblue', offset=1)])\n).encode(\n    x=alt.X('order_date_month:T', title='Order Date (Aggregated by Month)'),\n    y=alt.Y('cumulative_count:Q', title='Cumulative Count of Orders').stack(False),\n    tooltip=[\n        alt.Tooltip('order_date_month:T', title='Order Month'),\n        alt.Tooltip('cumulative_count:Q', title='Cumulative Orders')\n    ]\n).properties(\n    title='Running Total of Orders Over Time'\n)\n\ncumulative_chart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___cumulative_count_chart___customers_and_invoices.py"
    },
    {
        "type": "type_D",
        "db_id": "customer_deliveries",
        "chart_category": "Distributions",
        "chart_type": "dot_dash_plot",
        "NLQ": "Can you make the points bigger so they're easier to see? Also, I'd like to see the delivery status shown with different shapes, not just colors. And could you sort the truck IDs in descending order to make them easier to follow?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/customer_deliveries.sqlite')\n\nquery = '''\nSELECT\n    CAST(strftime('%d', delivery_date) AS INTEGER) AS delivery_day_of_month,\n    truck_id,\n    delivery_status_code\nFROM Order_Deliveries\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\nbrush_status = alt.when(brush).then(\"delivery_status_code\")\nbase = alt.Chart(df).add_params(brush)\n\npoints = base.mark_point(size=100).encode(\n    x=alt.X('delivery_day_of_month:Q', title='Delivery Day of Month'),\n    y=alt.Y('truck_id:Q', title='Truck ID', sort='-y'),\n    color=brush_status.otherwise(alt.value(\"grey\")),\n    shape='delivery_status_code:N'\n)\n\ntick_axis = alt.Axis(labels=False, domain=False, ticks=False)\ntick_color = brush_status.otherwise(alt.value(\"lightgrey\"))\n\nx_ticks = base.mark_tick().encode(\n    alt.X('delivery_day_of_month:Q', axis=tick_axis),\n    alt.Y('delivery_status_code:N', title='Delivery Status', axis=tick_axis),\n    color=tick_color\n)\n\ny_ticks = base.mark_tick().encode(\n    alt.X('delivery_status_code:N', title='', axis=tick_axis),\n    alt.Y('truck_id:Q', axis=tick_axis, sort='-y'),\n    color=tick_color\n)\n\ny_ticks | (points & x_ticks)",
        "original_code_path": "./vis_bench/vis_modify/Distributions___dot_dash_plot___customer_deliveries.py"
    },
    {
        "type": "type_D",
        "db_id": "customer_deliveries",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_logarithmic_scale",
        "NLQ": "The customer growth chart is a great start, and the logarithmic scale really helps visualize the trend. However, I'm finding it a bit difficult to pinpoint the exact number of customers for each year. Could we add some kind of marker, like a circle, to each data point on the line? That would make it easier to see where each year falls. Also, it would be incredibly useful to have tooltips. When I hover over each point, I'd like to see the exact date and the cumulative customer count. Finally, could we make the x-axis labels easier to read by tilting them at a slight angle, say -45 degrees?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/customer_deliveries.sqlite')\n\nquery = '''\nSELECT\n    date(date_became_customer) AS year,\n    COUNT(customer_id) AS num_customers\nFROM Customers\nGROUP BY\n    year\nORDER BY\n    year;\n'''\n\ndf = pd.read_sql_query(query, conn)\ndf['cumulative_customers'] = df['num_customers'].cumsum()\nconn.close()\n\nline = alt.Chart(df).mark_line().encode(\n    x=alt.X('year:O', axis=alt.Axis(labelAngle=-45)),\n    y=alt.Y('cumulative_customers', scale=alt.Scale(type=\"log\"), title='Cumulative Number of Customers')\n)\n\npoints = alt.Chart(df).mark_circle(size=60).encode(\n    x=alt.X('year:O', axis=alt.Axis(labelAngle=-45)),\n    y=alt.Y('cumulative_customers', scale=alt.Scale(type=\"log\"), title='Cumulative Number of Customers'),\n    tooltip=['year', 'cumulative_customers']\n)\n\n(line + points).properties(\n    title='Customer Growth Over Time (Logarithmic Scale)'\n)",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_logarithmic_scale___customer_deliveries.py"
    },
    {
        "type": "type_D",
        "db_id": "debate",
        "chart_category": "Distributions",
        "chart_type": "dot_dash_plot",
        "NLQ": "Could we change the colors for the win/loss indicators to green for 'Yes' and red for 'No' instead of the current colors? I think that would make it easier to distinguish, especially when printed. Also, it would be really helpful if I could hover over each dot and see details like the venue name, audience number, and whether the affirmative side won or not.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/debate.sqlite')\n\nquery = '''\nSELECT T1.Venue, T1.Num_of_Audience, T2.If_Affirmative_Win\nFROM debate AS T1\nINNER JOIN debate_people AS T2\nON T1.Debate_ID = T2.Debate_ID;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['If_Affirmative_Win'] = df['If_Affirmative_Win'].map({'T': 'Yes', 'F': 'No'})\n\nbrush = alt.selection_interval()\nwin_condition = alt.condition(brush, alt.Color('If_Affirmative_Win:N', scale=alt.Scale(domain=['Yes', 'No'], range=['green', 'red'])), alt.value('lightgray'))\nbase = alt.Chart(df).add_params(brush)\n\npoints = base.mark_point().encode(\n    x=alt.X('Num_of_Audience:Q', title='Number of Audience'),\n    y=alt.Y('Venue:N', title='Venue'),\n    color=win_condition,\n    tooltip=['Venue', 'Num_of_Audience', 'If_Affirmative_Win']\n)\n\ntick_axis = alt.Axis(labels=False, domain=False, ticks=False)\ntick_color = win_condition\n\nx_ticks = base.mark_tick().encode(\n    alt.X('Num_of_Audience:Q', axis=tick_axis),\n    alt.Y('If_Affirmative_Win:N', title='', axis=tick_axis),\n    color=tick_color\n)\n\ny_ticks = base.mark_tick().encode(\n    alt.X('If_Affirmative_Win:N', title='', axis=tick_axis),\n    alt.Y('Venue:N', axis=tick_axis),\n    color=tick_color\n)\n\ny_ticks | (points & x_ticks)",
        "original_code_path": "./vis_bench/vis_modify/Distributions___dot_dash_plot___debate.py"
    },
    {
        "type": "type_D",
        "db_id": "decoration_competition",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_items",
        "NLQ": "This bar chart is really helpful for visualizing the college rankings. However, the blue color is a bit plain, could we make it more visually appealing with a nicer color scheme, maybe something like a blue-green palette? Also, it's a little difficult to read the exact average rank from the bar heights. It would be great if we could add tooltips so that when I hover over a bar, I can see the precise average rank for that college. Lastly, the college names on the x-axis are a bit crowded and overlapping. Could we rotate those labels a bit, perhaps at an angle, to make them easier to read?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/decoration_competition.sqlite')\n\nquery = '''\nSELECT \n    c.Name AS College_Name,\n    AVG(r.Rank_in_Round) AS Avg_Rank\nFROM \n    round AS r\nJOIN \n    member AS m ON r.Member_ID = m.Member_ID\nJOIN \n    college AS c ON m.College_ID = c.College_ID\nGROUP BY \n    c.College_ID\nORDER BY \n    Avg_Rank DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X('College_Name:N', sort='-y', axis=alt.Axis(labelAngle=-45)),\n    alt.Y('Avg_Rank:Q'),\n    alt.Color('Avg_Rank:Q', scale=alt.Scale(scheme='blues')),\n    tooltip=['College_Name', 'Avg_Rank']\n).transform_window(\n    rank='rank(Avg_Rank)',\n    sort=[alt.SortField('Avg_Rank', order='descending')]\n).transform_filter(\n    (alt.datum.rank < 6)\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___top_k_items___decoration_competition.py"
    },
    {
        "type": "type_D",
        "db_id": "department_management",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_letters",
        "NLQ": "Can you show me the top 10 states where department heads were born instead of all of them? I'd like to add a title like \"Number of Department Heads by Birth State (Top 10)\" and highlight California in orange while keeping the other bars blue. Could you also add the exact head count as text at the end of each bar? And can you rotate the state names on the y-axis to make them easier to read? Oh, and it would be helpful to see tooltips with the state name and head count when I hover over the bars.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/department_management.sqlite')\n\nquery = '''\nSELECT h.born_state AS state, COUNT(*) AS head_count\nFROM head AS h\nGROUP BY h.born_state\nORDER BY head_count DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_window(\n    rank='rank(head_count)',\n    sort=[alt.SortField('head_count', order='descending')]\n).transform_filter(\n    alt.datum.rank < 11\n).mark_bar().encode(\n    y=alt.Y('state:N', axis=alt.Axis(labelAngle=-45)).sort('-x'),\n    x='head_count:Q',\n    color=alt.condition(\n        alt.datum.state == 'California',\n        alt.value('orange'),\n        alt.value('#4c78a8')\n    ),\n    tooltip=['state', 'head_count']\n).properties(\n    title='Number of Department Heads by Birth State (Top 10)'\n)\n\ntext = alt.Chart(df).transform_window(\n    rank='rank(head_count)',\n    sort=[alt.SortField('head_count', order='descending')]\n).transform_filter(\n     alt.datum.rank < 11\n).mark_text(\n    align='left',\n    baseline='middle',\n    dx=3\n).encode(\n    y=alt.Y('state:N', axis=alt.Axis(labelAngle=-45)).sort('-x'),\n    x='head_count:Q',\n    text='head_count:Q',\n    color=alt.condition(\n        alt.datum.state == 'California',\n        alt.value('orange'),\n        alt.value('#4c78a8')\n    )\n)\n\nfinal_chart = chart + text\nfinal_chart.show()",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___top_k_letters___department_management.py"
    },
    {
        "type": "type_D",
        "db_id": "department_management",
        "chart_category": "Distributions",
        "chart_type": "empirical_cumulative_distribution_function",
        "NLQ": "Can you enhance this ECDF chart to make it more informative? I'd like to see the actual data points marked on the line, maybe as circles. Could you change the line color to blue? Also, I need to highlight the median - could you add a dashed red line at the 50% mark with a small label that says \"Median (50%)\"? And it would be really helpful if I could hover over the data points to see the exact budget amount in dollars and the cumulative proportion as a percentage.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/department_management.sqlite')\n\nquery = '''\nSELECT Budget_in_Billions\nFROM department\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\necdf_chart = alt.Chart(df).transform_window(\n    ecdf=\"cume_dist()\",\n    sort=[{\"field\": \"Budget_in_Billions\"}]\n).mark_line(interpolate='step-after', color='steelblue').encode(\n    x=alt.X(\"Budget_in_Billions:Q\", title=\"Budget in Billions\"),\n    y=alt.Y(\"ecdf:Q\", title=\"Cumulative Proportion\", scale=alt.Scale(domain=[0, 1]))\n).properties(\n    title=\"Empirical Cumulative Distribution of Department Budgets\",\n    width=600,\n    height=400\n)\n\npoints = alt.Chart(df).transform_window(\n    ecdf=\"cume_dist()\",\n    sort=[{\"field\": \"Budget_in_Billions\"}]\n).mark_circle(size=60, color='steelblue').encode(\n    x=\"Budget_in_Billions:Q\",\n    y=\"ecdf:Q\",\n    tooltip=[\n        alt.Tooltip(\"Budget_in_Billions:Q\", title=\"Budget (Billions)\", format=\"$.2f\"),\n        alt.Tooltip(\"ecdf:Q\", title=\"Cumulative Proportion\", format=\".2%\")\n    ]\n)\n\nmedian_line = alt.Chart(pd.DataFrame({'y': [0.5]})).mark_rule(\n    strokeDash=[6, 3],\n    color='red',\n    strokeWidth=1.5\n).encode(\n    y='y:Q'\n)\n\nmedian_text = alt.Chart(pd.DataFrame({'y': [0.5], 'x': [df['Budget_in_Billions'].max() * 0.95], 'text': ['Median (50%)']})).mark_text(\n    align='right',\n    baseline='bottom',\n    color='red',\n    fontSize=12\n).encode(\n    x='x:Q',\n    y='y:Q',\n    text='text:N'\n)\n\nfinal_chart = ecdf_chart + points + median_line + median_text\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___empirical_cumulative_distribution_function___department_management.py"
    },
    {
        "type": "type_D",
        "db_id": "department_store",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_letters",
        "NLQ": "Can you make this chart more interactive and visually appealing? I'd like to see tooltips when I hover over the bars so I can see the exact product name and purchase count. Also, instead of the plain bars, could you use a blue color gradient based on the purchase count? One more thing - can you add the actual purchase count numbers directly on the bars so I don't have to guess the values from the axis?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/department_store.sqlite')\n\nquery = '''\nSELECT \n    P.product_name AS product,\n    COUNT(OI.order_item_id) AS purchase_count\nFROM \n    Products AS P\nJOIN \n    Order_Items AS OI ON P.product_id = OI.product_id\nGROUP BY \n    P.product_name\nORDER BY \n    purchase_count DESC\nLIMIT 10;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    y=alt.Y('product:N', sort='-x', title='Product'),\n    x=alt.X('purchase_count:Q', title='Purchase Count'),\n    color=alt.Color('purchase_count:Q', scale=alt.Scale(scheme='blues'), title='Purchase Count'),\n    tooltip=[alt.Tooltip('product:N', title='Product'), alt.Tooltip('purchase_count:Q', title='Purchase Count')]\n).properties(\n    title='Top 10 Most Frequently Purchased Products'\n)\n\ntext = chart.mark_text(\n    align='left',\n    baseline='middle',\n    dx=5\n).encode(\n    text=alt.Text('purchase_count:Q')\n)\n\nfinal_chart = chart + text\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___top_k_letters___department_store.py"
    },
    {
        "type": "type_D",
        "db_id": "device",
        "chart_category": "Advanced Calculations",
        "chart_type": "top_k_letters",
        "NLQ": "Can you make this chart of top software platforms more colorful by using different colors for each platform instead of the default blue? Also, I'd like to see the actual count numbers displayed at the end of each bar. Could you add tooltips so I can see the exact platform name and count when I hover over a bar? And please add a title to the chart like \"Top Software Platforms by Device Count\" and label the x-axis as \"Number of Devices\" to make it clearer what we're looking at.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/device.sqlite')\n\nquery = '''\nSELECT Software_Platform, COUNT(*) AS Platform_Count\nFROM device\nGROUP BY Software_Platform\nORDER BY Platform_Count DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbase = alt.Chart(df).transform_window(\n    rank='rank(Platform_Count)',\n    sort=[alt.SortField('Platform_Count', order='descending')]\n).transform_filter(\n    alt.datum.rank < 6\n).encode(\n    y=alt.Y('Software_Platform:N').sort('-x'),\n    x=alt.X('Platform_Count:Q', title='Number of Devices')\n)\n\nbar = base.mark_bar().encode(\n    tooltip=[alt.Tooltip('Software_Platform:N', title='Platform'), alt.Tooltip('Platform_Count:Q', title='Count')],\n    color=alt.Color('Software_Platform:N', scale=alt.Scale(scheme='tableau10'), legend=None)\n)\n\ntext = base.mark_text(\n    align='left',\n    baseline='middle',\n    dx=3\n).encode(\n    text='Platform_Count:Q'\n)\n\n(bar + text).properties(\n    title='Top Software Platforms by Device Count'\n)",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___top_k_letters___device.py"
    },
    {
        "type": "type_D",
        "db_id": "device",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_point_markers",
        "NLQ": "Can you make the year labels at the bottom easier to read? They're a bit crammed together. Also, I'd like to highlight the peak years 2009 and 2014 by adding the exact number of shops opened right above those points on the chart.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/device.sqlite')\nquery = '''\nSELECT Open_Year, COUNT(Shop_ID) AS Shop_Count\nFROM shop\nGROUP BY Open_Year\nORDER BY Open_Year\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    x=alt.X('Open_Year:O', title='Year Opened', axis=alt.Axis(labelAngle=-45)),\n    y=alt.Y('Shop_Count:Q', title='Number of Shops Opened'),\n    tooltip=['Open_Year', 'Shop_Count']\n).properties(\n    title='Trend of Shop Openings Over Years'\n)\n\nlabel_data = df[df['Open_Year'].isin([2009, 2014])]\ntext_labels = alt.Chart(label_data).mark_text(\n    dy=-10,\n    fontWeight='bold'\n).encode(\n    x=alt.X('Open_Year:O'),\n    y=alt.Y('Shop_Count:Q'),\n    text=alt.Text('Shop_Count:Q', format='')\n)\n\nfinal_chart = chart + text_labels\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_point_markers___device.py"
    },
    {
        "type": "type_D",
        "db_id": "document_management",
        "chart_category": "Advanced Calculations",
        "chart_type": "waterfall_chart",
        "NLQ": "Can you change the color scheme of my waterfall chart to something easier on the eyes? The red for increasing sections is too strong - maybe use blues instead of red for increases while keeping the green for decreases. Also, could you add tooltips so I can see the exact access count when I hover over each bar? It would be helpful if the numbers in the tooltips had commas for better readability.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/document_management.sqlite')\n\nquery = '''\nSELECT\n    DS.document_structure_description,\n    SUM(D.access_count) AS total_access_count\nFROM Documents AS D\nJOIN Document_Structures AS DS\n    ON D.document_structure_code = DS.document_structure_code\nGROUP BY DS.document_structure_description\nORDER BY DS.document_structure_code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbegin_row = pd.DataFrame([{\"document_structure_description\": \"Begin\", \"total_access_count\": 0}])\nend_row = pd.DataFrame([{\"document_structure_description\": \"End\", \"total_access_count\": df['total_access_count'].sum()}])\ndf = pd.concat([begin_row, df, end_row], ignore_index=True)\n\namount = alt.datum.total_access_count\nlabel = alt.datum.document_structure_description\nwindow_lead_label = alt.datum.window_lead_label\nwindow_sum_amount = alt.datum.window_sum_amount\n\ncalc_prev_sum = alt.expr.if_(label == \"End\", 0, window_sum_amount - amount)\ncalc_amount = alt.expr.if_(label == \"End\", window_sum_amount, amount)\ncalc_text_amount = (\n    alt.expr.if_((label != \"Begin\") & (label != \"End\") & calc_amount > 0, \"+\", \"\")\n    + calc_amount\n)\n\nbase_chart = alt.Chart(df).transform_window(\n    window_sum_amount=\"sum(total_access_count)\",\n    window_lead_label=\"lead(document_structure_description)\",\n).transform_calculate(\n    calc_lead=alt.expr.if_((window_lead_label == None), label, window_lead_label),\n    calc_prev_sum=calc_prev_sum,\n    calc_amount=calc_amount,\n    calc_text_amount=calc_text_amount,\n    calc_center=(window_sum_amount + calc_prev_sum) / 2,\n    calc_sum_dec=alt.expr.if_(window_sum_amount < calc_prev_sum, window_sum_amount, \"\"),\n    calc_sum_inc=alt.expr.if_(window_sum_amount > calc_prev_sum, window_sum_amount, \"\"),\n).encode(\n    x=alt.X(\"document_structure_description:O\", axis=alt.Axis(title=\"Document Structure\", labelAngle=0), sort=None)\n)\n\ncolor_coding = (\n    alt.when((label == \"Begin\") | (label == \"End\"))\n    .then(alt.value(\"#878d96\"))\n    .when(calc_amount < 0)\n    .then(alt.value(\"#24a148\"))\n    .otherwise(alt.value(\"#4c78a8\"))\n)\n\nbar = base_chart.mark_bar(size=45).encode(\n    y=alt.Y(\"calc_prev_sum:Q\", title=\"Access Count\"),\n    y2=alt.Y2(\"window_sum_amount:Q\"),\n    color=color_coding,\n    tooltip=[\n        alt.Tooltip(\"document_structure_description:O\", title=\"Section\"),\n        alt.Tooltip(\"total_access_count:Q\", title=\"Access Count\", format=\",\"),\n    ]\n)\n\nrule = base_chart.mark_rule(xOffset=-22.5, x2Offset=22.5).encode(\n    y=\"window_sum_amount:Q\",\n    x2=\"calc_lead\",\n)\n\ntext_pos_values_top_of_bar = base_chart.mark_text(baseline=\"bottom\", dy=-4).encode(\n    text=alt.Text(\"calc_sum_inc:N\"),\n    y=\"calc_sum_inc:Q\",\n)\ntext_neg_values_bot_of_bar = base_chart.mark_text(baseline=\"top\", dy=4).encode(\n    text=alt.Text(\"calc_sum_dec:N\"),\n    y=\"calc_sum_dec:Q\",\n)\ntext_bar_values_mid_of_bar = base_chart.mark_text(baseline=\"middle\").encode(\n    text=alt.Text(\"calc_text_amount:N\"),\n    y=\"calc_center:Q\",\n    color=alt.value(\"white\"),\n)\n\nalt.layer(\n    bar,\n    rule,\n    text_pos_values_top_of_bar,\n    text_neg_values_bot_of_bar,\n    text_bar_values_mid_of_bar\n).properties(\n    width=800,\n    height=450\n)",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___waterfall_chart___document_management.py"
    },
    {
        "type": "type_D",
        "db_id": "document_management",
        "chart_category": "Distributions",
        "chart_type": "faceted_histogram",
        "NLQ": "Can you make this histogram more informative? I'd like to add a title like \"Distribution of Access Counts by Document Type\" and improve the axis labels. Also, could you color-code the bars based on document type instead of using gray for everything? It would be helpful to add tooltips so I can see the exact counts when I hover over each bar. And if possible, make the chart interactive so users can zoom in and pan around. Finally, can you add a way for people to download the chart?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/document_management.sqlite')\nquery = '''\nSELECT \n    document_type_code AS Document_Type,\n    access_count AS Access_Count\nFROM \n    Documents\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"Access_Count:Q\", bin=alt.Bin(maxbins=30), title='Access Count'),\n    y=alt.Y(\"count()\", title='Count'),\n    row=alt.Row(\"Document_Type:N\", title='Document Type'),\n    color=alt.Color(\"Document_Type:N\", legend=None)\n).properties(\n    title='Distribution of Access Counts by Document Type'\n).interactive()\n\nchart = chart.encode(\n    tooltip=[alt.Tooltip('Access_Count:Q', bin=alt.Bin(maxbins=30)),\n             alt.Tooltip('count():Q', title='Count')]\n)\n\nchart.save('output.html')\nchart.display(save_path='distribution.html')\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___faceted_histogram___document_management.py"
    },
    {
        "type": "type_D",
        "db_id": "dog_kennels",
        "chart_category": "Advanced Calculations",
        "chart_type": "waterfall_chart",
        "NLQ": "This waterfall chart is really helpful for understanding how our monthly treatment costs accumulate over time. However, the red and green colors are a little intense for me. Could we perhaps use a more calming color palette, maybe something with blues and oranges? Also, when I'm looking at the chart, it's a bit difficult to read the exact cost change for each month just by looking at the bars. Would it be possible to add tooltips so that when I hover over a bar, I can see the precise monthly cost value? Finally, it would be great if we could add a title to the chart, something like 'Monthly Treatment Cost Waterfall Chart', just to make it clear what it's showing at a glance. And maybe just 'Cost' for the y-axis label would be a bit cleaner.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/dog_kennels.sqlite')\n\nquery = '''\nSELECT\n    STRFTIME('%Y-%m', date_of_treatment) AS treatment_month,\n    SUM(cost_of_treatment) AS monthly_cost\nFROM Treatments\nGROUP BY treatment_month\nORDER BY treatment_month;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndata = []\ntotal_cost = 0\ndata.append({\"treatment_month\": \"Start\", \"amount\": 0})\n\nfor index, row in df.iterrows():\n    amount = row['monthly_cost']\n    total_cost += amount\n    data.append({\"treatment_month\": row['treatment_month'], \"amount\": amount})\n\ndata.append({\"treatment_month\": \"End\", \"amount\": 0})\n\nsource = pd.DataFrame(data)\n\namount = alt.datum.amount\ntreatment_month = alt.datum.treatment_month\nwindow_lead_treatment_month = alt.datum.window_lead_treatment_month\nwindow_sum_amount = alt.datum.window_sum_amount\n\ncalc_prev_sum = alt.expr.if_(treatment_month == \"End\", 0, window_sum_amount - amount)\ncalc_amount = alt.expr.if_(treatment_month == \"End\", window_sum_amount, amount)\ncalc_text_amount = (\n    alt.expr.if_((treatment_month != \"Start\") & (treatment_month != \"End\") & calc_amount > 0, \"+\", \"\")\n    + calc_amount\n)\n\nbase_chart = alt.Chart(source).transform_window(\n    window_sum_amount=\"sum(amount)\",\n    window_lead_treatment_month=\"lead(treatment_month)\",\n).transform_calculate(\n    calc_lead=alt.expr.if_((window_lead_treatment_month == None), treatment_month, window_lead_treatment_month),\n    calc_prev_sum=calc_prev_sum,\n    calc_amount=calc_amount,\n    calc_text_amount=calc_text_amount,\n    calc_center=(window_sum_amount + calc_prev_sum) / 2,\n    calc_sum_dec=alt.expr.if_(window_sum_amount < calc_prev_sum, window_sum_amount, \"\"),\n    calc_sum_inc=alt.expr.if_(window_sum_amount > calc_prev_sum, window_sum_amount, \"\"),\n).encode(\n    x=alt.X(\"treatment_month:O\", axis=alt.Axis(title=\"Months\", labelAngle=45), sort=None)\n)\n\ncolor_coding = (\n    alt.when((treatment_month == \"Start\") | (treatment_month == \"End\"))\n    .then(alt.value(\"#878d96\"))\n    .when(calc_amount < 0)\n    .then(alt.value(\"#f58518\"))\n    .otherwise(alt.value(\"#4c78a8\"))\n)\n\nbar = base_chart.mark_bar(size=45).encode(\n    y=alt.Y(\"calc_prev_sum:Q\", title=\"Cost\"),\n    y2=alt.Y2(\"window_sum_amount:Q\"),\n    color=color_coding,\n    tooltip=['treatment_month', 'amount']\n)\n\nrule = base_chart.mark_rule(xOffset=-22.5, x2Offset=22.5).encode(\n    y=\"window_sum_amount:Q\",\n    x2=\"calc_lead\",\n)\n\ntext_pos_values_top_of_bar = base_chart.mark_text(baseline=\"bottom\", dy=-4).encode(\n    text=alt.Text(\"calc_sum_inc:N\"),\n    y=\"calc_sum_inc:Q\",\n)\ntext_neg_values_bot_of_bar = base_chart.mark_text(baseline=\"top\", dy=4).encode(\n    text=alt.Text(\"calc_sum_dec:N\"),\n    y=\"calc_sum_dec:Q\",\n)\ntext_bar_values_mid_of_bar = base_chart.mark_text(baseline=\"middle\").encode(\n    text=alt.Text(\"calc_text_amount:N\"),\n    y=\"calc_center:Q\",\n    color=alt.value(\"white\"),\n)\n\nalt.layer(\n    bar,\n    rule,\n    text_pos_values_top_of_bar,\n    text_neg_values_bot_of_bar,\n    text_bar_values_mid_of_bar\n).properties(\n    width=800,\n    height=450,\n    title='Monthly Treatment Cost Waterfall Chart'\n)",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___waterfall_chart___dog_kennels.py"
    },
    {
        "type": "type_D",
        "db_id": "dorm_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "waterfall_chart",
        "NLQ": "I like the waterfall chart showing the student capacity across dormitories, but could you make it look nicer with blue colors instead of the red and green? Maybe use different shades of blue for the start and total bars, and a medium blue for the dorm bars. Also, can you add tooltips so I can see the exact capacity when I hover over each bar? And the title is a bit wordy - could you shorten it to something like \"Dormitory Capacity Waterfall\"?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/dorm_1.sqlite')\nquery = '''\nSELECT dorm_name, student_capacity\nFROM Dorm\nORDER BY student_capacity;\n'''\ndf_dorm = pd.read_sql_query(query, conn)\nconn.close()\n\ndata = []\ndata.append({\"label\": \"Start\", \"amount\": 0})\nfor index, row in df_dorm.iterrows():\n    data.append({\"label\": row['dorm_name'], \"amount\": row['student_capacity']})\ntotal_capacity = df_dorm['student_capacity'].sum()\ndata.append({\"label\": \"Total\", \"amount\": total_capacity})\n\nsource = pd.DataFrame(data)\namount = alt.datum.amount\nlabel = alt.datum.label\nwindow_lead_label = alt.datum.window_lead_label\nwindow_sum_amount = alt.datum.window_sum_amount\n\ncalc_prev_sum = alt.expr.if_(label == \"Total\", 0, window_sum_amount - amount)\ncalc_amount = alt.expr.if_(label == \"Total\", window_sum_amount, amount)\ncalc_text_amount = (\n    alt.expr.if_((label != \"Start\") & (label != \"Total\") & calc_amount > 0, \"+\", \"\")\n    + calc_amount\n)\n\nbase_chart = alt.Chart(source).transform_window(\n    window_sum_amount=\"sum(amount)\",\n    window_lead_label=\"lead(label)\",\n).transform_calculate(\n    calc_lead=alt.expr.if_((window_lead_label == None), label, window_lead_label),\n    calc_prev_sum=calc_prev_sum,\n    calc_amount=calc_amount,\n    calc_text_amount=calc_text_amount,\n    calc_center=(window_sum_amount + calc_prev_sum) / 2,\n    calc_sum_dec=alt.expr.if_(window_sum_amount < calc_prev_sum, window_sum_amount, \"\"),\n    calc_sum_inc=alt.expr.if_(window_sum_amount > calc_prev_sum, window_sum_amount, \"\"),\n).encode(\n    x=alt.X(\"label:O\", axis=alt.Axis(title=\"Dormitory\", labelAngle=45), sort=None)\n)\n\ncolor_coding = alt.Scale(\n    domain=[\"Start\", \"Total\"],\n    range=[\"#c6dbef\", \"#08306b\"],\n    type=\"ordinal\"\n)\n\nbar = base_chart.mark_bar(size=45).encode(\n    y=alt.Y(\"calc_prev_sum:Q\", title=\"Student Capacity\"),\n    y2=alt.Y2(\"window_sum_amount:Q\"),\n    color=alt.condition(\n        (label == \"Start\") | (label == \"Total\"),\n        alt.Color(\"label:N\", scale=color_coding),\n        alt.value(\"#4292c6\")\n    ),\n    tooltip=[alt.Tooltip(\"label:N\", title=\"Dormitory\"), alt.Tooltip(\"amount:Q\", title=\"Capacity\")]\n)\n\nrule = base_chart.mark_rule(xOffset=-22.5, x2Offset=22.5).encode(\n    y=\"window_sum_amount:Q\",\n    x2=\"calc_lead\",\n)\n\ntext_pos_values_top_of_bar = base_chart.mark_text(baseline=\"bottom\", dy=-4).encode(\n    text=alt.Text(\"calc_sum_inc:N\"),\n    y=\"calc_sum_inc:Q\",\n)\ntext_neg_values_bot_of_bar = base_chart.mark_text(baseline=\"top\", dy=4).encode(\n    text=alt.Text(\"calc_sum_dec:N\"),\n    y=\"calc_sum_dec:Q\",\n)\ntext_bar_values_mid_of_bar = base_chart.mark_text(baseline=\"middle\").encode(\n    text=alt.Text(\"calc_text_amount:N\"),\n    y=\"calc_center:Q\",\n    color=alt.value(\"white\"),\n)\n\nchart = alt.layer(\n    bar,\n    rule,\n    text_pos_values_top_of_bar,\n    text_neg_values_bot_of_bar,\n    text_bar_values_mid_of_bar\n).properties(\n    title='Dormitory Capacity Waterfall',\n    width=800,\n    height=450\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___waterfall_chart___dorm_1.py"
    },
    {
        "type": "type_D",
        "db_id": "dorm_1",
        "chart_category": "Distributions",
        "chart_type": "heat_lane_chart",
        "NLQ": "I like the overall layout of this chart, but there are a few things that could make it easier to read and more interactive. First, the colors are a little hard to interpret. Could we switch to a more sequential color scheme, like shades of blue, to clearly show increments in the number of students? Also, it would be really helpful to add a tooltip so I can hover over a bar and see the exact age range, dorm name, and the number of students for that section. Lastly, the title could be a bit clearer—maybe something like 'Age Distribution of Students Across Dorms' would better describe what the chart is showing.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/dorm_1.sqlite')\nquery = '''\nSELECT \n    Dorm.dorm_name AS dorm_name,\n    Dorm.student_capacity AS capacity,\n    Student.Age AS age\nFROM \n    Lives_in\nJOIN \n    Student ON Lives_in.stuid = Student.StuID\nJOIN \n    Dorm ON Lives_in.dormid = Dorm.dormid\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Age Distribution of Students Across Dorms\", height=100, width=400).encode(\n    alt.X(\"bin_Age_start:Q\")\n        .title(\"Student Age\")\n        .axis(grid=False),\n    alt.X2(\"bin_Age_end:Q\"),\n    alt.Y(\"dorm_name:N\").title(\"Dorm Name\"),\n    alt.Y2(\"y2\")\n).transform_bin(\n    [\"bin_Age_start\", \"bin_Age_end\"],\n    field='age'\n).transform_aggregate(\n    count='count()',\n    groupby=[\"bin_Age_start\", \"bin_Age_end\", \"dorm_name\"]\n).transform_bin(\n    [\"bin_count_start\", \"bin_count_end\"],\n    field='count'\n).transform_calculate(\n    y=\"datum.bin_count_end/2\",\n    y2=\"-datum.bin_count_end/2\"\n).transform_joinaggregate(\n    max_bin_count_end=\"max(bin_count_end)\"\n)\n\nlayer1 = chart.mark_bar(xOffset=1, x2Offset=-1, cornerRadius=3).encode(\n    alt.Color(\"max_bin_count_end:O\")\n        .title(\"Number of Students\")\n        .scale(scheme=\"blues\")\n).interactive()\n\nlayer2 = chart.mark_bar(xOffset=1, x2Offset=-1, yOffset=-3, y2Offset=3).encode(\n    alt.Color(\"bin_count_end:O\").title(\"Number of Students\")\n).interactive()\n\ninteractive_chart = (layer1 + layer2).encode(\n    tooltip=[\n        alt.Tooltip(\"bin_Age_start:Q\", title=\"Age Range Start\"),\n        alt.Tooltip(\"bin_Age_end:Q\", title=\"Age Range End\"),\n        alt.Tooltip(\"dorm_name:N\", title=\"Dorm Name\"),\n        alt.Tooltip(\"count:Q\", title=\"Number of Students\")\n    ]\n)\n\ninteractive_chart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___heat_lane_chart___dorm_1.py"
    },
    {
        "type": "type_D",
        "db_id": "driving_school",
        "chart_category": "Advanced Calculations",
        "chart_type": "wilkinson_dot_plot",
        "NLQ": "Can you make this dot plot wider? It feels a bit cramped. Also, could you add clearer tick marks on the price axis so I can better see the actual values? And it would be really helpful if I could hover over the dots to see the exact vehicle type and price.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/driving_school.sqlite')\n\nquery = '''\nSELECT V.vehicle_details AS vehicle_type, L.price\nFROM Lessons AS L\nJOIN Vehicles AS V ON L.vehicle_id = V.vehicle_id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, height=100, width=600).mark_circle(opacity=1).transform_window(\n    id='rank()',\n    groupby=['vehicle_type', 'price']\n).encode(\n    alt.X('price:Q', title='Lesson Price', axis=alt.Axis(tickCount=10, format='d')),\n    alt.Y('id:O').axis(None).sort('descending'),\n    alt.Color('vehicle_type:N', title='Vehicle Type'),\n    tooltip=['vehicle_type', 'price']\n).properties(\n    title='Distribution of Lesson Prices by Vehicle Type'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___wilkinson_dot_plot___driving_school.py"
    },
    {
        "type": "type_D",
        "db_id": "driving_school",
        "chart_category": "Distributions",
        "chart_type": "heat_lane_chart",
        "NLQ": "Can you change the color scheme from light teal blue to something in the orange-red range to make it easier to see differences between the bars? Also, could you add tooltips so I can see the exact price ranges and number of lessons when I hover over each bar? And one more thing - can you make the x-axis label more descriptive by changing it to \"Lesson Price (in Dollars)\" instead of just \"Lesson Price\"?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/driving_school.sqlite')\n\nquery = '''\nSELECT \n    Vehicles.vehicle_details AS vehicle_type, \n    Lessons.price AS lesson_price\nFROM \n    Lessons\nJOIN \n    Vehicles ON Lessons.vehicle_id = Vehicles.vehicle_id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Distribution of Lesson Prices by Vehicle Type\", height=100, width=300).encode(\n    alt.X(\n        \"bin_price_start:Q\",\n        title=\"Lesson Price (in Dollars)\",\n        axis=alt.Axis(grid=False)\n    ),\n    alt.X2(\"bin_price_end:Q\"),\n    alt.Y(\"vehicle_type:N\", title=\"Vehicle Type\"),\n    alt.Y2(\"y2\")\n).transform_bin(\n    [\"bin_price_start\", \"bin_price_end\"],\n    field='lesson_price',\n    bin=alt.Bin(maxbins=20)\n).transform_aggregate(\n    count='count()',\n    groupby=[\"vehicle_type\", \"bin_price_start\", \"bin_price_end\"]\n).transform_bin(\n    [\"bin_count_start\", \"bin_count_end\"],\n    field='count'\n).transform_calculate(\n    y=\"datum.bin_count_end/2\",\n    y2=\"-datum.bin_count_end/2\",\n).transform_joinaggregate(\n    max_bin_count_end=\"max(bin_count_end)\",\n    groupby=[\"vehicle_type\"]\n)\n\nlayer1 = chart.mark_bar(xOffset=1, x2Offset=-1, cornerRadius=3).encode(\n    alt.Color(\n        \"max_bin_count_end:O\",\n        title=\"Number of Lessons\",\n        scale=alt.Scale(scheme=\"orangered\")\n    )\n)\nlayer2 = chart.mark_bar(xOffset=1, x2Offset=-1, yOffset=-3, y2Offset=3).encode(\n    alt.Color(\n        \"bin_count_end:O\",\n        title=\"Number of Lessons\",\n        scale=alt.Scale(scheme=\"orangered\")\n    ),\n)\n\ninteractive_layer = (layer1 + layer2).encode(\n    tooltip=[\n        alt.Tooltip(\"vehicle_type:N\", title=\"Vehicle Type\"),\n        alt.Tooltip(\"bin_price_start:Q\", title=\"Price Range Start\", format=\".2f\"),\n        alt.Tooltip(\"bin_price_end:Q\", title=\"Price Range End\", format=\".2f\"),\n        alt.Tooltip(\"bin_count_end:Q\", title=\"Number of Lessons\"),\n    ]\n)\n\ninteractive_layer",
        "original_code_path": "./vis_bench/vis_modify/Distributions___heat_lane_chart___driving_school.py"
    },
    {
        "type": "type_D",
        "db_id": "election",
        "chart_category": "Advanced Calculations",
        "chart_type": "wilkinson_dot_plot",
        "NLQ": "The Wilkinson dot plot is a good start, but it's a little hard to quickly compare the delegate counts between parties. Could we add some color to differentiate the parties, maybe using a distinct color for each? That would make it visually pop a bit more. Also, right now, the dots are all stacked up, and it's tough to get a sense of the actual numbers. It would be really helpful if we could add a tooltip that shows the exact delegate count when I hover over the dots for each party. Finally, could we add a proper y-axis title to indicate that the dots represent individual delegates, even though we don't need the tick marks? Oh, and can you remove that black border around the chart? It would look cleaner without it.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/election.sqlite')\n\nquery = '''\nSELECT p.Party, COUNT(e.Delegate) AS Delegate_Count\nFROM election AS e\nJOIN party AS p ON e.Party = p.Party_ID\nGROUP BY p.Party\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_circle(opacity=1).transform_window(\n    id='rank()',\n    groupby=['Party']\n).encode(\n    alt.X('Party:N', title='Political Party'),\n    alt.Y('id:O', title='Delegates', axis=alt.Axis(ticks=False, labels=False, domain=False)),\n    color='Party:N',\n    tooltip=['Party', 'Delegate_Count']\n).configure_view(\n    stroke=None\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___wilkinson_dot_plot___election.py"
    },
    {
        "type": "type_D",
        "db_id": "election",
        "chart_category": "Distributions",
        "chart_type": "heat_lane_chart",
        "NLQ": "Can you change the color scheme from teal-blue to a red-yellow-blue gradient? I think it would make the population density differences stand out better. Also, could you add gridlines to the x-axis to make it easier to track the population ranges? And I'd like to rename the x-axis title from just \"Population\" to \"Population Range\" to be more descriptive. One more thing - it would be helpful if I could hover over the bars to see details like the zip code, county count, and the exact population range for each bar.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/election.sqlite')\n\nquery = '''\nSELECT Zip_code, Population\nFROM county\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df, title=\"Population Distribution by Zip Code\", height=100, width=300).encode(\n    alt.X(\"bin_Population_start:Q\",\n          title=\"Population Range\",\n          axis=alt.Axis(grid=True)),\n    alt.X2(\"bin_Population_end:Q\"),\n    alt.Y(\"Zip_code:N\").title(\"Zip Code\"),\n).transform_bin(\n    [\"bin_Population_start\", \"bin_Population_end\"],\n    field='Population',\n    bin=alt.Bin(maxbins=20)\n).transform_aggregate(\n    count='count()',\n    groupby=[\"Zip_code\", \"bin_Population_start\", \"bin_Population_end\"]\n).transform_calculate(\n    y_offset=\"datum.count / 2\",\n    y2_offset=\"-datum.count / 2\",\n).mark_bar(xOffset=1, x2Offset=-1, cornerRadius=3).encode(\n    alt.Color(\"count:Q\",\n              title=\"Number of Counties\",\n              scale=alt.Scale(scheme=\"redyellowblue\")),\n    tooltip=[\n        alt.Tooltip(\"Zip_code:N\", title=\"Zip Code\"),\n        alt.Tooltip(\"count:Q\", title=\"County Count\"),\n        alt.Tooltip(\"bin_Population_start:Q\", title=\"Population Start\"),\n        alt.Tooltip(\"bin_Population_end:Q\", title=\"Population End\"),\n    ]\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___heat_lane_chart___election.py"
    },
    {
        "type": "type_D",
        "db_id": "election_representative",
        "chart_category": "Advanced Calculations",
        "chart_type": "wilkinson_dot_plot",
        "NLQ": "Can you make this dot plot more visually appealing by adding different colors for each political party? Also, I'd like to see the total number of seats when I hover over the dots. The chart looks a bit cramped vertically - could you make it taller so the dots aren't so squished together?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/election_representative.sqlite')\n\nquery = '''\nSELECT r.Party, SUM(e.Seats) AS Total_Seats\nFROM election AS e\nJOIN representative AS r ON e.Representative_ID = r.Representative_ID\nGROUP BY r.Party\nORDER BY Total_Seats DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndot_data = []\nfor _, row in df.iterrows():\n    dot_data.extend([row['Party']] * int(row['Total_Seats']))\n\ndot_df = pd.DataFrame({'Party': dot_data})\n\nchart = alt.Chart(dot_df, height=300).mark_circle(opacity=1).transform_window(\n    id='rank()',\n    groupby=['Party']\n).encode(\n    alt.X('Party:N', title='Political Party'),\n    alt.Y('id:O').axis(None).sort('descending'),\n    color=alt.Color('Party:N', legend=None),\n    tooltip=[alt.Tooltip('Party:N', title='Party'), alt.Tooltip('count():Q', title='Total Seats')]\n).properties(\n    height=300\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___wilkinson_dot_plot___election_representative.py"
    },
    {
        "type": "type_D",
        "db_id": "employee_hire_evaluation",
        "chart_category": "Area Charts",
        "chart_type": "area_chart_with_gradient",
        "NLQ": "I really like the area chart you've put together because it gives a clear picture of how bonuses have been allocated over the years. However, I'd love it if we could make a couple of tweaks to better engage with the data. First off, could we brighten up the colors a little bit? The dark blue is nice, but maybe something that pops a bit more would help the data stand out. Also, I'd find it incredibly helpful if there were interactive tooltips. That way, I could hover over the chart and see the exact bonus figures for each year. It's always handy when you don't have to estimate the values just from the scale. Let me know if these are possible!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/employee_hire_evaluation.sqlite')\n\nquery = '''\nSELECT e.City, ev.Year_awarded, SUM(ev.Bonus) AS Total_Bonus\nFROM employee AS e\nJOIN evaluation AS ev ON e.Employee_ID = ev.Employee_ID\nWHERE e.City = 'Bristol'\nGROUP BY ev.Year_awarded\nORDER BY ev.Year_awarded\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_area(\n    line={'color': '#377eb8'},\n    color=alt.Gradient(\n        gradient='linear',\n        stops=[alt.GradientStop(color='#e7f0fa', offset=0),\n               alt.GradientStop(color='#377eb8', offset=1)],\n        x1=1,\n        x2=1,\n        y1=1,\n        y2=0\n    )\n).encode(\n    alt.X('Year_awarded:T', title='Year'),\n    alt.Y('Total_Bonus:Q', title='Total Bonus Awarded'),\n    tooltip=['Year_awarded:T', 'Total_Bonus:Q']\n).properties(\n    title='Total Bonuses Awarded Over Years for Employees from Bristol'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___area_chart_with_gradient___employee_hire_evaluation.py"
    },
    {
        "type": "type_D",
        "db_id": "entertainment_awards",
        "chart_category": "Area Charts",
        "chart_type": "area_chart_with_gradient",
        "NLQ": "Can you make this area chart more user-friendly? I'd like to add tooltips so I can see the exact values when I hover over each year. Also, could you change the x-axis title from \"Year\" to \"Festival Year\" to be more specific? And the dark blue gradient is a bit too intense - can you make it a lighter shade of blue? Finally, the chart feels a bit cramped - could you make it wider and taller so it's easier to read?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/entertainment_awards.sqlite')\n\nquery = '''\nSELECT Year, SUM(Num_of_Audience) AS Total_Audience\nFROM festival_detail\nWHERE Location = 'United States'\nGROUP BY Year\nORDER BY Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_area(\n    line={'color': 'darkblue'},\n    color=alt.Gradient(\n        gradient='linear',\n        stops=[alt.GradientStop(color='white', offset=0),\n               alt.GradientStop(color='#4a90e2', offset=1)],\n        x1=1,\n        x2=1,\n        y1=1,\n        y2=0\n    )\n).encode(\n    alt.X('Year:T', title='Festival Year'),\n    alt.Y('Total_Audience:Q', title='Total Number of Audiences'),\n    tooltip=[alt.Tooltip('Year:T', title='Festival Year'),\n             alt.Tooltip('Total_Audience:Q', title='Total Audience')]\n).properties(\n    width=600,\n    height=400\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___area_chart_with_gradient___entertainment_awards.py"
    },
    {
        "type": "type_D",
        "db_id": "entrepreneur",
        "chart_category": "Area Charts",
        "chart_type": "area_chart_with_gradient",
        "NLQ": "Can you change the color of the area chart from dark blue to teal? I think it would look better. Also, could you add tooltips so when I hover over the chart I can see the exact date of birth and the total money requested with proper dollar formatting?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/entrepreneur.sqlite')\n\nquery = '''\nSELECT \n    p.Date_of_Birth AS date,\n    e.Investor AS investor,\n    SUM(e.Money_Requested) AS total_money_requested\nFROM entrepreneur AS e\nJOIN people AS p ON e.People_ID = p.People_ID\nGROUP BY p.Date_of_Birth, e.Investor\nORDER BY p.Date_of_Birth\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_filter(\n    'datum.investor === \"Duncan Bannatyne\"'\n).mark_area(\n    line={'color': 'teal'},\n    color=alt.Gradient(\n        gradient='linear',\n        stops=[alt.GradientStop(color='white', offset=0),\n               alt.GradientStop(color='teal', offset=1)],\n        x1=1,\n        x2=1,\n        y1=1,\n        y2=0\n    )\n).encode(\n    alt.X('date:T', title='Date of Birth'),\n    alt.Y('total_money_requested:Q', title='Cumulative Money Requested'),\n    tooltip=[\n        alt.Tooltip('date:T', title='Date of Birth'),\n        alt.Tooltip('total_money_requested:Q', title='Total Money Requested', format='$,.0f')\n    ]\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___area_chart_with_gradient___entrepreneur.py"
    },
    {
        "type": "type_D",
        "db_id": "entrepreneur",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_varying_size",
        "NLQ": "Can you make this chart easier to read? The investor names on the x-axis are overlapping and hard to read - could you rotate them by 45 degrees? Also, can you make the y-axis title more descriptive by changing it to \"Total Money Requested (USD)\" instead of just \"Total_Money_Requested\"? It would also be helpful to see the exact amount when I hover over each point - could you add tooltips showing the investor name and the money amount formatted with commas and decimal places?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/entrepreneur.sqlite')\n\nquery = '''\nSELECT \n    Investor, \n    SUM(Money_Requested) AS Total_Money_Requested\nFROM \n    entrepreneur\nGROUP BY \n    Investor\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_trail().encode(\n    x=alt.X('Investor:N', axis=alt.Axis(labelAngle=-45)),\n    y=alt.Y('Total_Money_Requested:Q', title='Total Money Requested (USD)'),\n    size='Total_Money_Requested:Q',\n    tooltip=['Investor', alt.Tooltip('Total_Money_Requested:Q', format=',.2f')]\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_varying_size___entrepreneur.py"
    },
    {
        "type": "type_D",
        "db_id": "epinions_1",
        "chart_category": "Area Charts",
        "chart_type": "faceted_area_chart",
        "NLQ": "Can you make this chart look nicer with a better color scheme? Maybe try using the Viridis palette to help distinguish between users more clearly. Also, could you make the user names in the row headers stand out more by making them bold and larger? It would be really helpful if I could interact with the chart and see tooltips when I hover over different areas to get the exact rank and rating values. That way I can explore the data more easily.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/epinions_1.sqlite')\n\nquery = '''\nSELECT \n    ua.name AS user_name,\n    r.rank AS rank,\n    SUM(r.rating) AS total_rating\nFROM \n    review AS r\nJOIN \n    useracct AS ua ON r.u_id = ua.u_id\nGROUP BY \n    ua.name, r.rank\nORDER BY \n    ua.name, r.rank\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_area().encode(\n    x=alt.X(\"rank:Q\", title=\"Rank\"),\n    y=alt.Y(\"total_rating:Q\", title=\"Total Rating\"),\n    color=alt.Color(\n        \"user_name:N\", \n        title=\"User\",\n        scale=alt.Scale(scheme=\"viridis\")\n    ),\n    row=alt.Row(\n        \"user_name:N\", \n        title=\"User\",\n        sort=alt.EncodingSortField(field=\"total_rating\", op=\"sum\", order=\"descending\"),\n        header=alt.Header(labelFontSize=14, labelFontWeight='bold')\n    )\n).properties(\n    height=50,\n    width=400\n).interactive()\n\nchart = chart.encode(\n    tooltip=[\n        alt.Tooltip(\"rank:Q\", title=\"Rank\"),\n        alt.Tooltip(\"total_rating:Q\", title=\"Total Rating\"),\n        alt.Tooltip(\"user_name:N\", title=\"User\")\n    ]\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___faceted_area_chart___epinions_1.py"
    },
    {
        "type": "type_D",
        "db_id": "epinions_1",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_gradient_color",
        "NLQ": "Can you improve this histogram of trust scores? I'd prefer a blue color scheme instead of the pink-yellow-green one - it would be easier to read. Also, could you add tooltips so I can see the exact count and trust score when I hover over each bar? And please add a title like \"Distribution of Trust Scores\" so it's clear what the chart is showing.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/epinions_1.sqlite')\n\nquery = '''\nSELECT trust\nFROM trust\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"trust:Q\", bin=alt.Bin(maxbins=20), scale=alt.Scale(domain=[0, 10])),\n    alt.Y('count()'),\n    alt.Color(\"trust:Q\", bin=alt.Bin(maxbins=20), scale=alt.Scale(scheme='blues')),\n    tooltip=['count()', 'trust']\n).properties(\n    title='Distribution of Trust Scores'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Distributions___histogram_with_gradient_color___epinions_1.py"
    },
    {
        "type": "type_D",
        "db_id": "e_learning",
        "chart_category": "Area Charts",
        "chart_type": "faceted_area_chart",
        "NLQ": "Can you make this area chart easier to read? I'd like to see all subjects on one chart instead of separate rows, with thicker lines (about 2 points wide) and points added to make the trends more visible. Could you also make the chart bigger - maybe around 600 pixels wide and 300 pixels tall? And it would be helpful to add tooltips so I can see the exact month, subject, and number of students when I hover over the chart.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/e_learning.sqlite')\n\nquery = '''\nSELECT \n    Subjects.subject_name AS subject,\n    strftime('%Y-%m', Student_Course_Enrolment.date_of_completion) AS completion_month,\n    COUNT(Student_Course_Enrolment.student_id) AS student_count\nFROM \n    Student_Course_Enrolment\nJOIN \n    Courses ON Student_Course_Enrolment.course_id = Courses.course_id\nJOIN \n    Subjects ON Courses.subject_id = Subjects.subject_id\nWHERE \n    Student_Course_Enrolment.date_of_completion IS NOT NULL\nGROUP BY \n    Subjects.subject_name, completion_month\nORDER BY \n    Subjects.subject_name, completion_month;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_area(\n    line={'size': 2},\n    point=True\n).encode(\n    x=alt.X(\"completion_month:T\", title=\"Completion Month\"),\n    y=alt.Y(\"student_count:Q\", title=\"Number of Students\"),\n    color=alt.Color(\"subject:N\", title=\"Subject\"),\n    tooltip=['completion_month', 'subject', 'student_count']\n).properties(\n    height=300,\n    width=600\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___faceted_area_chart___e_learning.py"
    },
    {
        "type": "type_D",
        "db_id": "e_learning",
        "chart_category": "Line Charts",
        "chart_type": "multiple_series_line_chart",
        "NLQ": "This line chart is great for seeing the trends, but the lines are a bit thin and hard to follow, especially where they overlap. Could we make the lines thicker, maybe 2.5 points wide? Also, it would be really helpful to see markers on each data point – small circles would be perfect. That would make it easier to pinpoint the exact completion numbers for each month. Finally, the title is a bit long; could we shorten it to something like \"Monthly Course Completions by Subject\"? It's just a bit cleaner.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/e_learning.sqlite')\n\nquery = '''\nSELECT \n    Subjects.subject_name AS subject,\n    strftime('%Y-%m', Student_Course_Enrolment.date_of_completion) AS completion_month,\n    COUNT(Student_Course_Enrolment.registration_id) AS completions\nFROM \n    Student_Course_Enrolment\nJOIN \n    Courses ON Student_Course_Enrolment.course_id = Courses.course_id\nJOIN \n    Subjects ON Courses.subject_id = Subjects.subject_id\nWHERE \n    Student_Course_Enrolment.date_of_completion IS NOT NULL\nGROUP BY \n    Subjects.subject_name, completion_month\nORDER BY \n    completion_month ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(\n    strokeWidth=2.5\n).encode(\n    x=alt.X('completion_month:T', title='Completion Month'),\n    y=alt.Y('completions:Q', title='Number of Completions'),\n    color=alt.Color('subject:N', title='Subject')\n).properties(\n    title='Monthly Course Completions by Subject'\n)\n\npoints = alt.Chart(df).mark_circle(size=50).encode(\n    x=alt.X('completion_month:T', title='Completion Month'),\n    y=alt.Y('completions:Q', title='Number of Completions'),\n    color=alt.Color('subject:N', title='Subject')\n)\n\nfinal_chart = chart + points\nfinal_chart.show()",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___multiple_series_line_chart___e_learning.py"
    },
    {
        "type": "type_D",
        "db_id": "farm",
        "chart_category": "Area Charts",
        "chart_type": "horizon_graph",
        "NLQ": "Can you improve my horizon graph of cattle population? I'd like to see the two ranges in different colors - maybe blue for the first range and orange for the second. Could you add titles to each section so it's clear what ranges they represent? Also, can you make the year labels horizontal so they're easier to read? It would be helpful to have tooltips that show the exact values when I hover over the chart. And instead of stacking the charts vertically, could you place them side by side for easier comparison?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/farm.sqlite')\nquery = '''\nSELECT Year, Total_Cattle\nFROM farm\nORDER BY Year\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\narea1 = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.7,\n    color='blue'\n).encode(\n    alt.X('Year:O', title='Year').axis(labelAngle=0),\n    alt.Y('Total_Cattle:Q').scale(domain=[0, 5000]).title('Total Cattle (0-5000)'),\n    tooltip=['Year:O', 'Total_Cattle:Q']\n).properties(\n    width=500,\n    height=75,\n    title='Cattle Population (0-5000 range)'\n)\n\narea2 = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.7,\n    color='orange'\n).encode(\n    alt.X('Year:O', title='Year').axis(labelAngle=0),\n    alt.Y('ny:Q').scale(domain=[0, 5000]).title('Total Cattle (5000-10000)'),\n    tooltip=['Year:O', 'ny:Q']\n).transform_calculate(\n    \"ny\", alt.datum.Total_Cattle - 5000\n).properties(\n    width=500,\n    height=75,\n    title='Cattle Population (5000-10000 range)'\n)\n\nfinal_chart = area1 | area2\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___horizon_graph___farm.py"
    },
    {
        "type": "type_D",
        "db_id": "film_rank",
        "chart_category": "Area Charts",
        "chart_type": "horizon_graph",
        "NLQ": "Can you make this horizon graph more informative and visually appealing? I'd like to add tooltips so I can see the exact revenue numbers when I hover over each country. Also, could you use different colors for the top and bottom halves - maybe orange for the top half and blue for the bottom half? That would make it easier to tell them apart. And can you make sure the x-axis is clearly labeled as \"Country\" so it's obvious what we're looking at?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/film_rank.sqlite')\n\nquery = '''\nSELECT \n    m.Country AS Country,\n    SUM(f.Gross_in_dollar) AS Total_Gross\nFROM \n    film_market_estimation AS fme\nJOIN \n    film AS f ON fme.Film_ID = f.Film_ID\nJOIN \n    market AS m ON fme.Market_ID = m.Market_ID\nGROUP BY \n    m.Country\nORDER BY \n    Total_Gross DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ntop_half = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.6,\n    color='orange'\n).encode(\n    alt.X('Country:N', title='Country'),\n    alt.Y('Total_Gross:Q', \n          scale=alt.Scale(domain=[0, df['Total_Gross'].max() / 2]), \n          title='Gross Revenue (Top Half)'),\n    tooltip=[alt.Tooltip('Country:N', title='Country'),\n             alt.Tooltip('Total_Gross:Q', title='Total Gross Revenue')]\n).properties(\n    width=500,\n    height=75\n)\n\nbottom_half = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.6,\n    color='blue'\n).encode(\n    alt.X('Country:N', title='Country'),\n    alt.Y('ny:Q', \n          scale=alt.Scale(domain=[0, df['Total_Gross'].max() / 2]), \n          title='Gross Revenue (Bottom Half)'),\n    tooltip=[alt.Tooltip('Country:N', title='Country'),\n             alt.Tooltip('ny:Q', title='Adjusted Revenue (Bottom Half)')]\n).transform_calculate(\n    ny='datum.Total_Gross - ' + str(df['Total_Gross'].max() / 2)\n).properties(\n    width=500,\n    height=75\n)\n\ntop_half + bottom_half",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___horizon_graph___film_rank.py"
    },
    {
        "type": "type_D",
        "db_id": "flight_1",
        "chart_category": "Area Charts",
        "chart_type": "horizon_graph",
        "NLQ": "Can you make the horizon chart more visually distinct by using different colors for the two distance bands? Maybe use orange for flights under 5,000 miles and blue for those over 5,000 miles? Also, could you add tooltips so I can see the exact distance when I hover over each aircraft type?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/flight_1.sqlite')\n\nquery = '''\nSELECT \n    a.name AS aircraft_name,\n    SUM(f.distance) AS total_distance\nFROM \n    flight AS f\nJOIN \n    aircraft AS a ON f.aid = a.aid\nGROUP BY \n    a.name\nORDER BY \n    total_distance DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\narea_under_5000 = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.6,\n    color='orange'\n).encode(\n    alt.X('aircraft_name:N').title('Aircraft Type'),\n    alt.Y('total_distance:Q').scale(domain=[0, 5000]).title('Distance (miles)'),\n    tooltip=['aircraft_name', 'total_distance']\n).properties(\n    width=500,\n    height=75\n)\n\narea_over_5000 = alt.Chart(df).mark_area(\n    clip=True,\n    interpolate='monotone',\n    opacity=0.6,\n    color='blue'\n).encode(\n    alt.X('aircraft_name:N'),\n    alt.Y('adjusted_distance:Q').scale(domain=[0, 5000]),\n    tooltip=['aircraft_name', 'total_distance']\n).transform_calculate(\n    adjusted_distance=\"datum.total_distance - 5000\"\n)\n\nfinal_chart = area_under_5000 + area_over_5000\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___horizon_graph___flight_1.py"
    },
    {
        "type": "type_D",
        "db_id": "game_injury",
        "chart_category": "Area Charts",
        "chart_type": "normalized_stacked_area_chart",
        "NLQ": "This chart is really helpful for seeing the competition trends over time, thanks! However, I'm finding the colors a little bit muted and hard to tell apart, especially for some of the smaller competitions. Could we maybe use a more vibrant color palette to make them pop a bit more? Also, when I'm trying to compare the proportions between different seasons, it's a little difficult to read the exact values off the chart. Would it be possible to add tooltips so I can hover over each area and see the precise proportion of games for each competition in each season? And could you add some gridlines to help me better compare values across different seasons? That would make it much easier to get the details I need.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/game_injury.sqlite')\n\nquery = '''\nSELECT\n  Season,\n  Competition,\n  COUNT(id) AS game_count\nFROM game\nGROUP BY Season, Competition\nORDER BY Season, Competition\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nvibrant_colors = alt.Scale(scheme='category20c')\n\nchart = alt.Chart(df).mark_area().encode(\n    x=alt.X('Season:O', title='Season', axis=alt.Axis(grid=True)),\n    y=alt.Y('game_count:Q', stack='normalize', title='Proportion of Games', axis=alt.Axis(grid=True)),\n    color=alt.Color('Competition:N', scale=vibrant_colors),\n    tooltip=['Competition', 'Season', alt.Tooltip('game_count:Q', format=\".2f\", title='Game Count')]\n).properties(\n    title='Proportion of Game Competitions Over Seasons'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___normalized_stacked_area_chart___game_injury.py"
    },
    {
        "type": "type_D",
        "db_id": "gymnast",
        "chart_category": "Area Charts",
        "chart_type": "normalized_stacked_area_chart",
        "NLQ": "This is a really interesting way to visualize the gymnast scores! It's helpful to see the proportion of points from each event. However, the colors are a little bit muted and it's hard to distinguish between some of the events, especially in the middle. Could we use a more vibrant color palette with better contrast? Also, when I'm looking at a specific gymnast, it would be helpful to know the exact percentage each event contributes to their total score without having to guess. Could you add tooltips so that when I hover over each section, I can see the event name and the percentage of points for that event?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/gymnast.sqlite')\n\nquery = '''\nSELECT\n    Gymnast_ID,\n    Floor_Exercise_Points AS Floor,\n    Pommel_Horse_Points AS Pommel_Horse,\n    Rings_Points AS Rings,\n    Vault_Points AS Vault,\n    Parallel_Bars_Points AS Parallel_Bars,\n    Horizontal_Bar_Points AS Horizontal_Bar\nFROM\n    gymnast\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_long = df.melt(id_vars=['Gymnast_ID'],\n                  value_vars=['Floor', 'Pommel_Horse', 'Rings', 'Vault', 'Parallel_Bars', 'Horizontal_Bar'],\n                  var_name='Event', value_name='Points')\n\nchart = alt.Chart(df_long).mark_area().encode(\n    x=alt.X(\"Gymnast_ID:N\", title=\"Gymnast ID\"),\n    y=alt.Y(\"Points:Q\").stack(\"normalize\"),\n    color=alt.Color(\"Event:N\", scale=alt.Scale(scheme='category20c')),\n    tooltip=['Event', alt.Y('Points:Q', format='.1%')]\n).properties(\n    title=\"Normalized Distribution of Points Across Gymnastic Events\"\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Area Charts___normalized_stacked_area_chart___gymnast.py"
    },
    {
        "type": "type_D",
        "db_id": "gymnast",
        "chart_category": "Distributions",
        "chart_type": "repeated_density_estimates",
        "NLQ": "Could you add some color to these density plots to make each gymnastic event stand out better? It would also be helpful if I could hover over the curves to see more details about the scores and density values. And is there a way to align the y-axes across all events so I can compare the distributions more easily?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/gymnast.sqlite')\n\nquery = '''\nSELECT \n    Floor_Exercise_Points AS Floor,\n    Pommel_Horse_Points AS Pommel_Horse,\n    Rings_Points AS Rings,\n    Vault_Points AS Vault,\n    Parallel_Bars_Points AS Parallel_Bars,\n    Horizontal_Bar_Points AS Horizontal_Bar\nFROM gymnast\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nevent_colors = alt.Color('Event:N', legend=None, scale=alt.Scale(scheme='category20'))\n\nchart = alt.Chart(df).transform_fold(\n    [\"Floor\", \"Pommel_Horse\", \"Rings\", \"Vault\", \"Parallel_Bars\", \"Horizontal_Bar\"],\n    as_=[\"Event\", \"Score\"]\n).transform_density(\n    density=\"Score\",\n    bandwidth=0.1,\n    groupby=[\"Event\"],\n    extent=[8, 10]\n).mark_area().encode(\n    alt.X(\"value:Q\", title=\"Score\"),\n    alt.Y(\"density:Q\", title=\"Density\"),\n    alt.Row(\"Event:N\"),\n    color=event_colors,\n    tooltip=['Event:N', 'value:Q', 'density:Q']\n).properties(\n    width=300, height=50\n).resolve_scale(\n    y='shared'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Distributions___repeated_density_estimates___gymnast.py"
    },
    {
        "type": "type_D",
        "db_id": "insurance_and_eClaims",
        "chart_category": "Bar Charts",
        "chart_type": "bar_and_tick_chart",
        "NLQ": "Can you make the bars blue instead of the default color? Also, I'd like to sort the claim types from highest to lowest total claimed amount so it's easier to see which ones have the biggest claims. And could you add tooltips that show both the total claimed amount and average paid amount when I hover over the bars and ticks?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_and_eClaims.sqlite')\n\nquery = '''\nSELECT \n    Claim_Type_Code AS claim_type,\n    SUM(Amount_Claimed) AS total_claimed,\n    AVG(Amount_Piad) AS avg_paid\nFROM \n    Claim_Headers\nGROUP BY \n    Claim_Type_Code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf = df.sort_values(by='total_claimed', ascending=False)\n\nbar = alt.Chart(df).mark_bar(color='steelblue').encode(\n    x=alt.X('claim_type:N', title='Claim Type'),\n    y=alt.Y('total_claimed:Q', title='Total Amount Claimed'),\n    tooltip=['claim_type:N', alt.Tooltip('total_claimed:Q', title='Total Claimed'), alt.Tooltip('avg_paid:Q', title='Avg Paid')]\n).properties(\n    width=alt.Step(40)\n)\n\ntick = alt.Chart(df).mark_tick(\n    color='red',\n    thickness=2,\n    size=40 * 0.9\n).encode(\n    x=alt.X('claim_type:N', title='Claim Type'),\n    y=alt.Y('avg_paid:Q', title='Average Amount Paid'),\n    tooltip=['claim_type:N', alt.Tooltip('total_claimed:Q', title='Total Claimed'), alt.Tooltip('avg_paid:Q', title='Avg Paid')]\n)\n\nchart = bar + tick\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_and_tick_chart___insurance_and_eClaims.py"
    },
    {
        "type": "type_D",
        "db_id": "insurance_and_eClaims",
        "chart_category": "Distributions",
        "chart_type": "ridgeline_plot",
        "NLQ": "Can you improve this ridgeline plot by adding tooltips so I can see the exact claim status, amount, and density when I hover over the chart? Also, I'd prefer a blue color scheme instead of the current colors. And could you add a label for the density axis? Right now it's not clear what the y-axis represents.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_and_eClaims.sqlite')\nquery = '''\nSELECT Claim_Status_Code, Amount_Claimed\nFROM Claim_Headers\nWHERE Amount_Claimed IS NOT NULL\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nstep = 20\noverlap = 1\n\nchart = alt.Chart(df, height=step).transform_density(\n    'Amount_Claimed',\n    groupby=['Claim_Status_Code'],\n    as_=['Amount_Claimed', 'density'],\n    extent=[0, df['Amount_Claimed'].max()],\n    bandwidth=50\n).mark_area(\n    interpolate='monotone',\n    fillOpacity=0.8,\n    stroke='lightgray',\n    strokeWidth=0.5\n).encode(\n    alt.X('Amount_Claimed:Q', title='Claim Amount'),\n    alt.Y('density:Q').axis(alt.Axis(title='Density')).scale(range=[step, -step * overlap]),\n    alt.Fill('Claim_Status_Code:N').legend(None).scale(scheme='blues'),\n    tooltip=[\n        alt.Tooltip('Claim_Status_Code:N', title='Claim Status'),\n        alt.Tooltip('Amount_Claimed:Q', title='Claim Amount', format='.2f'),\n        alt.Tooltip('density:Q', title='Density', format='.4f')\n    ]\n).facet(\n    row=alt.Row('Claim_Status_Code:N').title(None).header(labelAngle=0, labelAlign='left')\n).properties(\n    title='Distribution of Claim Amounts by Claim Status',\n    bounds='flush'\n).configure_facet(\n    spacing=0\n).configure_view(\n    stroke=None\n).configure_title(\n    anchor='end'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Distributions___ridgeline_plot___insurance_and_eClaims.py"
    },
    {
        "type": "type_D",
        "db_id": "insurance_fnol",
        "chart_category": "Bar Charts",
        "chart_type": "bar_and_tick_chart",
        "NLQ": "Can you make the chart easier to read by rotating the customer name labels? Also, I'd like to see the actual values when I hover over the bars. Instead of those red tick marks for the average, could you add a horizontal red line across the chart? And it would be great if you could color the bars differently - maybe make the ones above average blue and the ones below average light gray so they stand out better.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_fnol.sqlite')\n\nquery = '''\nSELECT \n    C.Customer_name AS customer_name,\n    COUNT(Cl.Claim_ID) AS total_claims\nFROM \n    Customers AS C\nJOIN \n    First_Notification_of_Loss AS FNOL ON C.Customer_ID = FNOL.Customer_ID\nJOIN \n    Claims AS Cl ON FNOL.FNOL_ID = Cl.FNOL_ID\nGROUP BY \n    C.Customer_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\naverage_claims = df['total_claims'].mean()\ndf['average_claims'] = average_claims\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('customer_name:N', title='Customer Name', axis=alt.Axis(labelAngle=-90)),\n    y=alt.Y('total_claims:Q', title='Total Claims'),\n    tooltip=['customer_name', 'total_claims'],\n    color=alt.condition(\n        alt.datum.total_claims > average_claims,\n        alt.value('steelblue'),\n        alt.value('lightgray')\n    )\n).properties(\n    width=alt.Step(40)\n)\n\nrule = alt.Chart(df).mark_rule(color='red', size=2).encode(\n    y='average_claims:Q'\n)\n\nchart = bar + rule\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_and_tick_chart___insurance_fnol.py"
    },
    {
        "type": "type_D",
        "db_id": "insurance_policies",
        "chart_category": "Bar Charts",
        "chart_type": "bar_and_tick_chart",
        "NLQ": "Can you make this chart easier to read? I'd like to see tooltips when I hover over the bars and ticks so I can see the exact claimed and settled amounts. Also, could you sort the policy types by total amount claimed in descending order so I can quickly see which ones have the highest claims? And please add a title to the chart like \"Total Claimed vs Settled Amounts by Policy Type\" to make it clearer what I'm looking at.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_policies.sqlite')\n\nquery = '''\nSELECT\n    CP.Policy_Type_Code AS Policy_Type,\n    SUM(C.Amount_Claimed) AS Total_Amount_Claimed,\n    SUM(C.Amount_Settled) AS Total_Amount_Settled\nFROM\n    Customer_Policies AS CP\nJOIN\n    Claims AS C ON CP.Policy_ID = C.Policy_ID\nGROUP BY\n    CP.Policy_Type_Code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Policy_Type', sort='-y'),\n    y='Total_Amount_Claimed',\n    tooltip=['Policy_Type', 'Total_Amount_Claimed']\n).properties(\n    width=alt.Step(40),\n    title='Total Claimed vs Settled Amounts by Policy Type'\n)\n\ntick = alt.Chart(df).mark_tick(\n    color='red',\n    thickness=2,\n    size=40 * 0.9,\n).encode(\n    x=alt.X('Policy_Type', sort='-y'),\n    y='Total_Amount_Settled',\n    tooltip=['Policy_Type', 'Total_Amount_Settled']\n)\n\nchart = bar + tick\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_and_tick_chart___insurance_policies.py"
    },
    {
        "type": "type_D",
        "db_id": "insurance_policies",
        "chart_category": "Distributions",
        "chart_type": "scatter_plot_with_faceted_marginal_histograms",
        "NLQ": "Can you make this insurance claims visualization more interactive? I'd like to be able to click on policy types in any part of the chart to highlight them across all the views. Also, please make the scatter plot points bigger and add different shapes for each policy type. Could you use a nicer color scheme too - maybe something from the Tableau palette? And it would be helpful to see the exact values when I hover over points, so adding tooltips would be great. When I select certain policy types, can you make the unselected ones fade out a bit so the ones I'm interested in stand out more?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/insurance_policies.sqlite')\n\nquery = '''\nSELECT\n    C.Amount_Claimed,\n    C.Amount_Settled,\n    CP.Policy_Type_Code\nFROM\n    Claims AS C\nJOIN\n    Customer_Policies AS CP ON C.Policy_ID = CP.Policy_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselection = alt.selection_multi(\n    fields=['Policy_Type_Code'],\n    nearest=False,\n    empty='none'\n)\n\nbase = alt.Chart(df)\nbase_bar = base.mark_bar(opacity=0.3, binSpacing=0)\n\npoints = base.mark_circle(size=60).encode(\n    alt.X(\"Amount_Claimed:Q\"),\n    alt.Y(\"Amount_Settled:Q\"),\n    alt.Color(\"Policy_Type_Code:N\").scale(scheme='tableau20'),\n    alt.Shape(\"Policy_Type_Code:N\"),\n    tooltip=['Amount_Claimed', 'Amount_Settled', 'Policy_Type_Code'],\n    opacity=alt.condition(selection, alt.value(1), alt.value(0.2))\n).add_selection(selection)\n\ntop_hist = (\n    base_bar\n    .encode(\n        alt.X(\"Amount_Claimed:Q\")\n            .bin(maxbins=20).stack(None).title(\"\"),\n        alt.Y(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Policy_Type_Code:N\").scale(scheme='tableau20'),\n         opacity=alt.condition(selection, alt.value(1), alt.value(0.2))\n    )\n    .properties(height=60)\n    .add_selection(selection)\n)\n\nright_hist = (\n    base_bar\n    .encode(\n        alt.Y(\"Amount_Settled:Q\")\n            .bin(maxbins=20)\n            .stack(None)\n            .title(\"\"),\n        alt.X(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Policy_Type_Code:N\").scale(scheme='tableau20'),\n        opacity=alt.condition(selection, alt.value(1), alt.value(0.2))\n    )\n    .properties(width=60)\n    .add_selection(selection)\n)\n\nchart = top_hist & (points | right_hist)\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___scatter_plot_with_faceted_marginal_histograms___insurance_policies.py"
    },
    {
        "type": "type_D",
        "db_id": "journal_committee",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_highlighting_values_beyond_a_threshold",
        "NLQ": "Thanks for the sales visualization! It's looking good, but I have a few suggestions to make it more useful for our upcoming meeting. Could we sort the bars by sales values rather than alphabetically? That would help us quickly identify the highest and lowest performing themes. Also, it's a bit hard to read the exact sales numbers from the chart - would it be possible to add the actual values as labels on top of each bar? And one last thing - the current colors are fine, but I think a gradient color scheme based on sales amount might tell the story better than just the binary above/below threshold highlight. Maybe something that transitions from light to dark blue as sales increase? This would give us a better sense of the relative performance across all themes. Could we also add tooltips when hovering over the bars to show the theme and sales amount? And can we make the chart a bit larger and format the numbers with commas to make them easier to read?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/journal_committee.sqlite')\n\nquery = '''\nSELECT Theme, SUM(Sales) AS Total_Sales\nFROM journal\nGROUP BY Theme\nORDER BY Total_Sales DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nthreshold = 2000\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"Theme:N\", title=\"Journal Theme\", sort='-y'),\n    y=alt.Y(\"Total_Sales:Q\", title=\"Total Sales\", axis=alt.Axis(format=',d')),\n    color=alt.Color('Total_Sales:Q', title='Sales', scale=alt.Scale(scheme='blues'), legend=alt.Legend(title=\"Sales Volume\")),\n    tooltip=[\n        alt.Tooltip('Theme:N', title='Theme'),\n        alt.Tooltip('Total_Sales:Q', title='Sales', format=',d')\n    ]\n).properties(title=\"Journal Sales by Theme\")\n\ntext = alt.Chart(df).mark_text(\n    align='center',\n    baseline='bottom',\n    dy=-5\n).encode(\n    x=alt.X(\"Theme:N\", sort='-y'),\n    y=alt.Y(\"Total_Sales:Q\"),\n    text=alt.Text('Total_Sales:Q', format=',d')\n)\n\nrule = alt.Chart().mark_rule(\n    color=\"red\", \n    strokeDash=[3, 5],\n    strokeWidth=1.5\n).encode(\n    y=alt.Y(datum=threshold)\n)\n\nlabel = rule.mark_text(\n    x=5,\n    dy=-5,\n    align='left',\n    baseline='bottom',\n    color='red',\n    text=\"High Sales Threshold (2,000)\"\n)\n\nfinal_chart = (chart + text + rule + label).properties(\n    width=600,\n    height=400\n)\n\nfinal_chart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_highlighting_values_beyond_a_threshold___journal_committee.py"
    },
    {
        "type": "type_D",
        "db_id": "journal_committee",
        "chart_category": "Distributions",
        "chart_type": "scatter_plot_with_faceted_marginal_histograms",
        "NLQ": "The scatter plot with marginal histograms looks good, but could you make it more interactive? I'd like to be able to filter the data by selecting work types from the legend. Also, can you make the circles in the scatter plot bigger and add tooltips so I can see the exact age, sales, and work type when I hover over points? It would be great if I could select ranges on both histograms - like brushing over a section of the age histogram to filter the data in both the scatter plot and sales histogram, and vice versa. When I filter by work type or use the brushing tool, could you make the non-selected data points appear dimmed rather than disappearing completely?",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/journal_committee.sqlite')\n\nquery = '''\nSELECT\n    e.Age,\n    j.Sales,\n    jc.Work_Type\nFROM\n    editor AS e\nJOIN\n    journal_committee AS jc ON e.Editor_ID = jc.Editor_ID\nJOIN\n    journal AS j ON jc.Journal_ID = j.Journal_ID;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nwork_type_selection = alt.selection_multi(fields=['Work_Type'], bind='legend')\nage_brush = alt.selection_interval(encodings=['x'])\nsales_brush = alt.selection_interval(encodings=['y'])\n\nbase = alt.Chart(df)\nbase_bar = base.mark_bar(binSpacing=0)\nxscale = alt.Scale(domain=(df['Age'].min() - 1, df['Age'].max() + 1))\nyscale = alt.Scale(domain=(df['Sales'].min() - 100, df['Sales'].max() + 100))\n\npoints = base.mark_circle(size=60).encode(\n    alt.X(\"Age:Q\").scale(xscale),\n    alt.Y(\"Sales:Q\").scale(yscale),\n    alt.Color(\"Work_Type:N\"),\n    tooltip=['Age', 'Sales', 'Work_Type'],\n    opacity=alt.condition(work_type_selection, alt.value(1), alt.value(0.2))\n).transform_filter(\n    work_type_selection\n).transform_filter(\n    age_brush\n).transform_filter(\n    sales_brush\n).add_selection(work_type_selection)\n\ntop_hist = (\n    base_bar\n    .encode(\n        alt.X(\"Age:Q\")\n            .bin(maxbins=20, extent=xscale.domain).stack(None).title(\"\"),\n        alt.Y(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Work_Type:N\"),\n        opacity=alt.condition(work_type_selection, alt.value(1), alt.value(0.2))\n    )\n    .properties(height=60)\n    .add_selection(age_brush)\n    .transform_filter(work_type_selection)\n    .transform_filter(sales_brush)\n)\n\nright_hist = (\n    base_bar\n    .encode(\n        alt.Y(\"Sales:Q\")\n            .bin(maxbins=20, extent=yscale.domain)\n            .stack(None)\n            .title(\"\"),\n        alt.X(\"count()\").stack(None).title(\"\"),\n        alt.Color(\"Work_Type:N\"),\n        opacity=alt.condition(work_type_selection, alt.value(1), alt.value(0.2))\n    )\n    .properties(width=60)\n    .add_selection(sales_brush)\n    .transform_filter(work_type_selection)\n    .transform_filter(age_brush)\n)\n\nchart = top_hist & (points | right_hist)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___scatter_plot_with_faceted_marginal_histograms___journal_committee.py"
    },
    {
        "type": "type_D",
        "db_id": "journal_committee",
        "chart_category": "Scatter Plots",
        "chart_type": "bubble_plot",
        "NLQ": "I really like the overall structure of this bubble plot! It's interesting to see the relationship between editor age and journal sales. However, it would be great if you could make it a bit more visually clear. For instance, can we add some color to differentiate the bubbles by contribution count? Maybe a gradient where darker colors represent editors with more contributions? Also, it would be super helpful to have tooltips so I can quickly see the exact age, sales, and contribution count for each bubble when I hover over them. Lastly, could we add axis titles to make it immediately clear what the x and y-axes represent? That way someone who's new to the chart understands it at a glance. Oh, and could you make the chart a bit bigger and adjust the bubble sizes so they're easier to see? Thanks!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/journal_committee.sqlite')\n\nquery = '''\nSELECT \n    e.Age AS Editor_Age,\n    j.Sales AS Journal_Sales,\n    COUNT(jc.Work_Type) AS Contribution_Count\nFROM \n    editor AS e\nJOIN \n    journal_committee AS jc ON e.Editor_ID = jc.Editor_ID\nJOIN \n    journal AS j ON jc.Journal_ID = j.Journal_ID\nGROUP BY \n    e.Editor_ID, j.Journal_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point().encode(\n    x=alt.X('Editor_Age:Q', title='Editor Age'),\n    y=alt.Y('Journal_Sales:Q', title='Journal Sales'),\n    size=alt.Size('Contribution_Count:Q', title='Contribution Count', scale=alt.Scale(range=[10, 500])),\n    color=alt.Color('Contribution_Count:Q', scale=alt.Scale(scheme='viridis'), title='Contribution Count'),\n    tooltip=['Editor_Age:Q', 'Journal_Sales:Q', 'Contribution_Count:Q']\n).properties(\n    width=600,\n    height=400\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___bubble_plot___journal_committee.py"
    },
    {
        "type": "type_D",
        "db_id": "loan_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_highlighting_values_beyond_a_threshold",
        "NLQ": "Thanks for creating this branch customer visualization! It's giving me the basic information I need, but I'd like to make it more insightful for our quarterly meeting. Could you sort the branches by customer count so we can quickly identify our busiest locations? I'd also like to add tooltips so I can see the exact branch ID and customer numbers when hovering over each bar. Finally, the current color scheme is a bit harsh - maybe we could use a more gradual color gradient that transitions from blue to red based on customer count? That would give a better sense of which branches are approaching our threshold rather than just a binary above/below distinction. Also, could you make the threshold line dashed for better visibility and adjust the chart size to be a bit larger? And maybe simplify the title to just \"Branches by Customer Count\"?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/loan_1.sqlite')\n\nquery = '''\nSELECT branch_ID, bname, no_of_customers\nFROM bank\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nthreshold = 300\n\ncolor_scale = alt.Scale(\n    domain=[0, threshold, df['no_of_customers'].max()],\n    range=['steelblue', '#97b7d8', '#e45755']\n)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"bname:N\", title=\"Branch Name\", sort='-y'),\n    y=alt.Y(\"no_of_customers:Q\", title=\"Number of Customers\"),\n    color=alt.Color('no_of_customers:Q', scale=color_scale, legend=alt.Legend(title=\"Customer Count\")),\n    tooltip=[\n        alt.Tooltip('branch_ID:N', title='Branch ID'),\n        alt.Tooltip('bname:N', title='Branch Name'),\n        alt.Tooltip('no_of_customers:Q', title='Number of Customers')\n    ]\n)\n\nrule = alt.Chart(pd.DataFrame({'threshold': [threshold]})).mark_rule(\n    strokeDash=[4, 4],\n    color='#444444'\n).encode(\n    y='threshold:Q'\n)\n\nlabel = rule.mark_text(\n    align=\"right\",\n    baseline=\"bottom\",\n    dx=-5,\n    dy=-5,\n    color='#444444',\n    fontSize=12,\n    text=\"Threshold (300)\"\n)\n\nfinal_chart = (chart + rule + label).properties(\n    title=\"Branches by Customer Count\",\n    width=600,\n    height=400\n)\n\nfinal_chart = final_chart.configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n).configure_title(\n    fontSize=16,\n    font='Arial',\n    anchor='start'\n)\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_highlighting_values_beyond_a_threshold___loan_1.py"
    },
    {
        "type": "type_D",
        "db_id": "loan_1",
        "chart_category": "Scatter Plots",
        "chart_type": "faceted_scatter_plot",
        "NLQ": "Can you make this scatter plot easier to read by adding different colors for each state? That way I can quickly tell which points belong to which state without just relying on the row labels. Also, could you add tooltips so when I hover over a point I can see the exact number of loans, credit score, and state? And maybe add a title like \"No. of Loans vs Credit Score by State\" to make it clearer what the chart is showing?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/loan_1.sqlite')\n\nquery = '''\nSELECT c.no_of_loans, c.credit_score, c.state\nFROM customer AS c\nWHERE c.no_of_loans IS NOT NULL AND c.credit_score IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df, width=100, height=100).mark_point().encode(\n    x=\"no_of_loans:Q\",\n    y=\"credit_score:Q\",\n    color=\"state:N\",\n    tooltip=[\"no_of_loans:Q\", \"credit_score:Q\", \"state:N\"],\n    row=\"state:N\"\n).properties(\n    title=\"No. of Loans vs Credit Score by State\"\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___faceted_scatter_plot___loan_1.py"
    },
    {
        "type": "type_D",
        "db_id": "local_govt_in_alabama",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_bar",
        "NLQ": "I like this chart showing the number of events by organizer, but could you make a few improvements? First, can you make the organizer labels horizontal instead of angled so they're easier to read? Also, could you add tooltips so I can see the exact numbers when I hover over the bars? And one more thing - right now it's sorted by event count, but sometimes I need to find specific organizers by name. Could you create two versions of the chart - one sorted alphabetically by organizer name and another sorted by the number of events? That way I can view the data both ways depending on what I'm looking for.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_in_alabama.sqlite')\n\nquery = '''\nSELECT\n    P.Participant_Details AS Organizer,\n    COUNT(E.Event_ID) AS Event_Count\nFROM\n    Participants AS P\nJOIN\n    Participants_in_Events AS PE ON P.Participant_ID = PE.Participant_ID\nJOIN\n    Events AS E ON PE.Event_ID = E.Event_ID\nWHERE\n    P.Participant_Type_Code = 'Organizer'\nGROUP BY\n    P.Participant_Details\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nhighlighted_organizer = df.loc[df['Event_Count'].idxmax(), 'Organizer']\ncolor = alt.condition(alt.datum.Organizer == highlighted_organizer, alt.value(\"orange\"), alt.value(\"steelblue\"))\n\ndf_sorted_name = df.sort_values(by='Organizer')\n\nchart_name_sort = alt.Chart(df_sorted_name).mark_bar().encode(\n    x=alt.X('Organizer:N', title='Organizer', axis=alt.Axis(labelAngle=0)),\n    y=alt.Y('Event_Count:Q', title='Number of Events Organized'),\n    color=color,\n    tooltip=['Organizer', 'Event_Count']\n).properties(width=600, title=\"Number of Events Organized by Each Organizer (Sorted by Name)\")\n\nchart_count_sort = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Organizer:N', title='Organizer', axis=alt.Axis(labelAngle=0), sort='-y'),\n    y=alt.Y('Event_Count:Q', title='Number of Events Organized'),\n    color=color,\n    tooltip=['Organizer', 'Event_Count']\n).properties(width=600, title=\"Number of Events Organized by Each Organizer (Sorted by Event Count)\")\n\nfinal_chart = chart_name_sort & chart_count_sort\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_highlighted_bar___local_govt_in_alabama.py"
    },
    {
        "type": "type_D",
        "db_id": "local_govt_in_alabama",
        "chart_category": "Distributions",
        "chart_type": "stacked_density_estimates",
        "NLQ": "Can you make this chart more professional and easier to understand? I'd like to add a title at the top that says \"Distribution of Service IDs by Service Type Code\" and add labels to the axes - \"Service ID\" for the x-axis and \"Density\" for the y-axis. Also, could you change the colors to different shades of blue instead of the default colors? It would look more consistent that way. And can you make the chart interactive so when I hover over areas, I can see tooltips with the Service Type Code, value, and density? Oh, and please make the text a bit larger so it's easier to read.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/local_govt_in_alabama.sqlite')\nquery = '''\nSELECT Service_ID, Service_Type_Code\nFROM Services\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_fold(\n    fold=['Service_ID'],\n    as_=['Measurement_type', 'value']\n).transform_density(\n    density='value',\n    bandwidth=0.3,\n    groupby=['Service_Type_Code'],\n    extent=[0, 10],\n    counts=True,\n    steps=200\n).mark_area().encode(\n    alt.X('value:Q', title='Service ID'),\n    alt.Y('density:Q', title='Density').stack('zero'),\n    alt.Color('Service_Type_Code:N', scale=alt.Scale(scheme='blues'))\n).properties(\n    width=400,\n    height=100,\n    title='Distribution of Service IDs by Service Type Code'\n).configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n).interactive()\n\nchart = chart.encode(\n    tooltip=['Service_Type_Code:N', 'value:Q', 'density:Q']\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Distributions___stacked_density_estimates___local_govt_in_alabama.py"
    },
    {
        "type": "type_D",
        "db_id": "local_govt_in_alabama",
        "chart_category": "Scatter Plots",
        "chart_type": "faceted_scatter_plot",
        "NLQ": "Can you make this scatter plot more informative and visually appealing? I'd like to see tooltips when I hover over points to show the exact service type, participant count, and success rate. Also, could you make the points sized according to how many participants there are - bigger points for more participants? And instead of the default colors, can you use different shades of blue to represent the success rates? Finally, can you make the chart a bit larger so it's easier to read?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_in_alabama.sqlite')\n\nquery = '''\nSELECT \n    S.Service_Type_Code,\n    COUNT(DISTINCT P.Participant_ID) AS Participant_Count,\n    AVG(CASE WHEN E.Event_Details = 'Success' THEN 1 ELSE 0 END) * 100 AS Success_Rate\nFROM \n    Events AS E\nJOIN \n    Services AS S ON E.Service_ID = S.Service_ID\nJOIN \n    Participants_in_Events AS PE ON E.Event_ID = PE.Event_ID\nJOIN \n    Participants AS P ON PE.Participant_ID = P.Participant_ID\nGROUP BY \n    S.Service_Type_Code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point().encode(\n    x=alt.X(\"Participant_Count:Q\", title=\"Number of Participants\"),\n    y=alt.Y(\"Success_Rate:Q\", title=\"Success Rate (%)\"),\n    size=alt.Size(\"Participant_Count:Q\", title=\"Point Size: Number of Participants\", scale=alt.Scale(range=[50, 400])),\n    color=alt.Color(\"Success_Rate:Q\", title=\"Success Rate (%)\", scale=alt.Scale(scheme=\"blues\")),\n    tooltip=[\n        alt.Tooltip(\"Service_Type_Code:N\", title=\"Service Type\"),\n        alt.Tooltip(\"Participant_Count:Q\", title=\"Number of Participants\"),\n        alt.Tooltip(\"Success_Rate:Q\", title=\"Success Rate (%)\", format=\".2f\")\n    ]\n).properties(\n    width=250,\n    height=250\n).facet(\n    row=alt.Row(\"Service_Type_Code:N\", title=\"Service Type\")\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___faceted_scatter_plot___local_govt_in_alabama.py"
    },
    {
        "type": "type_D",
        "db_id": "local_govt_mdm",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_bar",
        "NLQ": "This chart is pretty good for showing the number of customers by source system, especially how 'Rent' is highlighted. But looking at it, it's a little hard to quickly see which source systems have the most customers. Could we maybe sort the bars from highest to lowest number of customers? That would make it easier to compare them at a glance. Also, it would be super helpful if we could actually see the number of customers right on top of each bar, instead of just guessing from the y-axis. That way, I wouldn't have to try and line up the bars with the numbers on the side. And one more thing - could we add some kind of popup information when I hover over a bar to see the exact details?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_mdm.sqlite')\n\nquery = '''\nSELECT \n    source_system_code, \n    COUNT(master_customer_id) AS customer_count\nFROM \n    CMI_Cross_References\nGROUP BY \n    source_system_code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf = df.sort_values('customer_count', ascending=False)\n\ncolor = alt.condition(\n    alt.datum.source_system_code == 'Rent',\n    alt.value('orange'),\n    alt.value('steelblue')\n)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('source_system_code:N', title='Source System', sort=None),\n    y=alt.Y('customer_count:Q', title='Number of Customers'),\n    color=color,\n    tooltip=['source_system_code', 'customer_count']\n).properties(\n    width=600,\n    title='Number of Customers by Source System'\n)\n\ntext = chart.mark_text(\n    align='center',\n    baseline='bottom',\n    dy=-5\n).encode(\n    text='customer_count:Q'\n)\n\nfinal_chart = (chart + text)\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_highlighted_bar___local_govt_mdm.py"
    },
    {
        "type": "type_D",
        "db_id": "manufactory_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_segment",
        "NLQ": "Can you flip this chart to make it horizontal? The manufacturer names would be easier to read that way. Also, could you change the red highlighting to a darker blue color? It's a bit too bright right now. And one more thing - could you add the actual revenue numbers as labels on each bar so I don't have to guess the exact values?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufactory_1.sqlite')\n\nquery = '''\nSELECT Name, Revenue\nFROM Manufacturers\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nthreshold_value = 100\nthreshold_df = pd.DataFrame([{\"threshold\": threshold_value}])\n\nbars = alt.Chart(df).mark_bar().encode(\n    y=alt.Y(\"Name:N\", title=\"Manufacturer\", sort=None),\n    x=alt.X(\"Revenue:Q\", title=\"Revenue (in billions)\")\n)\n\nhighlight = alt.Chart(df).mark_bar(color=\"#3070b3\").encode(\n    y=alt.Y(\"Name:N\", title=\"Manufacturer\", sort=None),\n    x=alt.X(\"baseline:Q\", title=\"Revenue (in billions)\"),\n    x2=alt.X2(\"Revenue:Q\")\n).transform_filter(\n    alt.datum.Revenue > threshold_value\n).transform_calculate(\n    baseline=f\"{threshold_value}\"\n)\n\nrule = alt.Chart(threshold_df).mark_rule(color=\"black\", strokeDash=[3, 5]).encode(\n    x=\"threshold:Q\"\n)\n\ntext = bars.mark_text(\n    align='left',\n    baseline='middle',\n    dx=3\n).encode(\n    text='Revenue:Q'\n)\n\nchart = (bars + highlight + rule + text).properties(width=400, title=\"Manufacturer Revenue with Highlighted Threshold\")\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_highlighted_segment___manufactory_1.py"
    },
    {
        "type": "type_D",
        "db_id": "manufactory_1",
        "chart_category": "Scatter Plots",
        "chart_type": "multifeature_scatter_plot",
        "NLQ": "Can you make this scatter plot easier to read? I'd like to add some transparency to the circles so I can see where they overlap better. Also, could you add tooltips so I can see the exact revenue, average price, product count, and headquarter when I hover over each circle? The x-axis label \"Manufacturer Revenue\" is a bit long - can you just call it \"Revenue\"? I'd also like to be able to zoom and pan around the chart to focus on specific areas. One more thing - could you make it so I can click on the legend to filter by headquarter location?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufactory_1.sqlite')\n\nquery = '''\nSELECT \n    M.Revenue AS Revenue,\n    AVG(P.Price) AS AvgProductPrice,\n    COUNT(P.Code) AS ProductCount,\n    M.Headquarter AS Headquarter\nFROM \n    Manufacturers AS M\nJOIN \n    Products AS P ON M.Code = P.Manufacturer\nGROUP BY \n    M.Code\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nheadquarter_selection = alt.selection_multi(fields=['Headquarter'], bind='legend')\n\nchart = alt.Chart(df).mark_circle().encode(\n    alt.X('Revenue', scale=alt.Scale(zero=False), title='Revenue'),\n    alt.Y('AvgProductPrice', scale=alt.Scale(zero=False, padding=1), title='Average Product Price'),\n    color='Headquarter',\n    size='ProductCount',\n    tooltip=['Revenue', 'AvgProductPrice', 'ProductCount', 'Headquarter'],\n    opacity=alt.condition(headquarter_selection, alt.value(0.6), alt.value(0.1))\n).properties(\n    title='Manufacturer Revenue vs. Average Product Price'\n).add_params(\n    headquarter_selection\n).interactive()\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___multifeature_scatter_plot___manufactory_1.py"
    },
    {
        "type": "type_D",
        "db_id": "manufacturer",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_highlighted_segment",
        "NLQ": "Can you flip this chart to make it horizontal instead of vertical? I think it would be easier to read the manufacturer names that way. Also, could you clean up the gridlines? Maybe remove the vertical grid lines completely and make the horizontal ones lighter gray and dashed? That would help the data bars stand out more.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufacturer.sqlite')\n\nquery = '''\nSELECT Name, Num_of_Factories\nFROM manufacturer\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nthreshold_value = 20\nthreshold_df = pd.DataFrame([{\"threshold\": threshold_value}])\n\nbars = alt.Chart(df).mark_bar().encode(\n    y=alt.Y('Name:N', title='Manufacturer', sort=None),\n    x=alt.X('Num_of_Factories:Q', title='Number of Factories')\n)\n\nhighlight = alt.Chart(df).mark_bar(color=\"#e45755\").encode(\n    y='Name:N',\n    x='baseline:Q',\n    x2='Num_of_Factories:Q'\n).transform_filter(\n    alt.datum.Num_of_Factories > threshold_value\n).transform_calculate(\"baseline\", str(threshold_value))\n\nrule = alt.Chart(threshold_df).mark_rule(color=\"black\", strokeDash=[3, 5]).encode(\n    x='threshold:Q'\n)\n\nchart = (bars + highlight + rule).properties(\n    width=600, title=\"Number of Factories by Manufacturer\"\n).configure_axis(\n    gridColor=\"#ddd\",\n    gridDash=[1,7]\n).configure_axisX(\n    grid=False\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_highlighted_segment___manufacturer.py"
    },
    {
        "type": "type_D",
        "db_id": "manufacturer",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_matrix",
        "NLQ": "Can you make this scatter plot matrix more interactive? I'd like to be able to hover over points to see more information about each manufacturer. It would be helpful if hovering over a point showed details like the manufacturer name, open year, number of factories, and number of shops. Also, could you make the points I hover over stand out more - maybe make them bigger and keep them fully opaque while slightly fading the other points? And could you use a nicer color scheme for the different manufacturers? Something like a viridis palette would look better than the default colors.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/manufacturer.sqlite')\n\nquery = '''\nSELECT Manufacturer_ID, Open_Year, Num_of_Factories, Num_of_Shops, Name\nFROM manufacturer\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nhighlight = alt.selection_single(\n    on='mouseover', fields=['Name'], nearest=True, empty='none',\n    name='highlight'\n)\n\nscatter_matrix = alt.Chart(df).mark_circle().encode(\n    alt.X(alt.repeat(\"column\"), type='quantitative'),\n    alt.Y(alt.repeat(\"row\"), type='quantitative'),\n    color=alt.Color('Name:N', scale=alt.Scale(scheme='viridis')),\n    tooltip=['Name', 'Open_Year', 'Num_of_Factories', 'Num_of_Shops'],\n    opacity=alt.condition(highlight, alt.value(1), alt.value(0.7)),\n    size=alt.condition(highlight, alt.value(100), alt.value(50))\n).properties(\n    width=150,\n    height=150\n).repeat(\n    row=['Num_of_Factories', 'Num_of_Shops', 'Open_Year'],\n    column=['Open_Year', 'Num_of_Shops', 'Num_of_Factories']\n).add_selection(\n    highlight\n).interactive()\n\nscatter_matrix",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___scatter_matrix___manufacturer.py"
    },
    {
        "type": "type_D",
        "db_id": "movie_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_labels",
        "NLQ": "I really like the bar chart you made showing the average movie ratings. However, I was wondering if you could make a few tweaks to make it even more user-friendly. First, could you add some color to the bars? Maybe use a gradient that goes from blue to green to make it visually more appealing. Also, it would be awesome if you could add tooltips so when I hover over each bar, I can see the exact average rating instead of just relying on the labels. Lastly, the movie titles are quite long sometimes, and it's a bit hard to read them when they are horizontal. Could you rotate them to be angled? That would really make the titles easier to read.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/movie_1.sqlite')\n\nquery = '''\nSELECT \n    M.title AS MovieTitle,\n    AVG(R.stars) AS AverageRating\nFROM \n    Rating AS R\nJOIN \n    Movie AS M ON R.mID = M.mID\nGROUP BY \n    M.mID, M.title\nORDER BY \n    AverageRating DESC;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('AverageRating:Q', title='Average Rating'),\n    y=alt.Y('MovieTitle:N', sort='-x', title='Movie Title',\n            axis=alt.Axis(labelAngle=-45)),\n    tooltip=['MovieTitle:N', 'AverageRating:Q']\n)\n\nbars = base.mark_bar().encode(\n    color=alt.Color('AverageRating:Q', scale=alt.Scale(scheme='bluegreen'))\n)\n\ntext = base.mark_text(\n    align='left',\n    dx=2\n).encode(\n    text=alt.Text('AverageRating:Q', format='.2f')\n)\n\nchart = (bars + text).properties(\n    title=\"Average Movie Ratings\"\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_labels___movie_1.py"
    },
    {
        "type": "type_D",
        "db_id": "music_4",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_at_mean",
        "NLQ": "Can you improve this chart by sorting the bars from highest to lowest number of songs? Also, could you add tooltips so I can see the exact number when I hover over each bar? The red line showing the average is helpful, but could you label it with the actual average value so it's clearer what that line represents?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/music_4.sqlite')\n\nquery = '''\nSELECT \n    a.Artist, COUNT(v.Song) AS Song_Count\nFROM \n    artist AS a\nJOIN \n    volume AS v ON a.Artist_ID = v.Artist_ID\nGROUP BY \n    a.Artist\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf = df.sort_values(by='Song_Count', ascending=False)\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Artist:N', \n            sort='-y', \n            title='Artist'),\n    y=alt.Y('Song_Count:Q', title='Number of Songs on Top'),\n    tooltip=[alt.Tooltip('Artist:N', title='Artist'), \n             alt.Tooltip('Song_Count:Q', title='Top Songs')]\n)\n\nmean_song_count = df['Song_Count'].mean()\n\nrule = alt.Chart(df).mark_rule(color='red', strokeWidth=2).encode(\n    y=alt.datum(mean_song_count)\n).properties(\n    title='Red line indicates the average number of top songs per artist'\n)\n\nrule_text = alt.Chart(df).mark_text(\n    text=f'Avg: {mean_song_count:.2f}',\n    align='left',\n    dx=5, dy=-10,\n    color='red',\n    fontSize=12\n).encode(\n    y=alt.datum(mean_song_count)\n)\n\n(bar + rule + rule_text).properties(width=600)",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_line_at_mean___music_4.py"
    },
    {
        "type": "type_D",
        "db_id": "network_1",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_at_mean",
        "NLQ": "Can you sort the bars by the number of friends so we can easily see who has the most friends? Also, could you add tooltips so I can see the student's name and exact number of friends when I hover over each bar? And for the red average line, could you add a label showing the actual average value next to it so it's clearer what that line represents?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/network_1.sqlite')\n\nquery = '''\nSELECT \n    T1.ID AS student_id, \n    T1.name AS student_name, \n    COUNT(T2.friend_id) AS friend_count\nFROM \n    Highschooler AS T1\nLEFT JOIN \n    Friend AS T2 ON T1.ID = T2.student_id\nGROUP BY \n    T1.ID, T1.name\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nbar = alt.Chart(df).mark_bar().encode(\n    x=alt.X('student_name:N', title='Student Name', sort='-y'),\n    y=alt.Y('friend_count:Q', title='Number of Friends'),\n    tooltip=[\n        alt.Tooltip('student_name:N', title='Student Name'),\n        alt.Tooltip('friend_count:Q', title='Number of Friends')\n    ]\n)\n\naverage_line = alt.Chart(df).mark_rule(color='red').encode(\n    y='mean(friend_count):Q'\n).properties(\n    title='Average Line'\n)\n\naverage_label = average_line.mark_text(\n    align='left',\n    baseline='middle', \n    dx=5,\n    dy=-5\n).encode(\n    text=alt.Text('mean(friend_count):Q', format='.2f')\n)\n\nchart = (bar + average_line + average_label).properties(\n    width=600,\n    title='Number of Friends per Student with Average Line'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_line_at_mean___network_1.py"
    },
    {
        "type": "type_D",
        "db_id": "network_2",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_average",
        "NLQ": "Can you make this chart more visually appealing by using a blue color scheme for the bars? I'd also like to see the exact values when I hover over each bar. Could you sort the cities by their average friendship years rather than alphabetically so I can quickly see which cities have the longest friendships? And please add a title to the chart that says \"Average Years of Friendship By City\".",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/network_2.sqlite')\n\nquery = '''\nSELECT \n    P.city AS city, \n    AVG(PF.year) AS avg_years\nFROM \n    PersonFriend AS PF\nJOIN \n    Person AS P ON PF.name = P.name\nGROUP BY \n    P.city\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf = df.sort_values('avg_years', ascending=False)\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('city:N', title='City'),\n    y=alt.Y('avg_years:Q', title='Average Years of Friendship'),\n    color=alt.Color('city:N', scale=alt.Scale(scheme='blues')),\n    opacity=alt.condition(brush, alt.value(1), alt.value(0.7)),\n    tooltip=[\n        alt.Tooltip('city:N', title='City'),\n        alt.Tooltip('avg_years:Q', title='Avg. Friendship Years', format='.2f')\n    ]\n).add_params(\n    brush\n)\n\nline = alt.Chart(df).mark_rule(color='firebrick').encode(\n    y='mean(avg_years):Q',\n    size=alt.SizeValue(3)\n).transform_filter(\n    brush\n)\n\nchart = alt.layer(bars, line).properties(\n    title=\"Average Years of Friendship By City\"\n)\n\nchart.display()",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___interactive_average___network_2.py"
    },
    {
        "type": "type_D",
        "db_id": "news_report",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_on_dual_axis",
        "NLQ": "I really like this visualization showing the events by year alongside journalist experience, but I think we can make it more useful with a few tweaks. Right now it's hard to see the exact values without guessing. Could you add tooltips so when I hover over the bars or line points I can see the precise numbers? Also, the red line against the default blue bars isn't the most attractive color combination - maybe we could use a more cohesive color scheme? Perhaps something like a teal for the bars and orange for the line? Oh, and it would be helpful to have a clear legend that explains which visual represents which metric. Right now, if I were sharing this with colleagues, they might get confused about what they're looking at. Could you also add points to the line to make it easier to see the exact years? And maybe make the chart a bit bigger with a more descriptive subtitle explaining what each element represents? Thanks for your help with this!",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/news_report.sqlite')\n\nquery = '''\nSELECT\n    CAST(SUBSTR(T1.Date, LENGTH(T1.Date) - 3) AS INTEGER) AS EventYear,\n    COUNT(T1.Event_ID) AS NumberOfEvents,\n    AVG(T3.Years_working) AS AverageJournalistExperience\nFROM\n    event AS T1\nJOIN\n    news_report AS T2 ON T1.Event_ID = T2.Event_ID\nJOIN\n    journalist AS T3 ON T2.journalist_ID = T3.journalist_ID\nGROUP BY\n    EventYear\nORDER BY\n    EventYear;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('EventYear:O', title='Event Year')\n)\n\nbars = base.mark_bar(color='#2D9D8F').encode(\n    y=alt.Y('NumberOfEvents:Q', title='Number of Events'),\n    tooltip=[\n        alt.Tooltip('EventYear:O', title='Year'),\n        alt.Tooltip('NumberOfEvents:Q', title='Number of Events', format=',')\n    ]\n).properties(title='Events per Year and Journalist Experience')\n\nline = base.mark_line(color='#E76F51', point=True).encode(\n    y=alt.Y('AverageJournalistExperience:Q', title='Average Journalist Experience (Years)'),\n    tooltip=[\n        alt.Tooltip('EventYear:O', title='Year'),\n        alt.Tooltip('AverageJournalistExperience:Q', title='Avg. Experience', format='.1f')\n    ]\n)\n\nevents_legend = alt.Chart(pd.DataFrame({'legend': ['Number of Events']})).mark_rect(\n    color='#2D9D8F', width=15, height=10\n).encode(y=alt.Y('legend:N'))\n\nexperience_legend = alt.Chart(pd.DataFrame({'legend': ['Average Journalist Experience']})).mark_line(\n    color='#E76F51', strokeWidth=2\n).encode(y=alt.Y('legend:N'))\n\nlegend = alt.hconcat(events_legend, experience_legend).resolve_scale(y='independent')\n\nchart = alt.layer(\n    bars.encode(\n        y=alt.Y('NumberOfEvents:Q', title='Number of Events', axis=alt.Axis(grid=True))\n    ),\n    line.encode(\n        y=alt.Y('AverageJournalistExperience:Q', title='Average Experience (Years)', \n                axis=alt.Axis(grid=True))\n    )\n).resolve_scale(y='independent').properties(\n    width=600,\n    height=400,\n    title={\n        \"text\": \"Events per Year and Average Journalist Experience\",\n        \"subtitle\": \"Bar chart shows event count, line shows average years of experience\",\n        \"fontSize\": 16\n    }\n)\n\nfinal_chart = alt.vconcat(chart, legend).configure_view(\n    strokeWidth=0\n).configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n)\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_line_on_dual_axis___news_report.py"
    },
    {
        "type": "type_D",
        "db_id": "orchestra",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_on_dual_axis",
        "NLQ": "Can you improve this chart to tell a better story? I'd like a clear title that explains what we're comparing, and proper labels for both axes. Could you sort the performance types by attendance from highest to lowest so we can quickly see which ones are most popular? The bars look a bit plain - maybe use shades of blue instead? Also, the red line is hard to see - can you make it thicker and add points to mark each value? It would be really helpful if we could hover over the bars and lines to see the exact numbers. And could you make the chart a bit taller so it's easier to read? Thanks!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/orchestra.sqlite')\n\nquery = '''\nSELECT\n    P.Type,\n    AVG(S.Attendance) AS Average_Attendance,\n    AVG(P.\"Official_ratings_(millions)\") AS Average_Official_Ratings\nFROM Performance AS P\nJOIN Show AS S\n    ON P.Performance_ID = S.Performance_ID\nGROUP BY\n    P.Type;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndf = df.sort_values('Average_Attendance', ascending=False)\n\nbar_color = alt.Color('Average_Attendance:Q', \n                      scale=alt.Scale(scheme='blues'),\n                      legend=None)\n\nbase = alt.Chart(df).encode(\n    x=alt.X('Type:N', title='Performance Type', sort=None)\n).properties(\n    width=600,\n    height=400,\n    title='Average Attendance vs Official Ratings by Performance Type'\n)\n\nbar = base.mark_bar().encode(\n    y=alt.Y('Average_Attendance:Q', title='Average Attendance'),\n    color=bar_color,\n    tooltip=[\n        alt.Tooltip('Type', title='Performance Type'),\n        alt.Tooltip('Average_Attendance:Q', title='Average Attendance', format=',.0f')\n    ]\n)\n\nline = base.mark_line(color='red', strokeWidth=3).encode(\n    y=alt.Y('Average_Official_Ratings:Q', title='Average Official Ratings (millions)'),\n    tooltip=[\n        alt.Tooltip('Type', title='Performance Type'),\n        alt.Tooltip('Average_Official_Ratings:Q', title='Average Ratings (millions)', format=',.2f')\n    ]\n)\n\npoints = base.mark_circle(color='red', size=60).encode(\n    y=alt.Y('Average_Official_Ratings:Q'),\n    tooltip=[\n        alt.Tooltip('Type', title='Performance Type'),\n        alt.Tooltip('Average_Official_Ratings:Q', title='Average Ratings (millions)', format=',.2f')\n    ]\n)\n\nchart = alt.layer(\n    bar, line + points\n).resolve_scale(\n    y='independent'\n).configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n).configure_title(\n    fontSize=16,\n    anchor='middle'\n)\n\nattendance_legend = alt.Chart(pd.DataFrame({'legend': ['Average Attendance']})).mark_rect(\n    color='steelblue', width=15, height=15\n).encode(x=alt.value(10), y=alt.value(10))\n\nrating_legend = alt.Chart(pd.DataFrame({'legend': ['Average Official Ratings']})).mark_line(\n    color='red', strokeWidth=3\n).encode(x=alt.value(10), y=alt.value(30))\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_line_on_dual_axis___orchestra.py"
    },
    {
        "type": "type_D",
        "db_id": "orchestra",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_average",
        "NLQ": "Can you make this chart more user-friendly? I'd like a better color scheme - maybe something like blue and orange that would look more cohesive than the default colors. Also, could you add tooltips so I can see the exact ratings and performance types when I hover over the bars? And the axis labels need work - can you change them to be more descriptive, like \"Date (Day/Month)\" for the x-axis and add \"Official Ratings (Millions)\" for the y-axis? That would make the information clearer for viewers.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/orchestra.sqlite')\n\nquery = '''\nSELECT Date, Type, `Official_ratings_(millions)` AS Official_ratings\nFROM performance;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\ncolors = alt.Scale(scheme='blueorange')\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Date:O', title='Date (Day/Month)'),\n    y=alt.Y('Official_ratings:Q', title='Official Ratings (Millions)'),\n    color=alt.Color('Type:N', scale=colors, title='Performance Type'),\n    opacity=alt.condition(brush, alt.value(1), alt.value(0.7)),\n    tooltip=['Date', 'Type', 'Official_ratings']\n).add_params(\n    brush\n)\n\nline = alt.Chart(df).mark_rule(color='firebrick').encode(\n    y='mean(Official_ratings):Q',\n    size=alt.SizeValue(3)\n).transform_filter(\n    brush\n)\n\nchart = alt.layer(bars, line).properties(\n    title='Official Ratings of Performance Types Over Time with Average Line (Interactive)'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___interactive_average___orchestra.py"
    },
    {
        "type": "type_D",
        "db_id": "party_host",
        "chart_category": "Bar Charts",
        "chart_type": "bar_chart_with_line_on_dual_axis",
        "NLQ": "Can you improve this chart by sorting the party themes by the number of hosts to show which are most popular? Also, could you change the red line to orange and make it a bit thicker? I'd like to add tooltips so I can see the exact values when I hover over the bars and line. And could you add a title to the chart like \"Party Themes: Number of Hosts and Average Active Years\"? Maybe also make the bar color a nicer shade of blue and increase the font size for the labels and titles to make everything easier to read.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/party_host.sqlite')\nquery = '''\nSELECT \n    p.Party_Theme,\n    SUM(p.Number_of_hosts) AS Total_Hosts,\n    AVG(CAST(p.Last_year AS INT) - CAST(p.First_year AS INT)) AS Avg_Active_Years\nFROM \n    party AS p\nGROUP BY \n    p.Party_Theme\nORDER BY \n    Total_Hosts DESC;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    x=alt.X('Party_Theme:N', \n            title='Party Theme',\n            sort='-y')\n)\n\nbar = base.mark_bar(color='#4682B4').encode(\n    y=alt.Y('Total_Hosts:Q', title='Total Number of Hosts'),\n    tooltip=['Party_Theme', 'Total_Hosts']\n)\n\nline = base.mark_line(color='#FF8C00', strokeWidth=2).encode(\n    y=alt.Y('Avg_Active_Years:Q', title='Average Active Years'),\n    tooltip=['Party_Theme', 'Avg_Active_Years']\n)\n\nchart = (bar + line).resolve_scale(\n    y='independent'\n).properties(\n    width=600,\n    title='Party Themes: Number of Hosts and Average Active Years'\n).configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n).configure_title(\n    fontSize=16\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___bar_chart_with_line_on_dual_axis___party_host.py"
    },
    {
        "type": "type_D",
        "db_id": "pets_1",
        "chart_category": "Scatter Plots",
        "chart_type": "simple_scatter_plot_with_labels",
        "NLQ": "Can you make this chart more colorful by showing different pet types in different colors? Also, could you add a title that explains what the chart is showing? It would be helpful if I could hover over the points to see more details about each pet too, like their ID, age, and weight. And can you make the chart interactive so I can zoom in and explore the data better?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/pets_1.sqlite')\nquery = '''\nSELECT pet_age, weight, PetID, PetType\nFROM Pets\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['PetID'] = df['PetID'].astype(str)\n\npoints = alt.Chart(df).mark_point().encode(\n    x='pet_age:Q',\n    y='weight:Q',\n    color='PetType:N'\n).properties(\n    title='Relationship between Pet Age and Weight Colored by Pet Type'\n)\n\ntooltips = points.encode(\n    tooltip=['PetID:N', 'pet_age:Q', 'weight:Q']\n)\n\ntext = points.mark_text(\n    align='left',\n    baseline='middle',\n    dx=7\n).encode(\n    text='PetID:N'\n)\n\n(points + text + tooltips).interactive()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___simple_scatter_plot_with_labels___pets_1.py"
    },
    {
        "type": "type_D",
        "db_id": "poker_player",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_crossfilter",
        "NLQ": "Can you improve these histograms? They're a bit plain right now. I'd like to see the Earnings on a log scale since poker winnings are usually very skewed. Could you add titles to each chart so I know what I'm looking at? Also, it would be nice to have tooltips when I hover over the bars to see the exact counts. And maybe use different colors for each chart - like blue for Final Tables, green for Best Finish, and orange for Earnings - so they're easier to tell apart. Right now when I select regions, I can't really tell what values I'm looking at.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\nimport numpy as np\n\nconn = sqlite3.connect('database/poker_player.sqlite')\n\nquery = '''\nSELECT Final_Table_Made, Best_Finish, Earnings\nFROM poker_player;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['log_Earnings'] = np.log1p(df['Earnings'])\n\ncolor_scheme = {\n    \"Final_Table_Made\": \"steelblue\",\n    \"Best_Finish\": \"darkgreen\",\n    \"log_Earnings\": \"darkorange\"\n}\n\nbrush = alt.selection_interval(encodings=['x'])\n\ndef create_chart(field, title, color):\n    is_log = field == 'log_Earnings'\n    display_field = 'Earnings' if is_log else field\n    \n    base = alt.Chart(df, width=160, height=130).encode(\n        alt.X(field, bin=alt.Bin(maxbins=20), title=display_field),\n        alt.Y('count()', title='Count of Records'),\n        tooltip=[\n            alt.Tooltip(field, bin=alt.Bin(maxbins=20), title=display_field),\n            alt.Tooltip('count()', title='Count')\n        ]\n    ).properties(\n        title=title\n    )\n\n    background = base.mark_bar(color='#ddd').add_params(brush)\n    highlight = base.mark_bar(color=color).transform_filter(brush)\n    \n    return alt.layer(background, highlight)\n\nfinal_table_chart = create_chart(\n    'Final_Table_Made', \n    'Distribution of Final Tables Made', \n    color_scheme['Final_Table_Made']\n)\n\nbest_finish_chart = create_chart(\n    'Best_Finish', \n    'Distribution of Best Finishes', \n    color_scheme['Best_Finish']\n)\n\nearnings_chart = create_chart(\n    'log_Earnings', \n    'Distribution of Earnings (Log Scale)', \n    color_scheme['log_Earnings']\n)\n\nchart = alt.hconcat(\n    final_table_chart,\n    best_finish_chart,\n    earnings_chart\n).resolve_scale(\n    x='independent',\n    y='independent'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___interactive_crossfilter___poker_player.py"
    },
    {
        "type": "type_D",
        "db_id": "race_track",
        "chart_category": "Simple Charts",
        "chart_type": "simple_line_chart",
        "NLQ": "Can you sort the tracks by the number of races they've hosted instead of by their IDs? It would be easier to see which tracks host the most races. Also, could you add points on the line chart and make the line blue? It would be helpful to have tooltips so I can see the exact number of races when I hover over each point. And one more thing - can you add a title to the chart that says \"Number of Races Hosted by Each Track\"?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/race_track.sqlite')\nquery = '''\nSELECT \n    t.Name AS Track_Name,\n    COUNT(r.Race_ID) AS Race_Count\nFROM \n    track AS t\nLEFT JOIN \n    race AS r ON t.Track_ID = r.Track_ID\nGROUP BY \n    t.Track_ID\nORDER BY \n    Race_Count DESC\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    x=alt.X('Track_Name:N', sort='-y'),\n    y='Race_Count:Q',\n    color=alt.value('steelblue'),\n    tooltip=['Track_Name:N', 'Race_Count:Q']\n).properties(\n    title='Number of Races Hosted by Each Track'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_line_chart___race_track.py"
    },
    {
        "type": "type_D",
        "db_id": "railway",
        "chart_category": "Bar Charts",
        "chart_type": "calculating_percentage_of_total",
        "NLQ": "Thanks for creating this chart showing the percentage of trains by location. It's helpful, but I think we can make it more informative. Could you sort the locations by percentage in descending order so we can quickly see which places have the most trains? Also, when I look at just percentages, I'm curious about the actual counts too - maybe we could add tooltips that show both the percentage and the actual train count when I hover over each bar? And to make it more visually appealing, could you add some color to the bars instead of the default gray, maybe where the color intensity corresponds to the percentage? Oh, and a title would help give context to anyone viewing this chart for the first time. Could you also make the chart a bit bigger and add proper axis titles so it's clearer what we're looking at?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/railway.sqlite')\n\nquery = '''\nSELECT \n    T1.Location AS Location,\n    COUNT(T2.Train_ID) AS Train_Count\nFROM \n    railway AS T1\nJOIN \n    train AS T2 ON T1.Railway_ID = T2.Railway_ID\nGROUP BY \n    T1.Location\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_joinaggregate(\n    TotalTrains='sum(Train_Count)',\n).transform_calculate(\n    PercentOfTotal=\"datum.Train_Count / datum.TotalTrains\",\n    PercentFormatted=\"format(datum.Train_Count / datum.TotalTrains, '.1%')\"\n).mark_bar().encode(\n    alt.X('PercentOfTotal:Q', axis=alt.Axis(format='%', title='Percentage of Total Trains')),\n    alt.Y('Location:N', sort=alt.EncodingSortField(field='PercentOfTotal', order='descending'),\n          title='Location'),\n    color=alt.Color('PercentOfTotal:Q', scale=alt.Scale(scheme='blues'), \n                    legend=alt.Legend(title=\"Percentage\")),\n    tooltip=[\n        alt.Tooltip('Location:N', title='Location'),\n        alt.Tooltip('Train_Count:Q', title='Number of Trains'),\n        alt.Tooltip('PercentFormatted:N', title='Percentage')\n    ]\n).properties(\n    title='Distribution of Trains by Location',\n    width=600,\n    height=400\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___calculating_percentage_of_total___railway.py"
    },
    {
        "type": "type_D",
        "db_id": "railway",
        "chart_category": "Simple Charts",
        "chart_type": "simple_line_chart",
        "NLQ": "Can you make this chart easier to read? The year labels on the x-axis are cramped and hard to read - could you make them horizontal? Also, I'd like to see the actual data points on the line so I can identify each year's value better. It would be helpful if I could hover over those points to see the exact values. The y-axis has too much empty space at the top - can you adjust the scale to focus more on our data? And could you make the chart a bit wider and taller so everything is easier to see? Finally, it would be nice if I could zoom in and explore the chart interactively. Thanks!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/railway.sqlite')\n\nquery = '''\nSELECT \n    r.Built AS Year,\n    COUNT(t.Train_ID) AS Train_Count\nFROM \n    railway AS r\nLEFT JOIN \n    train AS t ON r.Railway_ID = t.Railway_ID\nWHERE \n    r.Built != '' AND r.Built != 'Unknown'\nGROUP BY \n    r.Built\nORDER BY \n    CAST(r.Built AS INTEGER)\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    x=alt.X('Year:N', \n            title='Year Built',\n            axis=alt.Axis(labelAngle=0, labelOverlap='parity')),\n    y=alt.Y('Train_Count:Q', \n            title='Number of Trains',\n            scale=alt.Scale(domain=[0, max(df['Train_Count']) * 1.1])),\n    tooltip=['Year', 'Train_Count']\n).properties(\n    title=\"Number of Trains Managed by Railways Over Time\",\n    width=600,\n    height=400\n).interactive()\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_line_chart___railway.py"
    },
    {
        "type": "type_D",
        "db_id": "riding_club",
        "chart_category": "Simple Charts",
        "chart_type": "simple_scatter_plot_with_tooltips",
        "NLQ": "I like the scatter plot showing the relationship between gold medals and points for different clubs by region. Could you make the data points bigger so they stand out more? Also, can you make the axis labels more descriptive - maybe change \"Gold\" to \"Number of Gold Medals Won\" and \"Points\" to \"Total Points Earned\"? One more thing - those gridlines are a bit distracting. Could you remove them to make the chart look cleaner and help the data points stand out better?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/riding_club.sqlite')\n\nquery = '''\nSELECT\n    c.Club_name,\n    c.Region,\n    m.Gold,\n    m.Points\nFROM\n    club AS c\nJOIN\n    match_result AS m\nON\n    c.Club_ID = m.Club_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nscatter_plot = alt.Chart(df).mark_circle(size=100).encode(\n    x=alt.X('Gold:Q', title='Number of Gold Medals Won'),\n    y=alt.Y('Points:Q', title='Total Points Earned'),\n    color=alt.Color('Region:N', scale=alt.Scale(scheme='category10')),\n    tooltip=['Club_name:N', 'Region:N', 'Gold:Q', 'Points:Q']\n).configure_axis(\n    grid=False\n).interactive()\n\nscatter_plot",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_scatter_plot_with_tooltips___riding_club.py"
    },
    {
        "type": "type_D",
        "db_id": "sakila_1",
        "chart_category": "Bar Charts",
        "chart_type": "diverging_stacked_bar_chart",
        "NLQ": "Can you make this visualization more user-friendly? I'd like to add tooltips so I can see the exact category, rating, and percentage when I hover over the bars. Also, the current colors are a bit harsh - could you use softer, pastel shades instead? It would also be helpful if you could sort the categories by their total film count rather than alphabetically, and add a title to the chart that explains what we're looking at.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/sakila_1.sqlite')\nquery = '''\nSELECT \n    c.name AS category_name,\n    f.rating,\n    COUNT(*) AS count\nFROM \n    film AS f\nJOIN \n    film_category AS fc ON f.film_id = fc.film_id\nJOIN \n    category AS c ON fc.category_id = c.category_id\nGROUP BY \n    c.name, f.rating\nORDER BY \n    c.name, f.rating\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nrating_order = {'G': -2, 'PG': -1, 'PG-13': 0, 'R': 1, 'NC-17': 2}\ndf['type_code'] = df['rating'].map(rating_order)\n\ndef compute_percentages(group):\n    group = group.set_index('type_code').sort_index()\n    perc = (group['count'] / group['count'].sum()) * 100\n    group['percentage'] = perc\n    group['percentage_end'] = perc.cumsum()\n    group['percentage_start'] = group['percentage_end'] - perc\n    return group\n\ndf = df.groupby('category_name').apply(compute_percentages).reset_index(drop=True)\ndf['total_count'] = df.groupby('category_name')['count'].transform('sum')\n\ncolor_scale = alt.Scale(\n    domain=['G', 'PG', 'PG-13', 'R', 'NC-17'],\n    range=[\"#a8d5e2\", \"#d4a5a5\", \"#fad6a5\", \"#c5a6e2\", \"#ffaeb3\"]\n)\n\ndf['category_name'] = pd.Categorical(\n    df['category_name'],\n    categories=df.groupby('category_name').sum('count').sort_values('count', ascending=False).index,\n    ordered=True\n)\n\ny_axis = alt.Axis(title=\"Film Category\", offset=5, ticks=False, minExtent=60, domain=False)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"percentage_start:Q\", title=\"Percentage\"),\n    x2=\"percentage_end:Q\",\n    y=alt.Y(\"category_name:N\", sort='-x', axis=y_axis),\n    color=alt.Color(\"rating:N\", title=\"Rating\", scale=color_scale),\n    tooltip=[\n        alt.Tooltip(\"category_name:N\", title=\"Category\"),\n        alt.Tooltip(\"rating:N\", title=\"Rating\"),\n        alt.Tooltip(\"percentage:Q\", title=\"Percentage\", format=\".2f\")\n    ]\n).properties(\n    title=\"Distribution of Film Ratings Across Categories\"\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___diverging_stacked_bar_chart___sakila_1.py"
    },
    {
        "type": "type_D",
        "db_id": "soccer_2",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_xoffset",
        "NLQ": "The chart is a good start, but it's a little cramped and some information is missing. Could we simplify it to just show the decision breakdown for each college, removing the player position for now? It would also be helpful to see the exact number of players for each decision when I hover over the bars. Finally, since it is a stacked bar, can you make sure the order are consistent? Perhaps putting 'yes' always on top. Also, could you add a title that explains what the chart is showing and use nicer colors for the decisions?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/soccer_2.sqlite')\n\nquery = '''\nSELECT \n    T.cName AS College,\n    T.decision AS Decision,\n    COUNT(T.pID) AS PlayerCount\nFROM Tryout AS T\nGROUP BY T.cName, T.decision\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=\"College:N\",\n    y=\"PlayerCount:Q\",\n    color=alt.Color(\"Decision:N\", scale=alt.Scale(range=['#4c78a8', '#f58518'])),\n    tooltip=['College', 'Decision', 'PlayerCount'],\n    order=alt.Order(\n      'Decision',\n      sort='descending'\n    )\n).properties(\n    title='Player Tryout Decisions by College'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___grouped_bar_chart_with_xoffset___soccer_2.py"
    },
    {
        "type": "type_D",
        "db_id": "solvency_ii",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_xoffset",
        "NLQ": "Can you reorganize this chart to make it easier to compare? I'd like to see the product types grouped in columns, with each column showing the event types. Also, please use a more vibrant color scheme like Tableau's colors to make the different product types stand out better. And could you add tooltips so I can see the exact numbers when I hover over each bar?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/solvency_ii.sqlite')\nquery = '''\nSELECT \n    E.Event_Type_Code AS EventType,\n    P.Product_Type_Code AS ProductType,\n    COUNT(PE.Product_ID) AS ProductCount\nFROM \n    Events AS E\nJOIN \n    Products_in_Events AS PE ON E.Event_ID = PE.Event_ID\nJOIN \n    Products AS P ON PE.Product_ID = P.Product_ID\nGROUP BY \n    E.Event_Type_Code, P.Product_Type_Code\nORDER BY \n    E.Event_Type_Code, P.Product_Type_Code;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\nchart = alt.Chart(df).mark_bar().encode(\n    column=alt.Column(\"ProductType:N\", title=\"Product Type\"),\n    x=alt.X(\"EventType:N\", title=\"Event Type\"),\n    y=alt.Y(\"ProductCount:Q\", title=\"Total Number of Products\"),\n    color=alt.Color(\"ProductType:N\", scale=alt.Scale(scheme='tableau20')),\n    tooltip=[\"EventType\", \"ProductType\", \"ProductCount\"]\n).properties(\n    title=\"Total Products by Event Type and Product Type\"\n)\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___grouped_bar_chart_with_xoffset___solvency_ii.py"
    },
    {
        "type": "type_D",
        "db_id": "theme_gallery",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_grouped_bar_chart",
        "NLQ": "Can you make this chart easier to read by combining all themes into a single visualization instead of separate rows? I'd like to see the themes sorted by total attendance with the most popular ones at the top. Also, please add a proper title to the chart like \"Exhibition Attendance by Theme and Year\" and make the chart bigger so it's easier to see. Could you add axis titles and make it so I can see the exact attendance numbers when I hover over each bar?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/theme_gallery.sqlite')\n\nquery = '''\nSELECT \n    e.Theme AS Theme, \n    e.Year AS Year, \n    SUM(er.Attendance) AS Total_Attendance\nFROM \n    exhibition AS e\nJOIN \n    exhibition_record AS er ON e.Exhibition_ID = er.Exhibition_ID\nGROUP BY \n    e.Theme, e.Year\nORDER BY \n    e.Theme, e.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ntheme_totals = df.groupby('Theme')['Total_Attendance'].sum().reset_index()\ntheme_totals = theme_totals.sort_values('Total_Attendance', ascending=False)\ntheme_order = theme_totals['Theme'].tolist()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Total_Attendance:Q', title='Total Attendance'),\n    y=alt.Y('Theme:N', \n            title='Theme',\n            sort=theme_order),\n    color=alt.Color('Year:N', title='Year'),\n    tooltip=['Theme:N', 'Year:N', 'Total_Attendance:Q']\n).properties(\n    width=700,\n    height=400,\n    title='Exhibition Attendance by Theme and Year'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___horizontal_grouped_bar_chart___theme_gallery.py"
    },
    {
        "type": "type_D",
        "db_id": "theme_gallery",
        "chart_category": "Interactive Charts",
        "chart_type": "reorder_stacked_bar_segments",
        "NLQ": "Thanks for creating this visualization! It's giving me a good overview of attendance across themes and years. I'm wondering if we could make a few improvements though. When I look at the chart, it's hard to tell the exact attendance numbers - could you add tooltips so I can see the specific values when I hover over each bar segment? Also, I find myself having to scan through the themes to find the most popular ones. Would it be possible to sort the chart by total attendance instead, with the highest attendance themes at the top? That would help me quickly identify our most successful exhibitions. And one more thing - the default colors are a bit bright for my taste. Could you change to a more muted color palette that would look better in my presentation? Oh, and could you add a title to the chart and make it a bit larger overall so it's easier to read?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/theme_gallery.sqlite')\n\nquery = '''\nSELECT \n    e.Theme AS Theme,\n    e.Year AS Year,\n    SUM(er.Attendance) AS Total_Attendance\nFROM \n    exhibition AS e\nJOIN \n    exhibition_record AS er\nON \n    e.Exhibition_ID = er.Exhibition_ID\nGROUP BY \n    e.Theme, e.Year\nORDER BY \n    e.Theme, e.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ntheme_totals = df.groupby('Theme')['Total_Attendance'].sum().reset_index()\ntheme_totals = theme_totals.rename(columns={'Total_Attendance': 'Theme_Total_Attendance'})\ndf = pd.merge(df, theme_totals, on='Theme')\n\nselection = alt.selection_point(fields=['Year'], bind='legend')\n\nchart = alt.Chart(df).mark_bar().transform_calculate(\n    year_order=f\"if({selection.name}.Year && indexof({selection.name}.Year, datum.Year) !== -1, 0, 1)\"\n).encode(\n    x=alt.X('sum(Total_Attendance):Q', title='Total Attendance'),\n    y=alt.Y('Theme:N', \n            title='Exhibition Theme',\n            sort=alt.EncodingSortField(\n                field='Theme_Total_Attendance',\n                op='sum',\n                order='descending'\n            )),\n    color=alt.Color('Year:N', \n                   title='Year',\n                   scale=alt.Scale(scheme='tableau10')),\n    order=alt.Order('year_order:N'),\n    opacity=alt.condition(selection, alt.value(0.9), alt.value(0.2)),\n    tooltip=[\n        alt.Tooltip('Theme:N', title='Theme'),\n        alt.Tooltip('Year:N', title='Year'),\n        alt.Tooltip('sum(Total_Attendance):Q', title='Attendance', format=',')\n    ]\n).add_params(\n    selection\n).properties(\n    title='Exhibition Attendance by Theme and Year',\n    width=700,\n    height=400\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___reorder_stacked_bar_segments___theme_gallery.py"
    },
    {
        "type": "type_D",
        "db_id": "tracking_software_problems",
        "chart_category": "Bar Charts",
        "chart_type": "horizontal_stacked_bar_chart",
        "NLQ": "Can you flip the chart so the categories are on the x-axis and the counts are on the y-axis? I think it would be easier to read that way. Also, could you make the colors more distinct using something like the Tableau color palette? And it would be helpful if I could see the exact category, status, and count when I hover over each bar section.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/tracking_software_problems.sqlite')\nquery = '''\nSELECT \n    pcc.problem_category_description AS category,\n    psc.problem_status_description AS status,\n    COUNT(*) AS count\nFROM \n    Problem_Log AS pl\nJOIN \n    Problem_Category_Codes AS pcc ON pl.problem_category_code = pcc.problem_category_code\nJOIN \n    Problem_Status_Codes AS psc ON pl.problem_status_code = psc.problem_status_code\nGROUP BY \n    pcc.problem_category_description, psc.problem_status_description\nORDER BY \n    pcc.problem_category_description, psc.problem_status_description;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='category:N',\n    y='sum(count):Q',\n    color=alt.Color('status:N', scale=alt.Scale(scheme='tableau20')),\n    tooltip=['category', 'status', 'sum(count)']\n).properties(\n    title=\"Problem Distribution by Category and Status\"\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___horizontal_stacked_bar_chart___tracking_software_problems.py"
    },
    {
        "type": "type_D",
        "db_id": "train_station",
        "chart_category": "Bar Charts",
        "chart_type": "layered_bar_chart",
        "NLQ": "Can you make this chart more visually appealing with brighter colors? Also, I'd like to see the stations sorted by total passenger traffic so it's easier to identify the busiest ones. It would be helpful if I could hover over the bars to see the exact passenger numbers. And could you add a title to the chart that explains what we're looking at?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/train_station.sqlite')\n\nquery = '''\nSELECT \n    Name AS Station_Name,\n    Annual_entry_exit AS Entry_Exit,\n    Annual_interchanges AS Interchanges\nFROM \n    station\nWHERE \n    Location = 'London'\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars='Station_Name', value_vars=['Entry_Exit', 'Interchanges'], \n                    var_name='Traffic_Type', value_name='Passenger_Count')\n\nstation_order = df_melted.groupby('Station_Name')['Passenger_Count'].sum().sort_values(ascending=False).index.tolist()\n\nchart = alt.Chart(df_melted).mark_bar(opacity=0.7).encode(\n    x=alt.X('Station_Name:N', sort=station_order),\n    y=alt.Y('Passenger_Count:Q').stack(None),\n    color=alt.Color('Traffic_Type:N', scale=alt.Scale(scheme='category10')),\n    tooltip=['Station_Name', 'Traffic_Type', 'Passenger_Count']\n).properties(\n    title='Annual Passenger Traffic at London Train Stations'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___layered_bar_chart___train_station.py"
    },
    {
        "type": "type_D",
        "db_id": "workshop_paper",
        "chart_category": "Bar Charts",
        "chart_type": "sorted_bar_chart",
        "NLQ": "Can you make this bar chart more informative? I'd like to add a title that explains these are colleges ranked by average submission scores. Also, could you color the bars in shades of blue where higher scores have darker colors? It would be helpful to see the actual average score values displayed next to each bar. And could you add tooltips that show both the college name, the average score (with 2 decimal places), and the number of submissions from each college? Finally, can you make the chart a bit larger so it's easier to read?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/workshop_paper.sqlite')\nquery = '''\nSELECT College, \n       AVG(Scores) AS Average_Score, \n       COUNT(Scores) AS Submission_Count\nFROM submission\nGROUP BY College\nORDER BY Average_Score DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['Average_Score_Formatted'] = df['Average_Score'].round(2).astype(str)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Average_Score:Q',\n    y=alt.Y('College:N').sort('-x'),\n    color=alt.Color('Average_Score:Q', scale=alt.Scale(scheme='blues')),\n    tooltip=[\n        alt.Tooltip('College:N', title='College'),\n        alt.Tooltip('Average_Score:Q', title='Average Score', format='.2f'),\n        alt.Tooltip('Submission_Count:Q', title='Number of Submissions')\n    ]\n).properties(\n    title='Colleges Ranked by Average Submission Scores',\n    width=600,\n    height=400\n)\n\ntext = alt.Chart(df).mark_text(\n    align='left',\n    baseline='middle',\n    dx=3\n).encode(\n    x='Average_Score:Q',\n    y=alt.Y('College:N').sort('-x'),\n    text='Average_Score_Formatted:N'\n)\n\nfinal_chart = chart + text\n\nfinal_chart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___sorted_bar_chart___workshop_paper.py"
    },
    {
        "type": "type_D",
        "db_id": "world_1",
        "chart_category": "Bar Charts",
        "chart_type": "sorted_bar_chart",
        "NLQ": "Thanks for this bar chart of the most populated cities. It's giving me the basic information I need, but I'd like to make it more presentable for my urban development report. Could you add a proper title to the chart and maybe format those population numbers with commas? They're pretty large numbers and hard to read as is. Also, I think it would look nicer with some color instead of the default gray bars - perhaps use a blue gradient where the most populated cities have a darker shade? It would help emphasize the population differences visually. And if possible, I'd love to see the actual population values displayed on the bars themselves so my colleagues can quickly see the numbers without having to estimate from the axis. Could you also make the chart a bit bigger so it's easier to read? Oh, and it would be helpful if people could hover over the bars to see the city name and population.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/world_1.sqlite')\nquery = '''\nSELECT Name, Population\nFROM city\nORDER BY Population DESC\nLIMIT 10\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['Formatted_Population'] = df['Population'].apply(lambda x: f\"{x:,}\")\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Population:Q', axis=alt.Axis(format=',', title='Population')),\n    y=alt.Y('Name:N').sort('-x'),\n    color=alt.Color('Population:Q', scale=alt.Scale(scheme='blues'), legend=None),\n    tooltip=['Name', 'Formatted_Population']\n).properties(\n    title='Top 10 Most Populated Cities in the World',\n    width=600,\n    height=400\n)\ntext = alt.Chart(df).mark_text(\n    align='left',\n    baseline='middle',\n    dx=3\n).encode(\n    x='Population:Q',\n    y=alt.Y('Name:N').sort('-x'),\n    text='Formatted_Population'\n)\nfinal_chart = chart + text\nfinal_chart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___sorted_bar_chart___world_1.py"
    },
    {
        "type": "type_D",
        "db_id": "wrestler",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart",
        "NLQ": "This chart is giving me a good overview of how long wrestlers held their reigns across different locations, but I think we could make it more insightful. Could you sort the locations by total days held instead of alphabetically? Tokyo clearly dominates here, and I'd like to see the locations ranked from highest to lowest total days. Also, it would be helpful if I could see the exact numbers when I hover over each bar segment - sometimes it's hard to visually estimate the values. And one more thing - could you add a proper title to the chart and maybe improve the axis labels to make it clearer what we're looking at? I'm sharing this with my wrestling fan friends and want to make sure they understand it right away. Could you also make the chart a bit bigger so it's easier to see all the details?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/wrestler.sqlite')\n\nquery = '''\nSELECT Location, Event, SUM(CAST(Days_held AS INT)) AS Total_Days_Held\nFROM wrestler\nGROUP BY Location, Event\nORDER BY Location, Event\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nlocation_totals = df.groupby('Location')['Total_Days_Held'].sum().reset_index()\nlocation_order = list(location_totals.sort_values('Total_Days_Held', ascending=False)['Location'])\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Location:N', \n            sort=location_order,\n            title='Event Location'),\n    y=alt.Y('Total_Days_Held:Q', \n            title='Total Days Held'),\n    color='Event:N',\n    tooltip=['Location', 'Event', 'Total_Days_Held']\n).properties(\n    title='Wrestler Reign Duration by Location and Event Type',\n    width=500,\n    height=400\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___stacked_bar_chart___wrestler.py"
    },
    {
        "type": "type_D",
        "db_id": "wrestler",
        "chart_category": "Interactive Charts",
        "chart_type": "simple_interactive_colored_scatter_plot",
        "NLQ": "Can you make this scatter plot more visually appealing? I'd like to see larger circles with a more vibrant color scheme for the teams. Also, could you add tooltips so when I hover over a point I can see the wrestler's name, how many days they held the title, their elimination time, what team they're on, and what elimination move was used? And one last thing - can you make both axes start at zero and extend to the maximum values in the data? That would give a clearer perspective.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/wrestler.sqlite')\n\nquery = '''\nSELECT \n    w.Name,\n    w.Days_held, \n    e.Time, \n    e.Team,\n    e.Elimination_Move\nFROM \n    wrestler AS w\nJOIN \n    Elimination AS e\nON \n    w.Wrestler_ID = e.Wrestler_ID\nWHERE \n    w.Days_held != '' AND e.Time != ''\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndf['Days_held'] = pd.to_numeric(df['Days_held'], errors='coerce')\ndf['Time'] = df['Time'].apply(lambda x: int(x.split(':')[0]) * 60 + int(x.split(':')[1]))\n\ncolor_scheme = alt.Scale(scheme='category20b')\n\nchart = alt.Chart(df).mark_circle(size=100).encode(\n    x=alt.X('Days_held', title='Days Held', scale=alt.Scale(domain=(0, df['Days_held'].max()))),\n    y=alt.Y('Time', title='Elimination Time (seconds)', scale=alt.Scale(domain=(0, df['Time'].max()))),\n    color=alt.Color('Team:N', scale=color_scheme, title='Team'),\n    tooltip=[\n        alt.Tooltip('Name:N', title='Wrestler Name'),\n        alt.Tooltip('Days_held:Q', title='Days Held'),\n        alt.Tooltip('Time:Q', title='Elimination Time (sec)'),\n        alt.Tooltip('Elimination_Move:N', title='Elimination Move'),\n        alt.Tooltip('Team:N', title='Team')\n    ]\n).interactive()\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___simple_interactive_colored_scatter_plot___wrestler.py"
    },
    {
        "type": "type_D",
        "db_id": "wrestler",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "scatter_plot_with_loess_lines",
        "NLQ": "This scatter plot is really interesting - I can see some patterns forming between title reign length and elimination times. But it's a bit hard to interpret at a glance. Could you make the elimination time display in minutes and seconds instead of just seconds? That would make it easier for me to understand the actual time frames we're looking at. Also, I'd love to see some tooltips when I hover over the points to get details about specific data points, like the exact days held and elimination times. Could you make the chart a bit bigger and improve the title to be more descriptive? Maybe call it \"Title Reign Duration\" instead of just \"Days Held\"? And lastly, the default colors are okay, but could you use a more distinct color scheme that makes it easier to tell the teams apart? I'm planning to share this with my wrestling analysis group and want to make sure everyone can quickly understand what they're looking at.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/wrestler.sqlite')\n\nquery = '''\nSELECT \n    w.Days_held AS Days_Held,\n    CAST(substr(e.Time, 4, 2) AS INTEGER) * 60 + CAST(substr(e.Time, 7, 2) AS INTEGER) AS Elimination_Time_Seconds,\n    e.Team AS Team\nFROM \n    wrestler AS w\nJOIN \n    Elimination AS e\nON \n    w.Wrestler_ID = e.Wrestler_ID\nWHERE \n    w.Event = 'Live event'\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndf['Elimination_Time_Formatted'] = df['Elimination_Time_Seconds'].apply(\n    lambda x: f\"{int(x // 60)}:{int(x % 60):02d}\"\n)\n\nbase = alt.Chart(df).mark_circle(opacity=0.7).encode(\n    alt.X('Days_Held:Q', title='Title Reign Duration (Days)'),\n    alt.Y('Elimination_Time_Seconds:Q', \n          title='Elimination Time', \n          axis=alt.Axis(\n              format=',.0f',\n              labelExpr=\"datum.value == 0 ? '0:00' : floor(datum.value/60) + ':' + (datum.value%60 < 10 ? '0' + datum.value%60 : datum.value%60)\"\n          )),\n    alt.Color('Team:N', title='Team', scale=alt.Scale(scheme='category10')),\n    tooltip=[\n        alt.Tooltip('Days_Held:Q', title='Days Held', format=','),\n        alt.Tooltip('Elimination_Time_Formatted:N', title='Elimination Time (MM:SS)'),\n        alt.Tooltip('Team:N', title='Team')\n    ]\n)\n\ntrend_lines = base.transform_loess(\n    'Days_Held', \n    'Elimination_Time_Seconds', \n    groupby=['Team']\n).mark_line(size=3)\n\nchart = (base + trend_lines).properties(\n    title=\"Relationship Between Title Reign Duration and Elimination Time by Team\",\n    width=700,\n    height=500\n).configure_legend(\n    orient='right',\n    titleFontSize=14,\n    labelFontSize=12\n).configure_title(\n    fontSize=16,\n    font='Arial',\n    anchor='start'\n)",
        "original_code_path": "./vis_bench/vis_modify/Uncertainties And Trends___scatter_plot_with_loess_lines___wrestler.py"
    },
    {
        "type": "type_D",
        "db_id": "architecture",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_sorted_segments",
        "NLQ": "Can you sort the bars by total length instead of alphabetically so it's easier to see which nationality has designed the longest bridges? Also, instead of using different colors for each nationality, could you just use a single blue color for all bars to make it look cleaner? And could you add tooltips so I can see the exact length when I hover over a bar? One more thing - can you add a proper label for the x-axis that shows it's measuring length in meters?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/architecture.sqlite')\n\nquery = '''\nSELECT \n    a.nationality AS nationality,\n    SUM(b.length_meters) AS total_length_meters\nFROM \n    architect AS a\nJOIN \n    bridge AS b ON a.id = b.architect_id\nGROUP BY \n    a.nationality\nORDER BY \n    a.nationality ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('sum(total_length_meters):Q', title='Total Length (m)'),\n    y=alt.Y('nationality:N', sort='-x'),\n    color=alt.value('steelblue'),\n    tooltip=['nationality', alt.Tooltip('sum(total_length_meters):Q', title='Total Length (m)')]\n).properties(\n    title=\"Total Length of Bridges by Architect Nationality\"\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___stacked_bar_chart_with_sorted_segments___architecture.py"
    },
    {
        "type": "type_D",
        "db_id": "body_builder",
        "chart_category": "Circular Plots",
        "chart_type": "donut_chart",
        "NLQ": "Thanks for this donut chart showing the weight lifted by birth place. It gives me a general overview, but I'm having trouble interpreting some details. Could you make the chart a bit more informative by adding tooltips so I can see the exact weight values when I hover over each segment? Also, I think it would look more professional with a proper title and maybe a better color scheme - the default colors aren't very appealing. One last thing - it's hard to tell which birthplace contributes the most at a glance. Could you sort the segments from highest to lowest total weight? That would help me quickly identify the top birthplaces.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/body_builder.sqlite')\n\nquery = '''\nSELECT p.Birth_Place AS BirthPlace, SUM(b.Total) AS TotalWeightLifted\nFROM body_builder AS b\nJOIN people AS p ON b.People_ID = p.People_ID\nGROUP BY p.Birth_Place\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf = df.sort_values('TotalWeightLifted', ascending=False)\ndf['FormattedWeight'] = df['TotalWeightLifted'].apply(lambda x: f\"{x:,.0f} kg\")\n\nchart = alt.Chart(df).mark_arc(innerRadius=50).encode(\n    theta=alt.Theta(field=\"TotalWeightLifted\", type=\"quantitative\", stack=True),\n    color=alt.Color(\n        \"BirthPlace:N\",\n        scale=alt.Scale(scheme=\"viridis\"),\n        legend=alt.Legend(title=\"Birth Place\")\n    ),\n    tooltip=[\n        alt.Tooltip(\"BirthPlace\", title=\"Birth Place\"),\n        alt.Tooltip(\"FormattedWeight\", title=\"Total Weight Lifted\")\n    ],\n    order=alt.Order(\"TotalWeightLifted:Q\", sort=\"descending\")\n).properties(\n    title={\n        \"text\": \"Total Weight Lifted by Bodybuilders' Birth Place\",\n        \"subtitle\": \"Data aggregated from body_builder database\"\n    },\n    width=400,\n    height=400\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Circular Plots___donut_chart___body_builder.py"
    },
    {
        "type": "type_D",
        "db_id": "club_1",
        "chart_category": "Circular Plots",
        "chart_type": "pie_chart_with_labels",
        "NLQ": "Can you improve this pie chart by showing percentages instead of just gender labels? I'd like to see the actual percentage values displayed on the chart with one decimal place. Also, could you use a more appealing color scheme, maybe something in purple tones? Please add a proper legend too, and change the label from \"Sex\" to \"Gender\" to be more professional. One last thing - can you remove that outline around the chart to make it look cleaner?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/club_1.sqlite')\n\nquery = '''\nSELECT Sex, COUNT(*) AS count\nFROM Student\nGROUP BY Sex;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['percentage'] = (df['count'] / df['count'].sum()) * 100\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"count:Q\").stack(True),\n    alt.Color(\"Sex:N\", scale=alt.Scale(scheme='viridis'), title=\"Gender\")\n)\n\npie = base.mark_arc(outerRadius=120)\n\ntext = base.mark_text(radius=140, size=12).encode(text=alt.Text('percentage:Q', format='.1f', formatType='number'))\n\nchart = (pie + text).configure_view(stroke=None)\nchart",
        "original_code_path": "./vis_bench/vis_modify/Circular Plots___pie_chart_with_labels___club_1.py"
    },
    {
        "type": "type_D",
        "db_id": "coffee_shop",
        "chart_category": "Circular Plots",
        "chart_type": "pie_chart_with_labels",
        "NLQ": "This pie chart is a great start, thanks! However, the labels are a little hard to read being on the outside, and it would be really helpful to see the actual percentage breakdown for each membership type directly on the slices. Could you move the labels inside the slices, and instead of showing the membership card type's name, show the percentage? Also, it would be nice to have a legend, even if it's small, just to remind me which color corresponds to which membership card. And can you remove those thin borders around the chart?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/coffee_shop.sqlite')\n\nquery = '''\nSELECT Membership_card, COUNT(*) AS count\nFROM member\nGROUP BY Membership_card;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf['percentage'] = (df['count'] / df['count'].sum()) * 100\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"count:Q\").stack(True),\n    alt.Color(\"Membership_card:N\")\n)\n\npie = base.mark_arc(outerRadius=120)\n\ntext = base.mark_text(radius=70, size=12).encode(\n    text=alt.Text(\"percentage:Q\", format=\".1f\")\n)\n\nchart = (pie + text).configure_view(stroke=None)\nchart",
        "original_code_path": "./vis_bench/vis_modify/Circular Plots___pie_chart_with_labels___coffee_shop.py"
    },
    {
        "type": "type_D",
        "db_id": "college_3",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_custom_order",
        "NLQ": "This is a good chart showing the grade trends, but the course IDs on the bottom are a bit hard to read because they're so close together and vertical. Could we rotate them a bit, maybe at an angle, to make them easier to read? Also, just visually, could we change the color of the line and points to something a bit more visually appealing, like a nice blue color?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/college_3.sqlite')\n\nquery = '''\nSELECT \n    Course.CID AS CourseID,\n    Course.CName AS CourseName,\n    Enrolled_in.Grade,\n    Gradeconversion.gradepoint AS GradePoint\nFROM \n    Enrolled_in\nJOIN \n    Course ON Enrolled_in.CID = Course.CID\nJOIN \n    Gradeconversion ON Enrolled_in.Grade = Gradeconversion.lettergrade\nWHERE \n    Course.DNO = 600\nORDER BY \n    Course.CID;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ngrouped_df = df.groupby(['CourseID', 'CourseName'], as_index=False).agg({'GradePoint': 'mean'})\n\nchart = alt.Chart(grouped_df).mark_line(point=True, color='blue').encode(\n    x=alt.X(\"CourseID:N\", title=\"Course ID\", axis=alt.Axis(labelAngle=-45)),\n    y=alt.Y(\"GradePoint:Q\").title(\"Average Grade Points\"),\n    order=\"CourseID\",\n    tooltip=[\"CourseID\", \"CourseName\", \"GradePoint\"]\n).properties(\n    title=\"Trend of Average Grade Points by Course in Computer Science Department\"\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_custom_order___college_3.py"
    },
    {
        "type": "type_D",
        "db_id": "company_office",
        "chart_category": "Circular Plots",
        "chart_type": "radial_chart",
        "NLQ": "Can you improve this chart by using a better color scheme for the cities? Maybe something more categorical that makes it easier to distinguish between them. Also, instead of showing the company count on each arc segment, could you display the year instead? That would make it easier to see which year each segment represents. And for the tooltips, it would be helpful to see not just the individual counts but also the total number of companies for each city across all years. Finally, can you make the chart a bit bigger so it's easier to read? Maybe 500x500 pixels would be good.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_office.sqlite')\n\nquery = '''\nSELECT \n    b.City AS city,\n    o.move_in_year AS year,\n    COUNT(o.company_id) AS company_count\nFROM \n    Office_locations AS o\nJOIN \n    buildings AS b ON o.building_id = b.id\nGROUP BY \n    b.City, o.move_in_year\nORDER BY \n    b.City, o.move_in_year;\n'''\n\ndf = pd.read_sql_query(query, conn)\ndf[\"city_total\"] = df.groupby(\"city\")[\"company_count\"].transform(\"sum\")\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.Theta(\"company_count:Q\").stack(True, as_=\"normalized\"),\n    alt.Radius(\"company_count:Q\").scale(type=\"sqrt\", zero=True, rangeMin=20),\n    color=alt.Color(\"city:N\", scale=alt.Scale(scheme=\"category20b\"), legend=alt.Legend(title=\"City\")),\n    tooltip=[\n        alt.Tooltip(\"city:N\", title=\"City\"),\n        alt.Tooltip(\"year:Q\", title=\"Year\"),\n        alt.Tooltip(\"company_count:Q\", title=\"Companies in Year\"),\n        alt.Tooltip(\"city_total:Q\", title=\"Total Companies\")\n    ],\n)\n\narcs = base.mark_arc(innerRadius=20, stroke=\"#fff\")\n\nlabels = base.mark_text(radiusOffset=10).encode(\n    text=alt.Text(\"year:Q\")\n)\n\nchart = (arcs + labels).properties(\n    title=\"Companies Moving Into Buildings by City and Year\",\n    width=500,\n    height=500\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Circular Plots___radial_chart___company_office.py"
    },
    {
        "type": "type_D",
        "db_id": "cre_Doc_Tracking_DB",
        "chart_category": "Distributions",
        "chart_type": "boxplot_with_minmax_whiskers",
        "NLQ": "Could you make this boxplot more informative? I'd like to add a title that says \"Storage Duration Distribution by Document Type\" at the top. Also, can you color-code the boxplots by document type instead of keeping them all gray? It would be helpful to add tooltips so I can see the exact document type and duration when I hover over parts of the chart. And could you make the y-axis label more descriptive by adding \"- Time From Start To End of Storage\" to clarify what the storage duration actually means?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/cre_Doc_Tracking_DB.sqlite')\n\nquery = '''\nSELECT \n    T1.Document_Type_Name,\n    (julianday(T2.Date_Stored) - julianday(T3.Date_in_Location_From)) AS Storage_Duration\nFROM \n    Ref_Document_Types AS T1\nJOIN \n    All_Documents AS T2 ON T1.Document_Type_Code = T2.Document_Type_Code\nJOIN \n    Document_Locations AS T3 ON T2.Document_ID = T3.Document_ID\nWHERE \n    T3.Date_in_Location_From IS NOT NULL AND T2.Date_Stored IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_boxplot(extent='min-max').encode(\n    x=alt.X('Document_Type_Name:N', title='Document Type'),\n    y=alt.Y('Storage_Duration:Q', title='Storage Duration (Days)', \n            axis=alt.Axis(title='Storage Duration (Days) - Time From Start To End of Storage')),\n    color=alt.Color('Document_Type_Name:N', title='Document Type'),\n    tooltip=[alt.Tooltip('Document_Type_Name:N', title='Document Type'), \n             alt.Tooltip('Storage_Duration:Q', title='Storage Duration (Days)')]\n).properties(\n    title='Storage Duration Distribution by Document Type'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___boxplot_with_minmax_whiskers___cre_Doc_Tracking_DB.py"
    },
    {
        "type": "type_D",
        "db_id": "customers_campaigns_ecommerce",
        "chart_category": "Distributions",
        "chart_type": "distributions_and_medians_of_likert_scale_ratings",
        "NLQ": "Can you improve this chart by sorting the product categories based on their median quantities? Also, instead of all circles being the same blue color, could you use a gradient of blues to show different order quantities? That would make it easier to see the patterns. And for the tooltips, could you add more information like the exact order quantity and product category so I don't have to look back and forth?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/customers_campaigns_ecommerce.sqlite')\n\nquery = '''\nSELECT p.product_category, CAST(oi.item_order_quantity AS INTEGER) AS item_order_quantity\nFROM Order_Items AS oi\nJOIN Products AS p ON oi.product_id = p.product_id\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nmedians_df = df.groupby('product_category')['item_order_quantity'].median().reset_index()\nmedians_df.columns = ['product_category', 'median_quantity']\nmedians_df['lo'] = 'Low Quantity'\nmedians_df['hi'] = 'High Quantity'\nmedians_df = medians_df.sort_values(by='median_quantity')\n\ny_axis = alt.Y(\"product_category\", sort=medians_df['product_category']).axis(\n    title=\"Product Category\",\n    offset=50,\n    labelFontWeight=\"bold\",\n    ticks=False,\n    grid=True,\n    domain=False,\n)\n\nbase = alt.Chart(medians_df).encode(y_axis)\n\nbubbles = (\n    alt.Chart(df)\n    .mark_circle()\n    .encode(\n        alt.X(\"item_order_quantity:Q\").title(\"Item Order Quantity\"),\n        y_axis,\n        alt.Color('item_order_quantity:Q',\n                  scale=alt.Scale(scheme='blues'),\n                  legend=alt.Legend(title=\"Order Quantity\")),\n        alt.Size(\"count()\").legend(offset=75, title=\"Number of Orders\"),\n        tooltip=[\n            alt.Tooltip(\"item_order_quantity:Q\", title=\"Order Quantity\"),\n            alt.Tooltip(\"product_category:N\", title=\"Product Category\"),\n            alt.Tooltip(\"count()\", title=\"Number of Orders\")\n        ],\n    )\n)\n\nticks = base.mark_tick(color=\"black\").encode(alt.X(\"median_quantity:Q\").axis(grid=False))\n\ntexts_lo = base.mark_text(align=\"right\", x=-5).encode(text=\"lo\")\n\ntexts_hi = base.mark_text(align=\"left\", x=255).encode(text=\"hi\")\n\nchart = (bubbles + ticks + texts_lo + texts_hi).properties(\n    title=\"Distribution of Item Order Quantities by Product Category\", width=300, height=200\n).configure_view(stroke=None)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___distributions_and_medians_of_likert_scale_ratings___customers_campaigns_ecommerce.py"
    },
    {
        "type": "type_D",
        "db_id": "hr_1",
        "chart_category": "Scatter Plots",
        "chart_type": "brushing_scatter_plot_to_show_data_on_a_table",
        "NLQ": "Can you improve this scatter plot to make patterns more obvious? I'd like to color-code the points by department instead of just having them turn blue when selected. Also, could you add tooltips so I can see employee details when I hover over points? It would be helpful to add a trend line to show the overall relationship between salary and commission. And please add a title to the chart that describes what we're looking at. For the selected points, instead of changing their color, maybe just make the unselected points more transparent?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/hr_1.sqlite')\n\nquery = '''\nSELECT \n    e.FIRST_NAME,\n    e.LAST_NAME,\n    e.SALARY,\n    e.COMMISSION_PCT,\n    j.JOB_TITLE,\n    d.DEPARTMENT_NAME\nFROM \n    employees AS e\nJOIN \n    jobs AS j ON e.JOB_ID = j.JOB_ID\nJOIN \n    departments AS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\n\ntooltip = ['FIRST_NAME', 'LAST_NAME', 'JOB_TITLE', 'DEPARTMENT_NAME', 'SALARY', 'COMMISSION_PCT']\n\npoints = alt.Chart(df).mark_point().encode(\n    x=alt.X('SALARY:Q', title='Salary'),\n    y=alt.Y('COMMISSION_PCT:Q', title='Commission Percentage'),\n    color=alt.Color('DEPARTMENT_NAME:N', title='Department'),\n    tooltip=tooltip,\n    opacity=alt.condition(brush, alt.value(1), alt.value(0.2))\n).properties(\n    title='Salary vs. Commission Percentage by Department'\n).add_params(brush)\n\ntrend_line = alt.Chart(df).mark_line(\n    color='black',\n    strokeDash=[5, 5],\n    strokeWidth=1\n).transform_regression(\n    'SALARY', 'COMMISSION_PCT'\n).encode(\n    x='SALARY:Q',\n    y='COMMISSION_PCT:Q'\n)\n\nranked_text = alt.Chart(df).mark_text(align='right').encode(\n    y=alt.Y('row_number:O').axis(None)\n).transform_filter(\n    brush\n).transform_window(\n    row_number='row_number()'\n).transform_filter(\n    alt.datum.row_number < 15\n)\n\nfirst_name = ranked_text.encode(text='FIRST_NAME:N').properties(\n    title=alt.Title(text='First Name', align='right')\n)\nlast_name = ranked_text.encode(text='LAST_NAME:N').properties(\n    title=alt.Title(text='Last Name', align='right')\n)\njob_title = ranked_text.encode(text='JOB_TITLE:N').properties(\n    title=alt.Title(text='Job Title', align='right')\n)\ndepartment_name = ranked_text.encode(text='DEPARTMENT_NAME:N').properties(\n    title=alt.Title(text='Department', align='right')\n)\ntext = alt.hconcat(first_name, last_name, job_title, department_name)\n\nscatter_with_trend = alt.layer(points, trend_line)\n\nchart = alt.hconcat(\n    scatter_with_trend,\n    text\n).resolve_legend(\n    color=\"independent\"\n).configure_view(\n    stroke=None\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___brushing_scatter_plot_to_show_data_on_a_table___hr_1.py"
    },
    {
        "type": "type_D",
        "db_id": "products_for_hire",
        "chart_category": "Simple Charts",
        "chart_type": "simple_heatmap",
        "NLQ": "Can you make the heatmap easier to read by showing month names instead of numbers? Also, I'd like to use shades of blue for the color scheme to better highlight the differences between higher and lower amounts. It would be helpful if I could hover over each square to see the exact amount payable for that month and year.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/products_for_hire.sqlite')\n\nquery = '''\nSELECT \n    strftime('%Y', booking_start_date) AS year,\n    strftime('%m', booking_start_date) AS month,\n    SUM(amount_payable) AS total_amount_payable\nFROM Bookings\nGROUP BY year, month\nORDER BY year, month\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['month'] = pd.to_datetime(df['month'], format='%m').dt.strftime('%B')\n\nheatmap = alt.Chart(df).mark_rect().encode(\n    x=alt.X('month:O', title='Month', sort=list(pd.date_range(start='2000-01-01', periods=12, freq='M').strftime('%B'))),\n    y=alt.Y('year:O', title='Year'),\n    color=alt.Color('total_amount_payable:Q', title='Total Amount Payable', scale=alt.Scale(scheme='blues', reverse=True)),\n    tooltip=[alt.Tooltip('total_amount_payable:Q', title='Total Amount Payable')]\n).properties(\n    title='Total Amount Payable by Month and Year'\n)\n\nheatmap",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_heatmap___products_for_hire.py"
    },
    {
        "type": "type_D",
        "db_id": "local_govt_and_lot",
        "chart_category": "Scatter Plots",
        "chart_type": "faceted_scatter_plot",
        "NLQ": "Can you make this scatter plot more professional looking? I'd like to use circles instead of points and make them bigger based on the resident count. Please add colors for the different service types - maybe blue, orange, and red would look nice. Can you also show the exact numbers next to each point? The chart is too small right now, so please make it wider and taller with better spacing between the panels. Add a proper title like \"Resident Count by Service Type and Property Type\" with a subtitle explaining it's about satisfied residents. I need better axis labels too - \"Number of Residents\" and \"Service Type\" would be clearer. Could you add tooltips when hovering over points? And please improve the overall look with better grid lines, fonts, and legends at the top of the chart.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/local_govt_and_lot.sqlite')\n\nquery = '''\nSELECT \n    T1.service_type_code AS Service_Type,\n    COUNT(T2.resident_id) AS Resident_Count,\n    T3.property_type_code AS Property_Type\nFROM \n    Services AS T1\nJOIN \n    Residents_Services AS T2 ON T1.service_id = T2.service_id\nJOIN \n    Properties AS T3 ON T2.property_id = T3.property_id\nWHERE \n    T1.service_details = 'Satisfied'\nGROUP BY \n    T1.service_type_code, T3.property_type_code\nORDER BY \n    T1.service_type_code, T3.property_type_code;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ncolor_scale = alt.Scale(\n    domain=['Check', 'Cleaning', 'Moving Out'],\n    range=['#4c78a8', '#f58518', '#e45756']\n)\n\nbase = alt.Chart(df).mark_circle().encode(\n    x=alt.X(\"Resident_Count:Q\", \n            title=\"Number of Residents\",\n            scale=alt.Scale(domain=[0, df['Resident_Count'].max() + 1]),\n            axis=alt.Axis(grid=True, tickMinStep=1, labelFontSize=11)),\n    y=alt.Y(\"Service_Type:N\", \n            title=\"Service Type\",\n            axis=alt.Axis(labelFontSize=11, titleFontSize=13)),\n    color=alt.Color(\"Service_Type:N\", \n                    scale=color_scale,\n                    legend=alt.Legend(orient='top', title=\"Service Type\")),\n    size=alt.Size(\"Resident_Count:Q\", \n                 scale=alt.Scale(range=[100, 400]),\n                 legend=alt.Legend(title=\"Number of Residents\")),\n    tooltip=[\n        alt.Tooltip(\"Service_Type:N\", title=\"Service Type\"),\n        alt.Tooltip(\"Property_Type:N\", title=\"Property Type\"),\n        alt.Tooltip(\"Resident_Count:Q\", title=\"Number of Residents\", format=\",d\")\n    ]\n).properties(\n    width=250,\n    height=150\n)\n\ntext = alt.Chart(df).mark_text(\n    align='left',\n    baseline='middle',\n    dx=15,\n    fontSize=10,\n    fontWeight='bold'\n).encode(\n    x=\"Resident_Count:Q\",\n    y=\"Service_Type:N\",\n    text=alt.Text(\"Resident_Count:Q\", format=',d'),\n    color=alt.value('black')\n)\n\nchart = (base + text).facet(\n    row=alt.Row(\"Property_Type:N\", \n                title=\"Property Type\",\n                header=alt.Header(labelFontSize=13, titleFontSize=15))\n).properties(\n    title={\n        \"text\": \"Resident Count by Service Type and Property Type\",\n        \"subtitle\": \"Breakdown of satisfied residents across different property and service categories\"\n    }\n).configure_title(\n    fontSize=18,\n    font='Arial',\n    anchor='middle',\n    color='black',\n    subtitleFontSize=13,\n    subtitleColor='gray'\n).configure_view(\n    stroke='lightgray',\n    strokeWidth=1,\n    strokeOpacity=0.5\n).configure_axis(\n    labelFontWeight='normal',\n    titleFontWeight='bold',\n    grid=True,\n    gridColor='lightgray',\n    gridWidth=0.5\n).configure_legend(\n    labelFontSize=11,\n    titleFontSize=12\n).configure_facet(\n    spacing=10\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___faceted_scatter_plot___local_govt_and_lot.py"
    },
    {
        "type": "type_D",
        "db_id": "activity_1",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart",
        "NLQ": "Can you improve this chart to make it easier to understand? I'd like to sort the activities by total number of participants instead of alphabetically. Also, could you use nicer colors like blue and green for the bars? It would be helpful to add a title to the chart and more descriptive labels for the axes and legend. And when I hover over the bars, could you show me the exact numbers of students and faculty for each activity?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/activity_1.sqlite')\n\nquery = '''\nSELECT\n    A.activity_name,\n    COUNT(DISTINCT P.stuid) AS student_count,\n    COUNT(DISTINCT F.FacID) AS faculty_count\nFROM\n    Activity AS A\nLEFT JOIN\n    Participates_in AS P ON A.actid = P.actid\nLEFT JOIN\n    Faculty_Participates_in AS F ON A.actid = F.actid\nGROUP BY\n    A.activity_name\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_melted = df.melt(id_vars=['activity_name'],\n                    value_vars=['student_count', 'faculty_count'],\n                    var_name='participant_type',\n                    value_name='count')\n\ndf_total = df.copy()\ndf_total['total_count'] = df_total['student_count'] + df_total['faculty_count']\ndf_total = df_total.sort_values('total_count', ascending=False)\nsort_order = df_total['activity_name'].tolist()\n\nchart = alt.Chart(df_melted).mark_bar().encode(\n    x=alt.X('activity_name:N', sort=sort_order, title='Activity'),\n    y=alt.Y('sum(count):Q', title='Number of Participants'),\n    color=alt.Color('participant_type:N',\n                    scale=alt.Scale(range=['#4c78a8', '#a2c4c9']),\n                    title='Participant Type'),\n    tooltip=['activity_name', 'participant_type', 'count']\n).properties(\n    title='Participant Counts for Different Activities'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___stacked_bar_chart___activity_1.py"
    },
    {
        "type": "type_D",
        "db_id": "allergy_1",
        "chart_category": "Interactive Charts",
        "chart_type": "slider_cutoff",
        "NLQ": "This chart is helpful to see how many students of each age have food allergies, especially with the slider to focus on younger ages. However, the blue and red color scheme is a bit stark, could we maybe use something a bit softer, like green for below the cutoff and maybe a light blue for above? Also, when I'm looking at the bars, it's hard to read the exact number of students just from the side axis, would it be possible to show the exact count when I hover over each bar? That would make it much easier to quickly get the precise numbers for each age group. Finally, a title for the chart would be great so it's clear at a glance what I'm looking at, maybe something like \"Number of Students with Food Allergies by Age\". And could you also make the y-axis label more descriptive, like \"Number of Students\" instead of just \"NumStudents\"?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/allergy_1.sqlite')\n\nquery = '''\nSELECT S.Age, COUNT(*) AS NumStudents\nFROM Student AS S\nJOIN Has_Allergy AS HA ON S.StuID = HA.StuID\nJOIN Allergy_Type AS AT ON HA.Allergy = AT.Allergy\nWHERE AT.AllergyType = 'food'\nGROUP BY S.Age\nORDER BY S.Age\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nslider = alt.binding_range(min=df['Age'].min(), max=df['Age'].max(), step=1)\ncutoff = alt.param(bind=slider, value=df['Age'].min())\n\npredicate = alt.datum.Age < cutoff\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='Age:O',\n    y=alt.Y('NumStudents:Q', title='Number of Students'),\n    color=alt.condition(\n        predicate,\n        alt.value(\"green\"),\n        alt.value(\"lightblue\")\n    ),\n    tooltip=['Age', 'NumStudents']\n).add_params(\n    cutoff\n).properties(\n    title='Number of Students with Food Allergies by Age'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___slider_cutoff___allergy_1.py"
    },
    {
        "type": "type_D",
        "db_id": "baseball_1",
        "chart_category": "Bar Charts",
        "chart_type": "stacked_bar_chart_with_text_overlay",
        "NLQ": "I like this chart showing home run data with stacked bars comparing leagues over time, but could we make it look more modern? Can you change the color scheme to use shades of blue instead of the default colors? Also, the numbers directly on the bars make it look a bit cluttered. Could you remove those text labels and add tooltips instead so I can see the exact values when I hover over each bar segment?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/baseball_1.sqlite')\n\nquery = '''\nSELECT\n    year,\n    league_id,\n    SUM(hr) AS total_hr\nFROM\n    batting\nWHERE\n    league_id IN ('NL', 'AL') AND hr IS NOT NULL\nGROUP BY\n    year, league_id\nORDER BY\n    year ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ncolor_palette = ['#4c78a8', '#7db0dd']\n\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('sum(total_hr):Q').stack('zero').title('Total Home Runs'),\n    y=alt.Y('year:N').title('Year'),\n    color=alt.Color('league_id:N').title('League', scale=alt.Scale(range=color_palette)),\n    tooltip=['year:N', 'league_id:N', 'sum(total_hr):Q']\n).properties(title=\"Total Home Runs by League Over the Years\")\n\nchart = bars\nchart",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___stacked_bar_chart_with_text_overlay___baseball_1.py"
    },
    {
        "type": "type_D",
        "db_id": "chinook_1",
        "chart_category": "Advanced Calculations",
        "chart_type": "gantt_chart",
        "NLQ": "I really like the concept of this Gantt chart—it's really helpful to visualize how long each employee has been with the company. But I think it could use a few tweaks. First, the colors are a bit plain; could we add a color gradient to represent tenure length? Maybe longer tenure could have a darker shade, while shorter tenure is lighter? Also, having tooltips that show exact hire dates and tenure lengths in years would make the chart even easier to interpret. Lastly, the current order of employee names makes it hard to identify trends—could you sort the chart by tenure length, with employees with the longest tenure at the top? And could you make the chart a bit bigger so it's easier to read?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nfrom datetime import datetime\n\nconn = sqlite3.connect('database/chinook_1.sqlite')\n\nquery = '''\nSELECT \n    EmployeeId,\n    FirstName || ' ' || LastName AS FullName,\n    HireDate\nFROM \n    Employee\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ntoday = datetime.today()\ndf['start'] = df['HireDate'].apply(lambda x: datetime.strptime(x, '%Y-%m-%d %H:%M:%S').year)\ndf['end'] = today.year\ndf['tenure'] = df['end'] - df['start']\ndf.sort_values(by='tenure', ascending=False, inplace=True)\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='start:O',\n    x2='end:O',\n    y=alt.Y('FullName:N', title=\"Employee Name\", sort='-x'),\n    color=alt.Color('tenure:Q', scale=alt.Scale(scheme='blues'), title=\"Tenure Length (Years)\"),\n    tooltip=[alt.Tooltip('FullName:N', title=\"Employee Name\"),\n             alt.Tooltip('start:O', title=\"Start Year\"),\n             alt.Tooltip('end:O', title=\"Current Year\"),\n             alt.Tooltip('tenure:Q', title=\"Tenure Length (Years)\")]\n).properties(\n    title=\"Employee Tenure at the Company\",\n    width=700,\n    height=400\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___gantt_chart___chinook_1.py"
    },
    {
        "type": "type_D",
        "db_id": "candidate_poll",
        "chart_category": "Advanced Calculations",
        "chart_type": "gantt_chart",
        "NLQ": "Can you make this Gantt chart more informative? I'd like to see different colors for each poll source and add tooltips that show the support rate when I hover over the bars. Also, could you sort the chart by support rate instead of candidate ID and add a title that explains what we're looking at?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/candidate_poll.sqlite')\n\nquery = '''\nSELECT Poll_Source, Candidate_ID, Support_rate\nFROM candidate\nORDER BY Support_rate DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf['start'] = df['Candidate_ID']\ndf['end'] = df['Candidate_ID'] + 1\ndf['task'] = df['Poll_Source']\n\nchart = alt.Chart(df).mark_bar().encode(\n    x='start',\n    x2='end',\n    y=alt.Y('task', sort=alt.EncodingSortField(field=\"Support_rate\", order=\"descending\")),\n    color='task:N',\n    tooltip=['Poll_Source', 'Candidate_ID', 'Support_rate']\n).properties(\n    title='Candidate Poll Sources Sorted by Support Rate'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___gantt_chart___candidate_poll.py"
    },
    {
        "type": "type_D",
        "db_id": "culture_company",
        "chart_category": "Advanced Calculations",
        "chart_type": "ranged_dot_plot",
        "NLQ": "This is a really helpful visualization for comparing movie budgets and worldwide gross! It's a bit hard to quickly see which movies were the most successful financially though. Could we possibly sort the movies so the ones that made the most money worldwide are listed at the top? That way, it's easier to immediately see the top performers. Also, when I look at the chart, it would be great if I could hover over the dots and actually see the exact budget and gross numbers pop up - that would save me from having to guess the values from the axis. One more thing - could you add a title to the chart that says something like \"Movie Budgets vs. Worldwide Gross Earnings\" and maybe label the x-axis to show that the values are in millions of dollars?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/culture_company.sqlite')\n\nquery = '''\nSELECT Title, Budget_million, Gross_worldwide\nFROM movie\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf = df.sort_values(by='Gross_worldwide', ascending=False)\n\ndf_melted = pd.melt(df, id_vars=['Title'], value_vars=['Budget_million', 'Gross_worldwide'], var_name='Measure', value_name='Value')\n\nchart = alt.Chart(df_melted).mark_line(color=\"#db646f\").encode(\n    y=alt.Y('Title:N', sort=None),\n    x=alt.X('Value:Q', title='Value (Millions of USD)'),\n    detail='Title:N'\n)\n\npoints = alt.Chart(df_melted).mark_point(\n    size=100,\n    opacity=1,\n    filled=True,\n).encode(\n    y=alt.Y('Title:N', sort=None),\n    x=alt.X('Value:Q'),\n    color=alt.Color('Measure:N').scale(domain=['Budget_million', 'Gross_worldwide'], range=[\"#e6959c\", \"#911a24\"]),\n    tooltip=['Title', 'Measure', 'Value']\n)\n\nfinal_chart = (chart + points).properties(\n    title='Movie Budgets vs. Worldwide Gross Earnings'\n)\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Advanced Calculations___ranged_dot_plot___culture_company.py"
    },
    {
        "type": "type_D",
        "db_id": "dog_kennels",
        "chart_category": "Distributions",
        "chart_type": "faceted_histogram",
        "NLQ": "I really like the overall structure of this chart with the faceted histograms for each treatment type, but it feels a bit plain visually. Could you add a bit more color to differentiate the treatment types more clearly? Maybe each facet's bars could have a unique color associated with the treatment type—just something to make it more visually engaging. Also, it would be great if I could see some specific details when I hover over the bars, like the treatment type and the precise cost range covered by each bin. One last thing—right now the chart lacks a title or clear labels on the axes. Could you add a title to the chart and better labels for the x-axis and y-axis so it's easier to understand at a glance? Thanks!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/dog_kennels.sqlite')\n\nquery = '''\nSELECT \n    T1.treatment_type_description AS treatment_type,\n    T2.cost_of_treatment AS cost\nFROM \n    Treatment_Types AS T1\nJOIN \n    Treatments AS T2\nON \n    T1.treatment_type_code = T2.treatment_type_code\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    alt.X(\"cost:Q\", bin=alt.Bin(maxbins=20), title=\"Cost of Treatment (Binned)\"),\n    alt.Y(\"count()\", title=\"Number of Treatments\"),\n    alt.Color(\"treatment_type:N\", title=\"Treatment Type\"),\n    row=alt.Row(\"treatment_type:N\", title=None),\n    tooltip=[\n        alt.Tooltip(\"treatment_type:N\", title=\"Treatment Type\"),\n        alt.Tooltip(\"cost:Q\", bin=alt.Bin(maxbins=20), title=\"Cost Range (Bin)\"),\n        alt.Tooltip(\"count()\", title=\"Number of Treatments\")\n    ]\n).properties(\n    title=\"Distribution of Treatment Costs by Treatment Type\"\n).configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n).configure_title(\n    fontSize=16,\n    anchor='start'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Distributions___faceted_histogram___dog_kennels.py"
    },
    {
        "type": "type_D",
        "db_id": "driving_school",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_sequence_generator",
        "NLQ": "Can you make the lines in this chart thicker so they're easier to see? Also, I'd like to see the actual data points on the lines - maybe add circles at each point so I can tell where the actual payment dates are. And it would be helpful if I could hover over these points to see the exact date, payment method, and cumulative amount for each one.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/driving_school.sqlite')\n\nquery = '''\nSELECT \n    DATE(datetime_payment) AS payment_date,\n    payment_method_code,\n    SUM(amount_payment) AS total_payment\nFROM \n    Customer_Payments\nGROUP BY \n    payment_date, payment_method_code\nORDER BY \n    payment_date\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nline_chart = alt.Chart(df).mark_line(strokeWidth=2.5).encode(\n    x=alt.X('payment_date:T', title='Payment Date'),\n    y=alt.Y('sum(total_payment):Q', title='Cumulative Payment Amount'),\n    color=alt.Color('payment_method_code:N', title='Payment Method')\n).transform_window(\n    cumulative_sum='sum(total_payment)',\n    frame=[None, 0],\n    groupby=['payment_method_code']\n).encode(\n    y=alt.Y('cumulative_sum:Q', title='Cumulative Payment Amount')\n)\n\npoints = alt.Chart(df).mark_circle(size=50).encode(\n    x=alt.X('payment_date:T', title='Payment Date'),\n    y=alt.Y('cumulative_sum:Q', title='Cumulative Payment Amount'),\n    color=alt.Color('payment_method_code:N', title='Payment Method'),\n     tooltip=['payment_date:T', 'cumulative_sum:Q', 'payment_method_code:N']\n).transform_window(\n        cumulative_sum='sum(total_payment)',\n        frame=[None,0],\n        groupby=['payment_method_code']\n)\n\nfinal_chart = line_chart + points\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_sequence_generator___driving_school.py"
    },
    {
        "type": "type_D",
        "db_id": "employee_hire_evaluation",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_a_global_mean_overlay",
        "NLQ": "Can you make this histogram more visually appealing? I'd like to see a blue gradient color for the bars based on frequency instead of the plain bars. Also, could you add labels showing the count on top of each bar? The red line showing the mean age is good, but could you add a \"Mean Age\" label next to it so it's clear what it represents? And can you improve the axis labels - specifically add \"Frequency\" as the y-axis title? Finally, could you make the chart a bit larger and clean up the styling with better font sizes?",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/employee_hire_evaluation.sqlite')\nquery = \"SELECT Age FROM employee;\"\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df)\n\nbar = base.mark_bar().encode(\n    alt.X('Age:Q', bin=alt.Bin(maxbins=30), title='Employee Age'),\n    y=alt.Y('count()', title='Frequency'),\n    color=alt.Color('count():Q', scale=alt.Scale(scheme='blues'), legend=None),\n    tooltip=['count()', 'Age']\n).properties(\n    width=600,\n    height=400\n)\n\nrule = base.mark_rule(color='red', size=2).encode(\n    x='mean(Age):Q'\n)\n\nmean_label = base.mark_text(align='left', dx=5, dy=-5, color='red').encode(\n    x='mean(Age):Q',\n    text=alt.value('Mean Age')\n)\n\nbar_labels = base.mark_text(\n    dy=-5,\n    color='black'\n).encode(\n    alt.X('Age:Q', bin=alt.Bin(maxbins=30)),\n    y='count()',\n    text='count():Q'\n)\n\nchart = (bar + rule + mean_label + bar_labels).configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n).configure_view(\n    strokeWidth=0\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___histogram_with_a_global_mean_overlay___employee_hire_evaluation.py"
    },
    {
        "type": "type_D",
        "db_id": "e_learning",
        "chart_category": "Distributions",
        "chart_type": "histogram_with_responsive_bins",
        "NLQ": "Can you make this chart more visually appealing by adding a blue color gradient to the bars? Also, the y-axis labels look a bit crowded - could you make them smaller? It would also be helpful if I could see the exact registration count when I hover over each bar.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/e_learning.sqlite')\n\nquery = '''\nSELECT \n    strftime('%H', date_of_registration) AS hour_of_registration,\n    COUNT(*) AS registration_count\nFROM Students\nGROUP BY hour_of_registration\nORDER BY hour_of_registration\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval(encodings=['x'])\n\nbase = alt.Chart(df).mark_bar().encode(\n    y=alt.Y('registration_count:Q', axis=alt.Axis(labelFontSize=8)),\n    tooltip=['hour_of_registration', 'registration_count']\n).properties(\n    width=600,\n    height=100\n)\n\nchart = alt.vconcat(\n    base.encode(\n        alt.X('hour_of_registration:Q')\n          .bin(maxbins=24, extent=brush)\n          .scale(domain=brush),\n        y='registration_count:Q',\n        color=alt.Color('hour_of_registration:Q', bin=alt.Bin(maxbins=24), scale=alt.Scale(scheme='blues'))\n    ),\n    base.encode(\n        alt.X('hour_of_registration:Q').bin(maxbins=24),\n        y='registration_count:Q',\n        color=alt.Color('hour_of_registration:Q', bin=alt.Bin(maxbins=24), scale=alt.Scale(scheme='blues'))\n    ).add_params(brush)\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Distributions___histogram_with_responsive_bins___e_learning.py"
    },
    {
        "type": "type_D",
        "db_id": "game_injury",
        "chart_category": "Line Charts",
        "chart_type": "step_chart",
        "NLQ": "Can you make the line thicker and add points at each season to highlight the exact injury counts? I'd also like to change the title to something more engaging like \"Seasonal Trends in Player Injuries\". And could you add tooltips so I can see the season and injury count when I hover over the points?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/game_injury.sqlite')\n\nquery = '''\nSELECT \n    g.Season AS season,\n    COUNT(i.id) AS injury_count\nFROM \n    game AS g\nJOIN \n    injury_accident AS i ON g.id = i.game_id\nGROUP BY \n    g.Season\nORDER BY \n    g.Season\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_line(interpolate='step-after', strokeWidth=3, point=True).encode(\n    x=alt.X('season:O', title='Season'),\n    y=alt.Y('injury_count:Q', title='Total Injuries'),\n    tooltip=['season', 'injury_count']\n).properties(\n    title='Seasonal Trends in Player Injuries'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___step_chart___game_injury.py"
    },
    {
        "type": "type_D",
        "db_id": "insurance_and_eClaims",
        "chart_category": "Scatter Plots",
        "chart_type": "brushing_scatter_plot_to_show_data_on_a_table",
        "NLQ": "Can you color-code the points in the scatter plot by claim type instead of just using blue? That would help me see the different types more easily when I select them. Also, could you add the Amount Claimed and Amount Paid values to the data table on the right? And can you make the table wider so it's easier to read all the information? Right now it feels a bit cramped.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_and_eClaims.sqlite')\n\nquery = '''\nSELECT \n    ch.Claim_Header_ID,\n    ch.Amount_Claimed,\n    ch.Amount_Piad AS Amount_Paid,\n    ch.Claim_Type_Code,\n    ch.Date_of_Settlement\nFROM \n    Claim_Headers AS ch\nWHERE \n    ch.Amount_Claimed IS NOT NULL AND ch.Amount_Piad IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df).mark_point().encode(\n    x=alt.X('Amount_Claimed:Q', title='Amount Claimed'),\n    y=alt.Y('Amount_Paid:Q', title='Amount Paid'),\n    color=alt.condition(brush, 'Claim_Type_Code:N', alt.value(\"grey\")),\n    tooltip=['Claim_Type_Code:N', 'Date_of_Settlement:T']\n).add_params(brush).properties(width=400, height=400)\n\nranked_text = alt.Chart(df).mark_text(align='right').encode(\n    y=alt.Y('row_number:O').axis(None)\n).transform_filter(brush).transform_window(\n    row_number='row_number()'\n).transform_filter(alt.datum.row_number < 15)\n\nclaim_type = ranked_text.encode(text='Claim_Type_Code:N').properties(\n    title=alt.Title(text='Claim Type', align='right'), width=100\n)\nsettlement_date = ranked_text.encode(text='Date_of_Settlement:T').properties(\n    title=alt.Title(text='Settlement Date', align='right'), width=150\n)\namount_claimed = ranked_text.encode(text='Amount_Claimed:Q').properties(\n    title=alt.Title(text='Amount Claimed', align='right'), width=100\n)\namount_paid = ranked_text.encode(text='Amount_Paid:Q').properties(\n    title=alt.Title(text='Amount Paid', align='right'), width=100\n)\n\ntext = alt.hconcat(claim_type, settlement_date, amount_claimed, amount_paid)\n\nchart = alt.hconcat(points, text).resolve_legend(\n    color=\"independent\"\n).configure_view(stroke=None)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___brushing_scatter_plot_to_show_data_on_a_table___insurance_and_eClaims.py"
    },
    {
        "type": "type_D",
        "db_id": "insurance_policies",
        "chart_category": "Scatter Plots",
        "chart_type": "bubble_plot",
        "NLQ": "Can you make the bubbles in my chart a bit see-through so I can see overlapping points better? Also, could you add gridlines to help me compare values more easily? One more thing - it would be really helpful if I could hover over the bubbles to see all the details about each claim. Thanks!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/insurance_policies.sqlite')\n\nquery = '''\nSELECT \n    Claims.Claim_ID,\n    Claims.Amount_Claimed,\n    Claims.Amount_Settled,\n    (Claims.Amount_Claimed - Claims.Amount_Settled) AS Difference,\n    Customer_Policies.Policy_Type_Code\nFROM \n    Claims\nJOIN \n    Customer_Policies ON Claims.Policy_ID = Customer_Policies.Policy_ID\nWHERE \n    strftime('%Y', Claims.Date_Claim_Made) = '2017'\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_point(opacity=0.5).encode(\n    x=alt.X('Amount_Claimed:Q', axis=alt.Axis(grid=True)),\n    y=alt.Y('Amount_Settled:Q', axis=alt.Axis(grid=True)),\n    size='Difference:Q',\n    color='Policy_Type_Code:N',\n    shape='Policy_Type_Code:N',\n    tooltip=['Claim_ID', 'Amount_Claimed', 'Amount_Settled', 'Difference', 'Policy_Type_Code']\n).properties(title='Relationship Between Amount Claimed and Amount Settled (2017)')\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___bubble_plot___insurance_policies.py"
    },
    {
        "type": "type_D",
        "db_id": "museum_visit",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_plot_with_href",
        "NLQ": "Can you make this scatter plot look more professional? I'd like to add a title at the top that says something like \"Relationship Between Tickets Purchased and Total Spending at Museums.\" Also, could you add proper labels to the axes - maybe \"Number of Tickets Purchased\" for the x-axis and \"Total Spending (in USD)\" for the y-axis? It would also be helpful if you could color-code the points by museum name so it's easier to tell them apart. Keep the Google search links when clicking on points, that's a nice feature. And maybe make the title stand out a bit more with better formatting?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/museum_visit.sqlite')\nquery = '''\nSELECT \n    m.Name AS Museum_Name,\n    v.Num_of_Ticket,\n    v.Total_spent\nFROM \n    visit AS v\nJOIN \n    museum AS m ON v.Museum_ID = m.Museum_ID\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_calculate(\n    url='https://www.google.com/search?q=' + alt.datum.Museum_Name\n).mark_point().encode(\n    x=alt.X('Num_of_Ticket:Q', title='Number of Tickets Purchased'),\n    y=alt.Y('Total_spent:Q', title='Total Spending (in USD)'),\n    color=alt.Color('Museum_Name:N', title='Museum'),\n    href='url:N',\n    tooltip=['Museum_Name:N', 'Num_of_Ticket:Q', 'Total_spent:Q']\n).properties(\n    title='Relationship Between Tickets Purchased and Total Spending at Museums'\n).configure_title(\n    fontSize=16, font='Arial', anchor='start', color='black'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___scatter_plot_with_href___museum_visit.py"
    },
    {
        "type": "type_D",
        "db_id": "orchestra",
        "chart_category": "Scatter Plots",
        "chart_type": "scatter_plot_with_shaded_area",
        "NLQ": "Can you make this scatter plot more visually appealing? I'd like to see the points colored based on the years of work using a nice color gradient. Also, could you add tooltips so I can see the exact age and years of work when I hover over each point? And please add a title to the chart that explains what we're looking at - something about the relationship between conductor age and years of work.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/orchestra.sqlite')\nquery = '''\nSELECT Age, Year_of_Work\nFROM conductor\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nshaded_area = pd.DataFrame({\n    \"x1\": [40],\n    \"x2\": [42]\n})\n\npoints = alt.Chart(df).mark_point().encode(\n    x=alt.X(\"Age:Q\", title=\"Conductor Age\"),\n    y=alt.Y(\"Year_of_Work:Q\", title=\"Years of Work\"),\n    color=alt.Color(\"Year_of_Work:Q\", scale=alt.Scale(scheme=\"viridis\"), title=\"Years of Work\"),\n    tooltip=[\"Age:Q\", \"Year_of_Work:Q\"]\n)\n\ninterval = alt.Chart(shaded_area).mark_rect(opacity=0.3, color=\"#FF0000\").encode(\n    x=\"x1:Q\",\n    x2=\"x2:Q\"\n)\n\nchart = (points + interval).properties(\n    title=\"Relationship Between Conductor Age and Years of Work\"\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___scatter_plot_with_shaded_area___orchestra.py"
    },
    {
        "type": "type_D",
        "db_id": "poker_player",
        "chart_category": "Simple Charts",
        "chart_type": "simple_heatmap",
        "NLQ": "Can you make this heatmap easier to read? I'd prefer a lighter blue color scheme instead of the current dark one. Also, could you add tooltips so I can see the exact earnings when I hover over each square? One more thing - it would be great if I could filter the data by clicking on nationalities to focus on specific countries.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/poker_player.sqlite')\n\nquery = '''\nSELECT \n    p.Nationality,\n    pp.Final_Table_Made,\n    SUM(pp.Earnings) AS Total_Earnings\nFROM \n    poker_player AS pp\nJOIN \n    people AS p ON pp.People_ID = p.People_ID\nGROUP BY \n    p.Nationality, pp.Final_Table_Made\nORDER BY \n    p.Nationality, pp.Final_Table_Made;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nselection = alt.selection_single(fields=['Nationality'], bind='legend', name='Filter')\n\nheatmap = alt.Chart(df).mark_rect().encode(\n    x=alt.X('Final_Table_Made:O', title='Final Tables Made'),\n    y=alt.Y('Nationality:O', title='Nationality'),\n    color=alt.Color('Total_Earnings:Q', title='Total Earnings', scale=alt.Scale(scheme='blues')),\n    tooltip=[\n        alt.Tooltip('Nationality:N', title='Nationality'),\n        alt.Tooltip('Final_Table_Made:O', title='Final Tables Made'),\n        alt.Tooltip('Total_Earnings:Q', title='Total Earnings')\n    ],\n    opacity=alt.condition(selection, alt.value(1), alt.value(0.3))\n).properties(\n    width=600,\n    height=400,\n    title=\"Heatmap of Poker Players' Earnings by Nationality and Final Tables Made\"\n).add_selection(\n    selection\n)\n\nheatmap",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_heatmap___poker_player.py"
    },
    {
        "type": "type_D",
        "db_id": "protein_institute",
        "chart_category": "Bar Charts",
        "chart_type": "calculating_percentage_of_total",
        "NLQ": "Can you make this chart more visually appealing? I'd like to sort the buildings by height with the tallest at the top, and add a blue color gradient to the bars based on their heights. Please add a proper title like \"Buildings' Contribution to Total Height\" and better axis titles. It would be helpful to see tooltips when I hover over each bar showing the building name, exact percentage, and actual height in feet. Also, can you make the chart interactive and adjust the font sizes to make it more readable? The title should be gray and aligned to the left.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/protein_institute.sqlite')\n\nquery = '''\nSELECT Name, Height_feet\nFROM building\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).transform_joinaggregate(\n    TotalHeight='sum(Height_feet)',\n).transform_calculate(\n    PercentOfTotal=\"datum.Height_feet / datum.TotalHeight\"\n).mark_bar().encode(\n    alt.X('PercentOfTotal:Q', axis=alt.Axis(format='.0%', title='Percentage of Total Height')),\n    y=alt.Y('Name:N', sort='-x', title='Building Name'),\n    color=alt.Color('Height_feet:Q', scale=alt.Scale(scheme='blues'), legend=None)\n).properties(\n    title='Buildings\\' Contribution to Total Height'\n).configure_axis(\n    labelFontSize=12,\n    titleFontSize=14\n).configure_title(\n    fontSize=18,\n    anchor='start',\n    color='gray'\n).add_selection(\n    alt.selection_interval()\n).interactive()\n\nchart = chart.encode(\n    tooltip=[alt.Tooltip('Name:N', title='Building'),\n             alt.Tooltip('PercentOfTotal:Q', format='.1%', title='Percent of Total Height'),\n             alt.Tooltip('Height_feet:Q', title='Height (ft)')]\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___calculating_percentage_of_total___protein_institute.py"
    },
    {
        "type": "type_D",
        "db_id": "race_track",
        "chart_category": "Bar Charts",
        "chart_type": "calculating_percentage_of_total",
        "NLQ": "Can you make this bar chart more visually appealing by adding colors to each bar? Also, I'd like to sort the bars by percentage so I can easily see which locations have the most races. It would be helpful if I could hover over each bar and see both the exact number of races and the percentage for that location. Oh, and could you add a title to the chart that says \"Percentage of Races by Track Location\"?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/race_track.sqlite')\n\nquery = '''\nSELECT \n    t.Location AS Track_Location,\n    COUNT(r.Race_ID) AS Race_Count\nFROM \n    race AS r\nJOIN \n    track AS t\nON \n    r.Track_ID = t.Track_ID\nGROUP BY \n    t.Location\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).transform_joinaggregate(\n    TotalRaces='sum(Race_Count)',\n).transform_calculate(\n    PercentOfTotal=\"datum.Race_Count / datum.TotalRaces\"\n).mark_bar().encode(\n    x=alt.X('PercentOfTotal:Q').axis(format='.0%'),\n    y=alt.Y('Track_Location:N', sort='-x'),\n    color=alt.Color('Track_Location:N', scale=alt.Scale(scheme='category20b')),\n    tooltip=[\n        alt.Tooltip('Track_Location:N', title='Location'),\n        alt.Tooltip('Race_Count:Q', title='Number of Races'),\n        alt.Tooltip('PercentOfTotal:Q', format='.2%', title='Percent of Total')\n    ]\n).properties(\n    title='Percentage of Races by Track Location'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___calculating_percentage_of_total___race_track.py"
    },
    {
        "type": "type_D",
        "db_id": "school_bus",
        "chart_category": "Interactive Charts",
        "chart_type": "interval_selection_with_initial_date_range",
        "NLQ": "Can you make the bars green instead of the default color? Also, I'd like to see the exact values when I hover over the bars - could you add tooltips that show both the years working and the number of drivers?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/school_bus.sqlite')\n\nquery = '''\nSELECT sb.Years_Working, COUNT(*) AS Driver_Count\nFROM school_bus AS sb\nJOIN driver AS d ON sb.Driver_ID = d.Driver_ID\nGROUP BY sb.Years_Working\nORDER BY sb.Years_Working\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ninitial_range = (5, 10)\n\nbrush = alt.selection_interval(encodings=['x'], value={'x': initial_range})\n\nbase = alt.Chart(df, width=600, height=200).mark_bar(color='seagreen').encode(\n    x=alt.X('Years_Working:Q', title='Years Working'),\n    y=alt.Y('Driver_Count:Q', title='Number of Drivers'),\n    tooltip=['Years_Working', 'Driver_Count']\n)\n\nupper = base.encode(\n    alt.X('Years_Working:Q').scale(domain=brush)\n)\n\nlower = base.properties(\n    height=60\n).add_params(brush)\n\nchart = upper & lower\nchart",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___interval_selection_with_initial_date_range___school_bus.py"
    },
    {
        "type": "type_D",
        "db_id": "school_finance",
        "chart_category": "Simple Charts",
        "chart_type": "simple_stacked_area_chart",
        "NLQ": "This chart is helpful for seeing the budget and investment trends across schools over the years. However, the colors are a little bit standard and not very visually engaging. Could we maybe use a more vibrant color palette, something that's easier on the eyes? Also, it's a bit hard to read the exact amounts for each school and year just by looking at the areas. It would be great if we could see the precise budgeted and invested amounts when we hover the mouse over each section of the chart. That would make it much easier to get the specific numbers we need.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/school_finance.sqlite')\n\nquery = '''\nSELECT \n    S.School_name AS School,\n    B.Year AS Year,\n    SUM(B.Budgeted) AS Total_Budgeted,\n    SUM(B.Invested) AS Total_Invested\nFROM \n    budget AS B\nJOIN \n    School AS S ON B.School_id = S.School_id\nGROUP BY \n    S.School_name, B.Year\nORDER BY \n    B.Year\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\ndf_melted = df.melt(id_vars=['School', 'Year'], value_vars=['Total_Budgeted', 'Total_Invested'], \n                    var_name='Category', value_name='Amount')\n\nchart = alt.Chart(df_melted).mark_area().encode(\n    x=alt.X(\"Year:O\", title=\"Year\"),\n    y=alt.Y(\"Amount:Q\", title=\"Amount\"),\n    color=alt.Color(\"School:N\", title=\"School\", scale=alt.Scale(scheme='viridis')),\n    row=alt.Row(\"Category:N\", title=\"Category\"),\n    tooltip=['School', 'Year', 'Category', 'Amount']\n).properties(\n    width=600,\n    height=150\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_stacked_area_chart___school_finance.py"
    },
    {
        "type": "type_D",
        "db_id": "school_player",
        "chart_category": "Interactive Charts",
        "chart_type": "interval_selection_with_initial_date_range",
        "NLQ": "Can you make the chart more colorful and easier to read? I'd like the line to be dark red and the points dark blue and bigger so they stand out more. Also, could you add the enrollment numbers as text labels next to each point so I don't have to hover to see the values? And maybe add some gridlines on the year axis to make it easier to see the time periods? Thanks!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\nimport datetime as dt\n\nconn = sqlite3.connect('database/school_player.sqlite')\n\nquery = '''\nSELECT School, Year_Entered_Competition, Enrollment\nFROM school\nWHERE Year_Entered_Competition IS NOT NULL AND Enrollment IS NOT NULL\nORDER BY Year_Entered_Competition\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndate_range = (dt.date(1900, 1, 1), dt.date(2000, 1, 1))\nbrush = alt.selection_interval(encodings=['x'], value={'x': date_range})\n\nbase = alt.Chart(df, width=600, height=200).mark_line(point=alt.OverlayMarkDef(color='darkblue', size=100)).encode(\n    x=alt.X('Year_Entered_Competition:T', title='Year Entered Competition', axis=alt.Axis(grid=True)),\n    y=alt.Y('Enrollment:Q', title='Enrollment'),\n    tooltip=['School:N', 'Year_Entered_Competition:T', 'Enrollment:Q'],\n    color=alt.value('darkred')\n)\n\ntext = base.mark_text(align='left', dx=5, dy=-5).encode(\n    text=alt.Text('Enrollment:Q', format='.0f')\n)\n\nupper = (base + text).encode(\n    alt.X('Year_Entered_Competition:T').scale(domain=brush)\n)\n\nlower = base.properties(\n    height=60\n).add_params(brush)\n\nchart = upper & lower\nchart",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___interval_selection_with_initial_date_range___school_player.py"
    },
    {
        "type": "type_D",
        "db_id": "scientist_1",
        "chart_category": "Simple Charts",
        "chart_type": "simple_strip_plot",
        "NLQ": "Can you make this chart more informative and interactive? I'd like to add axis titles like \"Hours Allocated\" and \"Project Code\" so it's clearer what we're looking at. Also, could you give each project a different color to help tell them apart? And it would be really helpful if I could hover over each mark to see the project code and exact number of hours in a tooltip.",
        "code": "import altair as alt\nimport pandas as pd\nimport sqlite3\n\nconn = sqlite3.connect('database/scientist_1.sqlite')\nquery = '''\nSELECT Code, Hours\nFROM Projects\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_tick().encode(\n    x=alt.X('Hours:Q', title='Hours Allocated'),\n    y=alt.Y('Code:O', title='Project Code'),\n    color='Code:N',\n    tooltip=['Code:N', 'Hours:Q']\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_strip_plot___scientist_1.py"
    },
    {
        "type": "type_D",
        "db_id": "singer",
        "chart_category": "Tables",
        "chart_type": "annual_weather_heatmap",
        "NLQ": "Can you make the song titles on the x-axis easier to read? Maybe rotate them a bit so they don't overlap. Also, I'd like to change the color scheme to better show which songs performed best - maybe use a greenblue gradient where darker colors represent better chart positions? And could you add some interactivity so I can zoom in and focus on specific parts of the chart?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/singer.sqlite')\n\nquery = '''\nSELECT \n    s.Birth_Year AS Singer_Birth_Year,\n    so.Title AS Song_Title,\n    MIN(so.Highest_Position) AS Best_Position\nFROM \n    singer AS s\nJOIN \n    song AS so\nON \n    s.Singer_ID = so.Singer_ID\nGROUP BY \n    s.Birth_Year, so.Title\nORDER BY \n    s.Birth_Year ASC, Best_Position ASC;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, title=\"Best Chart Positions by Singer Birth Year\").mark_rect().encode(\n    alt.X(\"Song_Title:N\")\n        .title(\"Song Title\")\n        .axis(labelAngle=-45),\n    alt.Y(\"Singer_Birth_Year:N\")\n        .title(\"Singer Birth Year\"),\n    alt.Color(\"Best_Position:Q\")\n        .title(\"Best Position\")\n        .scale(scheme=\"greenblue\", reverse=True),\n    tooltip=[\n        alt.Tooltip(\"Song_Title\", title=\"Song Title\"),\n        alt.Tooltip(\"Singer_Birth_Year\", title=\"Singer Birth Year\"),\n        alt.Tooltip(\"Best_Position\", title=\"Best Position\"),\n    ]\n).add_selection(\n    alt.selection(type=\"interval\", bind=\"scales\"),\n).configure_view(\n    step=13,\n    strokeWidth=0\n).configure_axis(\n    domain=False\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Tables___annual_weather_heatmap___singer.py"
    },
    {
        "type": "type_D",
        "db_id": "singer",
        "chart_category": "Bar Charts",
        "chart_type": "grouped_bar_chart_with_error_bars",
        "NLQ": "Can you improve this chart by sorting the countries from highest to lowest average net worth instead of alphabetically? Also, instead of using different colors for each country, could you use a blue gradient where darker blue means higher net worth? It would be helpful to add tooltips too, so when I hover over a bar or error bar, I can see the exact average net worth, minimum and maximum values, and how many singers are from each country.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/singer.sqlite')\nquery = '''\nSELECT Citizenship, AVG(Net_Worth_Millions) AS Avg_Net_Worth, \n       COUNT(*) AS Singer_Count, \n       MIN(Net_Worth_Millions) AS Min_Net_Worth, \n       MAX(Net_Worth_Millions) AS Max_Net_Worth\nFROM singer\nGROUP BY Citizenship\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf = df.sort_values('Avg_Net_Worth', ascending=False)\nbars = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Citizenship:N', sort=df['Citizenship'].tolist()),\n    y=alt.Y('Avg_Net_Worth:Q', title='Average Net Worth (Millions)'),\n    color=alt.Color('Avg_Net_Worth:Q', scale=alt.Scale(scheme='blues'), title='Average Net Worth'),\n    tooltip=[\n        alt.Tooltip('Citizenship:N', title='Citizenship'),\n        alt.Tooltip('Avg_Net_Worth:Q', title='Avg Net Worth (Millions)', format=',.2f'),\n        alt.Tooltip('Singer_Count:Q', title='Number of Singers'),\n        alt.Tooltip('Min_Net_Worth:Q', title='Minimum Net Worth (Millions)', format=',.2f'),\n        alt.Tooltip('Max_Net_Worth:Q', title='Maximum Net Worth (Millions)', format=',.2f')\n    ]\n)\nerror_bars = alt.Chart(df).mark_errorbar(extent='ci').encode(\n    x=alt.X('Citizenship:N', sort=df['Citizenship'].tolist()),\n    y=alt.Y('Min_Net_Worth:Q', title='Net Worth Range'),\n    y2='Max_Net_Worth:Q',\n    tooltip=[\n        alt.Tooltip('Min_Net_Worth:Q', title='Minimum Net Worth (Millions)', format=',.2f'),\n        alt.Tooltip('Max_Net_Worth:Q', title='Maximum Net Worth (Millions)', format=',.2f')\n    ]\n)\nchart = alt.layer(bars, error_bars).properties(\n    title='Comparison of Average Net Worth by Citizenship with Variability'\n)\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Bar Charts___grouped_bar_chart_with_error_bars___singer.py"
    },
    {
        "type": "type_D",
        "db_id": "tracking_software_problems",
        "chart_category": "Uncertainties And Trends",
        "chart_type": "error_bars_with_standard_deviation",
        "NLQ": "Can you make this chart more informative and visually appealing? I'd like to add tooltips so I can see the exact values when I hover over the points and error bars. Also, could you change the black dots to a nicer blue color and make them a bit larger? Finally, please add a title at the top that says \"Average Days to Resolve Problems by Category\" so people know what they're looking at right away.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/tracking_software_problems.sqlite')\n\nquery = '''\nSELECT\n    PCC.problem_category_description AS variety,\n    STRFTIME('%J', P.date_problem_closed) - STRFTIME('%J', P.date_problem_reported) AS yield\nFROM Problems AS P\nJOIN Problem_Log AS PL\n    ON P.problem_id = PL.problem_id\nJOIN Problem_Category_Codes AS PCC\n    ON PL.problem_category_code = PCC.problem_category_code\nWHERE\n    P.date_problem_closed IS NOT NULL AND P.date_problem_reported IS NOT NULL\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nerror_bars = alt.Chart(df).mark_errorbar(extent='stdev').encode(\n    x=alt.X('yield:Q', scale=alt.Scale(zero=False), title='Days to Close Problem'),\n    y=alt.Y('variety:N', title='Problem Category'),\n    tooltip=[\n        alt.Tooltip('variety:N', title='Problem Category'),\n        alt.Tooltip('yield:Q', aggregate='stdev', title='Standard Deviation')\n    ]\n)\n\npoints = alt.Chart(df).mark_point(filled=True, color='#1f77b4', size=75).encode(\n    x=alt.X('mean(yield):Q', title='Days to Close Problem'),\n    y=alt.Y('variety:N'),\n    tooltip=[\n        alt.Tooltip('variety:N', title='Problem Category'),\n        alt.Tooltip('mean(yield):Q', title='Mean Days to Close', format='.2f')\n    ]\n)\n\nchart = (error_bars + points).properties(\n    title=\"Average Days to Resolve Problems by Category\"\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Uncertainties And Trends___error_bars_with_standard_deviation___tracking_software_problems.py"
    },
    {
        "type": "type_D",
        "db_id": "workshop_paper",
        "chart_category": "Interactive Charts",
        "chart_type": "selection_histogram",
        "NLQ": "Can you make this chart more informative and visually appealing? I'd like to see the workshops sorted by their total submission count so we can easily identify the most popular ones. Also, could you use a more colorful palette instead of the default colors to better distinguish between acceptance results? It would be helpful to add titles to both charts - maybe \"Workshop Acceptance Rates\" for the main chart and \"Acceptance Result Breakdown\" for the smaller one. Finally, can you add tooltips so when I hover over a bar I can see details like the workshop name, acceptance result, count, and total submissions?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/workshop_paper.sqlite')\n\nquery = '''\nSELECT \n    w.Name AS Workshop_Name,\n    a.Result AS Acceptance_Result,\n    COUNT(*) AS Count\nFROM \n    Acceptance AS a\nJOIN \n    workshop AS w ON a.Workshop_ID = w.Workshop_ID\nGROUP BY \n    w.Name, a.Result\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\ndf_total = df.groupby('Workshop_Name').sum().reset_index()\ndf_sorted = df.merge(df_total, on='Workshop_Name', suffixes=('', '_Total')).sort_values(by='Count_Total', ascending=False)\n\nbrush = alt.selection_interval()\n\npoints = alt.Chart(df_sorted).mark_bar().encode(\n    x=alt.X('Workshop_Name:N', sort='-y'),\n    y='Count:Q',\n    color=alt.condition(brush, alt.Color('Acceptance_Result:N', scale=alt.Scale(scheme='set1')), alt.value('lightgray')),\n    tooltip=['Workshop_Name', 'Acceptance_Result', 'Count', alt.Tooltip('Count_Total', title='Total Submissions')]\n).add_params(\n    brush\n).properties(\n    title=\"Workshop Acceptance Rates\"\n)\n\nbars = alt.Chart(df_sorted).mark_bar().encode(\n    y='Acceptance_Result:N',\n    color=alt.Color('Acceptance_Result:N', scale=alt.Scale(scheme='set1')),\n    x='sum(Count):Q',\n    tooltip=['Acceptance_Result', 'sum(Count):Q']\n).transform_filter(\n    brush\n).properties(\n    title=\"Acceptance Result Breakdown\"\n)\n\npoints & bars",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___selection_histogram___workshop_paper.py"
    },
    {
        "type": "type_D",
        "db_id": "climbing",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_cumulative_sum",
        "NLQ": "Can you make this line chart more visually appealing? I'd like the line to be thicker, maybe 3 pixels, and change the color to teal. Also, could you add circular markers at each data point so I can see exactly where each mountain contributes to the cumulative height? One more thing - can you label the x-axis as \"Mountain ID\" to make it clearer what those numbers represent?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/climbing.sqlite')\nquery = '''\nSELECT Mountain_ID, Height\nFROM mountain\nORDER BY Mountain_ID;\n'''\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df, width=600).mark_line(\n    strokeWidth=3,\n    color='#008080'\n).transform_window(\n    sort=[{'field': 'Mountain_ID'}],\n    frame=[None, 0],\n    cumulative_height='sum(Height)'\n).encode(\n    x=alt.X('Mountain_ID:O', title='Mountain ID'),\n    y='cumulative_height:Q'\n)\n\npoints = alt.Chart(df).mark_point(\n    color='#008080',\n    filled=True,\n    size=50\n).transform_window(\n    sort=[{'field': 'Mountain_ID'}],\n    frame=[None, 0],\n    cumulative_height='sum(Height)'\n).encode(\n    x=alt.X('Mountain_ID:O', title='Mountain ID'),\n    y='cumulative_height:Q'\n)\nfinal_chart = chart + points\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_cumulative_sum___climbing.py"
    },
    {
        "type": "type_D",
        "db_id": "company_1",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_custom_order",
        "NLQ": "Hey, this chart showing the project hours is useful, but I was thinking, would it be possible to change it from a line chart to a bar chart? I think it would be easier to compare the hours across projects if we used bars instead of a line. Also, right now it's ordered by project number, but it would be super helpful if we could sort it by the total hours worked. That way, I could quickly see which projects are taking up the most time. It would just make it easier to quickly understand which projects are the most demanding.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/company_1.sqlite')\n\nquery = '''\nSELECT\n    p.Pname AS Project_Name,\n    p.Pnumber AS Project_Number,\n    SUM(w.Hours) AS Total_Hours\nFROM\n    works_on AS w\nJOIN\n    project AS p ON w.Pno = p.Pnumber\nGROUP BY\n    p.Pnumber, p.Pname\nORDER BY\n    p.Pnumber\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X(\"Project_Number:O\", sort=alt.EncodingSortField(field=\"Total_Hours\", order='descending')).title(\"Project Number\"),\n    y=alt.Y(\"Total_Hours:Q\").title(\"Total Hours Worked\"),\n    tooltip=[\"Project_Name\", \"Total_Hours\", \"Project_Number\"]\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_custom_order___company_1.py"
    },
    {
        "type": "type_D",
        "db_id": "course_teach",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_datum_for_color",
        "NLQ": "Hi, this chart is helpful in showing the trend of average teacher ID and grade across different course ID ranges. However, the labels are a bit confusing. Could we change \"IMDB_Rating\" on the x-axis to something like \"Course ID Range\" to make it clearer what we are looking at? Also, the y-axis title \"Mean of US and Worldwide Gross\" doesn't really make sense in this context, maybe we could make that more generic, like \"Average Value\"? Could you add a title to the chart that explains what we're looking at, something like \"Average Teacher ID and Grade by Course ID Range\"? It would also be great if we could see the exact average values when we hover over the lines, with the numbers formatted to two decimal places. And could you add points on the lines to make it easier to see where the data points actually are? That would make it much easier to get precise numbers from the visualization.",
        "code": "import altair as alt\nfrom vega_datasets import data\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/course_teach.sqlite')\n\nquery = '''\nSELECT C.Course_ID as Course_ID, T.Teacher_ID as Teacher_ID, CA.Grade as Grade\nFROM Course AS C\nJOIN course_arrange AS CA ON C.Course_ID = CA.Course_ID\nJOIN Teacher AS T ON CA.Teacher_ID = T.Teacher_ID;\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nchart = alt.Chart(df).mark_line(point=True).encode(\n    alt.X(\"Course_ID:Q\").bin(True).title(\"Course ID Range\"),\n    alt.Y(alt.repeat(\"layer\"), aggregate=\"mean\", title=\"Average Value\"),\n    color=alt.datum(alt.repeat(\"layer\")),\n    tooltip=[alt.Tooltip('Course_ID:Q', bin=True, title='Course ID Range'),\n             alt.Tooltip('mean_Teacher_ID:Q', title='Average Teacher ID', format=\".2f\"),\n             alt.Tooltip('mean_Grade:Q', title='Average Grade', format=\".2f\")]\n).repeat(\n    layer=[\"Teacher_ID\", \"Grade\"]\n).transform_aggregate(\n    mean_Teacher_ID='mean(Teacher_ID)',\n    mean_Grade='mean(Grade)',\n    groupby=['Course_ID']\n)\n\nchart = chart.properties(\n    title='Average Teacher ID and Grade by Course ID Range'\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_datum_for_color___course_teach.py"
    },
    {
        "type": "type_D",
        "db_id": "performance_attendance",
        "chart_category": "Scatter Plots",
        "chart_type": "simple_scatter_plot_with_labels",
        "NLQ": "This scatter plot is helpful to see the attendance at different locations, but it's a little hard to quickly compare which locations have the highest and lowest attendance. Could we maybe sort the locations based on attendance, so the ones with the highest attendance are at the top? Also, when I look at the points, it's a bit tricky to read the exact attendance number just from the axis. Would it be possible to add a little popup or something that shows the exact attendance when I hover over each point? And could you make the dots bigger and blue so they stand out more? That would make it much easier to see the data points clearly.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/performance_attendance.sqlite')\n\nquery = '''\nSELECT Location, Attendance\nFROM performance\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\ndf = df.sort_values('Attendance', ascending=False)\n\npoints = alt.Chart(df).mark_point(color='steelblue', size=100).encode(\n    x='Attendance:Q',\n    y=alt.Y('Location:N', sort=None),\n    tooltip=['Location', 'Attendance']\n)\n\ntext = points.mark_text(\n    align='left',\n    baseline='middle',\n    dx=7\n).encode(\n    text='Location:N'\n)\n\npoints + text",
        "original_code_path": "./vis_bench/vis_modify/Scatter Plots___simple_scatter_plot_with_labels___performance_attendance.py"
    },
    {
        "type": "type_D",
        "db_id": "pilot_record",
        "chart_category": "Simple Charts",
        "chart_type": "simple_bar_chart",
        "NLQ": "Can you make this bar chart more readable? The years on the x-axis are hard to see - could you rotate them a bit? Also, please add a title to the y-axis that says \"Total Flights\" and make the bars blue instead of the default color. It would be helpful to add tooltips so I can see the exact number of flights when I hover over each bar. Finally, can you make the chart a bit wider and taller so it's easier to view?",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/pilot_record.sqlite')\n\nquery = '''\nSELECT \n    SUBSTR(Date, 1, 4) AS Year,\n    COUNT(*) AS Total_Flights\nFROM pilot_record\nGROUP BY Year\nORDER BY Year\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_bar(color='steelblue').encode(\n    x=alt.X('Year:N', title='Year', axis=alt.Axis(labelAngle=-45)),\n    y=alt.Y('Total_Flights:Q', title='Total Flights'),\n    tooltip=[\n        alt.Tooltip('Year:N', title='Year'),\n        alt.Tooltip('Total_Flights:Q', title='Total Flights')\n    ]\n).properties(\n    width=600,\n    height=400\n)\n\nchart",
        "original_code_path": "./vis_bench/vis_modify/Simple Charts___simple_bar_chart___pilot_record.py"
    },
    {
        "type": "type_D",
        "db_id": "products_for_hire",
        "chart_category": "Interactive Charts",
        "chart_type": "interactive_legend",
        "NLQ": "Can you make this chart easier to understand? I'd like to see the payment types sorted by amount from highest to lowest. Also, could you change the color scheme to use shades of blue instead of the current mix of colors? And it would be helpful if I could see the exact payment amounts when I hover over each bar.",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/products_for_hire.sqlite')\n\nquery = '''\nSELECT \n    payment_type_code AS Payment_Type,\n    SUM(amount_paid) AS Total_Amount_Paid\nFROM Payments\nGROUP BY payment_type_code\nORDER BY Total_Amount_Paid DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\n\nconn.close()\n\nselection = alt.selection_point(fields=['Payment_Type'], bind='legend')\n\nchart = alt.Chart(df).mark_bar().encode(\n    x=alt.X('Payment_Type:N', title='Payment Type', sort='-y'),\n    y=alt.Y('Total_Amount_Paid:Q', title='Total Amount Paid'),\n    color=alt.Color('Payment_Type:N', scale=alt.Scale(scheme='blues')),\n    opacity=alt.condition(selection, alt.value(1), alt.value(0.2)),\n    tooltip=[alt.Tooltip('Payment_Type:N', title='Payment Type'),\n             alt.Tooltip('Total_Amount_Paid:Q', title='Total Amount Paid')]\n).add_params(\n    selection\n).properties(\n    title='Total Amount Paid by Payment Type'\n)\n\nchart.show()",
        "original_code_path": "./vis_bench/vis_modify/Interactive Charts___interactive_legend___products_for_hire.py"
    },
    {
        "type": "type_D",
        "db_id": "cre_Docs_and_Epenses",
        "chart_category": "Line Charts",
        "chart_type": "line_chart_with_datum_for_color",
        "NLQ": "Can you make this line chart easier to read? I'd like thicker lines and add points to highlight the data. Also, please label the x-axis as \"IMDB Rating Bins\" and the y-axis as \"Average Gross Revenue (USD)\" instead of the current generic labels. It would be helpful if I could hover over the points to see the exact average US Gross and Worldwide Gross values for each rating bin, formatted with dollar signs.",
        "code": "import altair as alt\nimport sqlite3\nimport pandas as pd\n\nconn = sqlite3.connect('database/cre_Docs_and_Epenses.sqlite')\n\nquery = '''\nSELECT\n    Document_ID as IMDB_Rating,\n    Project_ID * 100000 as US_Gross,\n    Project_ID * 150000 as Worldwide_Gross\nFROM Documents\nLIMIT 10;\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nbase = alt.Chart(df).encode(\n    alt.X(\"IMDB_Rating:Q\").bin(True).title(\"IMDB Rating Bins\"),\n    color=alt.datum(alt.repeat(\"layer\")),\n)\n\nline = base.mark_line(strokeWidth=3).encode(\n    alt.Y(alt.repeat(\"layer\"), type='quantitative')\n        .aggregate(\"mean\")\n        .title(\"Average Gross Revenue (USD)\"),\n)\n\npoints = base.mark_point(filled=True, size=80).encode(\n    alt.Y(alt.repeat(\"layer\"), type='quantitative').aggregate(\"mean\")\n)\n\nalt.layer(line, points).encode(\n    tooltip=[\n        alt.Tooltip(\"mean(US_Gross):Q\", format=\"$,.2f\", title=\"Average US Gross\"),\n        alt.Tooltip(\"mean(Worldwide_Gross):Q\", format=\"$,.2f\", title=\"Average Worldwide Gross\")\n    ]\n).repeat(\n    layer=[\"US_Gross\", \"Worldwide_Gross\"]\n)",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___line_chart_with_datum_for_color___cre_Docs_and_Epenses.py"
    },
    {
        "type": "type_D",
        "db_id": "game_1",
        "chart_category": "Line Charts",
        "chart_type": "step_chart",
        "NLQ": "Can you make this step chart more visually appealing? I'd like the line to be thicker and in teal color. Also, could you add markers at each data point so it's easier to see the exact values? It would be helpful if I could hover over both the line and markers to see the game type and total hours played. Thanks!",
        "code": "import sqlite3\nimport pandas as pd\nimport altair as alt\n\nconn = sqlite3.connect('database/game_1.sqlite')\n\nquery = '''\nSELECT VG.GType AS Game_Type, SUM(PG.Hours_Played) AS Total_Hours_Played\nFROM Plays_Games AS PG\nJOIN Video_Games AS VG ON PG.GameID = VG.GameID\nGROUP BY VG.GType\nORDER BY Total_Hours_Played DESC\n'''\n\ndf = pd.read_sql_query(query, conn)\nconn.close()\n\nchart = alt.Chart(df).mark_line(interpolate='step-after', strokeWidth=3, color='teal').encode(\n    x=alt.X('Game_Type:N', title='Game Type'),\n    y=alt.Y('Total_Hours_Played:Q', title='Total Hours Played'),\n    tooltip=[\n        alt.Tooltip('Game_Type:N', title='Game Type'),\n        alt.Tooltip('Total_Hours_Played:Q', title='Total Hours Played')\n    ]\n).properties(\n    title='Total Hours Played by Game Type'\n)\n\nmarkers = alt.Chart(df).mark_point(filled=True, size=60, color='teal').encode(\n    x=alt.X('Game_Type:N', title='Game Type'),\n    y=alt.Y('Total_Hours_Played:Q', title='Total Hours Played'),\n    tooltip=[\n        alt.Tooltip('Game_Type:N', title='Game Type'),\n        alt.Tooltip('Total_Hours_Played:Q', title='Total Hours Played')\n    ]\n)\n\nfinal_chart = chart + markers\n\nfinal_chart",
        "original_code_path": "./vis_bench/vis_modify/Line Charts___step_chart___game_1.py"
    }
]